<!DOCTYPE html>
<html lang="zh" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Golang åŸºç¡€è¯­æ³• | Blaine&#39;s Blog</title>
<meta name="keywords" content="Golang åŸºç¡€è¯­æ³•">
<meta name="description" content="Golang åŸºç¡€è¯­æ³•">
<meta name="author" content="Blaine">
<link rel="canonical" href="https://Bin-lin-rgb.github.io/posts/go/base/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.css" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.js" onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://Bin-lin-rgb.github.io/img/icon.png">
<link rel="icon" type="image/png" sizes="16x16" href="https://Bin-lin-rgb.github.io/img/icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://Bin-lin-rgb.github.io/img/icon.png">
<link rel="apple-touch-icon" href="https://Bin-lin-rgb.github.io/img/icon.png">
<link rel="mask-icon" href="https://Bin-lin-rgb.github.io/img/icon.png">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css">
<script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.3/dist/jquery.min.js"></script>



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = ""; 
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
<meta property="og:title" content="Golang åŸºç¡€è¯­æ³•" />
<meta property="og:description" content="Golang åŸºç¡€è¯­æ³•" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://Bin-lin-rgb.github.io/posts/go/base/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-11-30T15:55:23+08:00" />
<meta property="article:modified_time" content="2021-11-30T15:55:23+08:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Golang åŸºç¡€è¯­æ³•"/>
<meta name="twitter:description" content="Golang åŸºç¡€è¯­æ³•"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [

        {
          "@type": "ListItem",
          "position":  1 ,
          "name": "ğŸ“šæ–‡ç« ",
          "item": "https://Bin-lin-rgb.github.io/posts/"
        },

        {
          "@type": "ListItem",
          "position":  2 ,
          "name": "ğŸ¥‡ Golang",
          "item": "https://Bin-lin-rgb.github.io/posts/go/"
        }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "Golang åŸºç¡€è¯­æ³•",
      "item": "https://Bin-lin-rgb.github.io/posts/go/base/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Golang åŸºç¡€è¯­æ³•",
  "name": "Golang åŸºç¡€è¯­æ³•",
  "description": "Golang åŸºç¡€è¯­æ³•",
  "keywords": [
    "Golang åŸºç¡€è¯­æ³•"
  ],
  "articleBody": "Base\ngo å¸¸ç”¨å‘½ä»¤ build: ç¼–è¯‘åŒ…å’Œä¾èµ– clean: ç§»é™¤å¯¹è±¡æ–‡ä»¶ doc: æ˜¾ç¤ºåŒ…æˆ–è€…ç¬¦å·çš„æ–‡æ¡£ env: æ‰“å°goçš„ç¯å¢ƒä¿¡æ¯ bug: å¯åŠ¨é”™è¯¯æŠ¥å‘Š fix: è¿è¡Œgo tool fix fmt: è¿è¡Œgofmtè¿›è¡Œæ ¼å¼åŒ– generate: ä»processing sourceç”Ÿæˆgoæ–‡ä»¶ get: ä¸‹è½½å¹¶å®‰è£…åŒ…å’Œä¾èµ– install: ç¼–è¯‘å¹¶å®‰è£…åŒ…å’Œä¾èµ– list: åˆ—å‡ºåŒ… run: ç¼–è¯‘å¹¶è¿è¡Œgoç¨‹åº test: è¿è¡Œæµ‹è¯• tool: è¿è¡Œgoæä¾›çš„å·¥å…· version: æ˜¾ç¤ºgoçš„ç‰ˆæœ¬ vet: è¿è¡Œgo tool vet æ ‡è¯†ç¬¦çš„ç»„æˆ 1.æ ‡è¯†ç¬¦ç”±æ•°å­—ã€å­—æ¯å’Œä¸‹åˆ’çº¿ (_) ç»„æˆã€‚\n2.åªèƒ½ä»¥å­—æ¯å’Œä¸‹åˆ’çº¿ (_) å¼€å¤´ã€‚\n3.æ ‡è¯†ç¬¦åŒºåˆ†å¤§å°å†™ã€‚\nGoæ˜¯ä¸€é—¨åŒºåˆ†å¤§å°å†™çš„è¯­è¨€ å‘½åè§„åˆ™æ¶‰åŠå˜é‡ã€å¸¸é‡ã€å…¨å±€å‡½æ•°ã€ç»“æ„ã€æ¥å£ã€æ–¹æ³•ç­‰çš„å‘½åã€‚\nGOè¯­è¨€ä»è¯­æ³•å±‚é¢è¿›è¡Œäº†ä»¥ä¸‹é™å®šï¼š\nä»»ä½•éœ€è¦å¯¹å¤–æš´éœ²çš„åå­—å¿…é¡»ä»¥å¤§å†™å­—æ¯å¼€å¤´ï¼Œ\nä¸éœ€è¦å¯¹å¤–æš´éœ²çš„åˆ™åº”è¯¥ä»¥å°å†™å­—æ¯å¼€å¤´ã€‚\nçŸ­å˜é‡å£°æ˜åªèƒ½åœ¨å‡½æ•°é‡Œä½¿ç”¨ã€‚\nåŒ…åç§° ä¿æŒpackÄgeçš„åå­—å’Œç›®å½•ä¿æŒä¸€è‡´ï¼Œå°½é‡é‡‡å–æœ‰æ„ä¹‰çš„åŒ…åï¼Œç®€çŸ­ï¼Œæœ‰æ„ä¹‰ï¼Œå°½é‡å’Œæ ‡å‡†åº“ä¸è¦å†²çªã€‚==åŒ…ååº”è¯¥ä¸ºå°å†™å•è¯==ï¼Œä¸è¦ä½¿ç”¨ä¸‹çº¿æˆ–è€…æ··åˆå¤§å°å†™ã€‚\npackage dao package service æ–‡ä»¶å‘½å å°½é‡é‡‡å–æœ‰æ„ä¹‰çš„æ–‡ä»¶åï¼Œç®€çŸ­ï¼Œæœ‰æ„ä¹‰ï¼Œ==åº”è¯¥ä¸ºå°å†™å•è¯==ï¼Œä½¿ç”¨ä¸‹åˆ’çº¿åˆ†éš”å„ä¸ªå•è¯ã€‚\ncustomer_dao.go ç»“æ„ä½“å‘½å ==é‡‡ç”¨é©¼å³°å‘½åæ³•==ï¼Œé¦–å­—æ¯æ ¹æ®è®¿é—®æ§åˆ¶å¤§å†™æˆ–è€…å°å†™\nstructç”³æ˜å’Œåˆå§‹åŒ–æ ¼å¼é‡‡ç”¨å¤šè¡Œï¼Œä¾‹å¦‚ä¸‹é¢ï¼š\ntype Customerorder struct{ Name string Address string } order:=CustomerOrder{\"tom\",\"åŒ—äº¬æµ·æ·€\"} é”™è¯¯å¤„ç† é”™è¯¯å¤„ç†çš„åŸåˆ™å°±æ˜¯ä¸èƒ½ä¸¢å¼ƒä»»ä½•æœ‰è¿”å› err çš„è°ƒç”¨ï¼Œä¸è¦ä½¿ç”¨_ä¸¢å¼ƒï¼Œå¿…é¡»å…¨éƒ¨å¤„ç†ã€‚\næ¥æ”¶åˆ°é”™è¯¯ï¼Œ\nè¦ä¹ˆè¿”å› err, æˆ–è€…ä½¿ç”¨ log è®°å½•ä¸‹æ¥å°½æ—©return , ä¸€æ—¦æœ‰é”™è¯¯å‘ç”Ÿï¼Œé©¬ä¸Šè¿”å› å°½é‡ä¸è¦ä½¿ç”¨ panic ,é™¤éä½ çŸ¥é“ä½ åœ¨åšä»€ä¹ˆï¼Œ é”™è¯¯æè¿°å¦‚æœæ˜¯è‹±æ–‡å¿…é¡»ä¸ºå°å†™ï¼Œä¸éœ€è¦æ ‡ç‚¹ç»“å°¾ï¼Œé‡‡ç”¨ç‹¬ç«‹çš„é”™è¯¯æµè¿›è¡Œå¤„ç†. //æ­£ç¡®å†™æ³• if err != nil{ //é”™è¯¯å¤„ç† return } //æ­£å¸¸ä»£ç  å•å…ƒæµ‹è¯• å•å…ƒæµ‹è¯•æ–‡ä»¶åå‘½åè§„èŒƒä¸ºexample_test.goæµ‹è¯•ç”¨ä¾‹çš„å‡½æ•°åç§°å¿…é¡»ä»¥Testå¼€å¤´ï¼Œä¾‹å¦‚ï¼šTestExample\næ¯ä¸ªé‡è¦çš„å‡½æ•°éƒ½è¦é¦–å…ˆç¼–å†™æµ‹è¯•ç”¨ä¾‹ï¼Œæµ‹è¯•ç”¨ä¾‹å’Œæ­£è§„ä»£ç ä¸€èµ·æäº¤æ–¹ä¾¿è¿›è¡Œå›å½’æµ‹è¯•ã€‚\nå¸¸é‡ å®šä¹‰å¸¸é‡çš„è¯­æ³•\nå®šä¹‰ä¸€ä¸ªå¸¸é‡ä½¿ç”¨constå…³é”®å­—ï¼Œè¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š\nconst constantName [type]=value\nconst: å®šä¹‰å¸¸é‡å…³é”®å­— constantName: å¸¸é‡åç§° type: å¸¸é‡ç±»å‹ value: å¸¸é‡çš„å€¼ iota iotaæ¯”è¾ƒç‰¹æ®Šï¼Œå¯ä»¥è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªå¯è¢«ç¼–è¯‘å™¨ä¿®æ”¹çš„å¸¸é‡ï¼Œå®ƒé»˜è®¤å¼€å§‹å€¼æ˜¯g,æ¯è°ƒç”¨ä¸€æ¬¡åŠ 1ã€‚é‡åˆ°constå…³é”®å­—æ—¶è¢«é‡ç½®ä¸º0ã€‚ å®ä¾‹\npackage Base import \"fmt\" func Iota() { const ( a1 = iota a2 = iota a3 = iota ) fmt.Printf(\"a1:%v\\n\", a1) fmt.Printf(\"a2:%v\\n\", a2) fmt.Printf(\"a3:%v\\n\", a3) } ======== a1:0 a2:1 a3:2 è·³è¿‡1 func Iota() { const ( a1 = iota _ a3 = iota ) fmt.Printf(\"a1:%v\\n\", a1) fmt.Printf(\"a3:%v\\n\", a3) } ====== a1:0 a3:2 è·³è¿‡2 func Iota() { const ( a1 = iota a2 = 100 a3 = iota ) fmt.Printf(\"a1:%v\\n\", a1) fmt.Printf(\"a2:%v\\n\", a2) fmt.Printf(\"a3:%v\\n\", a3) } ====== a1:0 a2:100 a3:2 æ•°æ®ç±»å‹ æŒ‡é’ˆã€æ•°ç»„ã€åˆ‡ç‰‡ç±»å‹\nfunc DataType() { num := 200 p := \u0026num fmt.Printf(\"%T\\n\", p) //\t*int æŒ‡é’ˆ arr := [3]int{1, 2, 3} fmt.Printf(\"%T\\n\", arr) //[3]int æ•°ç»„ arr1 := []int{1, 2, 3} fmt.Printf(\"%T\\n\", arr1) //[]int åˆ‡ç‰‡ } bool ç±»å‹ bool ç±»å‹ï¼šä¸èƒ½ä½¿ç”¨ 0 å’Œ é0 è¡¨ç¤ºçœŸå‡\n//\tBool b := 0 if b { //å¤±è´¥ï¼ fmt.Println(b) } æ•°å­—ç±»å‹ go è¯­è¨€æ”¯æŒæ•´å‹å’Œæµ®ç‚¹å‹æ•°å­—ï¼Œå¹¶ä¸”åŸç”Ÿæ”¯æŒå¤æ•°ï¼Œå…¶ä¸­ä½çš„è¿ç®—é‡‡ç”¨è¡¥ç ã€‚\næœ‰åŸºäºæ¶æ„çš„ç±»å‹ï¼Œä¾‹å¦‚ï¼šintã€uintå’Œuintptrã€‚ è¿™äº›ç±»å‹çš„é•¿åº¦éƒ½æ˜¯æ ¹æ®è¿è¡Œç¨‹åºæ‰€åœ¨çš„æ“ä½œç³»ç»Ÿç±»å‹æ‰€å†³å®šçš„ï¼š\nintå’Œuintåœ¨32ä½æ“ä½œç³»ç»Ÿä¸Šï¼Œå®ƒä»¬å‡ä½¿ç”¨32ä½(4ä¸ªå­—èŠ‚)ï¼Œåœ¨64ä½æ“ä½œç³»ç»Ÿä¸Šï¼Œå®ƒä»¬å‡ä½¿ç”¨64ä½(8ä¸ªå­—èŠ‚)ã€‚\nuintptrçš„é•¿åº¦è¢«è®¾å®šä¸ºè¶³å¤Ÿå­˜æ”¾ä¸€ä¸ªæŒ‡é’ˆå³å¯ã€‚\ngoè¯­è¨€ä¸­æ²¡æœ‰floatç±»å‹ã€‚(Goè¯­è¨€ä¸­åªæœ‰float32å’Œfloat64)\næ²¡æœ‰ double ç±»å‹ã€‚\nä¸æ“ä½œç³»ç»Ÿæ¶æ„æ— å…³çš„ç±»å‹éƒ½æœ‰å›ºå®šçš„å¤§å°ï¼Œå¹¶åœ¨ç±»å‹çš„åç§°ä¸­å°±å¯ä»¥çœ‹å‡ºæ¥ã€‚\næŒºå¤šçš„å°±ä¸ä¸€ä¸€æµ‹äº†ã€‚\n//\tæ•°å­—ç±»å‹ var i8 int8 fmt.Printf(\"%T %db %v~%v\\n\", i8, unsafe.Sizeof(i8), math.MinInt8, math.MaxInt8) //int8 1b -128~127 var i int fmt.Printf(\"%T %db %v~%v\\n\", i, unsafe.Sizeof(i), math.MinInt, math.MaxInt) //int 8b -9223372036854775808~9223372036854775807 å­—ç¬¦ä¸² åå¼•å·å¯æ¢è¡Œ\nå­—ç¬¦ä¸²è¿æ¥ åŠ å· ä½¿ç”¨ fmt.Sprintf() ä½¿ç”¨ strings.Join() ä½¿ç”¨ buffer.WriteString() //\tString str1 := \"Hello,\" str2 := \"Tom\" sprintf := fmt.Sprintf(\"%s%s\", str1, str2) fmt.Println(sprintf) //\tstrings.Join join := strings.Join([]string{\"Hello\", \"Amy\"}, \",\") fmt.Println(join)\t//\tbuffer.WriteString var buffer bytes.Buffer buffer.WriteString(\"Hello\") buffer.WriteString(\",\") buffer.WriteString(\"DaMing\") fmt.Printf(\"%v\\n\", buffer.String()) 1ã€golangé‡Œé¢çš„å­—ç¬¦ä¸²éƒ½æ˜¯ä¸å¯å˜çš„ï¼Œæ¯æ¬¡è¿ç®—éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥ä¼šäº§ç”Ÿå¾ˆå¤šä¸´æ—¶çš„æ— ç”¨çš„å­—ç¬¦ä¸²ï¼Œä¸ä»…æ²¡æœ‰ç”¨ï¼Œè¿˜ä¼šç»™å¸¦æ¥é¢å¤–çš„è´Ÿæ‹…ï¼Œæ‰€ä»¥æ€§èƒ½æ¯”è¾ƒå·®ã€‚\n2ã€å†…éƒ¨ä½¿ç”¨[]byteå®ç°ï¼Œä¸åƒç›´æ¥è¿ç®—ç¬¦è¿™ç§ä¼šäº§ç”Ÿå¾ˆå¤šä¸´æ—¶çš„å­—ç¬¦ä¸²ï¼Œä½†æ˜¯å†…éƒ¨çš„é€»è¾‘æ¯”è¾ƒå¤æ‚ï¼Œæœ‰å¾ˆå¤šé¢å¤–çš„åˆ¤æ–­ï¼Œè¿˜ç”¨åˆ°äº†interfaceï¼Œæ‰€ä»¥æ€§èƒ½ä¹Ÿä¸æ˜¯å¾ˆå¥½\n3ã€joinä¼šå…ˆæ ¹æ®å­—ç¬¦ä¸²æ•°ç»„çš„å†…å®¹ï¼Œè®¡ç®—å‡ºä¸€ä¸ªæ‹¼æ¥ä¹‹åçš„é•¿åº¦ï¼Œç„¶åç”³è¯·å¯¹åº”å¤§å°çš„å†…å­˜ï¼Œä¸€ä¸ªä¸€ä¸ªå­—ç¬¦ä¸²å¡«å…¥ï¼Œåœ¨å·²æœ‰ä¸€ä¸ªæ•°ç»„çš„æƒ…å†µä¸‹ï¼Œè¿™ç§æ•ˆç‡ä¼šå¾ˆé«˜ï¼Œä½†æ˜¯æœ¬æ¥æ²¡æœ‰ï¼Œå»æ„é€ è¿™ä¸ªæ•°æ®çš„ä»£ä»·ä¹Ÿä¸å°ã€‚\n4ã€è¿™ä¸ªæ¯”è¾ƒç†æƒ³ï¼Œå¯ä»¥å½“æˆå¯å˜å­—ç¬¦ä½¿ç”¨ï¼Œå¯¹å†…å­˜çš„å¢é•¿ä¹Ÿæœ‰ä¼˜åŒ–ï¼Œå¦‚æœèƒ½é¢„ä¼°å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œè¿˜å¯ä»¥ç”¨buffer.Grow()æ¥å£æ¥è®¾ç½®capacity\nå­—ç¬¦ä¸²åˆ‡ç‰‡æ“ä½œ // å­—ç¬¦åˆ‡ç‰‡ str3 := \"Hello world!\" m, n := 3, 6 println(str3[m]) println(str3[:m]) // [0,3) println(str3[m:n]) println(str3[:n]) å­—ç¬¦ä¸²å‡½æ•° æ ¼å¼åŒ–è¾“å‡º https://pkg.go.dev/fmt?utm_source=godoc\nhttps://www.cnblogs.com/yinzhengjie/p/7680829.html\né€šç”¨ï¼š\n1 %v å€¼çš„é»˜è®¤æ ¼å¼è¡¨ç¤ºã€‚å½“è¾“å‡ºç»“æ„ä½“æ—¶ï¼Œæ‰©å±•æ ‡å¿—ï¼ˆ%+vï¼‰ä¼šæ·»åŠ å­—æ®µå 2 %#v å€¼çš„Goè¯­æ³•è¡¨ç¤º 3 %T å€¼çš„ç±»å‹çš„Goè¯­æ³•è¡¨ç¤º 4 %% ç™¾åˆ†å· //\tæ ¼å¼åŒ–è¾“å‡º user := User{ Name: \"David\", Age: 20, Gender: \"male\", } fmt.Printf(\"%v\\n\", user) // {David 20 male} fmt.Printf(\"%#v\\n\", user) // Base.User{Name:\"David\", Age:20, Gender:\"male\"} å¸ƒå°”å€¼ï¼š\n%t å•è¯trueæˆ–false æ•´æ•°ï¼š\n1 %b è¡¨ç¤ºä¸ºäºŒè¿›åˆ¶ 2 %c è¯¥å€¼å¯¹åº”çš„unicodeç å€¼[char] 3 %d è¡¨ç¤ºä¸ºåè¿›åˆ¶ 4 %o è¡¨ç¤ºä¸ºå…«è¿›åˆ¶ 5 %q è¯¥å€¼å¯¹åº”çš„å•å¼•å·æ‹¬èµ·æ¥çš„goè¯­æ³•å­—ç¬¦å­—é¢å€¼ï¼Œå¿…è¦æ—¶ä¼šé‡‡ç”¨å®‰å…¨çš„è½¬ä¹‰è¡¨ç¤º 6 %x è¡¨ç¤ºä¸ºåå…­è¿›åˆ¶ï¼Œä½¿ç”¨a-f 7 %X è¡¨ç¤ºä¸ºåå…­è¿›åˆ¶ï¼Œä½¿ç”¨A-F 8 %U è¡¨ç¤ºä¸ºUnicodeæ ¼å¼ï¼šU+1234ï¼Œç­‰ä»·äº\"U+%04X\" æµ®ç‚¹æ•°ã€å¤æ•°çš„ä¸¤ä¸ªç»„åˆ†ï¼š\n1 %b æ— å°æ•°éƒ¨åˆ†ã€äºŒè¿›åˆ¶æŒ‡æ•°çš„ç§‘å­¦è®¡æ•°æ³•ï¼Œå¦‚-123456p-78ï¼›å‚è§strconv.FormatFloat %e ç§‘å­¦è®¡æ•°æ³•ï¼Œå¦‚-1234.456e+78 %E ç§‘å­¦è®¡æ•°æ³•ï¼Œå¦‚-1234.456E+78 %f æœ‰å°æ•°éƒ¨åˆ†ä½†æ— æŒ‡æ•°éƒ¨åˆ†ï¼Œå¦‚123.456 %F ç­‰ä»·äº%f %g æ ¹æ®å®é™…æƒ…å†µé‡‡ç”¨%eæˆ–%fæ ¼å¼ï¼ˆä»¥è·å¾—æ›´ç®€æ´ã€å‡†ç¡®çš„è¾“å‡ºï¼‰ 2 %G æ ¹æ®å®é™…æƒ…å†µé‡‡ç”¨%Eæˆ–%Fæ ¼å¼ï¼ˆä»¥è·å¾—æ›´ç®€æ´ã€å‡†ç¡®çš„è¾“å‡ºï¼‰ å­—ç¬¦ä¸²å’Œ[]byteï¼š\n%s ç›´æ¥è¾“å‡ºå­—ç¬¦ä¸²æˆ–è€…[]byte %q è¯¥å€¼å¯¹åº”çš„åŒå¼•å·æ‹¬èµ·æ¥çš„goè¯­æ³•å­—ç¬¦ä¸²å­—é¢å€¼ï¼Œå¿…è¦æ—¶ä¼šé‡‡ç”¨å®‰å…¨çš„è½¬ä¹‰è¡¨ç¤º %x æ¯ä¸ªå­—èŠ‚ç”¨ä¸¤å­—ç¬¦åå…­è¿›åˆ¶æ•°è¡¨ç¤ºï¼ˆä½¿ç”¨a-fï¼‰ %X æ¯ä¸ªå­—èŠ‚ç”¨ä¸¤å­—ç¬¦åå…­è¿›åˆ¶æ•°è¡¨ç¤ºï¼ˆä½¿ç”¨A-Fï¼‰ æŒ‡é’ˆï¼š\n%p è¡¨ç¤ºä¸ºåå…­è¿›åˆ¶ï¼Œå¹¶åŠ ä¸Šå‰å¯¼çš„0x æ²¡æœ‰verb %uã€‚æ•´æ•°å¦‚æœæ˜¯æ— ç¬¦å·ç±»å‹è‡ªç„¶è¾“å‡ºä¹Ÿæ˜¯æ— ç¬¦å·çš„ã€‚ç±»ä¼¼çš„ï¼Œä¹Ÿæ²¡æœ‰å¿…è¦æŒ‡å®šæ“ä½œæ•°çš„å°ºå¯¸ï¼ˆint8ï¼Œint64ï¼‰ã€‚\nå®½åº¦é€šè¿‡ä¸€ä¸ªç´§è·Ÿåœ¨ç™¾åˆ†å·åé¢çš„åè¿›åˆ¶æ•°æŒ‡å®šï¼Œå¦‚æœæœªæŒ‡å®šå®½åº¦ï¼Œåˆ™è¡¨ç¤ºå€¼æ—¶é™¤å¿…éœ€ä¹‹å¤–ä¸ä½œå¡«å……ã€‚ç²¾åº¦é€šè¿‡ï¼ˆå¯èƒ½æœ‰çš„ï¼‰å®½åº¦åè·Ÿç‚¹å·åè·Ÿçš„åè¿›åˆ¶æ•°æŒ‡å®šã€‚å¦‚æœæœªæŒ‡å®šç²¾åº¦ï¼Œä¼šä½¿ç”¨é»˜è®¤ç²¾åº¦ï¼›å¦‚æœç‚¹å·åæ²¡æœ‰è·Ÿæ•°å­—ï¼Œè¡¨ç¤ºç²¾åº¦ä¸º0ã€‚ä¸¾ä¾‹å¦‚ä¸‹ï¼š\n%f: é»˜è®¤å®½åº¦ï¼Œé»˜è®¤ç²¾åº¦ %9f å®½åº¦9ï¼Œé»˜è®¤ç²¾åº¦ %.2f é»˜è®¤å®½åº¦ï¼Œç²¾åº¦2 %9.2f å®½åº¦9ï¼Œç²¾åº¦2 %9.f å®½åº¦9ï¼Œç²¾åº¦0 å®½åº¦å’Œç²¾åº¦æ ¼å¼åŒ–æ§åˆ¶çš„æ˜¯Unicodeç å€¼çš„æ•°é‡ï¼ˆä¸åŒäºCçš„printfï¼Œå®ƒçš„è¿™ä¸¤ä¸ªå› æ•°æŒ‡çš„æ˜¯å­—èŠ‚çš„æ•°é‡ï¼‰ã€‚ä¸¤è€…ä»»ä¸€ä¸ªæˆ–ä¸¤ä¸ªéƒ½å¯ä»¥ä½¿ç”¨â€™â€˜å·å–ä»£ï¼Œæ­¤æ—¶å®ƒä»¬çš„å€¼å°†è¢«å¯¹åº”çš„å‚æ•°ï¼ˆæŒ‰â€™â€˜å·å’Œverbå‡ºç°çš„é¡ºåºï¼Œå³æ§åˆ¶å…¶å€¼çš„å‚æ•°ä¼šå‡ºç°åœ¨è¦è¡¨ç¤ºçš„å€¼å‰é¢ï¼‰æ§åˆ¶ï¼Œè¿™ä¸ªæ“ä½œæ•°å¿…é¡»æ˜¯intç±»å‹ã€‚\nå¯¹äºå¤§å¤šæ•°ç±»å‹çš„å€¼ï¼Œå®½åº¦æ˜¯è¾“å‡ºçš„æœ€å°å­—ç¬¦æ•°ï¼Œå¦‚æœå¿…è¦æ˜¯ä¼šç”¨ç©ºæ ¼å¡«å……ã€‚å¯¹äºå­—ç¬¦ä¸²ï¼Œå®½åº¦æ˜¯è¾“å‡ºå­—ç¬¦æ•°ç›®çš„æœ€ä½æ•°é‡ï¼Œå¦‚æœå¿…è¦ä¼šæˆªæ–­å­—ç¬¦ä¸²ã€‚\nå¯¹äºæ•´æ•°ï¼Œå®½åº¦å’Œç²¾åº¦éƒ½è®¾ç½®è¾“å‡ºæ€»é•¿åº¦ã€‚é‡‡ç”¨ç²¾åº¦æ—¶è¡¨ç¤ºå³å¯¹é½å¹¶ç”¨0å¡«å……ï¼Œè€Œå®½åº¦é»˜è®¤è¡¨ç¤ºç”¨ç©ºæ ¼å¡«å……ã€‚\nå¯¹äºæµ®ç‚¹æ•°ï¼Œå®½åº¦è®¾ç½®è¾“å‡ºæ€»é•¿åº¦ï¼›ç²¾åº¦è®¾ç½®å°æ•°éƒ¨åˆ†é•¿åº¦ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ï¼Œé™¤äº†%g/%Gï¼Œæ­¤æ—¶ç²¾åº¦è®¾ç½®æ€»çš„æ•°å­—ä¸ªæ•°ã€‚ä¾‹å¦‚ï¼Œå¯¹æ•°å­—123.45ï¼Œæ ¼å¼%6.2f è¾“å‡º123.45ï¼›æ ¼å¼%.4gè¾“å‡º123.5ã€‚%eå’Œ%fçš„é»˜è®¤ç²¾åº¦æ˜¯6ï¼Œ%gçš„é»˜è®¤ç²¾åº¦æ˜¯å¯ä»¥å°†è¯¥å€¼åŒºåˆ†å‡ºæ¥éœ€è¦çš„æœ€å°æ•°å­—ä¸ªæ•°ã€‚\nå¯¹å¤æ•°ï¼Œå®½åº¦å’Œç²¾åº¦ä¼šåˆ†åˆ«ç”¨äºå®éƒ¨å’Œè™šéƒ¨ï¼Œç»“æœç”¨å°æ‹¬å·åŒ…è£¹ã€‚å› æ­¤%fç”¨äº1.2+3.4iè¾“å‡º(1.200000+3.400000i)ã€‚\nå…¶å®ƒflagï¼š\n1 + æ€»æ˜¯è¾“å‡ºæ•°å€¼çš„æ­£è´Ÿå·ï¼›å¯¹%qï¼ˆ%+qï¼‰ä¼šç”Ÿæˆå…¨éƒ¨æ˜¯ASCIIå­—ç¬¦çš„è¾“å‡ºï¼ˆé€šè¿‡è½¬ä¹‰ï¼‰ï¼› 2 - åœ¨è¾“å‡ºå³è¾¹å¡«å……ç©ºç™½è€Œä¸æ˜¯é»˜è®¤çš„å·¦è¾¹ï¼ˆå³ä»é»˜è®¤çš„å³å¯¹é½åˆ‡æ¢ä¸ºå·¦å¯¹é½ï¼‰ï¼› 3 # åˆ‡æ¢æ ¼å¼ï¼š 4 å…«è¿›åˆ¶æ•°å‰åŠ 0ï¼ˆ%#oï¼‰ï¼Œåå…­è¿›åˆ¶æ•°å‰åŠ 0xï¼ˆ%#xï¼‰æˆ–0Xï¼ˆ%#Xï¼‰ï¼ŒæŒ‡é’ˆå»æ‰å‰é¢çš„0xï¼ˆ%#pï¼‰ï¼› 5 å¯¹%qï¼ˆ%#qï¼‰ï¼Œå¦‚æœstrconv.CanBackquoteè¿”å›çœŸä¼šè¾“å‡ºåå¼•å·æ‹¬èµ·æ¥çš„æœªè½¬ä¹‰å­—ç¬¦ä¸²ï¼› 6 å¯¹%Uï¼ˆ%#Uï¼‰ï¼Œå¦‚æœå­—ç¬¦æ˜¯å¯æ‰“å°çš„ï¼Œä¼šåœ¨è¾“å‡ºUnicodeæ ¼å¼ã€ç©ºæ ¼ã€å•å¼•å·æ‹¬èµ·æ¥çš„goå­—é¢å€¼ï¼› 7 ' ' å¯¹æ•°å€¼ï¼Œæ­£æ•°å‰åŠ ç©ºæ ¼è€Œè´Ÿæ•°å‰åŠ è´Ÿå·ï¼› 8 å¯¹å­—ç¬¦ä¸²é‡‡ç”¨%xæˆ–%Xæ—¶ï¼ˆ% xæˆ–% Xï¼‰ä¼šç»™å„æ‰“å°çš„å­—èŠ‚ä¹‹é—´åŠ ç©ºæ ¼ï¼› 9 0 ä½¿ç”¨0è€Œä¸æ˜¯ç©ºæ ¼å¡«å……ï¼Œå¯¹äºæ•°å€¼ç±»å‹ä¼šæŠŠå¡«å……çš„0æ”¾åœ¨æ­£è´Ÿå·åé¢ï¼› verbä¼šå¿½ç•¥ä¸æ”¯æŒçš„flagã€‚ä¾‹å¦‚ï¼Œå› ä¸ºæ²¡æœ‰åè¿›åˆ¶åˆ‡æ¢æ¨¡å¼ï¼Œæ‰€ä»¥%#då’Œ%dçš„è¾“å‡ºæ˜¯ç›¸åŒçš„ã€‚\nå¯¹æ¯ä¸€ä¸ªç±»ä¼¼Printfçš„å‡½æ•°ï¼Œéƒ½æœ‰å¯¹åº”çš„Printå‹å‡½æ•°ï¼Œè¯¥å‡½æ•°ä¸æ¥å—æ ¼å¼å­—ç¬¦ä¸²ï¼Œå°±æ•ˆæœä¸Šç­‰ä»·äºå¯¹æ¯ä¸€ä¸ªå‚æ•°éƒ½æ˜¯ç”¨verb %vã€‚å¦ä¸€ä¸ªå˜ä½“Printlnå‹å‡½æ•°ä¼šåœ¨å„ä¸ªæ“ä½œæ•°çš„è¾“å‡ºä¹‹é—´åŠ ç©ºæ ¼å¹¶åœ¨æœ€åæ¢è¡Œã€‚\nä¸ç®¡verbå¦‚ä½•ï¼Œå¦‚æœæ“ä½œæ•°æ˜¯ä¸€ä¸ªæ¥å£å€¼ï¼Œé‚£ä¹ˆä¼šä½¿ç”¨æ¥å£å†…éƒ¨ä¿ç®¡çš„å€¼ï¼Œè€Œä¸æ˜¯æ¥å£ï¼Œå› æ­¤ï¼š\n1 /* 2 #!/usr/bin/env gorun 3 @author :yinzhengjie 4 Blog:http://www.cnblogs.com/yinzhengjie/tag/GO%E8%AF%AD%E8%A8%80%E7%9A%84%E8%BF%9B%E9%98%B6%E4%B9%8B%E8%B7%AF/ 5 EMAIL:y1053419035@qq.com 6 */ 7 8 package main 9 10 import \"fmt\" 11 12 func main() { 13 var name interface{} = \"yinzhengjie\" 14 fmt.Printf(\"My name is %v !\\n\", name) 15 var age interface{} = 18 16 fmt.Printf(\"I am [%d] years oldã€‚\",age) 17 } 18 19 20 21 #ä»¥ä¸Šä»£ç æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š 22 My name is yinzhengjie ! 23 I am [18] years oldã€‚ é™¤äº†verb %Tå’Œ%pä¹‹å¤–ï¼›å¯¹å®ç°äº†ç‰¹å®šæ¥å£çš„æ“ä½œæ•°ä¼šè€ƒè™‘é‡‡ç”¨ç‰¹æ®Šçš„æ ¼å¼åŒ–æŠ€å·§ã€‚æŒ‰åº”ç”¨ä¼˜å…ˆçº§å¦‚ä¸‹ï¼š\n\\1. å¦‚æœæ“ä½œæ•°å®ç°äº†Formatteræ¥å£ï¼Œä¼šè°ƒç”¨è¯¥æ¥å£çš„æ–¹æ³•ã€‚Formatteræä¾›äº†æ ¼å¼åŒ–çš„æ§åˆ¶ã€‚\n\\2. å¦‚æœverb %vé…åˆflag #ä½¿ç”¨ï¼ˆ%#vï¼‰ï¼Œä¸”æ“ä½œæ•°å®ç°äº†GoStringeræ¥å£ï¼Œä¼šè°ƒç”¨è¯¥æ¥å£ã€‚\nå¦‚æœæ“ä½œæ•°æ»¡è¶³å¦‚ä¸‹ä¸¤æ¡ä»»ä¸€æ¡ï¼Œå¯¹äº%sã€%qã€%vã€%xã€%Xäº”ä¸ªverbï¼Œå°†è€ƒè™‘ï¼š\n\\3. å¦‚æœæ“ä½œæ•°å®ç°äº†erroræ¥å£ï¼ŒErroræ–¹æ³•ä¼šç”¨æ¥ç”Ÿæˆå­—ç¬¦ä¸²ï¼Œéšåå°†æŒ‰ç»™å‡ºçš„flagï¼ˆå¦‚æœæœ‰ï¼‰å’Œverbæ ¼å¼åŒ–ã€‚\n\\4. å¦‚æœæ“ä½œæ•°å…·æœ‰Stringæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å°†è¢«ç”¨æ¥ç”Ÿæˆå­—ç¬¦ä¸²ï¼Œç„¶åå°†æŒ‰ç»™å‡ºçš„flagï¼ˆå¦‚æœæœ‰ï¼‰å’Œverbæ ¼å¼åŒ–ã€‚\nå¤åˆç±»å‹çš„æ“ä½œæ•°ï¼Œå¦‚åˆ‡ç‰‡å’Œç»“æ„ä½“ï¼Œæ ¼å¼åŒ–åŠ¨verbé€’å½’åœ°åº”ç”¨äºå…¶æ¯ä¸€ä¸ªæˆå‘˜ï¼Œè€Œä¸æ˜¯ä½œä¸ºæ•´ä½“ä¸€ä¸ªæ“ä½œæ•°ä½¿ç”¨ã€‚å› æ­¤%qä¼šå°†[]stringçš„æ¯ä¸€ä¸ªæˆå‘˜æ‹¬èµ·æ¥ï¼Œ%6.2fä¼šæ§åˆ¶æµ®ç‚¹æ•°ç»„çš„æ¯ä¸€ä¸ªå…ƒç´ çš„æ ¼å¼åŒ–ã€‚\nä¸ºäº†é¿å…å¯èƒ½å‡ºç°çš„æ— ç©·é€’å½’ï¼Œå¦‚ï¼š\n1 type X string 2 func (x X) String() string { return Sprintf(\"\u003c%s\u003e\", x) } åº”åœ¨é€’å½’ä¹‹å‰è½¬æ¢å€¼çš„ç±»å‹ï¼š\n1 func (x X) String() string { return Sprintf(\"\u003c%s\u003e\", string(x)) } æ˜¾å¼æŒ‡å®šå‚æ•°ç´¢å¼•ï¼š\nåœ¨Printfã€Sprintfã€Fprintfä¸‰ä¸ªå‡½æ•°ä¸­ï¼Œé»˜è®¤çš„è¡Œä¸ºæ˜¯å¯¹æ¯ä¸€ä¸ªæ ¼å¼åŒ–verbä¾æ¬¡å¯¹åº”è°ƒç”¨æ—¶æˆåŠŸä¼ é€’è¿›æ¥çš„å‚æ•°ã€‚ä½†æ˜¯ï¼Œç´§è·Ÿåœ¨verbä¹‹å‰çš„[n]ç¬¦å·è¡¨ç¤ºåº”æ ¼å¼åŒ–ç¬¬nä¸ªå‚æ•°ï¼ˆç´¢å¼•ä»1å¼€å§‹ï¼‰ã€‚åŒæ ·çš„åœ¨â€™*â€˜ä¹‹å‰çš„[n]ç¬¦å·è¡¨ç¤ºé‡‡ç”¨ç¬¬nä¸ªå‚æ•°çš„å€¼ä½œä¸ºå®½åº¦æˆ–ç²¾åº¦ã€‚åœ¨å¤„ç†å®Œæ–¹æ‹¬å·è¡¨è¾¾å¼[n]åï¼Œé™¤éå¦æœ‰æŒ‡ç¤ºï¼Œä¼šæ¥ç€å¤„ç†å‚æ•°n+1ï¼Œn+2â€¦â€¦ï¼ˆå°±æ˜¯è¯´ç§»åŠ¨äº†å½“å‰å¤„ç†ä½ç½®ï¼‰ã€‚ä¾‹å¦‚ï¼š\n1 fmt.Sprintf(\"%[2]d %[1]d\\n\", 11, 22) ä¼šç”Ÿæˆ\"22 11\"ï¼Œè€Œï¼š\n1 fmt.Sprintf(\"%[3]*.[2]*[1]f\", 12.0, 2, 6), ç­‰ä»·äºï¼š\n1 fmt.Sprintf(\"%6.2f\", 12.0), ä¼šç”Ÿæˆ\" 12.00\"ã€‚å› ä¸ºæ˜¾å¼çš„ç´¢å¼•ä¼šå½±å“éšåçš„verbï¼Œè¿™ç§ç¬¦å·å¯ä»¥é€šè¿‡é‡è®¾ç´¢å¼•ç”¨äºå¤šæ¬¡æ‰“å°åŒä¸€ä¸ªå€¼ï¼š\n1 fmt.Sprintf(\"%d %d %#[1]x %#x\", 16, 17) ä¼šç”Ÿæˆ\"16 17 0x10 0x11\"\næ ¼å¼åŒ–é”™è¯¯ï¼š\nå¦‚æœç»™æŸä¸ªverbæä¾›äº†éæ³•çš„å‚æ•°ï¼Œå¦‚ç»™%dæä¾›äº†ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œç”Ÿæˆçš„å­—ç¬¦ä¸²ä¼šåŒ…å«è¯¥é—®é¢˜çš„æè¿°ï¼Œå¦‚ä¸‹æ‰€ä¾‹ï¼š\n1 é”™è¯¯çš„ç±»å‹æˆ–æœªçŸ¥çš„verbï¼š%!verb(type=value) 2 Printf(\"%d\", hi): %!d(string=hi) 3 å¤ªå¤šå‚æ•°ï¼ˆé‡‡ç”¨ç´¢å¼•æ—¶ä¼šå¤±æ•ˆï¼‰ï¼š%!(EXTRA type=value) 4 Printf(\"hi\", \"guys\"): hi%!(EXTRA string=guys) 5 å¤ªå°‘å‚æ•°: %!verb(MISSING) 6 Printf(\"hi%d\"): hi %!d(MISSING) 7 å®½åº¦/ç²¾åº¦ä¸æ˜¯æ•´æ•°å€¼ï¼š%!(BADWIDTH) or %!(BADPREC) 9 Printf(\"%.*s\", 4.5, \"hi\"): %!(BADPREC)hi 10 æ²¡æœ‰ç´¢å¼•æŒ‡å‘çš„å‚æ•°ï¼š%!(BADINDEX) 11 Printf(\"%*[2]d\", 7): %!d(BADINDEX) 12 Printf(\"%.[2]d\", 7): %!d(BADINDEX) æ‰€æœ‰çš„é”™è¯¯éƒ½ä»¥å­—ç¬¦ä¸²\"%!â€œå¼€å§‹ï¼Œæœ‰æ—¶ä¼šåè·Ÿå•ä¸ªå­—ç¬¦ï¼ˆverbæ ‡è¯†ç¬¦ï¼‰ï¼Œå¹¶ä»¥åŠ å°æ‹¬å¼§çš„æè¿°ç»“æŸã€‚\nå¦‚æœè¢«printç³»åˆ—å‡½æ•°è°ƒç”¨æ—¶ï¼ŒErroræˆ–Stringæ–¹æ³•è§¦å‘äº†panicï¼ŒfmtåŒ…ä¼šæ ¹æ®panicé‡å»ºé”™è¯¯ä¿¡æ¯ï¼Œç”¨ä¸€ä¸ªå­—ç¬¦ä¸²è¯´æ˜è¯¥panicç»è¿‡äº†fmtåŒ…ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªStringæ–¹æ³•è°ƒç”¨äº†panic(â€œbadâ€)ï¼Œç”Ÿæˆçš„æ ¼å¼åŒ–ä¿¡æ¯å·®ä¸å¤šæ˜¯è¿™æ ·çš„ï¼š\n%!s(PANIC=bad) %!sæŒ‡ç¤ºè¡¨ç¤ºé”™è¯¯ï¼ˆpanicï¼‰å‡ºç°æ—¶çš„ä½¿ç”¨çš„verbã€‚\nè¿ç®—ç¬¦ è‡ªå¢ \u0026 è‡ªå‡ ä¸ç”¨äº è¡¨è¾¾å¼ä¸­ã€‚\n//num2:=num++ + 5 num3:=num + 5 fmt.Println(num3) æµç¨‹æ§åˆ¶ if switch case ==å¯ä»¥å¤šä¸ªã€å¯ä»¥æ˜¯è¡¨è¾¾å¼==\ncase é‡Œé¢ä¸éœ€è¦ break ï¼Œè‹¥æƒ³ç»§ç»­ä¸‹å» åŠ  fallthrough\nfunc Control() { str := \"b\" checkGrade(str) } func checkGrade(grade string) { //\tswitch switch grade { case \"a\", \"b\": fmt.Printf(\"Very Good\") case \"c\": fmt.Printf(\"Good\") default: fmt.Println(\"normal\") } } å¾ªç¯ for range å¯ä»¥ä½¿ç”¨for rangeéå†æ•°ç»„ã€åˆ‡ç‰‡ã€å­—ç¬¦ä¸²ã€mapåŠé€šé“(channel)ã€‚\né€šè¿‡for rangeéå†çš„è¿”å›å€¼æœ‰ä»¥ä¸‹è§„å¾‹ï¼š\n1.æ•°ç»„ã€åˆ‡ç‰‡ã€å­—ç¬¦ä¸²è¿”å›ç´¢å¼•å’Œå€¼ã€‚ 2.mapè¿”å›é”®å’Œå€¼ã€‚ 3.é€šé“(channel)åªè¿”å›é€šé“å†…çš„å€¼ã€‚\narr := [...]int{1, 2, 3} //[3]int //arr := []int{1, 2, 3} //[]int for i, v := range arr { fmt.Printf(\"%v:%v\\n\", i, v) } fmt.Printf(\"%T\\n\", arr) breakï¼šåœ¨å¾ªç¯ä¸­ï¼Œè·³å‡ºä¸€å±‚å¾ªç¯\ncontinue\ngoto\næ•°ç»„ package Base import \"fmt\" func Array() { //\tæ•°ç»„åˆ—è¡¨åˆå§‹åŒ– var arr = [5]int{4, 5, 6, 7, 8} fmt.Println(arr) //\tä½¿ç”¨ ... , è®©ä»–è‡ªè¡Œæ¨æ–­é•¿åº¦ var arr1 = [...]int{4, 5, 6, 7, 8, 9, 10} fmt.Println(arr1) //\tæŒ‡å®šç´¢å¼•å€¼çš„æ–¹å¼åˆå§‹åŒ– var arr2 = [...]int{0: 1, 2: 2, 3: 4} fmt.Println(arr2) } åˆ‡ç‰‡ å‰é¢æˆ‘ä»¬å­¦ä¹ äº†æ•°ç»„ï¼Œæ•°ç»„æ˜¯å›ºå®šé•¿åº¦ï¼Œå¯ä»¥å®¹çº³ç›¸åŒæ•°æ®ç±»å‹çš„å…ƒç´ çš„é›†åˆã€‚å½“é•¿åº¦å›ºå®šæ—¶ï¼Œä½¿ç”¨è¿˜æ˜¯å¸¦æ¥ä¸€äº›é™åˆ¶ï¼Œæ¯”å¦‚ï¼šæˆ‘ä»¬ç”³è¯·çš„é•¿åº¦å¤ªå¤§æµªè´¹å†…å­˜ï¼Œå¤ªå°åˆä¸å¤Ÿç”¨ã€‚\né‰´äºä¸Šè¿°åŸå› ï¼Œæˆ‘ä»¬æœ‰äº†goè¯­è¨€çš„åˆ‡ç‰‡ï¼Œå¯ä»¥æŠŠåˆ‡ç‰‡ç†è§£ä¸ºï¼Œå¯å˜é•¿åº¦çš„æ•°ç»„ï¼Œå…¶å®å®ƒåº•å±‚å°±æ˜¯ä½¿ç”¨æ•°ç»„å®ç°çš„ï¼Œå¢åŠ äº†è‡ªåŠ¨æ‰©å®¹åŠŸèƒ½ã€‚åˆ‡ç‰‡ (slice) æ˜¯ä¸€ä¸ªæ‹¥æœ‰ç›¸åŒç±»å‹å…ƒç´ çš„å¯å˜é•¿åº¦çš„åºåˆ—ã€‚\nfunc Slice() { //\tæ•°ç»„ var arr = [...]int{3, 4, 5, 6} fmt.Println(arr) //\tåˆ‡ç‰‡ var slice = []int{3, 4, 5, 6} fmt.Println(slice) // é€šè¿‡ make var sliceByMake = make([]int, 5) fmt.Println(sliceByMake) println(\"len\", len(sliceByMake)) println(\"cap\", cap(sliceByMake)) } tips headNum := 6 // è¿™é‡Œåˆ›å»ºäº† 6 ä¸ª 0 var UidIntArr = make([]int, headNum) // right var UidIntArr = make([]int, 0, headNum) æ·»åŠ ã€åˆ é™¤ã€Copy åˆ é™¤ï¼šè¿ç»­å®¹å™¨çš„å…ƒç´ åˆ é™¤æ— è®ºåœ¨ä»»ä½•è¯­è¨€ä¸­ï¼Œéƒ½è¦å°†åˆ é™¤ç‚¹å‰åçš„å…ƒç´ ç§»åŠ¨åˆ°æ–°çš„ä½ç½®ï¼Œéšç€å…ƒç´ çš„å¢åŠ ï¼Œè¿™ä¸ªè¿‡ç¨‹å°†ä¼šå˜å¾—æä¸ºè€—æ—¶ï¼Œå› æ­¤ï¼Œå½“ä¸šåŠ¡éœ€è¦å¤§é‡ã€é¢‘ç¹åœ°ä»ä¸€ä¸ªåˆ‡ç‰‡ä¸­åˆ é™¤å…ƒç´ æ—¶ï¼Œå¦‚æœå¯¹æ€§èƒ½è¦æ±‚è¾ƒé«˜çš„è¯ï¼Œå°±éœ€è¦è€ƒè™‘æ›´æ¢å…¶ä»–çš„å®¹å™¨äº†ï¼ˆå¦‚åŒé“¾è¡¨ç­‰èƒ½å¿«é€Ÿä»åˆ é™¤ç‚¹åˆ é™¤å…ƒç´ ï¼‰ã€‚\n//\tadd var slice1 = []int{1, 2, 3, 4, 5} fmt.Println(\"before add\", slice1) slice1 = append(slice1, 6) slice1 = append(slice1, 6) slice1 = append(slice1, 6) fmt.Println(\"after add\", slice1) //before add [1 2 3 4 5] //after add [1 2 3 4 5 6 6 6] //\tdelete fmt.Println(\"before delete\", slice1) // å‡è®¾æƒ³åˆ é™¤ ä¸‹æ ‡ä¸º 4 çš„å…ƒç´  slice1 = append(slice1[:4], slice1[5:]...) //\u003c======= fmt.Println(\"after delete\", slice1) //\tcopy var slice3 = []int{1, 2, 3, 4, 5} var slice4 []int copy(slice4, slice3) fmt.Println(\"slice4\", slice1) map mapæ˜¯ä¸€ç§key:valueé”®å€¼å¯¹çš„æ•°æ®ç»“æ„å®¹å™¨ã€‚mapå†…éƒ¨å®ç°æ˜¯å“ˆå¸Œè¡¨(hash)ã€‚ mapæœ€é‡è¦çš„ä¸€ç‚¹æ˜¯é€šè¿‡keyæ¥å¿«é€Ÿæ£€ç´¢æ•°æ®ï¼Œkeyç±»ä¼¼äºç´¢å¼•ï¼ŒæŒ‡å‘æ•°æ®çš„å€¼ã€‚ mapæ˜¯å¼•ç”¨ç±»å‹çš„ã€‚\nåˆå§‹åŒ– func MapInit() { map1 := map[string]string{ \"name\": \"Tom\", \"age\": \"12\", \"gender\": \"male\", } fmt.Println(map1) //map[age:12 gender:male name:Tom] map2 := make(map[string]string, 5) map2[\"name\"] = \"Amy\" map2[\"age\"] = \"13\" map2[\"gender\"] = \"female\" fmt.Println(map2) //map[age:13 gender:female name:Amy] } å–å€¼ã€éå† //\té€šè¿‡ key å–å€¼ key := \"name\" value := map2[key] fmt.Println(\"key = name , value = \", value) //key = name , value = Amy //\tåˆ¤æ–­ä¸€ä¸ªmapæ˜¯å¦å«æœ‰æŸä¸ª key å€¼ value1, ok := map2[key] fmt.Printf(\"key = name , isExist = %t , value = %v\\n\", ok, value1) //key = name , isExist = true , value = Amy //\téå† for k, v := range map2 { fmt.Printf(\"%v:%v\\n\", k, v) } //name:Amy //age:13 //gender:female function goè¯­è¨€ä¸­å‡½æ•°ç‰¹æ€§\n1.goè¯­è¨€ä¸­æœ‰3ç§å‡½æ•°ï¼šæ™®é€šå‡½æ•°ã€åŒ¿åå‡½æ•°ï¼ˆæ²¡æœ‰åç§°çš„å‡½æ•°ï¼‰ã€æ–¹æ³•ï¼ˆå®šä¹‰åœ¨structä¸Šçš„å‡½æ•°ï¼‰ã€‚\n2.goè¯­è¨€ä¸­ä¸å…è®¸å‡½æ•°é‡è½½(overload),ä¹Ÿå°±æ˜¯è¯´ä¸å…è®¸å‡½æ•°åŒåã€‚\n3.goè¯­è¨€ä¸­çš„å‡½æ•°ä¸èƒ½åµŒå¥—å‡½æ•°ï¼Œä½†å¯ä»¥åµŒå¥—åŒ¿åå‡½æ•°ã€‚\n4.å‡½æ•°æ˜¯ä¸€ä¸ªå€¼ï¼Œå¯ä»¥å°†å‡½æ•°èµ‹å€¼ç»™å˜é‡ï¼Œä½¿å¾—è¿™ä¸ªå˜é‡ä¹Ÿæˆä¸ºå‡½æ•°ã€‚\n5.å‡½æ•°å¯ä»¥ä½œä¸ºå‚æ•°ä¼ é€’ç»™å¦ä¸€ä¸ªå‡½æ•°ã€‚\n6.å‡½æ•°çš„è¿”å›å€¼å¯ä»¥æ˜¯ä¸€ä¸ªå‡½æ•°ã€‚\n7.å‡½æ•°è°ƒç”¨çš„æ—¶å€™ï¼Œå¦‚æœæœ‰å‚æ•°ä¼ é€’ç»™å‡½æ•°ï¼Œåˆ™å…ˆæ‹·è´å‚æ•°çš„å‰¯æœ¬ï¼Œå†å°†å‰¯æœ¬ä¼ é€’ç»™å‡½æ•°ã€‚\n8.å‡½æ•°å‚æ•°å¯ä»¥æ²¡æœ‰åç§°ã€‚\nè¿”å›å€¼ 1,returnå…³é”®å­—ä¸­æŒ‡å®šäº†å‚æ•°æ—¶ï¼Œè¿”å›å€¼å¯ä»¥ä¸ç”¨åç§°ã€‚å¦‚æœreturnçœç•¥å‚æ•°ï¼Œåˆ™è¿”å›å€¼éƒ¨åˆ†å¿…é¡»å¸¦åç§°\n2.å½“è¿”å›å€¼æœ‰åç§°æ—¶ï¼Œå¿…é¡»ä½¿ç”¨æ‹¬å·åŒ…å›´ï¼Œé€—å·åˆ†éš”ï¼Œå³ä½¿åªæœ‰ä¸€ä¸ªè¿”å›å€¼\n3.ä½†å³ä½¿è¿”å›å€¼å‘½åäº†ï¼Œreturnä¸­ä¹Ÿå¯ä»¥å¼ºåˆ¶æŒ‡å®šå…¶å®ƒè¿”å›å€¼çš„åç§°ï¼Œä¹Ÿå°±æ˜¯è¯´returnçš„ä¼˜å…ˆçº§æ›´é«˜\n4.å‘½åçš„è¿”å›å€¼æ˜¯é¢„å…ˆå£°æ˜å¥½çš„ï¼Œåœ¨å‡½æ•°å†…éƒ¨å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œæ— éœ€å†æ¬¡å£°æ˜ã€‚å‘½åè¿”å›å€¼çš„åç§°ä¸èƒ½å’Œå‡½æ•°å‚ æ•°åç§°ç›¸åŒï¼Œå¦åˆ™æŠ¥é”™æç¤ºå˜é‡é‡å¤å®šä¹‰\n5.returnä¸­å¯ä»¥æœ‰è¡¨è¾¾å¼ï¼Œä½†ä¸èƒ½å‡ºç°èµ‹å€¼è¡¨è¾¾å¼ï¼Œè¿™å’Œå…¶å®ƒè¯­è¨€å¯èƒ½æœ‰æ‰€ä¸åŒã€‚ä¾‹å¦‚return a+bæ˜¯æ­£ç¡® çš„ï¼Œä½†return c=a+bæ˜¯é”™è¯¯çš„ã€‚\nfunc Function() { name, age := fun1() fmt.Printf(\"name:%v,age:%v\\n\", name, age) } func fun1() (name string, age int) { name = \"Amy\" age = 19 return //\tç­‰ä»·äº ==\u003e return name, age } å‚æ•° å€¼ä¼ é€’ ã€å› ä¸ºä¼šåˆ›å»ºå‡½æ•°å‰¯æœ¬ã€‘\næ³¨æ„ ï¼šmapã€sliceã€interfaceã€channelè¿™äº›æ•°æ®ç±»å‹æœ¬èº«å°±æ˜¯æŒ‡é’ˆç±»å‹çš„ï¼Œæ‰€ä»¥å°±ç®—æ˜¯æ‹·è´ä¼ å€¼ä¹Ÿæ˜¯æ‹·è´çš„æŒ‡é’ˆï¼Œæ‹·è´åçš„å‚æ•°ä»ç„¶æŒ‡å‘åº•å±‚æ•°æ®ç»“æ„ï¼Œæ‰€ä»¥ä¿®æ”¹å®ƒä»¬å¯èƒ½ä¼šå½±å“å¤–éƒ¨æ•°æ®ç»“æ„çš„å€¼ã€‚\nfunc Function() { a := []int{1, 2} fun2(a) fmt.Println(a[0]) // 100 } func fun2(a []int) { a[0] = 100 } å˜é•¿å‚æ•° func Function() { fun3(\"Amy\", \"Beijing\", \"23\") } func fun3(args ...string) { for i, arg := range args { fmt.Printf(\"%v:%v\\n\", i, arg) } } 0:Amy 1:Beijing 2:23 é«˜é˜¶å‡½æ•° å‡½æ•°å¯ä»¥ä½œä¸ºä¸€ä¸ªå‡½æ•°çš„å‚æ•°ã€è¿”å›å€¼ã€‚\nåŒ¿åå‡½æ•° é—­åŒ… é—­åŒ…å¯ä»¥ç†è§£æˆå®šä¹‰åœ¨ä¸€ä¸ªå‡½æ•°å†…éƒ¨çš„å‡½æ•°ã€‚åœ¨æœ¬è´¨ä¸Šï¼Œé—­åŒ…æ˜¯å°†å‡½æ•°å†…éƒ¨å’Œå‡½æ•°å¤–éƒ¨è¿æ¥èµ·æ¥çš„æ¡¥æ¢ã€‚æˆ–è€…è¯´æ˜¯å‡½æ•°å’Œå…¶å¼•ç”¨ç¯å¢ƒçš„ç»„åˆä½“ã€‚ é—­åŒ…æŒ‡çš„æ˜¯ä¸€ä¸ªå‡½æ•°å’Œä¸å…¶ç›¸å…³çš„å¼•ç”¨ç¯å¢ƒç»„åˆè€Œæˆçš„å®ä½“ã€‚ç®€å•æ¥è¯´ï¼Œ==é—­åŒ…=å‡½æ•°+å¼•ç”¨ç¯å¢ƒ==ã€‚\nå˜é‡fæ˜¯ä¸€ä¸ªå‡½æ•°å¹¶ä¸”å®ƒå¼•ç”¨äº†å…¶å¤–éƒ¨ä½œç”¨åŸŸä¸­çš„xå˜é‡ï¼Œæ­¤æ—¶få°±æ˜¯ä¸€ä¸ªé—­åŒ…ã€‚åœ¨fçš„ç”Ÿå‘½å‘¨æœŸå†…ï¼Œå˜é‡xä¹Ÿä¸€ç›´æœ‰æ•ˆã€‚\nfunc Closure() { f := add() println(f(10)) println(f(20)) println(f(30)) // 10 // 30 // 60 //\tå˜é‡é€ƒé€¸ï¼Œä»æ ˆå»åˆ°å † } func add() func(int) int { var x int return func(y int) int { x += y return x } } é€’å½’ å‡½æ•°å†…éƒ¨è°ƒç”¨å‡½æ•°è‡ªèº«çš„å‡½æ•°ç§°ä¸ºé€’å½’å‡½æ•°ã€‚ ä½¿ç”¨é€’å½’å‡½æ•°æœ€é‡è¦çš„ä¸‰ç‚¹ï¼š\n1.é€’å½’å°±æ˜¯è‡ªå·±è°ƒç”¨è‡ªå·±ã€‚ 2.å¿…é¡»å…ˆå®šä¹‰å‡½æ•°çš„é€€å‡ºæ¡ä»¶ï¼Œæ²¡æœ‰é€€å‡ºæ¡ä»¶ï¼Œé€’å½’å°†æˆä¸ºæ­»å¾ªç¯ã€‚ 3.goè¯­è¨€é€’å½’å‡½æ•°å¾ˆå¯èƒ½ä¼šäº§ç”Ÿä¸€å¤§å †çš„goroutine,ä¹Ÿå¾ˆå¯èƒ½ä¼šå‡ºç°æ ˆç©ºé—´å†…å­˜è°¥å‡ºé—®é¢˜ã€‚\ndefer goè¯­è¨€ä¸­çš„deferè¯­å¥ä¼šå°†å…¶åé¢è·Ÿéšçš„è¯­å¥è¿›è¡Œå»¶è¿Ÿå¤„ç†ã€‚\nåœ¨deferå½’å±çš„å‡½æ•°å³å°†è¿”å›æ—¶ï¼Œå°†å»¶è¿Ÿå¤„ç†çš„è¯­å¥æŒ‰deferå®šä¹‰çš„é€†åºè¿›è¡Œæ‰§è¡Œï¼Œ\nä¹Ÿå°±æ˜¯è¯´ï¼Œå…ˆè¢«deferçš„è¯­å¥æœ€åè¢«æ‰§è¡Œï¼Œæœ€åè¢«deferçš„è¯­å¥ï¼Œæœ€å…ˆè¢«æ‰§è¡Œã€‚\ndeferâ€™ç‰¹æ€§\n1.å…³é”®å­—deferç”¨äºæ³¨å†Œå»¶è¿Ÿè°ƒç”¨ã€‚ 2.è¿™äº›è°ƒç”¨ç›´åˆ°returnå‰æ‰è¢«æ‰§ã€‚å› æ­¤ï¼Œå¯ä»¥ç”¨æ¥åšèµ„æºæ¸…ç†ã€‚ 3.å¤šä¸ªdeferè¯­å¥ï¼ŒæŒ‰å…ˆè¿›åå‡ºçš„æ–¹å¼æ‰§è¡Œã€‚ 4.deferè¯­å¥ä¸­çš„å˜é‡ï¼Œåœ¨deferå£°æ˜æ—¶å°±å†³å®šäº†ã€‚\ndeferç”¨é€” 1.å…³é—­æ–‡ä»¶å¥æŸ„ 2.é”èµ„æºé‡Šæ”¾ 3.æ•°æ®åº“è¿æ¥é‡Šæ”¾\ninitå‡½æ•° golangæœ‰ä¸€ä¸ªç‰¹æ®Šçš„å‡½æ•°initå‡½æ•°ï¼Œå…ˆäºmainå‡½æ•°æ‰§è¡Œï¼Œå®ç°åŒ…çº§åˆ«çš„ä¸€äº›åˆå§‹åŒ–æ“ä½œã€‚\ninitå‡½æ•°çš„ä¸»è¦ç‰¹ç‚¹ Â·initå‡½æ•°å…ˆäºmainå‡½æ•°==è‡ªåŠ¨æ‰§è¡Œ==ï¼Œä¸èƒ½è¢«å…¶ä»–å‡½æ•°è°ƒç”¨ï¼š Â·initå‡½æ•°æ²¡æœ‰è¾“å…¥å‚æ•°ã€è¿”å›å€¼ï¼š Â·æ¯ä¸ªåŒ…å¯ä»¥æœ‰å¤šä¸ªinitå‡½æ•°ï¼š Â·åŒ…çš„æ¯ä¸ªæºæ–‡ä»¶ä¹Ÿå¯ä»¥æœ‰å¤šä¸ªinitå‡½æ•°ï¼Œè¿™ç‚¹æ¯”è¾ƒç‰¹æ®Šï¼š Â·åŒä¸€ä¸ªåŒ…çš„initæ‰§è¡Œé¡ºåºï¼Œgolangæ²¡æœ‰æ˜ç¡®å®šä¹‰ï¼Œç¼–ç¨‹æ—¶è¦æ³¨æ„ç¨‹åºä¸è¦ä¾èµ–è¿™ä¸ªæ‰§è¡Œé¡ºåºã€‚ Â·ä¸åŒåŒ…çš„itå‡½æ•°æŒ‰ç…§åŒ…ï¼Œå¯¼å…¥çš„ä¾èµ–å…³ç³»å†³å®šæ‰§è¡Œé¡ºåºã€‚ golangåˆå§‹åŒ–é¡ºåº åˆå§‹åŒ–é¡ºåºï¼šå˜é‡åˆå§‹åŒ–-\u003einit()-\u003emain()\næŒ‡é’ˆ G0è¯­è¨€ä¸­çš„å‡½æ•°ä¼ å‚éƒ½æ˜¯å€¼æ‹·è´ï¼Œå½“æˆ‘ä»¬æƒ³è¦ä¿®æ”¹æŸä¸ªå˜é‡çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªæŒ‡å‘è¯¥å˜é‡åœ°å€çš„æŒ‡é’ˆå˜ é‡ã€‚ä¼ é€’æ•°æ®ä½¿ç”¨æŒ‡é’ˆï¼Œè€Œæ— é¡»æ‹·è´æ•°æ®ã€‚\nç±»å‹æŒ‡é’ˆä¸èƒ½è¿›è¡Œåç§»å’Œè¿ç®—ã€‚\nG0è¯­è¨€ä¸­çš„æŒ‡é’ˆæ“ä½œéå¸¸ç®€å•ï¼Œåªéœ€è¦è®°ä½ä¸¤ä¸ªç¬¦å·ï¼š\u0026ï¼ˆå–åœ°å€ï¼‰å’Œ *ï¼ˆæ ¹æ®åœ°å€å–å€¼ï¼‰ã€‚\næŒ‡é’ˆåœ°å€å’ŒæŒ‡é’ˆç±»å‹ æ¯ä¸ªå˜é‡åœ¨è¿è¡Œæ—¶éƒ½æ‹¥æœ‰ä¸€ä¸ªåœ°å€ï¼Œè¿™ä¸ªåœ°å€ä»£è¡¨å˜é‡åœ¨å†…å­˜ä¸­çš„ä½ç½®ã€‚\nGoè¯­è¨€ä¸­ä½¿ç”¨\u0026å­—ç¬¦æ”¾åœ¨å˜é‡å‰é¢å¯¹å˜é‡è¿›è¡Œå–åœ°å€æ“ä½œã€‚\nGoè¯­è¨€ä¸­çš„å€¼ç±»å‹(intã€floatã€boolã€stringã€arrayã€struct)éƒ½æœ‰å¯¹åº”çš„æŒ‡é’ˆç±»å‹ï¼Œå¦‚ï¼š*intã€*int64ã€*stringç­‰ã€‚\næŒ‡é’ˆè¯­æ³• ä¸€ä¸ªæŒ‡é’ˆå˜é‡æŒ‡å‘äº†ä¸€ä¸ªå€¼çš„å†…å­˜åœ°å€ã€‚\n(ä¹Ÿå°±æ˜¯æˆ‘ä»¬å£°æ˜äº†ä¸€ä¸ªæŒ‡é’ˆä¹‹åï¼Œå¯ä»¥åƒå˜é‡èµ‹å€¼ä¸€æ ·ï¼ŒæŠŠä¸€ä¸ªå€¼çš„å†…å­˜åœ°å€æ”¾å…¥åˆ°æŒ‡é’ˆå½“ä¸­ã€‚)\nç±»ä¼¼äºå˜é‡å’Œå¸¸é‡ï¼Œåœ¨ä½¿ç”¨æŒ‡é’ˆå‰ä½ éœ€è¦å£°æ˜æŒ‡é’ˆã€‚æŒ‡é’ˆå£°æ˜æ ¼å¼å¦‚ä¸‹ï¼š\nvar var_name *var-type var-type: ä¸ºæŒ‡é’ˆç±»å‹ var-name: ä¸ºæŒ‡é’ˆå˜é‡å *ï¼šç”¨äºæŒ‡å®šå˜é‡æ˜¯ä½œä¸ºä¸€ä¸ªæŒ‡é’ˆ æŒ‡é’ˆæ•°ç»„ è¡¨ç¤ºæ•°ç»„é‡Œé¢çš„å…ƒç´ çš„ç±»å‹æ˜¯æŒ‡é’ˆç±»å‹\nå®šä¹‰è¯­æ³•\nvar ptr [MAX]*int; ä¾‹å­\nfunc Pointer() { var arr = [3]int{1, 2, 3} var pArr [3]*int for i := 0; i \u003c len(arr); i++ { pArr[i] = \u0026arr[i] } for i := 0; i \u003c len(arr); i++ { println(pArr[i]) } //0xc000143f38 //0xc000143f40 //0xc000143f48 } ç±»å‹å®šä¹‰å’Œç±»å‹åˆ«å åœ¨ä»‹ç»ç»“æ„ä½“ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ä»€ä¹ˆæ˜¯ç±»å‹å®šä¹‰å’Œç±»å‹åˆ«åã€‚\ngoè¯­è¨€ç±»å‹å®šä¹‰ ç±»å‹å®šä¹‰çš„è¯­æ³•\ntype NewType Type å®ä¾‹\n//ç±»å‹å®šä¹‰ type MyInt int //iä¸ºMyIntç±»å‹ var i MyInt i = 100 fmt.Printf(\"i:%v i:%T\\n\", i, i) //\ti:100 i:Base.MyInt ç±»å‹åˆ«å //ç±»å‹åˆ«å type MyInt1 = int var i1 MyInt1 i1 = 100 fmt.Printf(\"i:%v i:%T\\n\", i1, i1) //\ti:100 i:int ç»“æ„ä½“ goè¯­è¨€æ²¡æœ‰é¢å‘å¯¹è±¡çš„æ¦‚å¿µäº†ï¼Œä½†æ˜¯å¯ä»¥ä½¿ç”¨ç»“æ„ä½“æ¥å®ç°é¢å‘å¯¹è±¡ç¼–ç¨‹çš„ä¸€äº›ç‰¹æ€§ï¼Œä¾‹å¦‚ï¼šç»§æ‰¿ã€ç»„åˆç­‰ç‰¹ æ€§ã€‚\nç»“æ„ä½“çš„å®šä¹‰ ç»“æ„ä½“çš„å®šä¹‰å’Œç±»å‹å®šä¹‰ç±»ä¼¼ï¼Œåªä¸è¿‡å¤šäº†ä¸€ä¸ªstructå…³é”®å­—ï¼š\ntype Person struct { id int name string age int email string } func Struct() { // åˆå§‹åŒ– person1 := Person{ 2, \"Amy\", 23, \"hello@qq.com\", } person2 := Person{ id: 3, name: \"Tom\", age: 20, email: \"world@qq.com\", } fmt.Printf(\"%#v\\n\", person1) fmt.Printf(\"%#v\\n\", person2) } ç»“æ„ä½“æŒ‡é’ˆ var p1Point *Person p1Point = \u0026person1 fmt.Printf(\"%p\\n\", p1Point) // é€šè¿‡ new var p2Point = new(Person) fmt.Printf(\"%p\\n\", p2Point) ç»“æ„ä½“ä½œä¸ºå‡½æ•°å‚æ•° goç»“æ„ä½“å¯ä»¥åƒæ™®é€šå˜é‡ä¸€æ ·ï¼Œä½œä¸ºå‡½æ•°çš„å‚æ•°ï¼Œä¼ é€’ç»™å‡½æ•°ï¼Œè¿™é‡Œåˆ†ä¸ºä¸¤ç§æƒ…å†µï¼š\nç›´æ¥ä¼ é€’ç»“æ„ä½“ï¼Œè¿™æ˜¯æ˜¯ä¸€ä¸ªå‰¯æœ¬ï¼ˆæ‹·è´ï¼‰ï¼Œåœ¨å‡½æ•°å†…éƒ¨ä¸ä¼šæ”¹å˜å¤–é¢ç»“æ„ä½“å†…å®¹ã€‚ ä¼ é€’ç»“æ„ä½“æŒ‡é’ˆï¼Œè¿™æ—¶åœ¨å‡½æ•°å†…éƒ¨ï¼Œèƒ½å¤Ÿæ”¹å˜å¤–éƒ¨ç»“æ„ä½“å†…å®¹ã€‚ ç›´æ¥ä¼ é€’ç»“æ„ä½“ è¿™æ˜¯å€¼ä¼ é€’ï¼Œå°†æ‹·è´ä¸€ä»½ï¼Œä¸ä¼šæ”¹å˜åŸæ¥çš„æ•°æ®\nä¼ é€’ç»“æ„ä½“æŒ‡é’ˆ è¿™å°±ä¼šä¿®æ”¹åŸæ¥çš„æ•°æ®äº†\ntype Person struct { id int name string age int email string } func Struct() { // åˆå§‹åŒ– person1 := Person{ 2, \"Amy\", 23, \"hello@qq.com\", } fmt.Printf(\"%#v\\n\", person1) showPerson(\u0026person1) fmt.Printf(\"%#v\\n\", person1) //Base.Person{id:2, name:\"Amy\", age:23, email:\"hello@qq.com\"} //Base.Person{id:2, name:\"Amy\", age:1000, email:\"hello@qq.com\"} } func showPerson(person *Person) { person.age = 1000 } åµŒå¥—ç»“æ„ä½“ goè¯­è¨€æ²¡æœ‰é¢å‘å¯¹è±¡ç¼–ç¨‹æ€æƒ³ï¼Œä¹Ÿæ²¡æœ‰ç»§æ‰¿å…³ç³»ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡ç»“æ„ä½“åµŒå¥—æ¥å®ç°è¿™ç§æ•ˆæœã€‚\nä¸‹é¢é€šè¿‡å®ä¾‹æ¼”ç¤ºå¦‚ä½•å®ç°ç»“æ„ä½“åµŒå¥—ï¼ŒåŠ å…¥æœ‰ä¸€ä¸ªäººPersonç»“æ„ä½“ï¼Œè¿™ä¸ªäººè¿˜å…»äº†ä¸€ä¸ªå® ç‰©Dogç»“æ„ä½“ã€‚\ntype Dog struct { name string color string age int } type Person struct { dog Dog name string age int } æ–¹æ³• gpè¯­è¨€æ²¡æœ‰é¢å‘å¯¹è±¡çš„ç‰¹æ€§ï¼Œä¹Ÿæ²¡æœ‰ç±»å¯¹è±¡çš„æ¦‚å¿µã€‚\nä½†æ˜¯ï¼Œå¯ä»¥ä½¿ç”¨ç»“æ„ä½“æ¥æ¨¡æ‹Ÿè¿™äº›ç‰¹æ€§ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“é¢å‘å¯¹è±¡é‡Œé¢æœ‰ç±»æ–¹æ³•ç­‰æ¦‚å¿µã€‚\næˆ‘ä»¬ä¹Ÿå¯ä»¥å£°æ˜ä¸€äº›æ–¹æ³•ï¼Œå±äºæŸä¸ªç»“æ„ä½“ã€‚\næ–¹æ³•çš„è¯­æ³• Goä¸­çš„æ–¹æ³•ï¼Œæ˜¯ä¸€ç§ç‰¹æ®Šçš„å‡½æ•°ï¼Œå®šä¹‰äºstructä¹‹ä¸Šï¼ˆä¸structå…³è”ã€ç»‘å®šï¼‰ï¼Œè¢«ç§°ä¸ºstructçš„æ¥å—è€…(receiver))ã€‚\né€šä¿—çš„è®²ï¼Œæ–¹æ³•å°±æ˜¯æœ‰æ¥æ”¶è€…çš„å‡½æ•°ã€‚\nä¸€ä¸ªæ–¹æ³•å’Œä¸€ä¸ªå‡½æ•°éå¸¸ç›¸ä¼¼ï¼Œå¤šäº†ä¸€ä¸ªæ¥å—ç±»å‹ã€‚\nè¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š type mytype struct{} func (recv mytype)my_method(para)return_type {} func (recv *mytype)my_method(para)return_type {} mytype:å®šä¹‰ä¸€ä¸ªç»“æ„ä½“ recv:æ¥å—è¯¥æ–¹æ³•çš„ç»“æ„ä½“(receiver) my-method:æ–¹æ³•åç§° para:å‚æ•°åˆ—è¡¨ return-type:è¿”å›å€¼ç±»å‹ å®ä¾‹\ntype Person struct { name string age int } func (p Person) eat() { fmt.Printf(\"%v is eating.\\n\", p.name) } func (p Person) sleep() { fmt.Printf(\"%v is sleepy.\\n\", p.name) } func Struct() { person := Person{ name: \"Tom\", age: 43, } person.eat() person.sleep() } æ–¹æ³•çš„æ³¨æ„äº‹é¡¹ æ–¹æ³•çš„receiver typeå¹¶éä¸€å®šè¦æ˜¯structç±»å‹ï¼Œtypeå®šä¹‰çš„ç±»å‹åˆ«åã€sliceã€.mapã€channelã€.funcç±»å‹ç­‰éƒ½å¯ ä»¥ã€‚ structç»“åˆå®ƒçš„æ–¹æ³•å°±ç­‰ä»·äºé¢å‘å¯¹è±¡ä¸­çš„ç±»ã€‚åªä¸è¿‡structå¯ä»¥å’Œå®ƒçš„æ–¹æ³•åˆ†å¼€ï¼Œå¹¶éä¸€å®šè¦å±äºåŒä¸€ä¸ªæ–‡ ä»¶ï¼Œä½†å¿…é¡»å±äºåŒä¸€ä¸ªåŒ…ã€‚ æ–¹æ³•æœ‰ä¸¤ç§æ¥æ”¶ç±»å‹ï¼š(T Type)å’Œ(T*Type),å®ƒä»¬ä¹‹é—´æœ‰åŒºåˆ«ã€‚ æ–¹æ³•å°±æ˜¯å‡½æ•°ï¼Œæ‰€ä»¥Goä¸­æ²¡æœ‰æ–¹æ³•é‡è½½(overload)çš„è¯´æ³•ï¼Œä¹Ÿå°±æ˜¯è¯´åŒä¸€ä¸ªç±»å‹ä¸­çš„æ‰€æœ‰æ–¹æ³•åå¿…é¡»éƒ½å”¯ä¸€ã€‚ å¦‚æœreceiveræ˜¯ä¸€ä¸ªæŒ‡é’ˆç±»å‹ï¼Œåˆ™ä¼šè‡ªåŠ¨è§£é™¤å¼•ç”¨ã€‚ æ–¹æ³•å’Œtypeæ˜¯åˆ†å¼€çš„ï¼Œæ„å‘³ç€å®ä¾‹çš„è¡Œä¸º(behavior)å’Œæ•°æ®å­˜å‚¨(field)æ˜¯åˆ†å¼€çš„ï¼Œä½†æ˜¯å®ƒä»¬é€šè¿‡receiverå»ºç«‹èµ· å…³è”å…³ç³»ã€‚ æ–¹æ³•æ¥æ”¶è€…ç±»å‹ ç»“æ„ä½“å®ä¾‹ï¼Œæœ‰å€¼ç±»å‹å’ŒæŒ‡é’ˆç±»å‹ï¼Œé‚£ä¹ˆæ–¹æ³•çš„æ¥æ”¶è€…æ˜¯ç»“æ„ä½“ï¼Œé‚£ä¹ˆä¹Ÿæœ‰å€¼ç±»å‹å’ŒæŒ‡é’ˆç±»å‹ã€‚\nåŒºåˆ«å°±æ˜¯æ¥æ”¶è€…æ˜¯å¦å¤åˆ¶ç»“æ„ä½“å‰¯æœ¬ã€‚==å€¼ç±»å‹å¤åˆ¶ï¼ŒæŒ‡é’ˆç±»å‹ä¸å¤åˆ¶ã€‚==\npackage Base import \"fmt\" type Person struct { name string age int } func (p Person) modifyName() { p.name = \"hello\" } func (p *Person) modifyName1() { p.name = \"hello\" } func Struct() { person := Person{ name: \"Tom\", age: 43, } fmt.Println(person) person.modifyName() fmt.Println(person) person.modifyName1() fmt.Println(person) //{Tom 43} //{Tom 43} //{hello 43} } æ¥å£ æ¥å£åƒæ˜¯ä¸€ä¸ªå…¬å¸é‡Œé¢çš„é¢†å¯¼ï¼Œä»–ä¼šå®šä¹‰ä¸€äº›é€šç”¨è§„èŒƒï¼Œåªè®¾è®¡è§„èŒƒï¼Œè€Œä¸å®ç°è§„èŒƒã€‚\ngoè¯­è¨€çš„æ¥å£ï¼Œæ˜¯ä¸€ç§æ–°çš„ç±»å‹å®šä¹‰ï¼Œå®ƒæŠŠæ‰€æœ‰çš„å…·æœ‰å…±æ€§çš„æ–¹æ³•å®šä¹‰åœ¨ä¸€èµ·ï¼Œä»»ä½•å…¶ä»–ç±»å‹åªè¦å®ç°äº†è¿™äº›æ–¹ æ³•å°±æ˜¯å®ç°äº†è¿™ä¸ªæ¥å£ã€‚\nè¯­æ³•æ ¼å¼å’Œæ–¹æ³•éå¸¸ç±»ä¼¼ã€‚\ndb_init package Dao import ( \"log\" \"server/Model\" \"gorm.io/driver/mysql\" \"gorm.io/gorm\" \"gorm.io/gorm/schema\" ) type Manager interface { Register(userinfo Model.User) error GetUser(userId uint64) (Model.User, error) IsExist(username string) (Model.User, error) GetPostListByUserId(userId uint64) ([]Model.Post, error) UpdateProfileById(userId uint64, data *Model.User) error GetCommunityList() ([]Model.Community, error) StoreArticle(postInfo Model.Post) error GetList(latestTime int64) ([]Model.Post, error) GetPostById(postId int64) (Model.Post, error) GetUsernameById(AuthorId uint64) (author string, err error) GetCommunityNameById(CommunityId uint64) (CommunityName string, err error) DeletePostById(postId int64) error AddComment(comment *Model.Comment) } type manager struct { db *gorm.DB } var Mgr Manager func init() { dsn := \"root:Admin666@tcp(127.0.0.1:3306)/blogserver?charset=utf8mb4\u0026parseTime=True\u0026loc=Local\" db, err := gorm.Open(mysql.Open(dsn), \u0026gorm.Config{ NamingStrategy: schema.NamingStrategy{ SingularTable: true, }, }) if err != nil { log.Fatal(\"Failed to init db:\", err) } Mgr = \u0026manager{db: db} if err := db.AutoMigrate(\u0026Model.Post{}); err != nil { log.Fatal(err) } } dao.user package Dao import ( \"server/Model\" ) func (mgr manager) Register(userinfo Model.User) error { result := mgr.db.Create(\u0026userinfo) return result.Error } func (mgr manager) GetUser(userId uint64) (Model.User, error) { var user Model.User if err := mgr.db.Select(\"user_id\", \"username\", \"company\", \"user_page\", \"user_introduce\", \"position\", \"created_at\"). Where(\"user_id=?\", userId).Find(\u0026user).Error; err != nil { return user, err } return user, nil } func (mgr manager) IsExist(username string) (Model.User, error) { var userinfo Model.User result := mgr.db.Where(\"username=?\", username).Find(\u0026userinfo) return userinfo, result.Error } func (mgr manager) UpdateProfileById(userId uint64, data *Model.User) error { var userinfo Model.User var maps = make(map[string]interface{}) maps[\"username\"] = data.Username maps[\"user_page\"] = data.UserPage maps[\"company\"] = data.Company maps[\"user_introduce\"] = data.UserIntroduce maps[\"position\"] = data.Position err := mgr.db.Model(\u0026userinfo).Where(\"user_id = ? \", userId).Updates(maps).Error return err } æ¥å£å’Œç±»å‹çš„å…³ç³» 1.ä¸€ä¸ªç±»å‹å¯ä»¥å®ç°å¤šä¸ªæ¥å£ 2.å¤šä¸ªç±»å‹å¯ä»¥å®ç°åŒä¸€ä¸ªæ¥å£ï¼ˆå¤šæ€ï¼‰\nä¸€ä¸ªç±»å‹å®ç°å¤šä¸ªæ¥å£\nä¾‹å¦‚ï¼šæœ‰ä¸€ä¸ªPlayeræ¥å£å¯ä»¥æ’­æ”¾éŸ³ä¹ï¼Œæœ‰ä¸€ä¸ªVideoæ¥å£å¯ä»¥æ’­æ”¾è§†é¢‘ï¼Œ\nä¸€ä¸ªæ‰‹æœºMobileå®ç°è¿™ä¸¤ä¸ªæ¥å£ï¼Œæ—¢å¯ä»¥æ’­æ”¾éŸ³ä¹ï¼Œåˆå¯ä»¥æ’­æ”¾è§†é¢‘ã€‚\næ¥å£åµŒå¥— package Base import \"fmt\" type Fly interface { FlyFunc() } type Swim interface { SwimFunc() } type FlyFish interface { Fly Swim } type Fish struct { } func (f Fish) FlyFunc() { fmt.Println(\"Fish is flying.\") } func (f Fish) SwimFunc() { fmt.Println(\"Fish is swimming.\") } func Interface() { var ff FlyFish // æ­¤å¤„å¦‚æœä¸å®ç°æ–¹æ³•ä¼šæŠ¥é”™ ff = Fish{} ff.SwimFunc() ff.FlyFunc() } é€šè¿‡æ¥å£å®ç°OCPè®¾è®¡åŸåˆ™ é¢å‘å¯¹è±¡çš„å¯å¤ç”¨è®¾è®¡çš„ç¬¬ä¸€å—åŸºçŸ³ï¼Œä¾¿æ˜¯æ‰€è°“çš„â€å¼€-é—­â€œåŸåˆ™(Open-Closed Principle,å¸¸ç¼©å†™ä¸ºOCP)ã€‚\nè™½ç„¶ï¼Œgoä¸æ˜¯é¢å‘å¯¹è±¡è¯­è¨€ï¼Œä½†æ˜¯ä¹Ÿå¯ä»¥æ¨¡æ‹Ÿå®ç°è¿™ä¸ªåŸåˆ™ã€‚\nå®ä¾‹ æ¥å£:\nç‰¹æ®Šçš„æ•°æ®ç±»å‹\næ–¹æ³•å®šä¹‰çš„é›†åˆ\næ–¹æ³•å(å½¢å‚ç±»å‹)è¿”å›å€¼ç±»å‹\næé«˜ä»£ç çš„å¤ç”¨ç‡\næ¥å£æœ¬èº«ä¸èƒ½ç»‘å®šæ–¹æ³•\nä¿å­˜çš„æ˜¯ï¼šå€¼+åŸå§‹ç±»å‹\n5.2.2 å®ç°\nä¸€ä¸ªç±»å‹å®ç°äº†æ¥å£çš„æ‰€æœ‰æ–¹æ³•\nå³å®ç°äº†è¯¥æ¥å£\ngoä¸­æ— éœ€â€œimplementsâ€å…³é”®å­—\n5.2.3 ç±»å‹é€‰æ‹©\nswitchâ€¦case + interface.(type)\n.(type)ä¸èƒ½åœ¨ switchâ€¦case å¤–ä½¿ç”¨\n5.2.4 ç±»å‹æ–­è¨€\nè¿˜åŸä¸ºåŸå§‹ç±»å‹ interface.(Type)\nå¦‚æœæ¥å£æ²¡æœ‰ä¿å­˜ç±»å‹ï¼Œåˆ™ä¼šæŠ¥é”™\nå¯è¿”å›ä¸¤ä¸ªå€¼\nvalue, ok := interface.(Type)\n5.2.5 ç©ºæ¥å£\ninterface{}\nç©ºæ¥å£å¯ä¿å­˜ä»»ä½•ç±»å‹\n5.2.6 nilé—®é¢˜\nnil å€¼ï¼šæœ‰ç±»å‹æ²¡æœ‰å€¼ï¼Œæ¥å£æœ¬èº«å¹¶ä¸æ˜¯ nilï¼Œå¯ä»¥å¤„ç†\nnil æ¥å£ï¼šå³æ²¡æœ‰ä¿å­˜å€¼ï¼Œä¹Ÿæ²¡æœ‰ä¿å­˜ç±»å‹ï¼Œä½¿ç”¨æ—¶ä¼šæŠ¥é”™\n//5.2 æ¥å£ type textMes struct { Type string Text string } func (tm *textMes) setText() { tm.Text = \"hello\" } type imgMes struct { Type string Img string } func (im *imgMes) setImg() { im.Img = \"æ¸…æ˜ä¸Šæ²³å›¾\" } type Mes interface { setType() } func (tm *textMes) setType() { tm.Type = \"æ–‡å­—æ¶ˆæ¯\" } func (im *imgMes) setType() { im.Type = \"å›¾ç‰‡æ¶ˆæ¯\" } func SendMes(m Mes) { m.setType() switch mptr := m.(type) { case *textMes: mptr.setText() case *imgMes: mptr.setImg() } fmt.Println(\"m=\", m) } func Interface() { tm := textMes{} SendMes(\u0026tm) im := imgMes{} SendMes(\u0026im) var n1 int = 1 n1interface := interface{}(n1) n2, ok := n1interface.(int) if ok { fmt.Println(\"n2=\", n2) } else { fmt.Println(\"ç±»å‹æ–­è¨€å¤±è´¥\") } } ç»§æ‰¿ golangæœ¬è´¨ä¸Šæ²¡æœ‰ocpçš„æ¦‚å¿µï¼Œä¹Ÿæ²¡æœ‰ç»§æ‰¿çš„æ¦‚å¿µï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡ç»“æ„ä½“åµŒå¥—å®ç°è¿™ä¸ªç‰¹æ€§ã€‚\ngolang ä¸­çš„ç»§æ‰¿æ˜¯é€šè¿‡ç»“æ„ä½“ä¸­çš„==åŒ¿åå­—æ®µ==æ¥å®ç°\nä¾‹ï¼šå®šä¹‰ä¸€ä¸ª BaseNum å¯¹è±¡ (ç»“æ„ä½“)ï¼Œä½œä¸ºçˆ¶ç±»ï¼ŒAdd å’ŒSub å¯¹è±¡(ç»“æ„ä½“)ä¸­åŒ…å«äº†BaseNum åŒ¿åå­—æ®µï¼Œ æ­¤æ—¶ Add å’ŒSub å°±æ˜¯BaseNumçš„å­ç±»\ntype BaseNum struct { num1 int num2 int } // BaseNum å³ä¸ºçˆ¶ç±»å‹åç§° type Add struct { BaseNum } //åŠ æ³•å­ç±», å®šä¹‰åŠ æ³•å­ç±»çš„ä¸»è¦ç›®çš„, æ˜¯ä¸ºäº†å®šä¹‰å¯¹åº”å­ç±»çš„æ–¹æ³• type Sub struct { BaseNum } //å‡æ³•å­ç±» æ„é€ å‡½æ•° golangæ²¡æœ‰æ„é€ å‡½æ•°çš„æ¦‚å¿µï¼Œå¯ä»¥ä½¿ç”¨å‡½æ•°æ¥æ¨¡æ‹Ÿæ„é€ å‡½æ•°çš„çš„åŠŸèƒ½ã€‚\npackage Base import \"fmt\" type Person1 struct { name string age int } func NewPerson(name string, age int) (*Person1, error) { if name == \"\" { return nil, fmt.Errorf(\"nameä¸èƒ½ä¸ºç©º\") } if age \u003c 0 { return nil, fmt.Errorf(\"ageä¸èƒ½å°äºg\") } return \u0026Person1{name: name, age: age}, nil } func Constructor() { person, err := NewPerson(\"tom\", 20) if err != nil { fmt.Printf(\"err:%v\\n\", err) } fmt.Printf(\"person:%v\\n\", *person) } åŒ…ç®¡ç†å·¥å…·go module go modulesæ˜¯golang1.11æ–°åŠ çš„ç‰¹æ€§ï¼Œç”¨æ¥ç®¡ç†æ¨¡å—ä¸­åŒ…çš„ä¾èµ–å…³ç³»ã€‚\ngo modä½¿ç”¨æ–¹æ³•\nåˆå§‹åŒ–æ¨¡å—\tgo mod init\u003cé¡¹ç›®æ¨¡å—åç§°\u003e\nä¾èµ–å…³ç³»å¤„ç†ï¼Œæ ¹æ®go.modæ–‡ä»¶\tgo mod tidy\nå°†ä¾èµ–åŒ…å¤åˆ¶åˆ°é¡¹ç›®ä¸‹çš„vendorç›®å½•\tgo mod vendor\nå¦‚æœåŒ…è¢«å±è”½ï¼ˆå¢™ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªå‘½ä»¤ï¼Œéšåä½¿ç”¨go build-mod=vendorç¼–è¯‘\næ˜¾ç¤ºä¾èµ–å…³ç³»\tgo list -m all\næ˜¾ç¤ºè¯¦ç»†ä¾èµ–å…³ç³»\tgo list -m -json all\nä¸‹è½½ä¾èµ–\tgo mod download [path@version] [path@version]æ˜¯éå¿…å†™çš„\nå¹¶å‘ç¼–ç¨‹-\u003eåç¨‹ Golangä¸­çš„å¹¶å‘æ˜¯å‡½æ•°ç›¸äº’ç‹¬ç«‹è¿è¡Œçš„èƒ½åŠ›ã€‚Goroutinesæ˜¯å¹¶å‘è¿è¡Œçš„å‡½æ•°ã€‚\nGolangæä¾›äº†Goroutinesä½œä¸ºå¹¶å‘å¤„ç†æ“ä½œçš„ä¸€ç§æ–¹å¼ã€‚\nåˆ›å»ºä¸€ä¸ªåç¨‹éå¸¸ç®€å•ï¼Œå°±æ˜¯åœ¨ä¸€ä¸ªä»»åŠ¡å‡½æ•°å‰é¢æ·»åŠ ä¸€ä¸ªgoå…³é”®å­—ï¼š\ngo task() Q1 select â€¦â€¦ case //5.3 åç¨‹ var ( c int lock sync.Mutex ) func PrimeNum(n int) { for i := 2; i \u003c n; i++ { if n%i == 0 { return } } fmt.Printf(\"%v\\t\", n) lock.Lock() c++ lock.Unlock() } func Goroutine() { for i := 2; i \u003c 100001; i++ { go PrimeNum(i) } var key string fmt.Scanln(\u0026key) fmt.Printf(\"\\nå…±æ‰¾åˆ°%vä¸ªç´ æ•°\\n\", c) } //5.4 channel func pushNum(c chan int) { for i := 0; i \u003c 100; i++ { c \u003c- i } close(c) } func pushPrimeNum(n int, c chan int) { for i := 2; i \u003c n; i++ { if n%i == 0 { return } } c \u003c- n } func Channel() { var c1 chan int = make(chan int) go pushNum(c1) // for { // v, ok := \u003c-c1 // if ok { // fmt.Printf(\"%v\\t\", v) // } else { // break // } // } for v := range c1 { fmt.Printf(\"%v\\t\", v) } var c2 chan int = make(chan int, 100) for i := 2; i \u003c 100001; i++ { go pushPrimeNum(i, c2) } Print: for { select { case v := \u003c-c2: fmt.Printf(\"%v\\t\", v) default: fmt.Println(\"æ‰€æœ‰ç´ æ•°å·²ç»æ‰¾åˆ°\") break Print } } } åœ¨ Go ç¼–ç¨‹è¯­è¨€ä¸­ï¼Œselect è¯­å¥ç”¨äºåœ¨å¤šä¸ªé€šé“æ“ä½œä¸­è¿›è¡Œé€‰æ‹©ã€‚å®ƒå¯ä»¥åœ¨å¤šä¸ªé€šé“ä¸Šç­‰å¾…æ•°æ®åˆ°è¾¾æˆ–æ“ä½œå®Œæˆï¼Œå¹¶æ ¹æ®æƒ…å†µæ‰§è¡Œç›¸åº”çš„æ“ä½œã€‚select çš„ç»“æ„å¦‚ä¸‹ï¼š\nselect { case \u003c-channel1: // æ‰§è¡Œ channel1 æ•°æ®åˆ°è¾¾æ—¶çš„æ“ä½œ case data := \u003c-channel2: // æ‰§è¡Œ channel2 æ•°æ®åˆ°è¾¾æ—¶çš„æ“ä½œï¼Œå¹¶å°†æ•°æ®å­˜å‚¨åœ¨ data å˜é‡ä¸­ case channel3 \u003c- data: // æ‰§è¡Œå°† data å‘é€åˆ° channel3 çš„æ“ä½œ default: // å½“æ²¡æœ‰ä»»ä½•é€šé“æ“ä½œå‡†å¤‡å°±ç»ªæ—¶æ‰§è¡Œçš„æ“ä½œ } åœ¨æ‚¨æä¾›çš„ä»£ç ä¸­ï¼Œæ‚¨ä½¿ç”¨äº† select æ¥ä»é€šé“ c2 ä¸­æ¥æ”¶æ•°æ®ï¼ŒåŒæ—¶è¿˜è®¾ç½®äº†ä¸€ä¸ª default åˆ†æ”¯ã€‚è®©æˆ‘å¯¹æ‚¨çš„ä»£ç è¿›è¡Œè§£é‡Šï¼š\né¦–å…ˆï¼Œæ‚¨åˆ›å»ºäº†ä¸€ä¸ªç¼“å†²é€šé“ c2ï¼Œå¹¶å¯åŠ¨äº†ä¸€ç³»åˆ— goroutineï¼Œæ¯ä¸ª goroutine è´Ÿè´£å°†ç´ æ•°æ¨é€åˆ° c2 é€šé“ã€‚ ç„¶åï¼Œä½¿ç”¨ä¸€ä¸ªæ— é™å¾ªç¯ï¼Œä¸æ–­åœ°æ‰§è¡Œ select è¯­å¥ã€‚ åœ¨ select è¯­å¥ä¸­ï¼Œæ‚¨ä½¿ç”¨äº†ä¸€ä¸ª case åˆ†æ”¯ï¼Œè¯¥åˆ†æ”¯å°è¯•ä» c2 é€šé“æ¥æ”¶ä¸€ä¸ªæ•´æ•°ã€‚å¦‚æœ c2 é€šé“ä¸­æœ‰æ•°æ®ï¼Œå®ƒä¼šæ‰§è¡Œç›¸åº”çš„æ“ä½œï¼Œå°†æ¥æ”¶åˆ°çš„æ•´æ•°æ‰“å°å‡ºæ¥ã€‚ æ‚¨è¿˜ä½¿ç”¨äº†ä¸€ä¸ª default åˆ†æ”¯ï¼Œè¿™æ˜¯å½“æ²¡æœ‰é€šé“æ“ä½œå‡†å¤‡å°±ç»ªæ—¶æ‰§è¡Œçš„åˆ†æ”¯ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒä¼šè¾“å‡º â€œæ‰€æœ‰ç´ æ•°å·²ç»æ‰¾åˆ°â€ï¼Œå¹¶é€šè¿‡ break Print è¯­å¥è·³å‡º for å¾ªç¯ã€‚ æ€»ç»“æ¥è¯´ï¼Œæ‚¨çš„ä»£ç é€šè¿‡å¤šä¸ªå¹¶å‘çš„ goroutine è®¡ç®—ç´ æ•°å¹¶æ¨é€åˆ°é€šé“ä¸­ï¼Œç„¶åä½¿ç”¨ select è¯­å¥ä»é€šé“ä¸­æ¥æ”¶æ•°æ®å¹¶è¿›è¡Œå¤„ç†ã€‚select çš„ä½œç”¨åœ¨äºå…è®¸æ‚¨åŒæ—¶ç­‰å¾…å¤šä¸ªé€šé“çš„æ•°æ®åˆ°è¾¾ï¼Œå“ªä¸ªé€šé“æœ‰æ•°æ®ï¼Œå°±æ‰§è¡Œç›¸åº”çš„æ“ä½œã€‚\né‚£è¿™æ®µä»£ç æ²¡æœ‰ select case å¯ä»¥å—ï¼Ÿ\nå½“æ‚¨ä½¿ç”¨ select æ—¶ï¼Œæ˜¯å› ä¸ºæ‚¨å¸Œæœ›èƒ½å¤ŸåŒæ—¶ç›‘è§†å¤šä¸ªé€šé“ï¼Œå¹¶åœ¨å…¶ä¸­ä»»ä½•ä¸€ä¸ªé€šé“å°±ç»ªæ—¶æ‰§è¡Œç›¸åº”çš„æ“ä½œã€‚åœ¨æ‚¨çš„ä»£ç ç¤ºä¾‹ä¸­ï¼Œæ‚¨ä½¿ç”¨ select æ¥ä»é€šé“ c2 æ¥æ”¶æ•°æ®ï¼Œå¹¶åœ¨æ²¡æœ‰æ•°æ®å¯æ¥æ”¶æ—¶è¾“å‡ºæç¤ºã€‚\nå¦‚æœæ‚¨ä¸éœ€è¦åŒæ—¶ç›‘è§†å¤šä¸ªé€šé“ï¼Œè€Œåªæ˜¯å¸Œæœ›ä»å•ä¸ªé€šé“ä¸­æ¥æ”¶æ•°æ®å¹¶æ‰§è¡Œç›¸åº”çš„æ“ä½œï¼Œé‚£ä¹ˆæ˜¯å¯ä»¥çœç•¥ select çš„ã€‚æ‚¨å¯ä»¥ç›´æ¥ä½¿ç”¨é€šé“çš„é˜»å¡æ¥æ”¶æ“ä½œï¼Œä¾‹å¦‚ï¼š\nfor { v, ok := \u003c-c2 if !ok { fmt.Println(\"æ‰€æœ‰ç´ æ•°å·²ç»æ‰¾åˆ°\") break } fmt.Printf(\"%v\\t\", v) } åœ¨è¿™ä¸ªå¾ªç¯ä¸­ï¼Œv, ok := \u003c-c2 å°†ä»é€šé“ c2 æ¥æ”¶æ•°æ®ï¼Œå¹¶å°†æ•°æ®å­˜å‚¨åœ¨å˜é‡ v ä¸­ã€‚åŒæ—¶ï¼Œok è¡¨ç¤ºé€šé“æ˜¯å¦å…³é—­ï¼Œå¦‚æœé€šé“å…³é—­äº†ï¼Œå°±ä¸å†æœ‰æ•°æ®å¯ä»¥æ¥æ”¶äº†ã€‚\nç„¶åï¼Œæ‚¨å¯ä»¥æ£€æŸ¥ ok çš„å€¼ï¼Œå¦‚æœä¸º falseï¼Œå°±è¾“å‡ºæç¤ºä¿¡æ¯å¹¶è·³å‡ºå¾ªç¯ã€‚å¦åˆ™ï¼Œç»§ç»­æ‰§è¡Œæ‰“å°æ“ä½œã€‚\næ‰€ä»¥ï¼Œæ‚¨å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚ï¼Œé€‰æ‹©ä½¿ç”¨å¸¦æœ‰ select çš„å¹¶å‘æ“ä½œï¼Œæˆ–è€…ç›´æ¥ä½¿ç”¨é€šé“çš„é˜»å¡æ¥æ”¶æ“ä½œã€‚\nå¹¶å‘ç¼–ç¨‹-\u003eé€šé“channel Goæä¾›äº†ä¸€ç§ç§°ä¸ºé€šé“çš„æœºåˆ¶ï¼Œç”¨äºåœ¨==goroutineä¹‹é—´==å…±äº«æ•°æ®ã€‚\nå½“æ‚¨ä½œä¸ºgoroutineæ‰§è¡Œå¹¶å‘æ´»åŠ¨æ—¶ï¼Œéœ€è¦åœ¨goroutineä¹‹é—´å…±äº«èµ„æºæˆ–æ•°æ®ï¼Œé€šé“å……å½“goroutineä¹‹é—´çš„ç®¡é“ï¼ˆç®¡é“ï¼‰å¹¶æä¾›ä¸€ç§æœºåˆ¶æ¥ä¿è¯åŒæ­¥äº¤æ¢ã€‚éœ€è¦åœ¨å£°æ˜é€šé“æ—¶æŒ‡å®šæ•°æ®ç±»å‹ã€‚æˆ‘ä»¬å¯ä»¥å…±äº«å†…ç½®ã€å‘½åã€ç»“æ„å’Œå¼•ç”¨ç±»å‹çš„å€¼å’ŒæŒ‡é’ˆã€‚æ•°æ®åœ¨é€šé“ä¸Šä¼ é€’ï¼šåœ¨ ä»»ä½•ç»™å®šæ—¶é—´åªæœ‰ä¸€ä¸ªgoroutineå¯ä»¥è®¿é—®æ•°æ®é¡¹ï¼šå› æ­¤æŒ‰ç…§è®¾è®¡ä¸ä¼šå‘ç”Ÿæ•°æ®ç«äº‰ã€‚\næ ¹æ®æ•°æ®äº¤æ¢çš„è¡Œä¸ºï¼Œæœ‰ä¸¤ç§ç±»å‹çš„é€šé“ï¼šæ— ç¼“å†²é€šé“å’Œç¼“å†²é€šé“ã€‚\næ— ç¼“å†²é€šé“ç”¨äºæ‰§è¡Œgoroutineä¹‹é—´çš„åŒæ­¥é€šä¿¡ï¼Œè€Œç¼“å†²é€šé“ç”¨äºæ‰§è¡Œå¼‚æ­¥é€šä¿¡ã€‚\næ— ç¼“å†²é€šé“ä¿è¯åœ¨å‘é€å’Œæ¥æ”¶å‘ç”Ÿçš„ç¬é—´æ‰§è¡Œä¸¤ä¸ªgoroutineä¹‹é—´çš„äº¤æ¢ã€‚ç¼“å†²é€šé“æ²¡æœ‰è¿™æ ·çš„ä¿è¯ã€‚\næ— ç¼“å†²é€šé“ï¼ˆUnbuffered Channelï¼‰å’Œç¼“å†²é€šé“ï¼ˆBuffered Channelï¼‰æ˜¯ Go è¯­è¨€ä¸­çš„ä¸¤ç§é€šé“ç±»å‹ï¼Œå®ƒä»¬åœ¨ä½¿ç”¨æ–¹å¼å’Œé€‚ç”¨åœºæ™¯ä¸Šæœ‰ä¸€äº›åŒºåˆ«ã€‚\næ— ç¼“å†²é€šé“ï¼š\næ— ç¼“å†²é€šé“æ˜¯æŒ‡åœ¨å‘é€æ•°æ®åˆ°é€šé“æ—¶ï¼Œå‘é€æ–¹ä¼šè¢«é˜»å¡ç›´åˆ°æ¥æ”¶æ–¹æ¥æ”¶æ•°æ®ã€‚åŒæ ·ï¼Œåœ¨æ¥æ”¶æ•°æ®æ—¶ï¼Œæ¥æ”¶æ–¹ä¼šè¢«é˜»å¡ç›´åˆ°å‘é€æ–¹å‘é€æ•°æ®ã€‚è¿™ç§é€šé“ä¿è¯äº†æ•°æ®çš„åŒæ­¥ä¼ è¾“ï¼Œå‘é€å’Œæ¥æ”¶æ˜¯ç´§å¯†è€¦åˆçš„ã€‚æ— ç¼“å†²é€šé“çš„å£°æ˜æ–¹å¼ä¸º make(chan T)ã€‚\né€‚ç”¨åœºæ™¯ï¼š\nåœ¨å¹¶å‘ç¼–ç¨‹ä¸­ï¼Œç”¨äºåè°ƒä¸¤ä¸ª goroutine ä¹‹é—´çš„åŒæ­¥æ“ä½œã€‚ å½“ç¡®ä¿å‘é€æ–¹å’Œæ¥æ”¶æ–¹åŒæ­¥å·¥ä½œå¾ˆé‡è¦æ—¶ï¼Œå¯ä»¥ä½¿ç”¨æ— ç¼“å†²é€šé“ã€‚ ç¼“å†²é€šé“ï¼š\nç¼“å†²é€šé“å…è®¸åœ¨é€šé“ä¸­å­˜å‚¨ä¸€å®šæ•°é‡çš„æ•°æ®ï¼Œå½“é€šé“ä¸­çš„æ•°æ®æ•°é‡è¾¾åˆ°ç¼“å†²åŒºå¤§å°æ—¶ï¼Œå‘é€æ–¹æ‰ä¼šè¢«é˜»å¡ã€‚åªæœ‰åœ¨é€šé“æ»¡äº†æ—¶ï¼Œå‘é€æ–¹æ‰ä¼šè¢«é˜»å¡ã€‚åŒæ ·ï¼Œå½“é€šé“ä¸­æ²¡æœ‰æ•°æ®æ—¶ï¼Œæ¥æ”¶æ–¹æ‰ä¼šè¢«é˜»å¡ã€‚ç¼“å†²é€šé“çš„å£°æ˜æ–¹å¼ä¸º make(chan T, capacity)ã€‚\né€‚ç”¨åœºæ™¯ï¼š\nåœ¨è§£è€¦å‘é€æ–¹å’Œæ¥æ”¶æ–¹çš„æƒ…å†µä¸‹ï¼Œå…è®¸å‘é€æ–¹å‘é€æ•°æ®åˆ°é€šé“ï¼Œç„¶åç»§ç»­æ‰§è¡Œå…¶ä»–æ“ä½œï¼Œè€Œä¸å¿…ç­‰å¾…æ¥æ”¶æ–¹ã€‚ åœ¨ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ç¼“å†²é€šé“æ¥å¹³è¡¡ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä¹‹é—´çš„é€Ÿåº¦å·®å¼‚ é€šé“ç”±makeå‡½æ•°åˆ›å»ºï¼Œè¯¥å‡½æ•°æŒ‡å®šchanå…³é”®å­—å’Œé€šé“çš„å…ƒç´ ç±»å‹ã€‚\nè¿™æ˜¯åˆ›å»ºæ— ç¼“å†²å’Œç¼“å†²é€šé“çš„ä»£ç å—ï¼š\nè¯­æ³•\nUnbuffered:=make(chan int)\t//æ•´å‹æ— ç¼“å†²é€šé“ buffered:=make(chan int,10)\t//æ•´å‹æœ‰ç¼“å†²é€šé“ ä½¿ç”¨å†…ç½®å‡½æ•°makeåˆ›å»ºæ— ç¼“å†²å’Œç¼“å†²é€šé“ã€‚\nmakeçš„ç¬¬ä¸€ä¸ªå‚æ•°éœ€è¦å…³é”®å­—chan,ç„¶åæ˜¯é€šé“å…è®¸äº¤æ¢çš„æ•°æ®ç±»å‹ã€‚\npackage Base import ( \"math/rand\" \"time\" ) var channel = make(chan int) func send() { rand.Seed(time.Now().UnixNano()) random := rand.Intn(10) println(\"éšæœºå€¼ï¼š\", random) time.Sleep(2 * time.Second) channel \u003c- random } func GoRoutine() { defer close(channel) go send() println(\"wait...\") receive := \u003c-channel println(\"æ¥æ”¶å€¼ï¼š\", receive) println(\"end...\") } channel éå† package Base func Channel() { c := make(chan int) go func() { for i := 0; i \u003c 5; i++ { c \u003c- i } close(c) }() for v := range c { println(v) } } å¹¶å‘ç¼–ç¨‹-\u003eWaitGroupå®ç°åŒæ­¥ æŸ¥çœ‹æ·»åŠ WaitGroupå’Œä¸æ·»åŠ WaitGroupçš„åŒºåˆ«\npackage Base import ( \"fmt\" \"sync\" ) var wg sync.WaitGroup func showMsg(i int) { defer wg.Done() fmt.Println(i) } func GoRoutine() { for i := 0; i \u003c 10; i++ { wg.Add(1) go showMsg(i) } wg.Wait() } // StuData è¯·æ±‚å‚æ•°éªŒè¯ç»“æ„ type StuData struct { File *multipart.FileHeader `form:\"file\" binding:\"required\"` } func dealStuData(row []string, buff chan map[string]string, wg *sync.WaitGroup, userList chan map[string]string, errData chan []string) { errMsg := make(map[string]string, 0) // ä¸èƒ½æäº¤ç©ºæ•°æ® for _, val := range row { if val == \"\" { errMsg[\"name\"] = row[common.EStuName] errMsg[\"reason\"] = \"æ•°æ®ä¸èƒ½ä¸ºç©º\" errData \u003c- row buff \u003c- errMsg wg.Done() return } } if row[common.EStuGender] != \"ç”·\" \u0026\u0026 row[common.EStuGender] != \"å¥³\" { errMsg[\"name\"] = row[common.EStuName] errMsg[\"reason\"] = \"æ€§åˆ«æ ¼å¼é”™è¯¯\" errData \u003c- row buff \u003c- errMsg wg.Done() return } // æ¯”å¯¹å­¦é™¢ä»£ç æ˜¯å¦æ­£ç¡® org := common.Organization{} err := org.GetOrgByCode(row[common.EStuCollegeCode]) if err != nil { msg := fmt.Sprintf(\"æŸ¥è¯¢ç›®æ ‡å­¦é™¢ä»£ç é”™è¯¯:%v\", err) logger.Error(msg) errMsg[\"name\"] = row[common.EStuName] errMsg[\"reason\"] = msg errData \u003c- row buff \u003c- errMsg wg.Done() return } if errors.Is(err, sql.ErrNoRows) || org.Name != row[common.EStuCollege] { var msg string if org.Code != \"\" { msg = fmt.Sprintf(\"åŒä¸€ä¸ªå­¦é™¢å‡ºç°ä¸åŒçš„å­¦é™¢ä»£ç ï¼šæ­£ç¡®ï¼šã€%v,%vã€‘ï¼Œé”™è¯¯ï¼šã€%v,%vã€‘\", org.Code, org.Name, row[common.EStuCollegeCode], row[common.EStuCollege]) } else { msg = fmt.Sprintf(\"ä¸å­˜åœ¨ä»£ç ä¸ºï¼š%vçš„å­¦é™¢\", row[common.EStuCollegeCode]) } logger.Error(msg) errMsg[\"name\"] = row[common.EStuName] errMsg[\"reason\"] = msg errData \u003c- row buff \u003c- errMsg wg.Done() return } ab := common.AddrBook{} // é€šè¿‡åŒæ­¥ç³»ç»Ÿæ•°æ®åº“æŸ¥çœ‹ä¼ä¸šå¾®ä¿¡ä¸­æ˜¯å¦æœ‰å¯¹åº”çš„å­¦é™¢éƒ¨é—¨ collegeDep, err := ab.GetDepByDbID(row[common.EStuCollegeCode], row[common.EStuLevel]) if err != nil \u0026\u0026 !errors.Is(err, sql.ErrNoRows) { msg := fmt.Sprintf(\"æŸ¥è¯¢åŒæ­¥ç³»ç»Ÿåº“å¤±è´¥:%s\", err.Error()) logger.Error(msg) errMsg[\"name\"] = row[common.EStuName] errMsg[\"reason\"] = msg errData \u003c- row buff \u003c- errMsg wg.Done() return } // å¦‚æœå¯¹åº”å­¦é™¢éƒ¨é—¨ä¸å­˜åœ¨ if errors.Is(err, sql.ErrNoRows) { parentDepid, _ := strconv.Atoi(pid[row[common.EStuLevel]]) depid, err := ab.GetAndUpdateConf() if err != nil { // TODO æ•°æ®åº“å¼‚å¸¸æ¦‚ç‡å°ï¼Œæ•…ç›´æ¥è¿”å›500 logger.Error(err.Error()) errMsg[\"name\"] = row[common.EStuName] errMsg[\"reason\"] = err.Error() errData \u003c- row buff \u003c- errMsg wg.Done() return } // TODO åœ¨ä¼ä¸šå¾®ä¿¡ä¸­æ–°å»ºå­¦é™¢éƒ¨é—¨ err = Wxapi.CreateDept(row[common.EStuCollege], int64(parentDepid), depid, depid) if err != nil { logger.Error(fmt.Sprintf(\"æ–°å»ºå­¦é™¢éƒ¨é—¨å¤±è´¥: %s,é”™è¯¯æ•°æ®ä¸º:[%s],\", err.Error(), strings.Join(row, \",\"))) errMsg[\"name\"] = row[common.EStuName] errMsg[\"reason\"] = err.Error() errData \u003c- row buff \u003c- errMsg wg.Done() return } collegeDep.WxName = row[common.EStuCollege] collegeDep.WxParentID = pid[row[common.EStuLevel]] collegeDep.WxCollegeID = \"None\" collegeDep.DbID = row[common.EStuCollegeCode] collegeDep.Grade = \"None\" collegeDep.WxGrade = \"None\" collegeDep.Level = 3 // TODO å°†éƒ¨é—¨ä¿¡æ¯å†™å…¥æ•°æ®åº“ err = ab.NewDep(\u0026collegeDep, row[common.EStuLevel], depid) if err != nil { msg := fmt.Sprintf(\"å°†éƒ¨é—¨ä¿¡æ¯å†™å…¥æ•°æ®åº“å¤±è´¥: %s,\", err.Error()) logger.Error(msg) // TODO åˆ é™¤åˆ›å»ºçš„éƒ¨é—¨ err := Wxapi.DelDept(depid) if err != nil { logger.Error(fmt.Sprintf(\"åˆ é™¤éƒ¨é—¨å¤±è´¥ï¼š%s\", err.Error())) } errMsg[\"name\"] = row[common.EStuName] errMsg[\"reason\"] = msg errData \u003c- row buff \u003c- errMsg wg.Done() return } } // é€šè¿‡åŒæ­¥ç³»ç»Ÿæ•°æ®åº“æŸ¥çœ‹ä¼ä¸šå¾®ä¿¡ä¸­æ˜¯å¦æœ‰å¯¹åº”çš„å¹´çº§éƒ¨é—¨ gradeDep, err := ab.GetDepByParentIdAndName(collegeDep.WxID, row[common.EStuGrade], row[common.EStuLevel]) if err != nil \u0026\u0026 !errors.Is(err, sql.ErrNoRows) { msg := fmt.Sprintf(\"æŸ¥è¯¢åŒæ­¥æ•°æ®åº“å¤±è´¥: %s\", err.Error()) logger.Error(msg) errMsg[\"name\"] = row[common.EStuName] errMsg[\"reason\"] = msg errData \u003c- row buff \u003c- errMsg wg.Done() return } // å¦‚æœå¹´çº§éƒ¨é—¨ä¸å­˜åœ¨ if errors.Is(err, sql.ErrNoRows) { parentId, _ := strconv.Atoi(collegeDep.WxID) depid, err := ab.GetAndUpdateConf() if err != nil { // TODO æ•°æ®åº“å¼‚å¸¸æ¦‚ç‡å°ï¼Œæ•…ç›´æ¥è¿”å›500 logger.Error(fmt.Sprintf(\"æŸ¥è¯¢åŒæ­¥æ•°æ®åº“å¤±è´¥:%s\", err.Error())) errMsg[\"name\"] = row[common.EStuName] errMsg[\"reason\"] = err.Error() errData \u003c- row buff \u003c- errMsg wg.Done() return } // TODO åœ¨ä¼ä¸šå¾®ä¿¡ä¸­æ–°å»ºå¹´çº§éƒ¨é—¨ err = Wxapi.CreateDept(row[common.EStuGrade], int64(parentId), depid, depid) if err != nil { logger.Error(fmt.Sprintf(\"æ–°å»ºå¹´çº§éƒ¨é—¨å¤±è´¥: %s\", err.Error())) errMsg[\"name\"] = row[common.EStuName] errMsg[\"reason\"] = err.Error() errData \u003c- row buff \u003c- errMsg wg.Done() return } gradeDep.WxName = row[common.EStuGrade] gradeDep.WxParentID = collegeDep.WxID gradeDep.WxCollegeID = collegeDep.WxID gradeDep.DbID = \"None\" gradeDep.Grade = \"None\" gradeDep.WxGrade = \"None\" gradeDep.Level = collegeDep.Level + 1 // TODO å°†éƒ¨é—¨ä¿¡æ¯å†™å…¥æ•°æ®åº“ err = ab.NewDep(\u0026gradeDep, row[common.EStuLevel], depid) if err != nil { msg := fmt.Sprintf(\"å°†éƒ¨é—¨ä¿¡æ¯å†™å…¥æ•°æ®åº“å¤±è´¥: %s,\", err.Error()) logger.Error(msg) errMsg[\"name\"] = row[common.EStuName] errMsg[\"reason\"] = msg errData \u003c- row buff \u003c- errMsg wg.Done() return } } // å…ˆæŸ¥è¯¢æ˜¯å¦æœ‰è¯¥æ–°ç”Ÿæ•°æ® bts := common.TStudent{} err1 := bts.QueryStudentByIdCard(row[common.EStuIdCard]) if err1 != nil \u0026\u0026 !errors.Is(err1, gorm.ErrRecordNotFound) { msg := fmt.Sprintf(\"æŸ¥è¯¢å­¦ç”Ÿä¿¡æ¯é”™è¯¯:%s\", err) logger.Error(msg) errMsg[\"name\"] = row[common.EStuName] errMsg[\"reason\"] = msg errData \u003c- row buff \u003c- errMsg wg.Done() return } // å½•å…¥æ–°ç”Ÿæ•°æ® ts := common.TStudent{ Name: row[common.EStuName], IdCard: row[common.EStuIdCard], StuId: row[common.EStuStuId], Gender: WxGender[row[common.EStuGender]], Birthday: row[common.EStuBirth], College: row[common.EStuCollege], CollegeCode: row[common.EStuCollegeCode], Grade: row[common.EStuGrade], Level: row[common.EStuLevel], } curUser := make(map[string]string, 0) curUser[\"name\"] = row[common.EStuName] curUser[\"idcard\"] = row[common.EStuIdCard] curUser[\"stu_id\"] = row[common.EStuStuId] curUser[\"gender\"] = WxGender[row[common.EStuGender]] curUser[\"birth\"] = row[common.EStuBirth] curUser[\"college\"] = row[common.EStuCollege] curUser[\"college_code\"] = row[common.EStuCollegeCode] curUser[\"grade\"] = row[common.EStuGrade] curUser[\"level\"] = row[common.EStuLevel] exist := false // å¦‚æœå·²æœ‰ä¿¡æ¯ if err1 == nil { if bts.Status == \"å·²æ ¸éªŒ\" { errMsg[\"name\"] = row[common.EStuName] errMsg[\"reason\"] = \"success\" buff \u003c- errMsg wg.Done() return } err := ts.UpdateStudentByIdCard(ts.IdCard) if err != nil { msg := fmt.Sprintf(\"ä¿®æ”¹å­¦ç”Ÿä¿¡æ¯å¤±è´¥:%s,é”™è¯¯æ•°æ®:[%s]\", err, strings.Join(row, \",\")) logger.Error(msg) errMsg[\"name\"] = row[common.EStuName] errMsg[\"reason\"] = msg errData \u003c- row buff \u003c- errMsg wg.Done() return } exist = true } //TODO åˆ¤æ–­ä¸­é—´åº“ä¸­æ˜¯å¦æœ‰è¯¥ç ”ç©¶ç”Ÿçš„ä¿¡æ¯ï¼ˆè¦ä»ä¸­é—´åº“ä¸­æœ¬ç§‘ç”Ÿï¼Œç ”ç©¶ç”Ÿï¼Œæ•™èŒå·¥è¡¨ä¸­æŸ¥è¯¢ï¼‰ if row[common.EStuLevel] != \"æœ¬ç§‘ç”Ÿ\" { pgStu := common.PGStudent{} originPosition, err2 := pgStu.GetStudentByIdCard(row[common.EStuIdCard]) if err2 != nil \u0026\u0026 !errors.Is(err2, sql.ErrNoRows) { logger.Error(fmt.Sprintf(\"ä¸­é—´åº“æ“ä½œé”™è¯¯ï¼š%s\", err2)) errMsg[\"name\"] = row[common.EStuName] errMsg[\"reason\"] = err2.Error() errData \u003c- row buff \u003c- errMsg wg.Done() return } // TODO å¦‚æœè¯¥ç ”ç©¶ç”Ÿä¿¡æ¯åœ¨ä¸­é—´åº“ä¸­å­˜åœ¨ if err2 == nil { user, err3 := Wxapi.GetUser(pgStu.StuID) if err3 != nil { msg := fmt.Sprintf(\"åœ¨ä¼ä¸šå¾®ä¿¡ä¸­è·å–ç ”ç©¶ç”Ÿ:%s çš„ä¿¡æ¯å¤±è´¥,ERROR:%s\", pgStu.Name, err3.Error()) logger.Error(msg) errMsg[\"name\"] = row[common.EStuName] errMsg[\"reason\"] = msg errData \u003c- row buff \u003c- errMsg wg.Done() return } var depid []int64 d, _ := strconv.Atoi(gradeDep.WxID) for _, val := range user.Departments { if val.DeptID != int64(d) { depid = append(depid, val.DeptID) } } // TODO ç»™ä¼ä¸šå¾®ä¿¡ä¸­å­˜åœ¨æ•°æ®çš„ç ”ç©¶ç”Ÿæ·»åŠ æ–°éƒ¨é—¨ depid = append(depid, int64(d)) extattr := user.Extattr err4 := Wxapi.UpdateUser(pgStu.StuID, pgStu.Name, depid, WxGender[row[common.EStuGender]], extattr) if err4 != nil { msg := fmt.Sprintf(\"æ›´æ–°å·²æœ‰ç ”ç©¶ç”Ÿéƒ¨é—¨å¤±è´¥:%s\", err4.Error()) logger.Error(msg) errMsg[\"name\"] = row[common.EStuName] errMsg[\"reason\"] = msg errData \u003c- row buff \u003c- errMsg wg.Done() return } ts.Status = \"å·²æ ¸éªŒ\" ts.InMidDb = \"y\" //è®°å½•è¯¥æˆå‘˜ä¿¡æ¯åœ¨ä¸­é—´åº“ä¸­å­˜åœ¨ ts.OriginalPosition = originPosition curUser[\"status\"] = \"å·²æ ¸éªŒ\" curUser[\"in_middb\"] = \"y\" curUser[\"originPosition\"] = originPosition } } // è·å–æ ‡ç­¾åˆ—è¡¨ taglist, err := Wxapi.GetTagList() if err != nil { logger.Error(fmt.Sprintf(\"è·å–ä¼ä¸šå¾®ä¿¡æ ‡ç­¾åˆ—è¡¨å¤±è´¥:%s\", err.Error())) errMsg[\"name\"] = row[common.EStuName] errMsg[\"reason\"] = err.Error() errData \u003c- row buff \u003c- errMsg wg.Done() return } flag := false // åˆ¤æ–­æ ‡ç­¾æ˜¯å¦å­˜åœ¨ tmp := strings.Replace(row[common.EStuGrade], \"çº§\", \"\", -1) tmp = fmt.Sprintf(\"%s/æ‰€æœ‰å­¦é™¢%sçº§éƒ¨é—¨\", row[common.EStuLevel], tmp) for _, values := range taglist.TagList { if values.TagName == tmp { flag = true break } } tagId := int64(-1) // æ ‡ç­¾ä¸å­˜åœ¨ if !flag { var err error tagId, err = Wxapi.CreateTag(tmp) if err != nil { msg := fmt.Sprintf(\"åˆ›å»ºæ ‡ç­¾å¤±è´¥ï¼š%s,ERR: %s\", tmp, err.Error()) logger.Error(msg) errMsg[\"name\"] = row[common.EStuName] errMsg[\"reason\"] = msg errData \u003c- row buff \u003c- errMsg wg.Done() return } } // å°†å¯¹åº”å¹´çº§éƒ¨é—¨åŠ å…¥åˆ°æ ‡ç­¾ if tagId != -1 { curDepid, _ := strconv.Atoi(gradeDep.WxID) err := Wxapi.AddTagUserOrDep(tagId, []string{}, []int64{int64(curDepid)}) if err != nil { msg := fmt.Sprintf(\"ä¸ºéƒ¨é—¨%væ·»åŠ æ ‡ç­¾ï¼š[%v]å¤±è´¥ï¼ŒERR: %s\", gradeDep.WxID, tmp, err.Error()) logger.Error(msg) errMsg[\"name\"] = row[common.EStuName] errMsg[\"reason\"] = msg errData \u003c- row buff \u003c- errMsg wg.Done() return } } errMsg[\"name\"] = row[common.EStuName] errMsg[\"reason\"] = \"success\" if !exist { userList \u003c- curUser } buff \u003c- errMsg wg.Done() } func (st *StuHandle) ImportStuData(context *gin.Context) { var resp = gin.H{ \"status\": 200, \"msg\": \"æ“ä½œæˆåŠŸ\", \"err_data_url\": \"\", } var form StuData if err := context.ShouldBind(\u0026form); err != nil { logger.Error(err.Error()) Response(context, http.StatusBadRequest, \"è¯·æ±‚ä¸åˆæ³•\", resp) return } tmpFile := `./fileTmp/test.xlsx` if _, err := os.Stat(tmpFile); os.IsNotExist(err) { logger.Info(\"æ–‡ä»¶ä¸å­˜åœ¨\") } else { logger.Info(\"æ–‡ä»¶å­˜åœ¨\") err := os.Remove(tmpFile) if err != nil { msg := fmt.Sprintf(\"åˆ é™¤æ–‡ä»¶å¤±è´¥: %s\", err) logger.Error(msg) Response(context, http.StatusInternalServerError, \"æ“ä½œå¤±è´¥ï¼Œè¯·ç¨åå†è¯•\", resp) return } } // æ¥æ”¶å¹¶å¤„ç†ä¸Šä¼ çš„excelè¡¨æ ¼ err := context.SaveUploadedFile(form.File, tmpFile) if err != nil { msg := fmt.Sprintf(\"ä¿å­˜ä¸Šä¼ æ–‡ä»¶å¤±è´¥: %s\", err) logger.Error(msg) Response(context, http.StatusInternalServerError, \"æ“ä½œå¤±è´¥ï¼Œè¯·ç¨åå†è¯•\", resp) return } f, err := excelize.OpenFile(tmpFile) if err != nil { msg := fmt.Sprintf(\"æ‰“å¼€æ–‡ä»¶å¤±è´¥:%s\", err) logger.Error(msg) Response(context, http.StatusInternalServerError, \"æ“ä½œå¤±è´¥ï¼Œè¯·ç¨åå†è¯•\", resp) return } // å…³é—­æ–‡ä»¶ defer func() { if err := f.Close(); err != nil { msg := fmt.Sprintf(\"å…³é—­æ–‡ä»¶å¤±è´¥:%s\", err) logger.Error(msg) } }() rows, err := f.GetRows(\"Sheet1\") if err != nil { msg := fmt.Sprintf(\"è¯»å–Excelæ–‡ä»¶å¤±è´¥: %s\", err.Error()) logger.Error(msg) Response(context, http.StatusAccepted, \"è§£æExcelæ•°æ®é”™è¯¯ï¼Œè¯·ç¡®ä¿æäº¤æ­£ç¡®çš„Excelæ•°æ®\", resp) return } if len(rows) == 0 { logger.Error(\"ä¸èƒ½æäº¤ç©ºæ–‡ä»¶\") Response(context, http.StatusAccepted, \"ä¸èƒ½æäº¤ç©ºæ–‡ä»¶\", resp) return } row := rows[0] if len(row) != 9 || row[common.EStuName] != \"å§“å\" || row[common.EStuIdCard] != \"èº«ä»½è¯å·\" || row[common.EStuStuId] != \"å­¦å·\" || row[common.EStuGender] != \"æ€§åˆ«\" || row[common.EStuBirth] != \"å‡ºç”Ÿæ—¥æœŸ\" || row[common.EStuCollege] != \"å­¦é™¢åç§°\" || row[common.EStuCollegeCode] != \"å­¦é™¢ä»£ç \" || row[common.EStuGrade] != \"å¹´çº§\" || row[common.EStuLevel] != \"å±‚æ¬¡\" { logger.Error(\"Excelæ ¼å¼ä¸ç¬¦åˆæ¨¡æ¿è¦æ±‚\") Response(context, http.StatusBadRequest, \"Excelæ ¼å¼ä¸ç¬¦åˆæ¨¡æ¿è¦æ±‚\", resp) return } var wg sync.WaitGroup wg.Add(len(rows) - 1) buff := make(chan map[string]string, len(rows)-1) //å»ºç«‹ç¼“å†²åŒºï¼Œè®°å½•ä¸èƒ½å¯¼å…¥çš„æ•°æ®å¯¹åº”çš„å§“å _failInfo := make([]map[string]string, 0) userBuff := make(chan map[string]string, len(rows)-1) errBuff := make(chan []string, len(rows)-1) // å¤šè¿›ç¨‹å¤„ç†ï¼Œä¸ºæ¯æ¡æ•°æ®åˆ†é…ä¸€ä¸ªgoroutine for _, data := range rows[1:] { if len(data) != 9 { msg := fmt.Sprintf(\"æ•°æ®ä¸ç¬¦åˆè¦æ±‚ï¼šã€%vã€‘\", data) logger.Error(msg) tmp := make(map[string]string, 0) tmp[\"name\"] = row[common.EStuName] tmp[\"reason\"] = msg errBuff \u003c- data buff \u003c- tmp } // å¤šçº¿ç¨‹å¤„ç†ï¼Œä¸ºæ¯æ¡æ•°æ®å¼€ä¸€ä¸ªçº¿ç¨‹ go dealStuData(data, buff, \u0026wg, userBuff, errBuff) } wg.Wait() close(buff) close(userBuff) close(errBuff) for val := range buff { _failInfo = append(_failInfo, val) } ts := common.TStudent{} userList := make([]common.TStudent, 0) for val := range userBuff { t := common.TStudent{ Name: val[\"name\"], IdCard: val[\"idcard\"], StuId: val[\"stu_id\"], Gender: val[\"gender\"], Birthday: val[\"birth\"], College: val[\"college\"], CollegeCode: val[\"college_code\"], Grade: val[\"grade\"], Level: val[\"level\"], } t.Status = val[\"status\"] t.InMidDb = val[\"in_middb\"] t.OriginalPosition = val[\"originPosition\"] userList = append(userList, t) } failData := make([][]string, 0) for val := range errBuff { failData = append(failData, val) } err = ts.CreateStudent(userList) if err != nil { logger.Error(err.Error()) Response(context, http.StatusInternalServerError, err.Error(), resp) return } success := 0 fail := 0 var failInfo []string for _, val := range _failInfo { if val[\"reason\"] != \"success\" { fail++ failInfo = append(failInfo, val[\"reason\"]) continue } success++ } if len(failData) == 0 { resp[\"err_data_url\"] = \"\" } else { fileName, _ := golib.NewErrDataFile(failData, failInfo) fileName = strings.Replace(fileName, \".xlsx\", \"\", -1) resp[\"err_data_url\"] = fmt.Sprintf(\"%v/student/err?name=%v\", config.HostName, fileName) } msg := fmt.Sprintf(\"æˆåŠŸå¯¼å…¥æ¡æ•°:%d å¯¼å…¥å¤±è´¥æ¡æ•°:%d æ€»è®¡æ¡æ•°:%d\", success, len(failData), len(rows)-1) status := http.StatusOK if fail != 0 { status = http.StatusAccepted } Response(context, status, msg, resp) return } // ä¸‹è½½ä¸èƒ½å¯¼å…¥çš„ä¿¡æ¯ type reqErrFile struct { FileName int `form:\"name\" binding:\"required\"` } func (st *StuHandle) StuErrFile(ctx *gin.Context) { resp := gin.H{ \"status\": 200, \"msg\": \"æ“ä½œæˆåŠŸ\", } err := golib.DelOldFile() if err != nil { logger.Error(fmt.Sprintf(\"åˆ é™¤æ—§æ–‡ä»¶å¤±è´¥ï¼š%v\", err)) Response(ctx, http.StatusInternalServerError, \"æ“ä½œå¤±è´¥\", resp) return } var form reqErrFile if err := ctx.ShouldBind(\u0026form); err != nil { logger.Error(fmt.Sprintf(\"å‚æ•°é”™è¯¯ï¼š%v\", err)) Response(ctx, http.StatusBadRequest, \"æ“ä½œä¸åˆæ³•\", resp) return } file, err := ioutil.ReadFile(fmt.Sprintf(\"./fileTmp/%v.xlsx\", form.FileName)) if err != nil { logger.Error(fmt.Sprintf(\"è¯»å–æ–‡ä»¶å¤±è´¥:%v\", err)) Response(ctx, http.StatusNotFound, \"æ‰¾ä¸åˆ°èµ„æº\", resp) return } ctx.Header(\"content-disposition\", `attachment; filename=`+fmt.Sprintf(\"%v.xlsx\", form.FileName)) ctx.Data(200, \"application/octet-stream\", file) } d := make(map[string]int,6) d[\"name\"] = 0 d[\"content\"] = 1 d[\"org\"] = 2 d[\"year\"] = 3 d[\"user_id\"] = 4 d[\"username\"] = 5 data å¹¶å‘ç¼–ç¨‹-\u003eruntime runtimeåŒ…é‡Œé¢å®šä¹‰äº†ä¸€äº›åç¨‹ç®¡ç†ç›¸å…³çš„api\nruntime.Gosched() è®©å‡ºCPUæ—¶é—´ç‰‡ï¼Œé‡æ–°ç­‰å¾…å®‰æ’ä»»åŠ¡\nfunc showMsg1(s string) { for i := 0; i \u003c 2; i++ { fmt.Println(s) } } func RunTime() { go showMsg1(\"java\") for i := 0; i \u003c 2; i++ { runtime.Gosched() fmt.Println(\"golang\") } fmt.Println(\"end...\") } java java golang golang end... å¦‚æœæ²¡æœ‰ç¬¬11è¡Œï¼Œå¯èƒ½mainåç¨‹ç›´æ¥ç»“æŸå•¦ golang golang end... runtime.Goexit() é€€å‡ºåç¨‹\nruntime.Goexit() runtime.GOMAXPROCS() func showA() { for i := 0; i \u003c 15; i++ { fmt.Printf(\"A:%v\\n\", i) } } func showB() { for i := 0; i \u003c 15; i++ { fmt.Printf(\"B:%v\\n\", i) } } func RunTime() { cpuNum := runtime.NumCPU() // æˆ‘è¿™æ˜¯ 8 æ ¸ println(cpuNum) runtime.GOMAXPROCS(1) // å¦‚æœè®¾ç½®ä¸º 1 ï¼Œåˆ™ä¸ä¼šäº¤æ›¿æ‰§è¡Œã€‚é™¤éæœ‰ç¡çœ åœ¨ã€‚ go showA() go showB() time.Sleep(time.Second) } å¹¶å‘ç¼–ç¨‹-\u003eMutexäº’æ–¥é”å®ç°åŒæ­¥ é™¤äº†ä½¿ç”¨ channel å®ç°åŒæ­¥ä¹‹å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨Mutexäº’æ–¥é”çš„æ–¹å¼å®ç°åŒæ­¥ã€‚\nGoè¯­è¨€æä¾›äº†syncåŒ…å’Œchannelæœºåˆ¶æ¥è§£å†³å¹¶å‘æœºåˆ¶ä¸­ä¸åŒgoroutineä¹‹é—´çš„åŒæ­¥å’Œé€šä¿¡\næ²¡åŠ é” package Base import ( \"fmt\" \"time\" ) func addOne(i int) { i++ } func subOne(i int) { i-- } func Mutex() { var i = 1 for ; i \u003c= 1000; i++ { go addOne(i) go subOne(i) } time.Sleep(time.Second * 1) fmt.Println(\"Sum:\", i) } Sum: 1001 åŠ äº†é” package Base import ( \"fmt\" \"sync\" \"time\" ) var mutex sync.Mutex func addOne(i int) { mutex.Lock() i++ mutex.Unlock() } func subOne(i int) { mutex.Lock() i-- mutex.Unlock() } func Mutex() { i := 0 for ; i \u003c 1000; i++ { go addOne(i) go subOne(i) } time.Sleep(time.Second * 1) fmt.Println(\"Sum:\", i) } Sum: 1000 é” Locker Goè¯­è¨€ä½¿ç”¨goè¯­å¥å¼€å¯æ–°çš„goroutineï¼Œç”±äºgoroutineéå¸¸è½»é‡é™¤äº†å¯¹å…¶åˆ†é…æ ˆç©ºé—´å¤–ï¼Œæ‰€å çš„ç©ºé—´ä¹Ÿæ˜¯å¾®ä¹å…¶å¾®çš„ã€‚ä½†å½“å¤šä¸ªgoroutineåŒæ—¶å¤„ç†æ—¶ä¼šé‡åˆ°æ¯”å¦‚åŒæ—¶æŠ¢å ä¸€ä¸ªèµ„æºï¼ŒæŸä¸ªgoroutineä¼šç­‰å¾…ç­‰ä¸€ä¸ªgoroutineå¤„ç†å®Œæ¯•æŸæ‰èƒ½ç»§ç»­æ‰§è¡Œçš„é—®é¢˜ã€‚å¯¹äºè¿™ç§æƒ…å†µï¼Œå®˜æ–¹å¹¶ä¸å¸Œæœ›ä¾é å…±äº«å†…å­˜çš„æ–¹å¼æ¥å®ç°è¿›ç¨‹çš„ååŒæ“ä½œï¼Œè€Œæ˜¯å¸Œæœ›é€šè¿‡channelä¿¡é“çš„æ–¹å¼æ¥å¤„ç†ã€‚ä½†åœ¨æŸäº›ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œä¾ç„¶éœ€è¦ä½¿ç”¨åˆ°é”ï¼Œä¸ºæ­¤syncåŒ…æä¾›äº†é”ã€‚\nå½“åœ¨å¹¶å‘æƒ…å†µä¸‹ï¼Œå¤šä¸ªgoroutineåŒæ—¶ä¿®æ”¹æŸä¸€ä¸ªå˜é‡æ—¶ï¼Œå°±ä¼šå‡ºç°èµ„æºæŠ¢å ï¼Œå› æ­¤ä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ã€‚\npackage main import ( \"fmt\" \"time\" ) func main() { var num = 0 for i := 0; i \u003c 100000; i++ { go func(i int) { num++ fmt.Printf(\"goroutine %d: num = %d\\n\", i, num) }(i) } time.Sleep(time.Second)//ä¸»goroutineç­‰å¾…1ç§’ä»¥ç¡®ä¿æ‰€æœ‰å·¥ä½œgoroutineæ‰§è¡Œå®Œæ¯• } ... goroutine 10018: num = 98635 goroutine 12646: num = 98635 goroutine 12844: num = 98635 goroutine 12950: num = 98635 ... ä¸Šä¾‹ä¸­goroutineä¸€ä¾æ¬¡ä»å¯„å­˜å™¨ä¸­è¯»å–numçš„å€¼ååšåŠ æ³•è¿ç®—ï¼Œç„¶åå°†å…¶ç»“æœå›å†™åˆ°å¯„å­˜å™¨ä¸­ã€‚è¿è¡Œä¸­ä¼šå‘ç°å­˜åœ¨ä¸€ä¸ªgoroutineå–å‡ºnumçš„å€¼æ—¶åšåŠ æ³•è¿ç®—æ—¶ï¼Œå¦ä¸€ä¸ªgoroutineä¹Ÿå–å‡ºäº†numçš„å€¼ã€‚å› ä¸ºä¸Šä¸€ä¸ªgoroutineè¿è¡Œç»“æœè¿˜æ²¡æœ‰å›å†™åˆ°å¯„å­˜å™¨ï¼Œæœ€ç»ˆå¯¼è‡´å¤šä¸ªgoroutineäº§ç”Ÿçš„ç›¸åŒçš„ç»“æœã€‚\nå¹¶å‘ç¼–ç¨‹ä¸­åŒæ­¥åŸè¯­-é”ï¼Œä¸ºäº†ä¿è¯å¤šä¸ªçº¿ç¨‹æˆ–goroutineåœ¨è®¿é—®åŒä¸€å—å†…å­˜æ—¶ä¸å‡ºç°æ··ä¹±ï¼ŒGoè¯­è¨€çš„syncåŒ…æä¾›äº†å¸¸è§çš„å¹¶å‘ç¼–ç¨‹åŒæ­¥åŸè¯­çš„æ§åˆ¶é”ã€‚\nsyncåŒ…å›´ç»•ç€Lockeré”æ¥å£å±•å¼€ï¼ŒLockeræ¥å£ä¸­æä¾›äº†ä¸¤ä¸ªæ–¹æ³•Lock()å’ŒUnlock()ã€‚\ntype Locker interface { Lock() Unlock() } Goè¯­è¨€æ ‡å‡†åº“syncä¸­æä¾›äº†ä¸¤ç§é”åˆ†åˆ«æ˜¯äº’æ–¥é”sync.Mutexå’Œè¯»å†™äº’æ–¥é”sync.RWMutex\näº’æ–¥é”sync.Mutex sync.Mutexæ˜¯ä¸€ä¸ªäº’æ–¥é”ï¼Œå¯ä»¥ç”±ä¸åŒçš„goroutineåŠ é”å’Œè§£é”ã€‚\nsync.Mutexæ˜¯Golangæ ‡å‡†åº“æä¾›çš„ä¸€ä¸ªäº’æ–¥é”ï¼Œå½“ä¸€ä¸ªgoroutineè·å¾—äº’æ–¥é”æƒé™åï¼Œå…¶ä»–è¯·æ±‚é”çš„goroutineä¼šé˜»å¡åœ¨Lock()æ–¹æ³•çš„è°ƒç”¨ä¸Šï¼Œç›´åˆ°è°ƒç”¨Unlock()æ–¹æ³•è¢«é‡Šæ”¾ã€‚\nä¾‹å¦‚ï¼š10ä¸ªå¹¶å‘çš„goroutineæ‰“å°åŒä¸€ä¸ªæ•°å­—100ï¼Œä¸ºé¿å…é‡å¤æ‰“å°ï¼Œå®ç°printOnce(num int)å‡½æ•°ï¼Œä½¿ç”¨é›†åˆsetè®°å½•å·²æ‰“å°è¿‡çš„æ•°å­—ã€‚è‹¥æ•°å­—å·²ç»æ‰“å°è¿‡ï¼Œåˆ™ä¸å†æ‰“å°ã€‚\n$ vim mutex_test.go package test import ( \"fmt\" \"testing\" \"time\" ) var set = make(map[int]bool, 0) func printOnce(index int, num int) { if _, ok := set[num]; !ok { fmt.Println(index, num) } set[num] = true } func TestPrint(t *testing.T) { for i := 0; i \u003c 10; i++ { go printOnce(i, 100) } time.Sleep(time.Second) } $ go test -v mutex_test.go === RUN TestPrint 9 100 3 100 --- PASS: TestPrint (1.00s) PASS ok command-line-arguments 1.304s ç¨‹åºå¤šæ¬¡è¿è¡Œåä¼šå‘ç°æ‰“å°æ¬¡æ•°å¤šæ¬¡ï¼Œå› ä¸ºå¯¹åŒä¸€ä¸ªæ•°æ®ç»“æ„setçš„è®¿é—®å‘ç”Ÿäº†å†²çªã€‚\nå¹¶å‘è®¿é—®ä¸­æ¯”å¦‚å¤šä¸ªgoroutineå¹¶å‘æ›´æ–°åŒä¸€ä¸ªèµ„æºï¼Œæ¯”å¦‚è®¡æ—¶å™¨ã€è´¦æˆ·ä½™é¢ã€ç§’æ€ç³»ç»Ÿã€å‘åŒä¸€ä¸ªç¼“å­˜ä¸­å¹¶å‘å†™å…¥æ•°æ®ç­‰ç­‰ã€‚å¦‚æœæ²¡æœ‰äº’æ–¥æ§åˆ¶ï¼Œå¾ˆå®¹æ˜“ä¼šå‡ºç°å¼‚å¸¸ï¼Œæ¯”å¦‚è®¡æ—¶å™¨è®¡æ•°ä¸å‡†ç¡®ã€ç”¨æˆ·è´¦æˆ·å¯èƒ½å‡ºç°é€æ”¯ã€ç§’æ€ç³»ç»Ÿå‡ºç°è¶…å–ã€ç¼“å­˜å‡ºç°æ•°æ®ç¼“å­˜ç­‰ç­‰ï¼Œåæœä¼šå¾ˆä¸¥é‡ã€‚\näº’æ–¥é”æ˜¯å¹¶å‘æ§åˆ¶çš„ä¸€ç§åŸºæœ¬æ‰‹æ®µï¼Œæ˜¯ä¸ºäº†é¿å…ç«äº‰è€Œå»ºç«‹çš„ä¸€ç§å¹¶å‘æ§åˆ¶æœºåˆ¶ã€‚å­¦ä¹ å‰é¦–å…ˆéœ€è¦å¼„æ¸…æ¥šä¸€ä¸ªæ¦‚å¿µ-ä¸´ç•ŒåŒºã€‚åœ¨å¹¶å‘ç¼–ç¨‹ä¸­ï¼Œå¦‚æœç¨‹åºä¸­çš„ä¸€éƒ¨åˆ†ä¼šè¢«å¹¶å‘è®¿é—®æˆ–ä¿®æ”¹ï¼Œä¸ºäº†é¿å…å¹¶å‘è®¿é—®å¯¼è‡´çš„æ„æƒ³ä¸åˆ°çš„ç»“æœï¼Œè¿™éƒ¨åˆ†ç¨‹åºéœ€è¦è¢«ä¿æŠ¤èµ·æ¥ï¼Œè¿™éƒ¨åˆ†è¢«ä¿æŠ¤èµ·æ¥çš„ç¨‹åºå°±å«åšä¸´ç•ŒåŒºã€‚\nä¸´ç•ŒåŒºæ˜¯ä¸€ä¸ªè¢«å…±äº«çš„èµ„æºï¼Œæˆ–è€…è¯´æ˜¯ä¸€ä¸ªæ•´ä½“çš„å…±äº«èµ„æºï¼Œæ¯”å¦‚å¯¹æ•°æ®åº“çš„è®¿é—®ï¼Œå¯¹æŸä¸ªå…±äº«æ•°æ®ç»“æ„çš„æ“ä½œã€‚å¯¹ä¸€ä¸ªI/Oè®¾å¤‡çš„ä½¿ç”¨ï¼Œå¯¹ä¸€ä¸ªè¿æ¥æ± ä¸­çš„è¿æ¥çš„è°ƒç”¨ç­‰ç­‰ã€‚\nå¦‚æœå¾ˆå¤šçº¿ç¨‹åŒæ­¥è®¿é—®ä¸´ç•ŒåŒºå°±ä¼šé€ æˆè®¿é—®æˆ–æ“ä½œé”™è¯¯ï¼Œè¿™å¹¶ä¸æ˜¯æˆ‘ä»¬å¸Œæœ›çœ‹åˆ°çš„ç»“æœã€‚æ‰€ä»¥ï¼Œä½¿ç”¨äº’æ–¥é”ï¼Œé™å®šä¸´ç•ŒåŒºåªèƒ½åŒæ—¶ç”±ä¸€ä¸ªçº¿ç¨‹æŒæœ‰ã€‚å½“ä¸´ç•ŒåŒºç”±ä¸€ä¸ªçº¿ç¨‹æŒæœ‰çš„æ—¶å€™ï¼Œå…¶ä»–çº¿ç¨‹å¦‚æœæƒ³è¿›å…¥ä¸´ç•ŒåŒºå°±ä¼šè¿”å›å¤±è´¥ï¼Œæˆ–è€…æ˜¯ç­‰å¾…ã€‚ç›´åˆ°æŒæœ‰çš„çº¿ç¨‹é€€å‡ºä¸´ç•ŒåŒºï¼Œè¿™äº›ç­‰å¾…çº¿ç¨‹ä¸­çš„æŸä¸€ä¸ªæ‰æœ‰æœºä¼šæ¥ç€æŒæœ‰è¿™ä¸ªä¸´ç•ŒåŒºã€‚\näº’æ–¥é”\näº’æ–¥é”å¯ä»¥å¾ˆå¥½çš„è§£å†³èµ„æºç«äº‰çš„é—®é¢˜ï¼Œå› æ­¤ä¹Ÿæœ‰äººç§°ä¹‹ä¸ºæ’å®ƒé”ã€‚Golangæ ‡å‡†åº“ä¸­ä½¿ç”¨Mutexæ¥å®ç°äº’æ–¥é”ã€‚æ ¹æ®2019å¹´åˆ†æGoå¹¶å‘Bugçš„è®ºæ–‡Understanding Real-World Concurrency Bugs in Goä¸­ï¼ŒMutexæ˜¯ä½¿ç”¨æœ€ä¸ºå¹¿æ³›çš„åŒæ­¥åŸè¯­ï¼ˆSynchronization primitivesï¼Œ å¹¶å‘åŸè¯­æˆ–åŒæ­¥åŸè¯­ï¼‰ã€‚å…³äºåŒæ­¥åŸè¯­å¹¶æ²¡æœ‰ä¸€ä¸ªä¸¥æ ¼çš„å®šä¹‰ï¼Œå¯å°†å…¶çœ‹ä½œæ˜¯è§£å†³å¹¶å‘é—®é¢˜çš„ä¸€ä¸ªåŸºç¡€çš„æ•°æ®ç»“æ„ã€‚\ntype Mutex struct { state int32 //çŠ¶æ€æ ‡è¯† sema uint32 //ä¿¡å·é‡ } Goæ ‡å‡†åº“æä¾›äº†sync.Mutexäº’æ–¥é”ç±»å‹ä»¥åŠä¸¤ä¸ªæ–¹æ³•åˆ†åˆ«æ˜¯LockåŠ é”å’ŒUnlocké‡Šæ”¾é”ã€‚å¯ä»¥é€šè¿‡åœ¨ä»£ç å‰è°ƒç”¨Lockæ–¹æ³•ï¼Œåœ¨ä»£ç åè°ƒç”¨Unlockæ–¹æ³•æ¥ä¿è¯ä¸€æ®µä»£ç çš„äº’æ–¥æ‰§è¡Œï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨deferè¯­å¥æ¥ä¿è¯äº’æ–¥é”ä¸€å®šä¼šè¢«è§£é”ã€‚å½“ä¸€ä¸ªgoroutineè°ƒç”¨Lockæ–¹æ³•è·å¾—é”åï¼Œå…¶å®ƒè¯·æ±‚çš„goroutineéƒ½ä¼šé˜»å¡åœ¨Lockæ–¹æ³•ç›´åˆ°é”è¢«é‡Šæ”¾ã€‚\nä¸€ä¸ªäº’æ–¥é”åªèƒ½åŒæ—¶è¢«ä¸€ä¸ªgoroutineé”å®šï¼Œå…¶å®ƒgoroutineå°†é˜»å¡ç›´åˆ°äº’æ–¥é”è¢«è§£é”ï¼Œä¹Ÿå°±æ˜¯é‡æ–°äº‰æŠ¢å¯¹äº’æ–¥é”çš„é”å®šã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¯¹ä¸€ä¸ªæœªé”å®šçš„äº’æ–¥é”è§£é”æ—¶å°†ä¼šäº§ç”Ÿè¿è¡Œæ—¶é”™è¯¯ã€‚\nsync.Mutexä¸åŒºåˆ†è¯»å†™é”ï¼Œåªæœ‰Lock()å’ŒLock()ä¹‹é—´æ‰ä¼šå¯¼è‡´é˜»å¡çš„æƒ…å†µã€‚è‹¥åœ¨ä¸€ä¸ªåœ°æ–¹Lock()ï¼Œåœ¨å¦ä¸€ä¸ªåœ°æ–¹ä¸Lock()è€Œæ˜¯ç›´æ¥ä¿®æ”¹æˆ–è®¿é—®å…±äº«æ•°æ®ï¼Œå¯¹äºsync.Mutextç±»å‹æ˜¯å…è®¸çš„ï¼Œå› ä¸ºmutexä¸ä¼šå’Œgoroutineè¿›è¡Œå…³è”ã€‚è‹¥è¦åŒºåˆ†è¯»é”å’Œå†™é”ï¼Œå¯ä½¿ç”¨sync.RWMutexç±»å‹ã€‚\nåœ¨Lock()å’ŒUnlock()ä¹‹é—´çš„ä»£ç æ®µæˆä¸ºèµ„æºä¸´ç•ŒåŒºï¼ˆcritical sectionï¼‰ï¼Œåœ¨è¿™ä¸€åŒºé—´å†…çš„ä»£ç æ˜¯ä¸¥æ ¼è¢«Lock()ä¿æŠ¤çš„ï¼Œæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä»»ä½•ä¸€ä¸ªæ—¶é—´ç‚¹éƒ½åªèƒ½æœ‰ä¸€ä¸ªgoroutineæ‰§è¡Œè¿™æ®µåŒºé—´çš„ä»£ç ã€‚\nä¾‹å¦‚ï¼šä½¿ç”¨äº’æ–¥é”çš„Lock()å’ŒUnlock()æ–¹æ³•å°†å†²çªåŒ…è£¹\npackage test import ( \"fmt\" \"sync\" \"testing\" \"time\" ) var m sync.Mutex var set = make(map[int]bool, 0) func printOnce(index int, num int) { m.Lock() defer m.Unlock() if _, ok := set[num]; !ok { fmt.Println(index, num) } set[num] = true } func TestPrint(t *testing.T) { for i := 0; i \u003c 10; i++ { go printOnce(i, 100) } time.Sleep(time.Second) } ç›¸åŒçš„æ•°å­—åªä¼šæ¯”æ‰“å°ä¸€æ¬¡ï¼Œå½“ä¸€ä¸ªgoroutineè°ƒç”¨äº†Lock()æ–¹æ³•æ—¶ï¼Œå…¶ä»–goroutineè¢«é˜»å¡äº†ï¼Œç›´åˆ°Unlock()è°ƒç”¨å°†é”é‡Šæ”¾ã€‚å› æ­¤è¢«åŒ…è£¹éƒ¨åˆ†çš„ä»£ç å°±èƒ½é¿å…å†²çªï¼Œå®ç°äº’æ–¥ã€‚\näº’æ–¥å³ä¸èƒ½åŒæ—¶è¿è¡Œï¼Œä½¿ç”¨äº’æ–¥é”çš„ä¸¤ä¸ªä»£ç ç‰‡æ®µç›¸äº’æ’æ–¥ï¼Œåªæœ‰å…¶ä¸­ä¸€ä¸ªä»£ç ç‰‡æ®µæ‰§è¡Œå®Œæ¯•åï¼Œå¦ä¸€ä¸ªæ‰èƒ½æ‰§è¡Œã€‚\npackage main import ( \"fmt\" \"sync\" \"time\" ) func main() { var num = 0 var locker sync.Mutex for i := 0; i \u003c 100000; i++ { go func(i int) { locker.Lock() defer locker.Unlock() num++ fmt.Printf(\"goroutine %d: num = %d\\n\", i, num) }(i) } time.Sleep(time.Second) } ä»ä¸Šä¾‹ä¸­å¯ä»¥å‘ç°ï¼Œæ·»åŠ äº’æ–¥é”åï¼Œä¸ä»…æ²¡æœ‰å‡ºç°æŠ¢å èµ„æºå¯¼è‡´çš„é‡å¤è¾“å‡ºï¼Œè€Œä¸”è¾“å‡ºç»“æœé¡ºåºé€’å¢ã€‚\nGoè¯­è¨€ä¸­çš„Mutexç±»å‹çš„äº’æ–¥é”Lock()é”å®šä¸å…¶å®ƒè¯­è¨€ä¸åŒçš„æ˜¯ï¼ŒLock()é”å®šçš„æ˜¯äº’æ–¥é”è€Œéä¸€æ®µä»£ç ã€‚å…¶ä»–è¯­è¨€æ¯”å¦‚Javaä¸­ä½¿ç”¨åŒæ­¥é”é”å®šçš„æ˜¯ä¸€æ®µä»£ç ï¼Œä»¥ç¡®ä¿å¤šçº¿ç¨‹å¹¶å‘èª“åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥æ§åˆ¶è¿è¡Œæ­¤ä»£ç å—ç›´åˆ°é‡Šæ”¾åŒæ­¥é”ã€‚Goè¯­è¨€æ˜¯åœ¨goroutineä¸­é”å®šäº’æ–¥é”ï¼Œå…¶å®ƒgoroutineæ‰§è¡Œåˆ°æœ‰é”çš„ä½ç½®æ—¶ï¼Œç”±äºè·å–ä¸åˆ°äº’æ–¥é”çš„é”å®šï¼Œå› æ­¤ä¼šå‘ç”Ÿé˜»å¡è€Œç­‰å¾…ï¼Œä»è€Œè¾¾åˆ°æ§åˆ¶åŒæ­¥çš„ç›®çš„ã€‚\nrace detector Golangæä¾›äº†ä¸€ä¸ªæ£€æµ‹å¹¶å‘è®¿é—®å…±äº«èµ„æºæ˜¯å¦å­˜åœ¨é—®é¢˜çš„å·¥å…· - race detectorï¼Œå®ƒå¯ä»¥å¸®åŠ©è‡ªåŠ¨å‘ç°åŸä¸­æœ‰æ²¡æœ‰data raceçš„é—®é¢˜ã€‚\nGolangçš„race detectoræ˜¯åŸºäºGoogleçš„C/C++ sanitizersæŠ€æœ¯å®ç°çš„ï¼Œç¼–è¯‘å™¨é€šè¿‡æ¢æµ‹æ‰€æœ‰çš„å†…å­˜è®¿é—®ï¼ŒåŠ å…¥ä»£ç èƒ½ç›‘è§†å¯¹è¿™äº›å†…å­˜åœ°å€çš„è®¿é—®ï¼ˆè¯»æˆ–æ˜¯å†™ï¼‰ã€‚ä»£ç è¿è¡Œæ—¶race detectorèƒ½ç›‘æ§å¯¹å…±äº«å˜é‡çš„éåŒæ­¥è®¿é—®ï¼Œå‡ºç°raceæ—¶å°±ä¼šæ‰“å°å‡ºè­¦å‘Šä¿¡æ¯ã€‚\nhttps://blog.golang.org/race-detector\nè¯»å†™é”sync.RWMutex åœ¨é“¶è¡Œå­˜å–é’±æ—¶ï¼Œå¯¹è´¦æˆ·ä½™é¢çš„ä¿®æ”¹æ˜¯éœ€è¦åŠ é”çš„ï¼Œå› æ­¤æ­¤æ—¶å¯èƒ½æœ‰äººæ±‡æ¬¾åˆ°ä½ çš„è´¦æˆ·ï¼Œå¦‚æœå¯¹é‡‘é¢çš„ä¿®æ”¹ä¸åŠ é”ï¼Œå¾ˆå¯èƒ½å¯¼è‡´æœ€åçš„é‡‘é¢å‘ç”Ÿé”™è¯¯ã€‚è¯»å–è´¦æˆ·ä½™é¢ä¹Ÿéœ€è¦ç­‰å¾…ä¿®æ”¹æ“ä½œç»“æŸï¼Œæ‰èƒ½è¯»å–åˆ°æ­£ç¡®çš„ä½™é¢ã€‚å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œè¯»å–ä½™é¢çš„æ“ä½œä¼šæ›´åŠ é¢‘ç¹ï¼Œå¦‚æœèƒ½ä¿è¯è¯»å–ä½™é¢çš„æ“ä½œèƒ½å¹¶å‘æ‰§è¡Œï¼Œç¨‹åºçš„æ•ˆç‡ä¼šå¾ˆå¤§åœ°æå‡ã€‚\nä¿è¯è¯»æ“ä½œçš„å®‰å…¨ï¼Œåªéœ€è¦ä¿è¯å¹¶å‘è¯»æ—¶æ²¡æœ‰å†™æ“ä½œåœ¨è¿›è¡Œå°±è¡Œã€‚åœ¨è¿™ç§åœºæ™¯ä¸‹å°±éœ€è¦ä¸€ç§ç‰¹æ®Šç±»å‹çš„é”ï¼Œå³å…è®¸å¤šä¸ªåªè¯»æ“ä½œå¹¶è¡Œæ‰§è¡Œï¼Œä½†å†™æ“ä½œä¼šå®Œå…¨äº’æ–¥ã€‚è¿™ç§é”ç§°ä¹‹ä¸ºå¤šè¯»å•å†™é”ï¼ˆmultiple readers, single writer lockï¼‰ï¼Œç®€ç§°è¯»å†™é”ã€‚è¯»å†™é”åˆ†ä¸ºè¯»é”å’Œå†™é”ï¼Œè¯»é”å…è®¸åŒæ—¶æ‰§è¡Œï¼Œä½†å†™é”æ˜¯äº’æ–¥çš„ã€‚\nsync.RWMutexè¯»å†™é”æ˜¯åŸºäºsync.Mutexå®ç°çš„ï¼Œè¯»å†™é”çš„ç‰¹ç‚¹æ˜¯é’ˆå¯¹è¯»å†™æ“ä½œçš„äº’æ–¥é”ï¼Œè¯»å†™é”ä¸äº’æ–¥é”æœ€å¤§ä¸åŒä¹‹å¤„åœ¨äºåˆ†åˆ«å¯¹è¯»ã€å†™è¿›è¡Œäº†é”å®šã€‚ä¸€èˆ¬ç”¨åœ¨å¤§é‡è¯»æ“ä½œå°‘é‡å†™æ“ä½œä¸­ã€‚\nåŒæ—¶åªèƒ½å…·æœ‰ä¸€ä¸ªgoroutineèƒ½å¤Ÿè·å¾—å†™é”å®š åŒæ—¶å¯ä»¥å…·æœ‰ä»»æ„å¤šä¸ªgoroutineè·å¾—è¯»é”å®š åŒæ—¶åªèƒ½å­˜åœ¨å†™é”å®šæˆ–è¯»é”å®šï¼Œå³è¯»å’Œå†™äº’æ–¥ã€‚ æ¢å¥è¯è¯´\nå½“åªæœ‰ä¸€ä¸ªgoroutineè·å¾—å†™é”å®šæ—¶ï¼Œå…¶å®ƒæ— è®ºæ˜¯è¯»é”å®šè¿˜æ˜¯å†™é”å®šéƒ½å°†ä¼šé˜»å¡ç›´åˆ°å†™è§£é”ã€‚ å½“åªæœ‰ä¸€ä¸ªgoroutineè·å¾—è¯»é”å®šæ—¶ï¼Œå…¶å®ƒè¯»é”å®šä»ç„¶å¯ä»¥ç»§ç»­æ‰§è¡Œã€‚ å½“æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªè¯»é”å®šæ—¶ï¼Œå†™é”å®šå°†ç­‰å¾…æ‰€æœ‰è¯»é”å®šè§£é”ä¹‹åæ‰èƒ½è¿›è¡Œå†™é”å®šã€‚ è¿™é‡Œæ‰€è°“çš„è¯»é”å®šï¼ˆRLockï¼‰ç›®çš„æ˜¯ä¸ºäº†å‘Šè¯‰å†™é”å®šï¼ˆLockï¼‰ï¼Œæ­¤æ—¶æœ‰å¾ˆå¤šäººæ­£åœ¨è¯»å–æ•°æ®ï¼Œå†™é”å®šéœ€è¦æ’é˜Ÿç­‰å¾…ã€‚\nä¸€èˆ¬æ¥è¯´ï¼Œè¯»å†™é”ä¼šåˆ†ä¸ºå‡ ç§æƒ…å†µï¼š\nè¯»é”ä¹‹é—´ä¸äº’æ–¥ï¼Œåœ¨æ²¡æœ‰å†™é”çš„æƒ…å†µä¸‹ï¼Œè¯»é”æ˜¯æ— å µå¡çš„ï¼Œå¤šä¸ªgoroutineå¯ä»¥åŒæ—¶è·å¾—è¯»é”ã€‚ å†™é”ä¹‹é—´æ˜¯äº’æ–¥çš„ï¼Œå½“å­˜åœ¨å†™é”æ—¶ï¼Œå…¶å®ƒå†™é”ä¼šé˜»å¡ã€‚ å†™é”ä¸è¯»é”äº’æ–¥ï¼Œè‹¥å­˜åœ¨è¯»é”åˆ™å†™é”é˜»å¡ï¼Œè‹¥å­˜åœ¨å†™é”åˆ™è¯»é”é˜»å¡ã€‚ Goæ ‡å‡†åº“sync.RWMutexè¯»å†™äº’æ–¥é”æä¾›äº†å››ä¸ªæ–¹æ³•\nè¯»å†™äº’æ–¥é” æè¿° Lock æ·»åŠ å†™é” Unlock é‡Šæ”¾å†™é” RLock æ·»åŠ è¯»é” RUnlock é‡Šæ”¾è¯»é” å¹¶å‘ç¼–ç¨‹-\u003eselect switch 1.selectæ˜¯Goä¸­çš„ä¸€ä¸ªæ§åˆ¶ç»“æ„ï¼Œç±»ä¼¼äºswitchè¯­å¥ï¼Œç”¨äºå¤„ç†å¼‚æ­¥IOæ“ä½œã€‚selectä¼šç›‘å¬caseè¯­å¥ä¸­channelçš„è¯»å†™æ“ä½œï¼Œå½“caseä¸­channelè¯»å†™æ“ä½œä¸ºéé˜»å¡çŠ¶æ€ï¼ˆå³èƒ½è¯»å†™ï¼‰æ—¶ï¼Œå°†ä¼šè§¦å‘ç›¸åº”çš„åŠ¨ä½œã€‚\nselectä¸­çš„caseè¯­å¥å¿…é¡»æ˜¯ä¸€ä¸ªchannelæ“ä½œ. selectä¸­çš„defaultå­å¥æ€»æ˜¯å¯è¿è¡Œçš„ã€‚\n2.å¦‚æœæœ‰å¤šä¸ªcaseéƒ½å¯ä»¥è¿è¡Œï¼Œselectä¼šéšæœºå…¬å¹³åœ°é€‰å‡ºä¸€ä¸ªæ‰§è¡Œï¼Œå…¶ä»–ä¸ä¼šæ‰§è¡Œã€‚\n3.å¦‚æœæ²¡æœ‰å¯è¿è¡Œçš„caseè¯­å¥ï¼Œä¸”æœ‰defaultè¯­å¥ï¼Œé‚£ä¹ˆå°±ä¼šæ‰§è¡Œdefaultçš„åŠ¨ä½œã€‚\n4.å¦‚æœæ²¡æœ‰å¯è¿è¡Œçš„caseè¯­å¥ï¼Œä¸”æ²¡æœ‰defaultè¯­å¥ï¼Œselectå°†é˜»å¡ï¼Œç›´åˆ°æŸä¸ªcaseé€šä¿¡å¯ä»¥è¿è¡Œ.\nå®ä¾‹\npackage Base import \"time\" var chanInt = make(chan int) var chanStr = make(chan string) func Channel() { go func() { chanInt \u003c- 100 chanStr \u003c- \"Hello\" defer close(chanInt) defer close(chanStr) }() for { select { case r := \u003c-chanInt: println(\"chanInt\", r) case r := \u003c-chanStr: println(\"chanStr\", r) default: println(\"default\") } time.Sleep(time.Second) } } default chanInt 100 chanStr Hello chanStr chanStr chanInt 0 chanInt 0 â€¦â€¦\nå¹¶å‘ç¼–ç¨‹-\u003eTimer Timeré¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å®šæ—¶å™¨çš„æ„æ€ï¼Œå¯ä»¥å®ç°ä¸€äº›å®šæ—¶æ“ä½œï¼Œå†…éƒ¨ä¹Ÿæ˜¯é€šè¿‡channelæ¥å®ç°çš„ã€‚\npackage Base import ( \"fmt\" \"time\" ) func Timer() { // ç¬¬ä¸€ç§åˆ›å»ºæ–¹å¼ timer := time.NewTimer(time.Second * 2) fmt.Println(time.Now()) c := \u003c-timer.C fmt.Println(c) // ç›¸å·®ä¸¤ç§’ //2022-09-13 11:28:25.6609052 +0800 +08 m=+0.004536701 //2022-09-13 11:28:27.6616643 +0800 +08 m=+2.005295801 } å¹¶å‘ç¼–ç¨‹-\u003eTicker Timeråªæ‰§è¡Œä¸€æ¬¡ï¼ŒTickerTå¯ä»¥å‘¨æœŸçš„æ‰§è¡Œã€‚\nå®ä¾‹\nfunc Ticker() { ticker := time.NewTicker(time.Second) count := 0 for range ticker.C { fmt.Println(\"ticker...\") count++ if count \u003e= 5 { ticker.Stop() break } } } å¹¶å‘ç¼–ç¨‹-\u003eåŸå­å˜é‡ package Base import ( \"fmt\" \"sync/atomic\" \"time\" ) var num int64 = 1 func Add(i int64) { atomic.AddInt64(\u0026i, 1) } func Sub(i int64) { atomic.AddInt64(\u0026i, -1) } func Atomic() { for ; num \u003c 1000; num++ { go Add(num) go Sub(num) } time.Sleep(time.Second * 1) fmt.Println(\"Sum:\", num) } Advanced level fmt https://www.bilibili.com/read/cv14519061/?from=readlist\næ–‡ä»¶å¸¸è§æ“ä½œ/è¯»å†™ (os, io, bufioåŒ…) https://www.bilibili.com/read/cv14586068/?from=readlist\né”™è¯¯/æ—¥å¿—/å•å…ƒæµ‹è¯• é”™è¯¯å¤„ç†\nfunc Errors() { defer func() { err := recover() fmt.Println(\"æ•æ‰åˆ°äº†é”™è¯¯:\", err) }() err1 := errors.New(\"å¯çˆ±çš„é”™è¯¯\") fmt.Println(\"err1=\", err1) err2 := fmt.Errorf(\"%sçš„é”™è¯¯\", \"æ¸©æŸ”\") fmt.Println(\"err2=\", err2) panic(err1) } å•å…ƒæµ‹è¯• 6.10.1 å‘½åè§„èŒƒ\næ–‡ä»¶å: xxx_test.go (é€šå¸¸xxxä¸ºè¢«æµ‹è¯•æ–‡ä»¶å)\n6.10.2 æµ‹è¯•å‡½æ•°\næµ‹è¯•å‡½æ•°: func TestXxx(*testing.T) (é€šå¸¸Xxxä¸ºè¢«æµ‹è¯•å‡½æ•°å)\næ€§èƒ½æµ‹è¯•å‡½æ•°: func BenchmarkXxx(*testing.B) (é€šå¸¸Xxxä¸ºè¢«æµ‹è¯•å‡½æ•°å)\n6.10.3 testing.Tä¸testing.B\ntesting.Tä¸testing.Bæ˜¯testingåŒ…å®šä¹‰çš„ç»“æ„ä½“ï¼Œä¸‹é¢ç®€ç§°tä¸b\n6.10.4 æµ‹è¯•å‘½ä»¤(go modä¸‹)\né¡¹ç›®åå¯ä»¥ç®€å†™ä¸ºâ€.\"ï¼Œä¸‹é¢åŒä¸€ä¸º\".\"\næµ‹è¯•æŒ‡å®šåŒ…: go test ./æ–‡ä»¶å¤¹è·¯å¾„\nå°†è‡ªåŠ¨è°ƒç”¨æ‰€æœ‰_test.goæ–‡ä»¶ä¸­çš„æ‰€æœ‰TestXxxå‡½æ•°\næµ‹è¯•æŒ‡å®šæ–‡ä»¶: go test ./æ–‡ä»¶å¤¹è·¯å¾„/xxx_test.go ./go/æ–‡ä»¶å¤¹è·¯å¾„/xxx.go\nå°†è‡ªåŠ¨è°ƒç”¨xxx_test.goä¸­çš„æ‰€æœ‰TestXxxå‡½æ•°\nflag\nflagå¯ä»¥å†™åœ¨ ./â€¦ å‰ä¹Ÿå¯ä»¥å†™åœ¨ ./â€¦ ä¹‹å\nä¹Ÿè¿è¡ŒBenchmarkXxxå‡½æ•°: go test -bench ./â€¦\nè¯¦ç»†è¾“å‡º(verbose): go test -v ./â€¦\nå³ä½¿è¿è¡ŒæˆåŠŸä¹Ÿè¾“å‡ºæ—¥å¿—\nè§„å®šæµ‹è¯•æ—¶é—´: go test -benchtime XhXmXs ./â€¦\nè§„å®šæµ‹è¯•æ¬¡æ•°: go test -benchtime Nx ./â€¦\næŒ‡å®šæµ‹è¯•cpuæ•°é‡: go test -cpu N ./â€¦\næŒ‡å®šæµ‹è¯•å‡½æ•°: go test -run TestXxx ./â€¦\nåªæµ‹è¯•TestXxxå‡½æ•°\nè¶…æ—¶é™åˆ¶: go test -timeout XhXmXs ./â€¦\né»˜è®¤é™åˆ¶ä¸º10min\næ‰“å°æµ‹è¯•çš„å†…å­˜ä½¿ç”¨ç»Ÿè®¡: go test -benchmem ./â€¦\nä½œè€…ï¼šFangChannel https://www.bilibili.com/read/cv14614760/?from=readlist å‡ºå¤„ï¼šbilibili\nfor range package main import ( \"fmt\" \"strings\" ) type Detail struct{ Rid int TeamName string Member string } type TeamMember struct{ Rid int Member string } func main() { d1:=Detail{ Rid: 10, TeamName: \"ddd10\", Member: \"\", } d2:=Detail{ Rid: 11, TeamName: \"ddd11\", Member: \"\", } d3:=Detail{ Rid: 12, TeamName: \"ddd12\", Member: \"\", } t1:=TeamMember{ Rid: 10, Member: \"10çš„Member\", } var ds []Detail ds = append(ds,d1,d2,d3) var ts []TeamMember ts = append(ts, t1) fmt.Println(ts) fmt.Println(ds) for i := 0; i \u003c len(ds); i++ { for j := 0; j \u003c len(ts); j++ { if ds[i].Rid == ts[j].Rid { ds[i].Member = ts[j].Member break } } } // ==== ?? ==== for _, v := range ds { for _, v2 := range ts { if v.Rid == v2.Rid { v.member = v2.menber } } } fmt.Println(ts) fmt.Println(ds) } ",
  "wordCount" : "22946",
  "inLanguage": "zh",
  "datePublished": "2021-11-30T15:55:23+08:00",
  "dateModified": "2021-11-30T15:55:23+08:00",
  "author":[{
    "@type": "Person",
    "name": "Blaine"
  }],
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://Bin-lin-rgb.github.io/posts/go/base/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Blaine's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://Bin-lin-rgb.github.io/img/icon.png"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    (function () {
        let  arr,reg = new RegExp("(^| )"+"change-themes"+"=([^;]*)(;|$)");
        if(arr = document.cookie.match(reg)) {
        } else {
            if (new Date().getHours() >= 19 || new Date().getHours() < 6) {
                document.body.classList.add('dark');
                localStorage.setItem("pref-theme", 'dark');
            } else {
                document.body.classList.remove('dark');
                localStorage.setItem("pref-theme", 'light');
            }
        }
    })()

    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }
</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://Bin-lin-rgb.github.io/" accesskey="h" title="Blaine&#39;s Blog (Alt + H)">
            <img src="https://Bin-lin-rgb.github.io/img/icon.png" alt="logo" aria-label="logo"
                 height="35">Blaine&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                         fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                         stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                         fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                         stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://Bin-lin-rgb.github.io/" title="ğŸ  ä¸»é¡µ">
                <span>ğŸ  ä¸»é¡µ</span>
                </a>
            </li>
            <li>
                <a href="https://Bin-lin-rgb.github.io/posts" title="ğŸ“š æ–‡ç« ">
                <span>ğŸ“š æ–‡ç« </span>
                </a>
            </li>
            <li>
                <a href="https://Bin-lin-rgb.github.io/search" title="ğŸ” æœç´¢ (Alt &#43; /)" accesskey=/>
                <span>ğŸ” æœç´¢</span>
                </a>
            </li>
            <li>
                <a href="https://Bin-lin-rgb.github.io/tags" title="ğŸ§© æ ‡ç­¾">
                <span>ğŸ§© æ ‡ç­¾</span>
                </a>
            </li>
            <li>
                <a href="https://Bin-lin-rgb.github.io/archives/" title="â±ï¸ æ—¶é—´è½´">
                <span>â±ï¸ æ—¶é—´è½´</span>
                </a>
            </li>
            <li>
                <a href="https://Bin-lin-rgb.github.io/about" title="ğŸ™‹ğŸ»â€â™‚ï¸ å…³äº">
                <span>ğŸ™‹ğŸ»â€â™‚ï¸ å…³äº</span>
                </a>
            </li>
            <li>
                <a href="https://Bin-lin-rgb.github.io/links" title="ğŸ¤ å‹é“¾">
                <span>ğŸ¤ å‹é“¾</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main page">
<style>
    i[id*="post_meta_style"] {
        display: flex;
        align-items: center;
        margin: 0 0 10px 0;
    }
</style>

<article class="post-single">
    <div id="single-content">
        <header class="post-header">
            <div class="breadcrumbs"><a href="https://Bin-lin-rgb.github.io/">ğŸ  ä¸»é¡µ</a>&nbsp;Â»&nbsp;<a href="https://Bin-lin-rgb.github.io/posts/">ğŸ“šæ–‡ç« </a>&nbsp;Â»&nbsp;<a href="https://Bin-lin-rgb.github.io/posts/go/">ğŸ¥‡ Golang</a></div>
            <h1 class="post-title">
                Golang åŸºç¡€è¯­æ³•
            </h1>
            <div class="post-description">
                Golang åŸºç¡€è¯­æ³•
            </div>
            <div class="post-meta">

<style>
    i[id*="post_meta_style"] {
        display: flex;
        align-items: center;
        margin: 0 0 10px 0;
    }

    .parent-post-meta {
        display: flex;
        flex-wrap: wrap;
        opacity: 0.8;
    }
</style>

<span class="parent-post-meta">
    <span id="post_meta_style_1">
        <span class="fa fa-calendar-check-o"></span>
        <span>2021-11-30
            &nbsp;&nbsp;
        </span>
    </span>
    
    
    
    
    
    
    
    <span id="post_meta_style_3">
        <span class="fa fa-file-word-o"></span>
        <span>22946å­—
            &nbsp;&nbsp;
        </span>
    </span>
    <span id="post_meta_style_4">
        <span class="fa fa-clock-o"></span>
        <span>46åˆ†é’Ÿ
            &nbsp;&nbsp;
        </span>
    </span>
    <span id="post_meta_style_5">
        <span class="fa fa-user-o"></span>
        <span>Blaine
            &nbsp;&nbsp;
        </span>
    </span>
    <span id="post_meta_style_6">
        <span class="fa fa-tags" style="opacity: 0.8"></span>
        <span>
            <span class="post-tags-meta">
                <a href="https://Bin-lin-rgb.github.io/tags/golang/" style="color: var(--secondary)!important;">Golang</a>
                &nbsp;<a href="https://Bin-lin-rgb.github.io/tags/tech/" style="color: var(--secondary)!important;">tech</a>
            </span>
        </span>
    </span>
</span>
<span style="opacity: 0.8;">
                    <span id="post_meta_style_7">
                        &nbsp;&nbsp;
                        <span class="fa fa-eye" ></span>
                        <span>
                            <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv"></span></span>
                            &nbsp;&nbsp;
                        </span>
                    </span>
                    <span id="post_meta_style_8">
                        <span class="fa fa-commenting-o"></span>
                        <span>
                            <script src="https://cdn.staticfile.org/twikoo/1.5.8/twikoo.all.min.js"></script>
                            <script>
                                let url = document.documentURI
                                
                                let dnsUrl = "https://Bin-lin-rgb.github.io/"
                                let urlSplit = url.split(dnsUrl)
                                let finalUrl = urlSplit[1]
                                if (finalUrl[0] !== '/') {
                                    finalUrl = '/'+finalUrl
                                }
                                twikoo.getCommentsCount({
                                    envId: "https://twikoo-api-nine-silk.vercel.app/", 
                                region: "ap-guangzhou", 
                                urls: [ 
                                    
                                    finalUrl,
                                ],
                                    includeReply: false 
                                }).then(function (res) {
                                    let count = res[0].count
                                    const obj = document.getElementById("comment_count");
                                    obj.innerText = count
                                    
                                    
                                    
                                }).catch(function (err) {
                                    
                                    console.error(err);
                                });
                            </script>
                            <span id="comment_count"></span>
                        </span>
                    </span>
                </span>

</div>
        </header> <aside id="toc-container" class="toc-container wide">
    <div class="toc">
        <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">ç›®å½•</span>
        </summary>

        <div class="inner"><ul><ul>
                <li>
                    <a href="#go-%e5%b8%b8%e7%94%a8%e5%91%bd%e4%bb%a4" aria-label="go å¸¸ç”¨å‘½ä»¤">go å¸¸ç”¨å‘½ä»¤</a></li>
                <li>
                    <a href="#%e6%a0%87%e8%af%86%e7%ac%a6%e7%9a%84%e7%bb%84%e6%88%90" aria-label="æ ‡è¯†ç¬¦çš„ç»„æˆ">æ ‡è¯†ç¬¦çš„ç»„æˆ</a><ul>
                        
                <li>
                    <a href="#go%e6%98%af%e4%b8%80%e9%97%a8%e5%8c%ba%e5%88%86%e5%a4%a7%e5%b0%8f%e5%86%99%e7%9a%84%e8%af%ad%e8%a8%80" aria-label="Goæ˜¯ä¸€é—¨åŒºåˆ†å¤§å°å†™çš„è¯­è¨€">Goæ˜¯ä¸€é—¨åŒºåˆ†å¤§å°å†™çš„è¯­è¨€</a></li>
                <li>
                    <a href="#%e5%8c%85%e5%90%8d%e7%a7%b0" aria-label="åŒ…åç§°">åŒ…åç§°</a></li>
                <li>
                    <a href="#%e6%96%87%e4%bb%b6%e5%91%bd%e5%90%8d" aria-label="æ–‡ä»¶å‘½å">æ–‡ä»¶å‘½å</a></li>
                <li>
                    <a href="#%e7%bb%93%e6%9e%84%e4%bd%93%e5%91%bd%e5%90%8d" aria-label="ç»“æ„ä½“å‘½å">ç»“æ„ä½“å‘½å</a></li></ul>
                </li>
                <li>
                    <a href="#%e9%94%99%e8%af%af%e5%a4%84%e7%90%86" aria-label="é”™è¯¯å¤„ç†">é”™è¯¯å¤„ç†</a></li>
                <li>
                    <a href="#%e5%8d%95%e5%85%83%e6%b5%8b%e8%af%95" aria-label="å•å…ƒæµ‹è¯•">å•å…ƒæµ‹è¯•</a></li>
                <li>
                    <a href="#%e5%b8%b8%e9%87%8f" aria-label="å¸¸é‡">å¸¸é‡</a><ul>
                        
                <li>
                    <a href="#iota" aria-label="iota">iota</a><ul>
                        
                <li>
                    <a href="#%e8%b7%b3%e8%bf%871" aria-label="è·³è¿‡1">è·³è¿‡1</a></li>
                <li>
                    <a href="#%e8%b7%b3%e8%bf%872" aria-label="è·³è¿‡2">è·³è¿‡2</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#%e6%95%b0%e6%8d%ae%e7%b1%bb%e5%9e%8b" aria-label="æ•°æ®ç±»å‹">æ•°æ®ç±»å‹</a><ul>
                        
                <li>
                    <a href="#bool-%e7%b1%bb%e5%9e%8b" aria-label="bool ç±»å‹">bool ç±»å‹</a></li>
                <li>
                    <a href="#%e6%95%b0%e5%ad%97%e7%b1%bb%e5%9e%8b" aria-label="æ•°å­—ç±»å‹">æ•°å­—ç±»å‹</a></li>
                <li>
                    <a href="#%e5%ad%97%e7%ac%a6%e4%b8%b2" aria-label="å­—ç¬¦ä¸²">å­—ç¬¦ä¸²</a><ul>
                        
                <li>
                    <a href="#%e5%ad%97%e7%ac%a6%e4%b8%b2%e8%bf%9e%e6%8e%a5" aria-label="å­—ç¬¦ä¸²è¿æ¥">å­—ç¬¦ä¸²è¿æ¥</a></li>
                <li>
                    <a href="#%e5%ad%97%e7%ac%a6%e4%b8%b2%e5%88%87%e7%89%87%e6%93%8d%e4%bd%9c" aria-label="å­—ç¬¦ä¸²åˆ‡ç‰‡æ“ä½œ">å­—ç¬¦ä¸²åˆ‡ç‰‡æ“ä½œ</a></li>
                <li>
                    <a href="#%e5%ad%97%e7%ac%a6%e4%b8%b2%e5%87%bd%e6%95%b0" aria-label="å­—ç¬¦ä¸²å‡½æ•°">å­—ç¬¦ä¸²å‡½æ•°</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#%e6%a0%bc%e5%bc%8f%e5%8c%96%e8%be%93%e5%87%ba" aria-label="æ ¼å¼åŒ–è¾“å‡º">æ ¼å¼åŒ–è¾“å‡º</a></li>
                <li>
                    <a href="#%e8%bf%90%e7%ae%97%e7%ac%a6" aria-label="è¿ç®—ç¬¦">è¿ç®—ç¬¦</a></li>
                <li>
                    <a href="#%e6%b5%81%e7%a8%8b%e6%8e%a7%e5%88%b6" aria-label="æµç¨‹æ§åˆ¶">æµç¨‹æ§åˆ¶</a><ul>
                        
                <li>
                    <a href="#if" aria-label="if">if</a></li>
                <li>
                    <a href="#switch" aria-label="switch">switch</a></li>
                <li>
                    <a href="#%e5%be%aa%e7%8e%af" aria-label="å¾ªç¯">å¾ªç¯</a><ul>
                        
                <li>
                    <a href="#for-range" aria-label="for range">for range</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#%e6%95%b0%e7%bb%84" aria-label="æ•°ç»„">æ•°ç»„</a></li>
                <li>
                    <a href="#%e5%88%87%e7%89%87" aria-label="åˆ‡ç‰‡">åˆ‡ç‰‡</a><ul>
                        
                <li>
                    <a href="#tips" aria-label="tips">tips</a></li>
                <li>
                    <a href="#%e6%b7%bb%e5%8a%a0%e5%88%a0%e9%99%a4copy" aria-label="æ·»åŠ ã€åˆ é™¤ã€Copy">æ·»åŠ ã€åˆ é™¤ã€Copy</a></li></ul>
                </li>
                <li>
                    <a href="#map" aria-label="map">map</a><ul>
                        
                <li>
                    <a href="#%e5%88%9d%e5%a7%8b%e5%8c%96" aria-label="åˆå§‹åŒ–">åˆå§‹åŒ–</a></li>
                <li>
                    <a href="#%e5%8f%96%e5%80%bc%e9%81%8d%e5%8e%86" aria-label="å–å€¼ã€éå†">å–å€¼ã€éå†</a></li></ul>
                </li>
                <li>
                    <a href="#function" aria-label="function">function</a><ul>
                        
                <li>
                    <a href="#%e8%bf%94%e5%9b%9e%e5%80%bc" aria-label="è¿”å›å€¼">è¿”å›å€¼</a></li>
                <li>
                    <a href="#%e5%8f%82%e6%95%b0" aria-label="å‚æ•°">å‚æ•°</a><ul>
                        
                <li>
                    <a href="#%e5%80%bc%e4%bc%a0%e9%80%92" aria-label="å€¼ä¼ é€’">å€¼ä¼ é€’</a></li>
                <li>
                    <a href="#%e5%8f%98%e9%95%bf%e5%8f%82%e6%95%b0" aria-label="å˜é•¿å‚æ•°">å˜é•¿å‚æ•°</a></li></ul>
                </li>
                <li>
                    <a href="#%e9%ab%98%e9%98%b6%e5%87%bd%e6%95%b0" aria-label="é«˜é˜¶å‡½æ•°">é«˜é˜¶å‡½æ•°</a></li>
                <li>
                    <a href="#%e5%8c%bf%e5%90%8d%e5%87%bd%e6%95%b0" aria-label="åŒ¿åå‡½æ•°">åŒ¿åå‡½æ•°</a></li>
                <li>
                    <a href="#%e9%97%ad%e5%8c%85" aria-label="é—­åŒ…">é—­åŒ…</a></li></ul>
                </li>
                <li>
                    <a href="#%e9%80%92%e5%bd%92" aria-label="é€’å½’">é€’å½’</a></li>
                <li>
                    <a href="#defer" aria-label="defer">defer</a></li>
                <li>
                    <a href="#init%e5%87%bd%e6%95%b0" aria-label="initå‡½æ•°">initå‡½æ•°</a><ul>
                        
                <li>
                    <a href="#init%e5%87%bd%e6%95%b0%e7%9a%84%e4%b8%bb%e8%a6%81%e7%89%b9%e7%82%b9" aria-label="initå‡½æ•°çš„ä¸»è¦ç‰¹ç‚¹">initå‡½æ•°çš„ä¸»è¦ç‰¹ç‚¹</a></li>
                <li>
                    <a href="#golang%e5%88%9d%e5%a7%8b%e5%8c%96%e9%a1%ba%e5%ba%8f" aria-label="golangåˆå§‹åŒ–é¡ºåº">golangåˆå§‹åŒ–é¡ºåº</a></li></ul>
                </li>
                <li>
                    <a href="#%e6%8c%87%e9%92%88" aria-label="æŒ‡é’ˆ">æŒ‡é’ˆ</a><ul>
                        
                <li>
                    <a href="#%e6%8c%87%e9%92%88%e5%9c%b0%e5%9d%80%e5%92%8c%e6%8c%87%e9%92%88%e7%b1%bb%e5%9e%8b" aria-label="æŒ‡é’ˆåœ°å€å’ŒæŒ‡é’ˆç±»å‹">æŒ‡é’ˆåœ°å€å’ŒæŒ‡é’ˆç±»å‹</a></li>
                <li>
                    <a href="#%e6%8c%87%e9%92%88%e8%af%ad%e6%b3%95" aria-label="æŒ‡é’ˆè¯­æ³•">æŒ‡é’ˆè¯­æ³•</a></li></ul>
                </li>
                <li>
                    <a href="#%e6%8c%87%e9%92%88%e6%95%b0%e7%bb%84" aria-label="æŒ‡é’ˆæ•°ç»„">æŒ‡é’ˆæ•°ç»„</a></li>
                <li>
                    <a href="#%e7%b1%bb%e5%9e%8b%e5%ae%9a%e4%b9%89%e5%92%8c%e7%b1%bb%e5%9e%8b%e5%88%ab%e5%90%8d" aria-label="ç±»å‹å®šä¹‰å’Œç±»å‹åˆ«å">ç±»å‹å®šä¹‰å’Œç±»å‹åˆ«å</a><ul>
                        
                <li>
                    <a href="#go%e8%af%ad%e8%a8%80%e7%b1%bb%e5%9e%8b%e5%ae%9a%e4%b9%89" aria-label="goè¯­è¨€ç±»å‹å®šä¹‰">goè¯­è¨€ç±»å‹å®šä¹‰</a></li>
                <li>
                    <a href="#%e7%b1%bb%e5%9e%8b%e5%88%ab%e5%90%8d" aria-label="ç±»å‹åˆ«å">ç±»å‹åˆ«å</a></li></ul>
                </li>
                <li>
                    <a href="#%e7%bb%93%e6%9e%84%e4%bd%93" aria-label="ç»“æ„ä½“">ç»“æ„ä½“</a><ul>
                        
                <li>
                    <a href="#%e7%bb%93%e6%9e%84%e4%bd%93%e7%9a%84%e5%ae%9a%e4%b9%89" aria-label="ç»“æ„ä½“çš„å®šä¹‰">ç»“æ„ä½“çš„å®šä¹‰</a></li>
                <li>
                    <a href="#%e7%bb%93%e6%9e%84%e4%bd%93%e6%8c%87%e9%92%88" aria-label="ç»“æ„ä½“æŒ‡é’ˆ">ç»“æ„ä½“æŒ‡é’ˆ</a></li>
                <li>
                    <a href="#%e7%bb%93%e6%9e%84%e4%bd%93%e4%bd%9c%e4%b8%ba%e5%87%bd%e6%95%b0%e5%8f%82%e6%95%b0" aria-label="ç»“æ„ä½“ä½œä¸ºå‡½æ•°å‚æ•°">ç»“æ„ä½“ä½œä¸ºå‡½æ•°å‚æ•°</a><ul>
                        
                <li>
                    <a href="#%e7%9b%b4%e6%8e%a5%e4%bc%a0%e9%80%92%e7%bb%93%e6%9e%84%e4%bd%93" aria-label="ç›´æ¥ä¼ é€’ç»“æ„ä½“">ç›´æ¥ä¼ é€’ç»“æ„ä½“</a></li>
                <li>
                    <a href="#%e4%bc%a0%e9%80%92%e7%bb%93%e6%9e%84%e4%bd%93%e6%8c%87%e9%92%88" aria-label="ä¼ é€’ç»“æ„ä½“æŒ‡é’ˆ">ä¼ é€’ç»“æ„ä½“æŒ‡é’ˆ</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%b5%8c%e5%a5%97%e7%bb%93%e6%9e%84%e4%bd%93" aria-label="åµŒå¥—ç»“æ„ä½“">åµŒå¥—ç»“æ„ä½“</a></li></ul>
                </li>
                <li>
                    <a href="#%e6%96%b9%e6%b3%95" aria-label="æ–¹æ³•">æ–¹æ³•</a><ul>
                        
                <li>
                    <a href="#%e6%96%b9%e6%b3%95%e7%9a%84%e8%af%ad%e6%b3%95" aria-label="æ–¹æ³•çš„è¯­æ³•">æ–¹æ³•çš„è¯­æ³•</a></li>
                <li>
                    <a href="#%e6%96%b9%e6%b3%95%e7%9a%84%e6%b3%a8%e6%84%8f%e4%ba%8b%e9%a1%b9" aria-label="æ–¹æ³•çš„æ³¨æ„äº‹é¡¹">æ–¹æ³•çš„æ³¨æ„äº‹é¡¹</a></li>
                <li>
                    <a href="#%e6%96%b9%e6%b3%95%e6%8e%a5%e6%94%b6%e8%80%85%e7%b1%bb%e5%9e%8b" aria-label="æ–¹æ³•æ¥æ”¶è€…ç±»å‹">æ–¹æ³•æ¥æ”¶è€…ç±»å‹</a></li></ul>
                </li>
                <li>
                    <a href="#%e6%8e%a5%e5%8f%a3" aria-label="æ¥å£">æ¥å£</a><ul>
                        
                <li>
                    <a href="#db_init" aria-label="db_init">db_init</a></li>
                <li>
                    <a href="#daouser" aria-label="dao.user">dao.user</a></li>
                <li>
                    <a href="#%e6%8e%a5%e5%8f%a3%e5%92%8c%e7%b1%bb%e5%9e%8b%e7%9a%84%e5%85%b3%e7%b3%bb" aria-label="æ¥å£å’Œç±»å‹çš„å…³ç³»">æ¥å£å’Œç±»å‹çš„å…³ç³»</a></li>
                <li>
                    <a href="#%e6%8e%a5%e5%8f%a3%e5%b5%8c%e5%a5%97" aria-label="æ¥å£åµŒå¥—">æ¥å£åµŒå¥—</a></li>
                <li>
                    <a href="#%e9%80%9a%e8%bf%87%e6%8e%a5%e5%8f%a3%e5%ae%9e%e7%8e%b0ocp%e8%ae%be%e8%ae%a1%e5%8e%9f%e5%88%99" aria-label="é€šè¿‡æ¥å£å®ç°OCPè®¾è®¡åŸåˆ™">é€šè¿‡æ¥å£å®ç°OCPè®¾è®¡åŸåˆ™</a></li>
                <li>
                    <a href="#%e5%ae%9e%e4%be%8b" aria-label="å®ä¾‹">å®ä¾‹</a></li></ul>
                </li>
                <li>
                    <a href="#%e7%bb%a7%e6%89%bf" aria-label="ç»§æ‰¿">ç»§æ‰¿</a></li>
                <li>
                    <a href="#%e6%9e%84%e9%80%a0%e5%87%bd%e6%95%b0" aria-label="æ„é€ å‡½æ•°">æ„é€ å‡½æ•°</a></li>
                <li>
                    <a href="#%e5%8c%85%e7%ae%a1%e7%90%86%e5%b7%a5%e5%85%b7go-module" aria-label="åŒ…ç®¡ç†å·¥å…·go module">åŒ…ç®¡ç†å·¥å…·go module</a></li>
                <li>
                    <a href="#%e5%b9%b6%e5%8f%91%e7%bc%96%e7%a8%8b-%e5%8d%8f%e7%a8%8b" aria-label="å¹¶å‘ç¼–ç¨‹-&amp;gt;åç¨‹">å¹¶å‘ç¼–ç¨‹-&gt;åç¨‹</a><ul>
                        
                <li>
                    <a href="#q1-select--case" aria-label="Q1 select â€¦â€¦ case">Q1 select â€¦â€¦ case</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%b9%b6%e5%8f%91%e7%bc%96%e7%a8%8b-%e9%80%9a%e9%81%93channel" aria-label="å¹¶å‘ç¼–ç¨‹-&amp;gt;é€šé“channel">å¹¶å‘ç¼–ç¨‹-&gt;é€šé“channel</a><ul>
                        
                <li>
                    <a href="#channel-%e9%81%8d%e5%8e%86" aria-label="channel éå†">channel éå†</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%b9%b6%e5%8f%91%e7%bc%96%e7%a8%8b-waitgroup%e5%ae%9e%e7%8e%b0%e5%90%8c%e6%ad%a5" aria-label="å¹¶å‘ç¼–ç¨‹-&amp;gt;WaitGroupå®ç°åŒæ­¥">å¹¶å‘ç¼–ç¨‹-&gt;WaitGroupå®ç°åŒæ­¥</a></li>
                <li>
                    <a href="#%e5%b9%b6%e5%8f%91%e7%bc%96%e7%a8%8b-runtime" aria-label="å¹¶å‘ç¼–ç¨‹-&amp;gt;runtime">å¹¶å‘ç¼–ç¨‹-&gt;runtime</a><ul>
                        
                <li>
                    <a href="#runtimegosched" aria-label="runtime.Gosched()">runtime.Gosched()</a></li>
                <li>
                    <a href="#runtimegoexit" aria-label="runtime.Goexit()">runtime.Goexit()</a></li>
                <li>
                    <a href="#runtimegomaxprocs" aria-label="runtime.GOMAXPROCS()">runtime.GOMAXPROCS()</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%b9%b6%e5%8f%91%e7%bc%96%e7%a8%8b-mutex%e4%ba%92%e6%96%a5%e9%94%81%e5%ae%9e%e7%8e%b0%e5%90%8c%e6%ad%a5" aria-label="å¹¶å‘ç¼–ç¨‹-&amp;gt;Mutexäº’æ–¥é”å®ç°åŒæ­¥">å¹¶å‘ç¼–ç¨‹-&gt;Mutexäº’æ–¥é”å®ç°åŒæ­¥</a><ul>
                        
                <li>
                    <a href="#%e6%b2%a1%e5%8a%a0%e9%94%81" aria-label="æ²¡åŠ é”">æ²¡åŠ é”</a></li>
                <li>
                    <a href="#%e5%8a%a0%e4%ba%86%e9%94%81" aria-label="åŠ äº†é”">åŠ äº†é”</a></li>
                <li>
                    <a href="#%e9%94%81-locker" aria-label="é” Locker">é” <code>Locker</code></a></li>
                <li>
                    <a href="#%e4%ba%92%e6%96%a5%e9%94%81syncmutex" aria-label="äº’æ–¥é”sync.Mutex">äº’æ–¥é”<code>sync.Mutex</code></a></li>
                <li>
                    <a href="#race-detector" aria-label="race detector">race detector</a></li>
                <li>
                    <a href="#%e8%af%bb%e5%86%99%e9%94%81syncrwmutex" aria-label="è¯»å†™é”sync.RWMutex">è¯»å†™é”<code>sync.RWMutex</code></a></li></ul>
                </li>
                <li>
                    <a href="#%e5%b9%b6%e5%8f%91%e7%bc%96%e7%a8%8b-select-switch" aria-label="å¹¶å‘ç¼–ç¨‹-&amp;gt;select switch">å¹¶å‘ç¼–ç¨‹-&gt;select switch</a></li>
                <li>
                    <a href="#%e5%b9%b6%e5%8f%91%e7%bc%96%e7%a8%8b-timer" aria-label="å¹¶å‘ç¼–ç¨‹-&amp;gt;Timer">å¹¶å‘ç¼–ç¨‹-&gt;Timer</a></li>
                <li>
                    <a href="#%e5%b9%b6%e5%8f%91%e7%bc%96%e7%a8%8b-ticker" aria-label="å¹¶å‘ç¼–ç¨‹-&amp;gt;Ticker">å¹¶å‘ç¼–ç¨‹-&gt;Ticker</a></li>
                <li>
                    <a href="#%e5%b9%b6%e5%8f%91%e7%bc%96%e7%a8%8b-%e5%8e%9f%e5%ad%90%e5%8f%98%e9%87%8f" aria-label="å¹¶å‘ç¼–ç¨‹-&amp;gt;åŸå­å˜é‡">å¹¶å‘ç¼–ç¨‹-&gt;åŸå­å˜é‡</a></li></ul>
                    
                <li>
                    <a href="#advanced-level" aria-label="Advanced level">Advanced level</a><ul>
                        
                <li>
                    <a href="#fmt" aria-label="fmt">fmt</a></li>
                <li>
                    <a href="#%e6%96%87%e4%bb%b6%e5%b8%b8%e8%a7%81%e6%93%8d%e4%bd%9c%e8%af%bb%e5%86%99-os-io-bufio%e5%8c%85" aria-label="æ–‡ä»¶å¸¸è§æ“ä½œ/è¯»å†™ (os, io, bufioåŒ…)">æ–‡ä»¶å¸¸è§æ“ä½œ/è¯»å†™ (os, io, bufioåŒ…)</a></li>
                <li>
                    <a href="#%e9%94%99%e8%af%af%e6%97%a5%e5%bf%97%e5%8d%95%e5%85%83%e6%b5%8b%e8%af%95" aria-label="é”™è¯¯/æ—¥å¿—/å•å…ƒæµ‹è¯•">é”™è¯¯/æ—¥å¿—/å•å…ƒæµ‹è¯•</a><ul>
                        
                <li>
                    <a href="#%e5%8d%95%e5%85%83%e6%b5%8b%e8%af%95-1" aria-label="å•å…ƒæµ‹è¯•">å•å…ƒæµ‹è¯•</a></li></ul>
                </li>
                <li>
                    <a href="#for-range-1" aria-label="for range">for range</a>
                </li>
            </ul>
            </li>
            </ul>
        </div>
        </details>
    </div>
</aside>
<script>
    let activeElement;
    let elements;
    window.addEventListener('DOMContentLoaded', function (event) {
        checkTocPosition();

        elements = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]');
        
        activeElement = elements[0];
        const id = encodeURI(activeElement.getAttribute('id')).toLowerCase();
        document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
    }, false);

    window.addEventListener('resize', function(event) {
        checkTocPosition();
    }, false);

    window.addEventListener('scroll', () => {
        
        if (elements) {
            activeElement = Array.from(elements).find((element) => {
                if ((getOffsetTop(element) - window.pageYOffset) > 0 &&
                    (getOffsetTop(element) - window.pageYOffset) < window.innerHeight/2) {
                    return element;
                }
            }) || activeElement

            elements.forEach(element => {
                const id = encodeURI(element.getAttribute('id')).toLowerCase();
                if (element === activeElement){
                    document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
                } else {
                    document.querySelector(`.inner ul li a[href="#${id}"]`).classList.remove('active');
                }
            })
        }
    }, false);

    const main = parseInt(getComputedStyle(document.body).getPropertyValue('--article-width'), 10);
    const toc = parseInt(getComputedStyle(document.body).getPropertyValue('--toc-width'), 10);
    const gap = parseInt(getComputedStyle(document.body).getPropertyValue('--gap'), 10);

    function checkTocPosition() {
        const width = document.body.scrollWidth;
        if (width - main - (toc * 2) - (gap * 4) > 0) {
            document.getElementById("toc-container").classList.add("wide");
        } else {
            document.getElementById("toc-container").classList.remove("wide");
        }
    }

    function getOffsetTop(element) {
        if (!element.getClientRects().length) {
            return 0;
        }
        let rect = element.getBoundingClientRect();
        let win = element.ownerDocument.defaultView;
        return rect.top + win.pageYOffset;
    }
</script>
        <div class="post-content"><p>Base</p>
<h2 id="go-å¸¸ç”¨å‘½ä»¤">go å¸¸ç”¨å‘½ä»¤<a hidden class="anchor" aria-hidden="true" href="#go-å¸¸ç”¨å‘½ä»¤">#</a></h2>
<ul>
<li>build: ç¼–è¯‘åŒ…å’Œä¾èµ–</li>
<li>clean: ç§»é™¤å¯¹è±¡æ–‡ä»¶</li>
<li>doc: æ˜¾ç¤ºåŒ…æˆ–è€…ç¬¦å·çš„æ–‡æ¡£</li>
<li>env: æ‰“å°goçš„ç¯å¢ƒä¿¡æ¯</li>
<li>bug: å¯åŠ¨é”™è¯¯æŠ¥å‘Š</li>
<li>fix: è¿è¡Œgo tool fix</li>
<li>fmt: è¿è¡Œgofmtè¿›è¡Œæ ¼å¼åŒ–</li>
<li>generate: ä»processing sourceç”Ÿæˆgoæ–‡ä»¶</li>
<li>get: ä¸‹è½½å¹¶å®‰è£…åŒ…å’Œä¾èµ–</li>
<li>install: ç¼–è¯‘å¹¶å®‰è£…åŒ…å’Œä¾èµ–</li>
<li>list: åˆ—å‡ºåŒ…</li>
<li>run: ç¼–è¯‘å¹¶è¿è¡Œgoç¨‹åº</li>
<li>test: è¿è¡Œæµ‹è¯•</li>
<li>tool: è¿è¡Œgoæä¾›çš„å·¥å…·</li>
<li>version: æ˜¾ç¤ºgoçš„ç‰ˆæœ¬</li>
<li>vet: è¿è¡Œgo tool vet</li>
</ul>
<h2 id="æ ‡è¯†ç¬¦çš„ç»„æˆ">æ ‡è¯†ç¬¦çš„ç»„æˆ<a hidden class="anchor" aria-hidden="true" href="#æ ‡è¯†ç¬¦çš„ç»„æˆ">#</a></h2>
<p>1.æ ‡è¯†ç¬¦ç”±æ•°å­—ã€å­—æ¯å’Œä¸‹åˆ’çº¿ (_) ç»„æˆã€‚</p>
<p>2.åªèƒ½ä»¥å­—æ¯å’Œä¸‹åˆ’çº¿ (_) å¼€å¤´ã€‚</p>
<p>3.æ ‡è¯†ç¬¦åŒºåˆ†å¤§å°å†™ã€‚</p>
<h3 id="goæ˜¯ä¸€é—¨åŒºåˆ†å¤§å°å†™çš„è¯­è¨€">Goæ˜¯ä¸€é—¨åŒºåˆ†å¤§å°å†™çš„è¯­è¨€<a hidden class="anchor" aria-hidden="true" href="#goæ˜¯ä¸€é—¨åŒºåˆ†å¤§å°å†™çš„è¯­è¨€">#</a></h3>
<p>å‘½åè§„åˆ™æ¶‰åŠå˜é‡ã€å¸¸é‡ã€å…¨å±€å‡½æ•°ã€ç»“æ„ã€æ¥å£ã€æ–¹æ³•ç­‰çš„å‘½åã€‚</p>
<p>GOè¯­è¨€ä»è¯­æ³•å±‚é¢è¿›è¡Œäº†ä»¥ä¸‹é™å®šï¼š</p>
<p><strong>ä»»ä½•éœ€è¦å¯¹å¤–æš´éœ²çš„åå­—å¿…é¡»ä»¥å¤§å†™å­—æ¯å¼€å¤´</strong>ï¼Œ</p>
<p>ä¸éœ€è¦å¯¹å¤–æš´éœ²çš„åˆ™åº”è¯¥ä»¥å°å†™å­—æ¯å¼€å¤´ã€‚</p>
<p>çŸ­å˜é‡å£°æ˜åªèƒ½åœ¨å‡½æ•°é‡Œä½¿ç”¨ã€‚</p>
<h3 id="åŒ…åç§°">åŒ…åç§°<a hidden class="anchor" aria-hidden="true" href="#åŒ…åç§°">#</a></h3>
<p>ä¿æŒpackÄgeçš„åå­—å’Œç›®å½•ä¿æŒä¸€è‡´ï¼Œå°½é‡é‡‡å–æœ‰æ„ä¹‰çš„åŒ…åï¼Œç®€çŸ­ï¼Œæœ‰æ„ä¹‰ï¼Œå°½é‡å’Œæ ‡å‡†åº“ä¸è¦å†²çªã€‚==åŒ…ååº”è¯¥ä¸ºå°å†™å•è¯==ï¼Œä¸è¦ä½¿ç”¨ä¸‹çº¿æˆ–è€…æ··åˆå¤§å°å†™ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#ff6ac1">package</span> dao
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">package</span> service
</span></span></code></pre></div><h3 id="æ–‡ä»¶å‘½å">æ–‡ä»¶å‘½å<a hidden class="anchor" aria-hidden="true" href="#æ–‡ä»¶å‘½å">#</a></h3>
<p>å°½é‡é‡‡å–æœ‰æ„ä¹‰çš„æ–‡ä»¶åï¼Œç®€çŸ­ï¼Œæœ‰æ„ä¹‰ï¼Œ==åº”è¯¥ä¸ºå°å†™å•è¯==ï¼Œä½¿ç”¨ä¸‹åˆ’çº¿åˆ†éš”å„ä¸ªå•è¯ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>customer_dao.<span style="color:#ff6ac1">go</span> 
</span></span></code></pre></div><h3 id="ç»“æ„ä½“å‘½å">ç»“æ„ä½“å‘½å<a hidden class="anchor" aria-hidden="true" href="#ç»“æ„ä½“å‘½å">#</a></h3>
<p>==é‡‡ç”¨é©¼å³°å‘½åæ³•==ï¼Œé¦–å­—æ¯æ ¹æ®è®¿é—®æ§åˆ¶å¤§å†™æˆ–è€…å°å†™</p>
<p>structç”³æ˜å’Œåˆå§‹åŒ–æ ¼å¼é‡‡ç”¨å¤šè¡Œï¼Œä¾‹å¦‚ä¸‹é¢ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#ff5c57">type</span> Customerorder <span style="color:#ff5c57">struct</span>{
</span></span><span style="display:flex;"><span>    Name <span style="color:#9aedfe">string</span>
</span></span><span style="display:flex;"><span>    Address <span style="color:#9aedfe">string</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>order<span style="color:#ff6ac1">:=</span>CustomerOrder{<span style="color:#5af78e">&#34;tom&#34;</span>,<span style="color:#5af78e">&#34;åŒ—äº¬æµ·æ·€&#34;</span>}
</span></span></code></pre></div><h2 id="é”™è¯¯å¤„ç†">é”™è¯¯å¤„ç†<a hidden class="anchor" aria-hidden="true" href="#é”™è¯¯å¤„ç†">#</a></h2>
<p>é”™è¯¯å¤„ç†çš„åŸåˆ™å°±æ˜¯ä¸èƒ½ä¸¢å¼ƒä»»ä½•æœ‰è¿”å› err çš„è°ƒç”¨ï¼Œä¸è¦ä½¿ç”¨_ä¸¢å¼ƒï¼Œå¿…é¡»å…¨éƒ¨å¤„ç†ã€‚</p>
<p>æ¥æ”¶åˆ°é”™è¯¯ï¼Œ</p>
<ul>
<li>è¦ä¹ˆè¿”å› err,</li>
<li>æˆ–è€…ä½¿ç”¨ log è®°å½•ä¸‹æ¥å°½æ—©return ,  ä¸€æ—¦æœ‰é”™è¯¯å‘ç”Ÿï¼Œé©¬ä¸Šè¿”å›</li>
<li>å°½é‡ä¸è¦ä½¿ç”¨ panic ,é™¤éä½ çŸ¥é“ä½ åœ¨åšä»€ä¹ˆï¼Œ</li>
<li>é”™è¯¯æè¿°å¦‚æœæ˜¯è‹±æ–‡å¿…é¡»ä¸ºå°å†™ï¼Œä¸éœ€è¦æ ‡ç‚¹ç»“å°¾ï¼Œé‡‡ç”¨ç‹¬ç«‹çš„é”™è¯¯æµè¿›è¡Œå¤„ç†.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#78787e">//æ­£ç¡®å†™æ³•
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span><span style="color:#ff6ac1">if</span> err <span style="color:#ff6ac1">!=</span> <span style="color:#ff6ac1">nil</span>{
</span></span><span style="display:flex;"><span>    <span style="color:#78787e">//é”™è¯¯å¤„ç†
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>    <span style="color:#ff6ac1">return</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#78787e">//æ­£å¸¸ä»£ç 
</span></span></span></code></pre></div><h2 id="å•å…ƒæµ‹è¯•">å•å…ƒæµ‹è¯•<a hidden class="anchor" aria-hidden="true" href="#å•å…ƒæµ‹è¯•">#</a></h2>
<p>å•å…ƒæµ‹è¯•æ–‡ä»¶åå‘½åè§„èŒƒä¸º<code>example_test.go</code>æµ‹è¯•ç”¨ä¾‹çš„å‡½æ•°åç§°å¿…é¡»ä»¥Testå¼€å¤´ï¼Œä¾‹å¦‚ï¼š<code>TestExample</code></p>
<p>æ¯ä¸ªé‡è¦çš„å‡½æ•°éƒ½è¦é¦–å…ˆç¼–å†™æµ‹è¯•ç”¨ä¾‹ï¼Œæµ‹è¯•ç”¨ä¾‹å’Œæ­£è§„ä»£ç ä¸€èµ·æäº¤æ–¹ä¾¿è¿›è¡Œå›å½’æµ‹è¯•ã€‚</p>
<h2 id="å¸¸é‡">å¸¸é‡<a hidden class="anchor" aria-hidden="true" href="#å¸¸é‡">#</a></h2>
<p>å®šä¹‰å¸¸é‡çš„è¯­æ³•</p>
<p>å®šä¹‰ä¸€ä¸ªå¸¸é‡ä½¿ç”¨constå…³é”®å­—ï¼Œè¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š</p>
<p><code>const constantName [type]=value</code></p>
<ul>
<li>const: å®šä¹‰å¸¸é‡å…³é”®å­—</li>
<li>constantName: å¸¸é‡åç§°</li>
<li>type: å¸¸é‡ç±»å‹</li>
<li>value: å¸¸é‡çš„å€¼</li>
</ul>
<h3 id="iota">iota<a hidden class="anchor" aria-hidden="true" href="#iota">#</a></h3>
<p>iotaæ¯”è¾ƒç‰¹æ®Šï¼Œå¯ä»¥è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªå¯è¢«ç¼–è¯‘å™¨ä¿®æ”¹çš„å¸¸é‡ï¼Œå®ƒé»˜è®¤å¼€å§‹å€¼æ˜¯g,æ¯è°ƒç”¨ä¸€æ¬¡åŠ 1ã€‚é‡åˆ°constå…³é”®å­—æ—¶è¢«é‡ç½®ä¸º0ã€‚
å®ä¾‹</p>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#ff6ac1">package</span> Base
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">import</span> <span style="color:#5af78e">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">func</span> <span style="color:#57c7ff">Iota</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#ff5c57">const</span> (
</span></span><span style="display:flex;"><span>		a1 = <span style="color:#ff6ac1">iota</span>
</span></span><span style="display:flex;"><span>		a2 = <span style="color:#ff6ac1">iota</span>
</span></span><span style="display:flex;"><span>		a3 = <span style="color:#ff6ac1">iota</span>
</span></span><span style="display:flex;"><span>	)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	fmt.<span style="color:#57c7ff">Printf</span>(<span style="color:#5af78e">&#34;a1:%v\n&#34;</span>, a1)
</span></span><span style="display:flex;"><span>	fmt.<span style="color:#57c7ff">Printf</span>(<span style="color:#5af78e">&#34;a2:%v\n&#34;</span>, a2)
</span></span><span style="display:flex;"><span>	fmt.<span style="color:#57c7ff">Printf</span>(<span style="color:#5af78e">&#34;a3:%v\n&#34;</span>, a3)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">========</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>a1:<span style="color:#ff9f43">0</span>
</span></span><span style="display:flex;"><span>a2:<span style="color:#ff9f43">1</span>
</span></span><span style="display:flex;"><span>a3:<span style="color:#ff9f43">2</span>
</span></span></code></pre></div><h4 id="è·³è¿‡1">è·³è¿‡1<a hidden class="anchor" aria-hidden="true" href="#è·³è¿‡1">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#ff5c57">func</span> <span style="color:#57c7ff">Iota</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#ff5c57">const</span> (
</span></span><span style="display:flex;"><span>		a1 = <span style="color:#ff6ac1">iota</span>
</span></span><span style="display:flex;"><span>		_
</span></span><span style="display:flex;"><span>		a3 = <span style="color:#ff6ac1">iota</span>
</span></span><span style="display:flex;"><span>	)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	fmt.<span style="color:#57c7ff">Printf</span>(<span style="color:#5af78e">&#34;a1:%v\n&#34;</span>, a1)
</span></span><span style="display:flex;"><span>	fmt.<span style="color:#57c7ff">Printf</span>(<span style="color:#5af78e">&#34;a3:%v\n&#34;</span>, a3)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">======</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>a1:<span style="color:#ff9f43">0</span>
</span></span><span style="display:flex;"><span>a3:<span style="color:#ff9f43">2</span>
</span></span></code></pre></div><h4 id="è·³è¿‡2">è·³è¿‡2<a hidden class="anchor" aria-hidden="true" href="#è·³è¿‡2">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#ff5c57">func</span> <span style="color:#57c7ff">Iota</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#ff5c57">const</span> (
</span></span><span style="display:flex;"><span>		a1 = <span style="color:#ff6ac1">iota</span>
</span></span><span style="display:flex;"><span>		a2 = <span style="color:#ff9f43">100</span>
</span></span><span style="display:flex;"><span>		a3 = <span style="color:#ff6ac1">iota</span>
</span></span><span style="display:flex;"><span>	)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	fmt.<span style="color:#57c7ff">Printf</span>(<span style="color:#5af78e">&#34;a1:%v\n&#34;</span>, a1)
</span></span><span style="display:flex;"><span>	fmt.<span style="color:#57c7ff">Printf</span>(<span style="color:#5af78e">&#34;a2:%v\n&#34;</span>, a2)
</span></span><span style="display:flex;"><span>	fmt.<span style="color:#57c7ff">Printf</span>(<span style="color:#5af78e">&#34;a3:%v\n&#34;</span>, a3)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">======</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>a1:<span style="color:#ff9f43">0</span>
</span></span><span style="display:flex;"><span>a2:<span style="color:#ff9f43">100</span>
</span></span><span style="display:flex;"><span>a3:<span style="color:#ff9f43">2</span>
</span></span></code></pre></div><h2 id="æ•°æ®ç±»å‹">æ•°æ®ç±»å‹<a hidden class="anchor" aria-hidden="true" href="#æ•°æ®ç±»å‹">#</a></h2>
<p><img loading="lazy" src="https://cdn.jsdelivr.net/gh/Bin-lin-rgb/blog-img@main/20220906155414.png" alt=""  />
</p>
<p>æŒ‡é’ˆã€æ•°ç»„ã€åˆ‡ç‰‡ç±»å‹</p>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#ff5c57">func</span> <span style="color:#57c7ff">DataType</span>() {
</span></span><span style="display:flex;"><span>	num <span style="color:#ff6ac1">:=</span> <span style="color:#ff9f43">200</span>
</span></span><span style="display:flex;"><span>	p <span style="color:#ff6ac1">:=</span> <span style="color:#ff6ac1">&amp;</span>num
</span></span><span style="display:flex;"><span>	fmt.<span style="color:#57c7ff">Printf</span>(<span style="color:#5af78e">&#34;%T\n&#34;</span>, p)
</span></span><span style="display:flex;"><span>	<span style="color:#78787e">//	*int æŒ‡é’ˆ
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>
</span></span><span style="display:flex;"><span>	arr <span style="color:#ff6ac1">:=</span> [<span style="color:#ff9f43">3</span>]<span style="color:#9aedfe">int</span>{<span style="color:#ff9f43">1</span>, <span style="color:#ff9f43">2</span>, <span style="color:#ff9f43">3</span>}
</span></span><span style="display:flex;"><span>	fmt.<span style="color:#57c7ff">Printf</span>(<span style="color:#5af78e">&#34;%T\n&#34;</span>, arr)
</span></span><span style="display:flex;"><span>	<span style="color:#78787e">//[3]int æ•°ç»„
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>
</span></span><span style="display:flex;"><span>	arr1 <span style="color:#ff6ac1">:=</span> []<span style="color:#9aedfe">int</span>{<span style="color:#ff9f43">1</span>, <span style="color:#ff9f43">2</span>, <span style="color:#ff9f43">3</span>}
</span></span><span style="display:flex;"><span>	fmt.<span style="color:#57c7ff">Printf</span>(<span style="color:#5af78e">&#34;%T\n&#34;</span>, arr1)
</span></span><span style="display:flex;"><span>	<span style="color:#78787e">//[]int åˆ‡ç‰‡
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="bool-ç±»å‹">bool ç±»å‹<a hidden class="anchor" aria-hidden="true" href="#bool-ç±»å‹">#</a></h3>
<p>bool ç±»å‹ï¼šä¸èƒ½ä½¿ç”¨ 0 å’Œ é0 è¡¨ç¤ºçœŸå‡</p>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>	<span style="color:#78787e">//	Bool
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>	b <span style="color:#ff6ac1">:=</span> <span style="color:#ff9f43">0</span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">if</span> b { <span style="color:#78787e">//å¤±è´¥ï¼
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>		fmt.<span style="color:#57c7ff">Println</span>(b)
</span></span><span style="display:flex;"><span>	}
</span></span></code></pre></div><h3 id="æ•°å­—ç±»å‹">æ•°å­—ç±»å‹<a hidden class="anchor" aria-hidden="true" href="#æ•°å­—ç±»å‹">#</a></h3>
<p>go è¯­è¨€æ”¯æŒ<strong>æ•´å‹å’Œæµ®ç‚¹å‹</strong>æ•°å­—ï¼Œå¹¶ä¸”åŸç”Ÿæ”¯æŒå¤æ•°ï¼Œå…¶ä¸­ä½çš„è¿ç®—é‡‡ç”¨è¡¥ç ã€‚</p>
<p>æœ‰åŸºäºæ¶æ„çš„ç±»å‹ï¼Œä¾‹å¦‚ï¼šintã€uintå’Œuintptrã€‚
è¿™äº›ç±»å‹çš„é•¿åº¦éƒ½æ˜¯æ ¹æ®è¿è¡Œç¨‹åºæ‰€åœ¨çš„æ“ä½œç³»ç»Ÿç±»å‹æ‰€å†³å®šçš„ï¼š</p>
<p>intå’Œuintåœ¨32ä½æ“ä½œç³»ç»Ÿä¸Šï¼Œå®ƒä»¬å‡ä½¿ç”¨32ä½(4ä¸ªå­—èŠ‚)ï¼Œåœ¨64ä½æ“ä½œç³»ç»Ÿä¸Šï¼Œå®ƒä»¬å‡ä½¿ç”¨64ä½(8ä¸ªå­—èŠ‚)ã€‚</p>
<p>uintptrçš„é•¿åº¦è¢«è®¾å®šä¸ºè¶³å¤Ÿå­˜æ”¾ä¸€ä¸ªæŒ‡é’ˆå³å¯ã€‚</p>
<p>goè¯­è¨€ä¸­æ²¡æœ‰floatç±»å‹ã€‚(Goè¯­è¨€ä¸­<strong>åªæœ‰float32å’Œfloat64</strong>)</p>
<p>æ²¡æœ‰ double ç±»å‹ã€‚</p>
<p>ä¸æ“ä½œç³»ç»Ÿæ¶æ„æ— å…³çš„ç±»å‹éƒ½æœ‰å›ºå®šçš„å¤§å°ï¼Œå¹¶åœ¨ç±»å‹çš„åç§°ä¸­å°±å¯ä»¥çœ‹å‡ºæ¥ã€‚</p>
<p>æŒºå¤šçš„å°±ä¸ä¸€ä¸€æµ‹äº†ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>	<span style="color:#78787e">//	æ•°å­—ç±»å‹
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>	<span style="color:#ff5c57">var</span> i8 <span style="color:#9aedfe">int8</span>
</span></span><span style="display:flex;"><span>	fmt.<span style="color:#57c7ff">Printf</span>(<span style="color:#5af78e">&#34;%T %db %v~%v\n&#34;</span>, i8, unsafe.<span style="color:#57c7ff">Sizeof</span>(i8), math.MinInt8, math.MaxInt8)
</span></span><span style="display:flex;"><span>	<span style="color:#78787e">//int8 1b -128~127
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>	
</span></span><span style="display:flex;"><span>	<span style="color:#ff5c57">var</span> i <span style="color:#9aedfe">int</span>
</span></span><span style="display:flex;"><span>	fmt.<span style="color:#57c7ff">Printf</span>(<span style="color:#5af78e">&#34;%T %db %v~%v\n&#34;</span>, i, unsafe.<span style="color:#57c7ff">Sizeof</span>(i), math.MinInt, math.MaxInt)
</span></span><span style="display:flex;"><span>	<span style="color:#78787e">//int 8b -9223372036854775808~9223372036854775807
</span></span></span></code></pre></div><h3 id="å­—ç¬¦ä¸²">å­—ç¬¦ä¸²<a hidden class="anchor" aria-hidden="true" href="#å­—ç¬¦ä¸²">#</a></h3>
<p>åå¼•å·å¯æ¢è¡Œ</p>
<h4 id="å­—ç¬¦ä¸²è¿æ¥">å­—ç¬¦ä¸²è¿æ¥<a hidden class="anchor" aria-hidden="true" href="#å­—ç¬¦ä¸²è¿æ¥">#</a></h4>
<ol>
<li>åŠ å·</li>
<li>ä½¿ç”¨ fmt.Sprintf()</li>
<li>ä½¿ç”¨ strings.Join()</li>
<li>ä½¿ç”¨ buffer.WriteString()</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>	<span style="color:#78787e">//	String
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>	str1 <span style="color:#ff6ac1">:=</span> <span style="color:#5af78e">&#34;Hello,&#34;</span>
</span></span><span style="display:flex;"><span>	str2 <span style="color:#ff6ac1">:=</span> <span style="color:#5af78e">&#34;Tom&#34;</span>
</span></span><span style="display:flex;"><span>	sprintf <span style="color:#ff6ac1">:=</span> fmt.<span style="color:#57c7ff">Sprintf</span>(<span style="color:#5af78e">&#34;%s%s&#34;</span>, str1, str2)
</span></span><span style="display:flex;"><span>	fmt.<span style="color:#57c7ff">Println</span>(sprintf)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#78787e">//	strings.Join
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>	join <span style="color:#ff6ac1">:=</span> strings.<span style="color:#57c7ff">Join</span>([]<span style="color:#9aedfe">string</span>{<span style="color:#5af78e">&#34;Hello&#34;</span>, <span style="color:#5af78e">&#34;Amy&#34;</span>}, <span style="color:#5af78e">&#34;,&#34;</span>)
</span></span><span style="display:flex;"><span>	fmt.<span style="color:#57c7ff">Println</span>(join)	
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#78787e">//	buffer.WriteString
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>	<span style="color:#ff5c57">var</span> buffer bytes.Buffer
</span></span><span style="display:flex;"><span>	buffer.<span style="color:#57c7ff">WriteString</span>(<span style="color:#5af78e">&#34;Hello&#34;</span>)
</span></span><span style="display:flex;"><span>	buffer.<span style="color:#57c7ff">WriteString</span>(<span style="color:#5af78e">&#34;,&#34;</span>)
</span></span><span style="display:flex;"><span>	buffer.<span style="color:#57c7ff">WriteString</span>(<span style="color:#5af78e">&#34;DaMing&#34;</span>)
</span></span><span style="display:flex;"><span>	fmt.<span style="color:#57c7ff">Printf</span>(<span style="color:#5af78e">&#34;%v\n&#34;</span>, buffer.<span style="color:#57c7ff">String</span>())
</span></span></code></pre></div><p>1ã€golangé‡Œé¢çš„å­—ç¬¦ä¸²éƒ½æ˜¯ä¸å¯å˜çš„ï¼Œæ¯æ¬¡è¿ç®—éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥ä¼šäº§ç”Ÿå¾ˆå¤šä¸´æ—¶çš„æ— ç”¨çš„å­—ç¬¦ä¸²ï¼Œä¸ä»…æ²¡æœ‰ç”¨ï¼Œè¿˜ä¼šç»™å¸¦æ¥é¢å¤–çš„è´Ÿæ‹…ï¼Œæ‰€ä»¥æ€§èƒ½æ¯”è¾ƒå·®ã€‚</p>
<p>2ã€å†…éƒ¨ä½¿ç”¨[]byteå®ç°ï¼Œä¸åƒç›´æ¥è¿ç®—ç¬¦è¿™ç§ä¼šäº§ç”Ÿå¾ˆå¤šä¸´æ—¶çš„å­—ç¬¦ä¸²ï¼Œä½†æ˜¯å†…éƒ¨çš„é€»è¾‘æ¯”è¾ƒå¤æ‚ï¼Œæœ‰å¾ˆå¤šé¢å¤–çš„åˆ¤æ–­ï¼Œè¿˜ç”¨åˆ°äº†interfaceï¼Œæ‰€ä»¥æ€§èƒ½ä¹Ÿä¸æ˜¯å¾ˆå¥½</p>
<p>3ã€joinä¼šå…ˆæ ¹æ®å­—ç¬¦ä¸²æ•°ç»„çš„å†…å®¹ï¼Œè®¡ç®—å‡ºä¸€ä¸ªæ‹¼æ¥ä¹‹åçš„é•¿åº¦ï¼Œç„¶åç”³è¯·å¯¹åº”å¤§å°çš„å†…å­˜ï¼Œä¸€ä¸ªä¸€ä¸ªå­—ç¬¦ä¸²å¡«å…¥ï¼Œåœ¨å·²æœ‰ä¸€ä¸ªæ•°ç»„çš„æƒ…å†µä¸‹ï¼Œè¿™ç§æ•ˆç‡ä¼šå¾ˆé«˜ï¼Œä½†æ˜¯æœ¬æ¥æ²¡æœ‰ï¼Œå»æ„é€ è¿™ä¸ªæ•°æ®çš„ä»£ä»·ä¹Ÿä¸å°ã€‚</p>
<p>4ã€è¿™ä¸ªæ¯”è¾ƒç†æƒ³ï¼Œå¯ä»¥å½“æˆå¯å˜å­—ç¬¦ä½¿ç”¨ï¼Œå¯¹å†…å­˜çš„å¢é•¿ä¹Ÿæœ‰ä¼˜åŒ–ï¼Œå¦‚æœèƒ½é¢„ä¼°å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œè¿˜å¯ä»¥ç”¨buffer.Grow()æ¥å£æ¥è®¾ç½®capacity</p>
<h4 id="å­—ç¬¦ä¸²åˆ‡ç‰‡æ“ä½œ">å­—ç¬¦ä¸²åˆ‡ç‰‡æ“ä½œ<a hidden class="anchor" aria-hidden="true" href="#å­—ç¬¦ä¸²åˆ‡ç‰‡æ“ä½œ">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>	<span style="color:#78787e">//  å­—ç¬¦åˆ‡ç‰‡
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>	str3 <span style="color:#ff6ac1">:=</span> <span style="color:#5af78e">&#34;Hello world!&#34;</span>
</span></span><span style="display:flex;"><span>	m, n <span style="color:#ff6ac1">:=</span> <span style="color:#ff9f43">3</span>, <span style="color:#ff9f43">6</span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff5c57">println</span>(str3[m])
</span></span><span style="display:flex;"><span>	<span style="color:#ff5c57">println</span>(str3[:m]) <span style="color:#78787e">// [0,3)
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>	<span style="color:#ff5c57">println</span>(str3[m:n])
</span></span><span style="display:flex;"><span>	<span style="color:#ff5c57">println</span>(str3[:n])
</span></span></code></pre></div><h4 id="å­—ç¬¦ä¸²å‡½æ•°">å­—ç¬¦ä¸²å‡½æ•°<a hidden class="anchor" aria-hidden="true" href="#å­—ç¬¦ä¸²å‡½æ•°">#</a></h4>
<p><img loading="lazy" src="https://cdn.jsdelivr.net/gh/Bin-lin-rgb/blog-img@main/3cadc5862efe0aae1d91f79b16dd225.jpg" alt=""  />
</p>
<h2 id="æ ¼å¼åŒ–è¾“å‡º">æ ¼å¼åŒ–è¾“å‡º<a hidden class="anchor" aria-hidden="true" href="#æ ¼å¼åŒ–è¾“å‡º">#</a></h2>
<p><a href="https://pkg.go.dev/fmt?utm_source=godoc">https://pkg.go.dev/fmt?utm_source=godoc</a></p>
<p><a href="https://www.cnblogs.com/yinzhengjie/p/7680829.html">https://www.cnblogs.com/yinzhengjie/p/7680829.html</a></p>
<p>é€šç”¨ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#ff9f43">1</span> <span style="color:#ff6ac1">%</span>v    å€¼çš„é»˜è®¤æ ¼å¼è¡¨ç¤º<span style="color:#ff5c57">ã€‚</span>å½“è¾“å‡ºç»“æ„ä½“æ—¶<span style="color:#ff5c57">ï¼Œ</span>æ‰©å±•æ ‡å¿—<span style="color:#ff5c57">ï¼ˆ</span><span style="color:#ff6ac1">%+</span>v<span style="color:#ff5c57">ï¼‰</span>ä¼šæ·»åŠ å­—æ®µå
</span></span><span style="display:flex;"><span><span style="color:#ff9f43">2</span> <span style="color:#ff6ac1">%</span><span style="color:#ff5c57">#</span>v    å€¼çš„Goè¯­æ³•è¡¨ç¤º
</span></span><span style="display:flex;"><span><span style="color:#ff9f43">3</span> <span style="color:#ff6ac1">%</span>T    å€¼çš„ç±»å‹çš„Goè¯­æ³•è¡¨ç¤º
</span></span><span style="display:flex;"><span><span style="color:#ff9f43">4</span> <span style="color:#ff6ac1">%%</span>    ç™¾åˆ†å·
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#78787e">//	æ ¼å¼åŒ–è¾“å‡º
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>	user <span style="color:#ff6ac1">:=</span> User{
</span></span><span style="display:flex;"><span>		Name:   <span style="color:#5af78e">&#34;David&#34;</span>,
</span></span><span style="display:flex;"><span>		Age:    <span style="color:#ff9f43">20</span>,
</span></span><span style="display:flex;"><span>		Gender: <span style="color:#5af78e">&#34;male&#34;</span>,
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	fmt.<span style="color:#57c7ff">Printf</span>(<span style="color:#5af78e">&#34;%v\n&#34;</span>, user)
</span></span><span style="display:flex;"><span>	<span style="color:#78787e">// {David 20 male}
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>	fmt.<span style="color:#57c7ff">Printf</span>(<span style="color:#5af78e">&#34;%#v\n&#34;</span>, user)
</span></span><span style="display:flex;"><span>	<span style="color:#78787e">// Base.User{Name:&#34;David&#34;, Age:20, Gender:&#34;male&#34;}
</span></span></span></code></pre></div><p>å¸ƒå°”å€¼ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>%t    å•è¯trueæˆ–false
</span></span></code></pre></div><p>æ•´æ•°ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>1 %b    è¡¨ç¤ºä¸ºäºŒè¿›åˆ¶
</span></span><span style="display:flex;"><span>2 %c    è¯¥å€¼å¯¹åº”çš„unicodeç å€¼[char]
</span></span><span style="display:flex;"><span>3 %d    è¡¨ç¤ºä¸ºåè¿›åˆ¶
</span></span><span style="display:flex;"><span>4 %o    è¡¨ç¤ºä¸ºå…«è¿›åˆ¶
</span></span><span style="display:flex;"><span>5 %q    è¯¥å€¼å¯¹åº”çš„å•å¼•å·æ‹¬èµ·æ¥çš„goè¯­æ³•å­—ç¬¦å­—é¢å€¼ï¼Œå¿…è¦æ—¶ä¼šé‡‡ç”¨å®‰å…¨çš„è½¬ä¹‰è¡¨ç¤º
</span></span><span style="display:flex;"><span>6 %x    è¡¨ç¤ºä¸ºåå…­è¿›åˆ¶ï¼Œä½¿ç”¨a-f
</span></span><span style="display:flex;"><span>7 %X    è¡¨ç¤ºä¸ºåå…­è¿›åˆ¶ï¼Œä½¿ç”¨A-F
</span></span><span style="display:flex;"><span>8 %U    è¡¨ç¤ºä¸ºUnicodeæ ¼å¼ï¼šU+1234ï¼Œç­‰ä»·äº&#34;U+%04X&#34;
</span></span></code></pre></div><p>æµ®ç‚¹æ•°ã€å¤æ•°çš„ä¸¤ä¸ªç»„åˆ†ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>1 %b    æ— å°æ•°éƒ¨åˆ†ã€äºŒè¿›åˆ¶æŒ‡æ•°çš„ç§‘å­¦è®¡æ•°æ³•ï¼Œå¦‚-123456p-78ï¼›å‚è§strconv.FormatFloat %e    ç§‘å­¦è®¡æ•°æ³•ï¼Œå¦‚-1234.456e+78 %E    ç§‘å­¦è®¡æ•°æ³•ï¼Œå¦‚-1234.456E+78 %f    æœ‰å°æ•°éƒ¨åˆ†ä½†æ— æŒ‡æ•°éƒ¨åˆ†ï¼Œå¦‚123.456 %F    ç­‰ä»·äº%f %g    æ ¹æ®å®é™…æƒ…å†µé‡‡ç”¨%eæˆ–%fæ ¼å¼ï¼ˆä»¥è·å¾—æ›´ç®€æ´ã€å‡†ç¡®çš„è¾“å‡ºï¼‰
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>2 %G    æ ¹æ®å®é™…æƒ…å†µé‡‡ç”¨%Eæˆ–%Fæ ¼å¼ï¼ˆä»¥è·å¾—æ›´ç®€æ´ã€å‡†ç¡®çš„è¾“å‡ºï¼‰
</span></span></code></pre></div><p>å­—ç¬¦ä¸²å’Œ[]byteï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>%s    ç›´æ¥è¾“å‡ºå­—ç¬¦ä¸²æˆ–è€…[]byte %q    è¯¥å€¼å¯¹åº”çš„åŒå¼•å·æ‹¬èµ·æ¥çš„goè¯­æ³•å­—ç¬¦ä¸²å­—é¢å€¼ï¼Œå¿…è¦æ—¶ä¼šé‡‡ç”¨å®‰å…¨çš„è½¬ä¹‰è¡¨ç¤º
</span></span><span style="display:flex;"><span>%x    æ¯ä¸ªå­—èŠ‚ç”¨ä¸¤å­—ç¬¦åå…­è¿›åˆ¶æ•°è¡¨ç¤ºï¼ˆä½¿ç”¨a-fï¼‰
</span></span><span style="display:flex;"><span>%X    æ¯ä¸ªå­—èŠ‚ç”¨ä¸¤å­—ç¬¦åå…­è¿›åˆ¶æ•°è¡¨ç¤ºï¼ˆä½¿ç”¨A-Fï¼‰
</span></span></code></pre></div><p>æŒ‡é’ˆï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>%p    è¡¨ç¤ºä¸ºåå…­è¿›åˆ¶ï¼Œå¹¶åŠ ä¸Šå‰å¯¼çš„0x
</span></span></code></pre></div><p>æ²¡æœ‰verb %uã€‚æ•´æ•°å¦‚æœæ˜¯æ— ç¬¦å·ç±»å‹è‡ªç„¶è¾“å‡ºä¹Ÿæ˜¯æ— ç¬¦å·çš„ã€‚ç±»ä¼¼çš„ï¼Œä¹Ÿæ²¡æœ‰å¿…è¦æŒ‡å®šæ“ä½œæ•°çš„å°ºå¯¸ï¼ˆint8ï¼Œint64ï¼‰ã€‚</p>
<p>å®½åº¦é€šè¿‡ä¸€ä¸ªç´§è·Ÿåœ¨ç™¾åˆ†å·åé¢çš„åè¿›åˆ¶æ•°æŒ‡å®šï¼Œå¦‚æœæœªæŒ‡å®šå®½åº¦ï¼Œåˆ™è¡¨ç¤ºå€¼æ—¶é™¤å¿…éœ€ä¹‹å¤–ä¸ä½œå¡«å……ã€‚ç²¾åº¦é€šè¿‡ï¼ˆå¯èƒ½æœ‰çš„ï¼‰å®½åº¦åè·Ÿç‚¹å·åè·Ÿçš„åè¿›åˆ¶æ•°æŒ‡å®šã€‚å¦‚æœæœªæŒ‡å®šç²¾åº¦ï¼Œä¼šä½¿ç”¨é»˜è®¤ç²¾åº¦ï¼›å¦‚æœç‚¹å·åæ²¡æœ‰è·Ÿæ•°å­—ï¼Œè¡¨ç¤ºç²¾åº¦ä¸º0ã€‚ä¸¾ä¾‹å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>%f:    é»˜è®¤å®½åº¦ï¼Œé»˜è®¤ç²¾åº¦
</span></span><span style="display:flex;"><span>%9f    å®½åº¦9ï¼Œé»˜è®¤ç²¾åº¦
</span></span><span style="display:flex;"><span>%.2f   é»˜è®¤å®½åº¦ï¼Œç²¾åº¦2 
</span></span><span style="display:flex;"><span>%9.2f  å®½åº¦9ï¼Œç²¾åº¦2 
</span></span><span style="display:flex;"><span>%9.f   å®½åº¦9ï¼Œç²¾åº¦0
</span></span></code></pre></div><p>å®½åº¦å’Œç²¾åº¦æ ¼å¼åŒ–æ§åˆ¶çš„æ˜¯Unicodeç å€¼çš„æ•°é‡ï¼ˆä¸åŒäºCçš„printfï¼Œå®ƒçš„è¿™ä¸¤ä¸ªå› æ•°æŒ‡çš„æ˜¯å­—èŠ‚çš„æ•°é‡ï¼‰ã€‚ä¸¤è€…ä»»ä¸€ä¸ªæˆ–ä¸¤ä¸ªéƒ½å¯ä»¥ä½¿ç”¨&rsquo;<em>&lsquo;å·å–ä»£ï¼Œæ­¤æ—¶å®ƒä»¬çš„å€¼å°†è¢«å¯¹åº”çš„å‚æ•°ï¼ˆæŒ‰&rsquo;</em>&lsquo;å·å’Œverbå‡ºç°çš„é¡ºåºï¼Œå³æ§åˆ¶å…¶å€¼çš„å‚æ•°ä¼šå‡ºç°åœ¨è¦è¡¨ç¤ºçš„å€¼å‰é¢ï¼‰æ§åˆ¶ï¼Œè¿™ä¸ªæ“ä½œæ•°å¿…é¡»æ˜¯intç±»å‹ã€‚</p>
<p>å¯¹äºå¤§å¤šæ•°ç±»å‹çš„å€¼ï¼Œå®½åº¦æ˜¯è¾“å‡ºçš„æœ€å°å­—ç¬¦æ•°ï¼Œå¦‚æœå¿…è¦æ˜¯ä¼šç”¨ç©ºæ ¼å¡«å……ã€‚å¯¹äºå­—ç¬¦ä¸²ï¼Œå®½åº¦æ˜¯è¾“å‡ºå­—ç¬¦æ•°ç›®çš„æœ€ä½æ•°é‡ï¼Œå¦‚æœå¿…è¦ä¼šæˆªæ–­å­—ç¬¦ä¸²ã€‚</p>
<p>å¯¹äºæ•´æ•°ï¼Œå®½åº¦å’Œç²¾åº¦éƒ½è®¾ç½®è¾“å‡ºæ€»é•¿åº¦ã€‚é‡‡ç”¨ç²¾åº¦æ—¶è¡¨ç¤ºå³å¯¹é½å¹¶ç”¨0å¡«å……ï¼Œè€Œå®½åº¦é»˜è®¤è¡¨ç¤ºç”¨ç©ºæ ¼å¡«å……ã€‚</p>
<p>å¯¹äºæµ®ç‚¹æ•°ï¼Œå®½åº¦è®¾ç½®è¾“å‡ºæ€»é•¿åº¦ï¼›ç²¾åº¦è®¾ç½®å°æ•°éƒ¨åˆ†é•¿åº¦ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ï¼Œé™¤äº†%g/%Gï¼Œæ­¤æ—¶ç²¾åº¦è®¾ç½®æ€»çš„æ•°å­—ä¸ªæ•°ã€‚ä¾‹å¦‚ï¼Œå¯¹æ•°å­—123.45ï¼Œæ ¼å¼%6.2f è¾“å‡º123.45ï¼›æ ¼å¼%.4gè¾“å‡º123.5ã€‚%eå’Œ%fçš„é»˜è®¤ç²¾åº¦æ˜¯6ï¼Œ%gçš„é»˜è®¤ç²¾åº¦æ˜¯å¯ä»¥å°†è¯¥å€¼åŒºåˆ†å‡ºæ¥éœ€è¦çš„æœ€å°æ•°å­—ä¸ªæ•°ã€‚</p>
<p>å¯¹å¤æ•°ï¼Œå®½åº¦å’Œç²¾åº¦ä¼šåˆ†åˆ«ç”¨äºå®éƒ¨å’Œè™šéƒ¨ï¼Œç»“æœç”¨å°æ‹¬å·åŒ…è£¹ã€‚å› æ­¤%fç”¨äº1.2+3.4iè¾“å‡º(1.200000+3.400000i)ã€‚</p>
<p>å…¶å®ƒflagï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>1 +    æ€»æ˜¯è¾“å‡ºæ•°å€¼çš„æ­£è´Ÿå·ï¼›å¯¹%qï¼ˆ%+qï¼‰ä¼šç”Ÿæˆå…¨éƒ¨æ˜¯ASCIIå­—ç¬¦çš„è¾“å‡ºï¼ˆé€šè¿‡è½¬ä¹‰ï¼‰ï¼›
</span></span><span style="display:flex;"><span>2 -    åœ¨è¾“å‡ºå³è¾¹å¡«å……ç©ºç™½è€Œä¸æ˜¯é»˜è®¤çš„å·¦è¾¹ï¼ˆå³ä»é»˜è®¤çš„å³å¯¹é½åˆ‡æ¢ä¸ºå·¦å¯¹é½ï¼‰ï¼›
</span></span><span style="display:flex;"><span>3 #    åˆ‡æ¢æ ¼å¼ï¼š
</span></span><span style="display:flex;"><span>4       å…«è¿›åˆ¶æ•°å‰åŠ 0ï¼ˆ%#oï¼‰ï¼Œåå…­è¿›åˆ¶æ•°å‰åŠ 0xï¼ˆ%#xï¼‰æˆ–0Xï¼ˆ%#Xï¼‰ï¼ŒæŒ‡é’ˆå»æ‰å‰é¢çš„0xï¼ˆ%#pï¼‰ï¼›
</span></span><span style="display:flex;"><span>5      å¯¹%qï¼ˆ%#qï¼‰ï¼Œå¦‚æœstrconv.CanBackquoteè¿”å›çœŸä¼šè¾“å‡ºåå¼•å·æ‹¬èµ·æ¥çš„æœªè½¬ä¹‰å­—ç¬¦ä¸²ï¼›
</span></span><span style="display:flex;"><span>6      å¯¹%Uï¼ˆ%#Uï¼‰ï¼Œå¦‚æœå­—ç¬¦æ˜¯å¯æ‰“å°çš„ï¼Œä¼šåœ¨è¾“å‡ºUnicodeæ ¼å¼ã€ç©ºæ ¼ã€å•å¼•å·æ‹¬èµ·æ¥çš„goå­—é¢å€¼ï¼›
</span></span><span style="display:flex;"><span>7 &#39; &#39;    å¯¹æ•°å€¼ï¼Œæ­£æ•°å‰åŠ ç©ºæ ¼è€Œè´Ÿæ•°å‰åŠ è´Ÿå·ï¼›
</span></span><span style="display:flex;"><span>8       å¯¹å­—ç¬¦ä¸²é‡‡ç”¨%xæˆ–%Xæ—¶ï¼ˆ% xæˆ–% Xï¼‰ä¼šç»™å„æ‰“å°çš„å­—èŠ‚ä¹‹é—´åŠ ç©ºæ ¼ï¼›
</span></span><span style="display:flex;"><span>9 0    ä½¿ç”¨0è€Œä¸æ˜¯ç©ºæ ¼å¡«å……ï¼Œå¯¹äºæ•°å€¼ç±»å‹ä¼šæŠŠå¡«å……çš„0æ”¾åœ¨æ­£è´Ÿå·åé¢ï¼›
</span></span></code></pre></div><p>verbä¼šå¿½ç•¥ä¸æ”¯æŒçš„flagã€‚ä¾‹å¦‚ï¼Œå› ä¸ºæ²¡æœ‰åè¿›åˆ¶åˆ‡æ¢æ¨¡å¼ï¼Œæ‰€ä»¥%#då’Œ%dçš„è¾“å‡ºæ˜¯ç›¸åŒçš„ã€‚</p>
<p>å¯¹æ¯ä¸€ä¸ªç±»ä¼¼Printfçš„å‡½æ•°ï¼Œéƒ½æœ‰å¯¹åº”çš„Printå‹å‡½æ•°ï¼Œè¯¥å‡½æ•°ä¸æ¥å—æ ¼å¼å­—ç¬¦ä¸²ï¼Œå°±æ•ˆæœä¸Šç­‰ä»·äºå¯¹æ¯ä¸€ä¸ªå‚æ•°éƒ½æ˜¯ç”¨verb %vã€‚å¦ä¸€ä¸ªå˜ä½“Printlnå‹å‡½æ•°ä¼šåœ¨å„ä¸ªæ“ä½œæ•°çš„è¾“å‡ºä¹‹é—´åŠ ç©ºæ ¼å¹¶åœ¨æœ€åæ¢è¡Œã€‚</p>
<p>ä¸ç®¡verbå¦‚ä½•ï¼Œå¦‚æœæ“ä½œæ•°æ˜¯ä¸€ä¸ªæ¥å£å€¼ï¼Œé‚£ä¹ˆä¼šä½¿ç”¨æ¥å£å†…éƒ¨ä¿ç®¡çš„å€¼ï¼Œè€Œä¸æ˜¯æ¥å£ï¼Œå› æ­¤ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span> <span style="color:#ff9f43">1</span> <span style="color:#78787e">/*
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"> 2 #!/usr/bin/env gorun
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"> 3 @author :yinzhengjie
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"> 4 Blog:http://www.cnblogs.com/yinzhengjie/tag/GO%E8%AF%AD%E8%A8%80%E7%9A%84%E8%BF%9B%E9%98%B6%E4%B9%8B%E8%B7%AF/
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"> 5 EMAIL:y1053419035@qq.com
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"> 6 */</span>
</span></span><span style="display:flex;"><span> <span style="color:#ff9f43">7</span> 
</span></span><span style="display:flex;"><span> <span style="color:#ff9f43">8</span> <span style="color:#ff6ac1">package</span> main
</span></span><span style="display:flex;"><span> <span style="color:#ff9f43">9</span> 
</span></span><span style="display:flex;"><span><span style="color:#ff9f43">10</span> <span style="color:#ff6ac1">import</span> <span style="color:#5af78e">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff9f43">11</span> 
</span></span><span style="display:flex;"><span><span style="color:#ff9f43">12</span> <span style="color:#ff5c57">func</span> <span style="color:#57c7ff">main</span>() {
</span></span><span style="display:flex;"><span><span style="color:#ff9f43">13</span>     <span style="color:#ff5c57">var</span> name <span style="color:#ff5c57">interface</span>{} = <span style="color:#5af78e">&#34;yinzhengjie&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff9f43">14</span>     fmt.<span style="color:#57c7ff">Printf</span>(<span style="color:#5af78e">&#34;My name is %v !\n&#34;</span>, name)
</span></span><span style="display:flex;"><span><span style="color:#ff9f43">15</span>     <span style="color:#ff5c57">var</span> age  <span style="color:#ff5c57">interface</span>{} = <span style="color:#ff9f43">18</span>
</span></span><span style="display:flex;"><span><span style="color:#ff9f43">16</span>     fmt.<span style="color:#57c7ff">Printf</span>(<span style="color:#5af78e">&#34;I am [%d] years oldã€‚&#34;</span>,age)
</span></span><span style="display:flex;"><span><span style="color:#ff9f43">17</span> }
</span></span><span style="display:flex;"><span><span style="color:#ff9f43">18</span> 
</span></span><span style="display:flex;"><span><span style="color:#ff9f43">19</span> 
</span></span><span style="display:flex;"><span><span style="color:#ff9f43">20</span> 
</span></span><span style="display:flex;"><span><span style="color:#ff9f43">21</span> <span style="color:#ff5c57">#</span>ä»¥ä¸Šä»£ç æ‰§è¡Œç»“æœå¦‚ä¸‹<span style="color:#ff5c57">ï¼š</span>
</span></span><span style="display:flex;"><span><span style="color:#ff9f43">22</span> My name is yinzhengjie !
</span></span><span style="display:flex;"><span><span style="color:#ff9f43">23</span> I am [<span style="color:#ff9f43">18</span>] years old<span style="color:#ff5c57">ã€‚</span>
</span></span></code></pre></div><p>é™¤äº†verb %Tå’Œ%pä¹‹å¤–ï¼›å¯¹å®ç°äº†ç‰¹å®šæ¥å£çš„æ“ä½œæ•°ä¼šè€ƒè™‘é‡‡ç”¨ç‰¹æ®Šçš„æ ¼å¼åŒ–æŠ€å·§ã€‚æŒ‰åº”ç”¨ä¼˜å…ˆçº§å¦‚ä¸‹ï¼š</p>
<p>\1. å¦‚æœæ“ä½œæ•°å®ç°äº†Formatteræ¥å£ï¼Œä¼šè°ƒç”¨è¯¥æ¥å£çš„æ–¹æ³•ã€‚Formatteræä¾›äº†æ ¼å¼åŒ–çš„æ§åˆ¶ã€‚</p>
<p>\2. å¦‚æœverb %vé…åˆflag #ä½¿ç”¨ï¼ˆ%#vï¼‰ï¼Œä¸”æ“ä½œæ•°å®ç°äº†GoStringeræ¥å£ï¼Œä¼šè°ƒç”¨è¯¥æ¥å£ã€‚</p>
<p>å¦‚æœæ“ä½œæ•°æ»¡è¶³å¦‚ä¸‹ä¸¤æ¡ä»»ä¸€æ¡ï¼Œå¯¹äº%sã€%qã€%vã€%xã€%Xäº”ä¸ªverbï¼Œå°†è€ƒè™‘ï¼š</p>
<p>\3. å¦‚æœæ“ä½œæ•°å®ç°äº†erroræ¥å£ï¼ŒErroræ–¹æ³•ä¼šç”¨æ¥ç”Ÿæˆå­—ç¬¦ä¸²ï¼Œéšåå°†æŒ‰ç»™å‡ºçš„flagï¼ˆå¦‚æœæœ‰ï¼‰å’Œverbæ ¼å¼åŒ–ã€‚</p>
<p>\4. å¦‚æœæ“ä½œæ•°å…·æœ‰Stringæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å°†è¢«ç”¨æ¥ç”Ÿæˆå­—ç¬¦ä¸²ï¼Œç„¶åå°†æŒ‰ç»™å‡ºçš„flagï¼ˆå¦‚æœæœ‰ï¼‰å’Œverbæ ¼å¼åŒ–ã€‚</p>
<p>å¤åˆç±»å‹çš„æ“ä½œæ•°ï¼Œå¦‚åˆ‡ç‰‡å’Œç»“æ„ä½“ï¼Œæ ¼å¼åŒ–åŠ¨verbé€’å½’åœ°åº”ç”¨äºå…¶æ¯ä¸€ä¸ªæˆå‘˜ï¼Œè€Œä¸æ˜¯ä½œä¸ºæ•´ä½“ä¸€ä¸ªæ“ä½œæ•°ä½¿ç”¨ã€‚å› æ­¤%qä¼šå°†[]stringçš„æ¯ä¸€ä¸ªæˆå‘˜æ‹¬èµ·æ¥ï¼Œ%6.2fä¼šæ§åˆ¶æµ®ç‚¹æ•°ç»„çš„æ¯ä¸€ä¸ªå…ƒç´ çš„æ ¼å¼åŒ–ã€‚</p>
<p>ä¸ºäº†é¿å…å¯èƒ½å‡ºç°çš„æ— ç©·é€’å½’ï¼Œå¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>1 type X string
</span></span><span style="display:flex;"><span>2 func (x X) String() string { return Sprintf(&#34;&lt;%s&gt;&#34;, x) }
</span></span></code></pre></div><p>åº”åœ¨é€’å½’ä¹‹å‰è½¬æ¢å€¼çš„ç±»å‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>1 func (x X) String() string { return Sprintf(&#34;&lt;%s&gt;&#34;, string(x)) }
</span></span></code></pre></div><p>æ˜¾å¼æŒ‡å®šå‚æ•°ç´¢å¼•ï¼š</p>
<p>åœ¨Printfã€Sprintfã€Fprintfä¸‰ä¸ªå‡½æ•°ä¸­ï¼Œé»˜è®¤çš„è¡Œä¸ºæ˜¯å¯¹æ¯ä¸€ä¸ªæ ¼å¼åŒ–verbä¾æ¬¡å¯¹åº”è°ƒç”¨æ—¶æˆåŠŸä¼ é€’è¿›æ¥çš„å‚æ•°ã€‚ä½†æ˜¯ï¼Œç´§è·Ÿåœ¨verbä¹‹å‰çš„[n]ç¬¦å·è¡¨ç¤ºåº”æ ¼å¼åŒ–ç¬¬nä¸ªå‚æ•°ï¼ˆç´¢å¼•ä»1å¼€å§‹ï¼‰ã€‚åŒæ ·çš„åœ¨&rsquo;*&lsquo;ä¹‹å‰çš„[n]ç¬¦å·è¡¨ç¤ºé‡‡ç”¨ç¬¬nä¸ªå‚æ•°çš„å€¼ä½œä¸ºå®½åº¦æˆ–ç²¾åº¦ã€‚åœ¨å¤„ç†å®Œæ–¹æ‹¬å·è¡¨è¾¾å¼[n]åï¼Œé™¤éå¦æœ‰æŒ‡ç¤ºï¼Œä¼šæ¥ç€å¤„ç†å‚æ•°n+1ï¼Œn+2â€¦â€¦ï¼ˆå°±æ˜¯è¯´ç§»åŠ¨äº†å½“å‰å¤„ç†ä½ç½®ï¼‰ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>1 fmt.Sprintf(&#34;%[2]d %[1]d\n&#34;, 11, 22)
</span></span></code></pre></div><p>ä¼šç”Ÿæˆ&quot;22 11&quot;ï¼Œè€Œï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>1 fmt.Sprintf(&#34;%[3]*.[2]*[1]f&#34;, 12.0, 2, 6),
</span></span></code></pre></div><p>ç­‰ä»·äºï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>1 fmt.Sprintf(&#34;%6.2f&#34;, 12.0),
</span></span></code></pre></div><p>ä¼šç”Ÿæˆ&quot; 12.00&quot;ã€‚å› ä¸ºæ˜¾å¼çš„ç´¢å¼•ä¼šå½±å“éšåçš„verbï¼Œè¿™ç§ç¬¦å·å¯ä»¥é€šè¿‡é‡è®¾ç´¢å¼•ç”¨äºå¤šæ¬¡æ‰“å°åŒä¸€ä¸ªå€¼ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>1 fmt.Sprintf(&#34;%d %d %#[1]x %#x&#34;, 16, 17)
</span></span></code></pre></div><p>ä¼šç”Ÿæˆ&quot;16 17 0x10 0x11&quot;</p>
<p>æ ¼å¼åŒ–é”™è¯¯ï¼š</p>
<p>å¦‚æœç»™æŸä¸ªverbæä¾›äº†éæ³•çš„å‚æ•°ï¼Œå¦‚ç»™%dæä¾›äº†ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œç”Ÿæˆçš„å­—ç¬¦ä¸²ä¼šåŒ…å«è¯¥é—®é¢˜çš„æè¿°ï¼Œå¦‚ä¸‹æ‰€ä¾‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span> 1 é”™è¯¯çš„ç±»å‹æˆ–æœªçŸ¥çš„verbï¼š%!verb(type=value)
</span></span><span style="display:flex;"><span> 2     Printf(&#34;%d&#34;, hi):          %!d(string=hi)
</span></span><span style="display:flex;"><span> 3 å¤ªå¤šå‚æ•°ï¼ˆé‡‡ç”¨ç´¢å¼•æ—¶ä¼šå¤±æ•ˆï¼‰ï¼š%!(EXTRA type=value)
</span></span><span style="display:flex;"><span> 4     Printf(&#34;hi&#34;, &#34;guys&#34;):      hi%!(EXTRA string=guys)
</span></span><span style="display:flex;"><span> 5 å¤ªå°‘å‚æ•°: %!verb(MISSING)
</span></span><span style="display:flex;"><span> 6     Printf(&#34;hi%d&#34;):            hi %!d(MISSING)
</span></span><span style="display:flex;"><span> 7 å®½åº¦/ç²¾åº¦ä¸æ˜¯æ•´æ•°å€¼ï¼š%!(BADWIDTH) or %!(BADPREC)
</span></span><span style="display:flex;"><span> 9     Printf(&#34;%.*s&#34;, 4.5, &#34;hi&#34;): %!(BADPREC)hi
</span></span><span style="display:flex;"><span>10 æ²¡æœ‰ç´¢å¼•æŒ‡å‘çš„å‚æ•°ï¼š%!(BADINDEX)
</span></span><span style="display:flex;"><span>11     Printf(&#34;%*[2]d&#34;, 7):       %!d(BADINDEX)
</span></span><span style="display:flex;"><span>12     Printf(&#34;%.[2]d&#34;, 7):       %!d(BADINDEX)
</span></span></code></pre></div><p>æ‰€æœ‰çš„é”™è¯¯éƒ½ä»¥å­—ç¬¦ä¸²&quot;%!&ldquo;å¼€å§‹ï¼Œæœ‰æ—¶ä¼šåè·Ÿå•ä¸ªå­—ç¬¦ï¼ˆverbæ ‡è¯†ç¬¦ï¼‰ï¼Œå¹¶ä»¥åŠ å°æ‹¬å¼§çš„æè¿°ç»“æŸã€‚</p>
<p>å¦‚æœè¢«printç³»åˆ—å‡½æ•°è°ƒç”¨æ—¶ï¼ŒErroræˆ–Stringæ–¹æ³•è§¦å‘äº†panicï¼ŒfmtåŒ…ä¼šæ ¹æ®panicé‡å»ºé”™è¯¯ä¿¡æ¯ï¼Œç”¨ä¸€ä¸ªå­—ç¬¦ä¸²è¯´æ˜è¯¥panicç»è¿‡äº†fmtåŒ…ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªStringæ–¹æ³•è°ƒç”¨äº†panic(&ldquo;bad&rdquo;)ï¼Œç”Ÿæˆçš„æ ¼å¼åŒ–ä¿¡æ¯å·®ä¸å¤šæ˜¯è¿™æ ·çš„ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>%!s(PANIC=bad)
</span></span></code></pre></div><p>%!sæŒ‡ç¤ºè¡¨ç¤ºé”™è¯¯ï¼ˆpanicï¼‰å‡ºç°æ—¶çš„ä½¿ç”¨çš„verbã€‚</p>
<h2 id="è¿ç®—ç¬¦">è¿ç®—ç¬¦<a hidden class="anchor" aria-hidden="true" href="#è¿ç®—ç¬¦">#</a></h2>
<p>è‡ªå¢ &amp; è‡ªå‡ ä¸ç”¨äº è¡¨è¾¾å¼ä¸­ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>	<span style="color:#78787e">//num2:=num++ + 5
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>	num3<span style="color:#ff6ac1">:=</span>num <span style="color:#ff6ac1">+</span> <span style="color:#ff9f43">5</span>
</span></span><span style="display:flex;"><span>	fmt.<span style="color:#57c7ff">Println</span>(num3)
</span></span></code></pre></div><h2 id="æµç¨‹æ§åˆ¶">æµç¨‹æ§åˆ¶<a hidden class="anchor" aria-hidden="true" href="#æµç¨‹æ§åˆ¶">#</a></h2>
<h3 id="if">if<a hidden class="anchor" aria-hidden="true" href="#if">#</a></h3>
<h3 id="switch">switch<a hidden class="anchor" aria-hidden="true" href="#switch">#</a></h3>
<p>case <strong>==å¯ä»¥å¤šä¸ªã€å¯ä»¥æ˜¯è¡¨è¾¾å¼==</strong></p>
<p>case é‡Œé¢ä¸éœ€è¦ break ï¼Œè‹¥æƒ³ç»§ç»­ä¸‹å» åŠ  fallthrough</p>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#ff5c57">func</span> <span style="color:#57c7ff">Control</span>() {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	str <span style="color:#ff6ac1">:=</span> <span style="color:#5af78e">&#34;b&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#57c7ff">checkGrade</span>(str)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">func</span> <span style="color:#57c7ff">checkGrade</span>(grade <span style="color:#9aedfe">string</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#78787e">//	switch
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">switch</span> grade {
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">case</span> <span style="color:#5af78e">&#34;a&#34;</span>, <span style="color:#5af78e">&#34;b&#34;</span>:
</span></span><span style="display:flex;"><span>		fmt.<span style="color:#57c7ff">Printf</span>(<span style="color:#5af78e">&#34;Very Good&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">case</span> <span style="color:#5af78e">&#34;c&#34;</span>:
</span></span><span style="display:flex;"><span>		fmt.<span style="color:#57c7ff">Printf</span>(<span style="color:#5af78e">&#34;Good&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">default</span>:
</span></span><span style="display:flex;"><span>		fmt.<span style="color:#57c7ff">Println</span>(<span style="color:#5af78e">&#34;normal&#34;</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="å¾ªç¯">å¾ªç¯<a hidden class="anchor" aria-hidden="true" href="#å¾ªç¯">#</a></h3>
<h4 id="for-range">for range<a hidden class="anchor" aria-hidden="true" href="#for-range">#</a></h4>
<p>å¯ä»¥ä½¿ç”¨for rangeéå†æ•°ç»„ã€åˆ‡ç‰‡ã€å­—ç¬¦ä¸²ã€mapåŠé€šé“(channel)ã€‚</p>
<p>é€šè¿‡for rangeéå†çš„è¿”å›å€¼æœ‰ä»¥ä¸‹è§„å¾‹ï¼š</p>
<p>1.æ•°ç»„ã€åˆ‡ç‰‡ã€å­—ç¬¦ä¸²è¿”å›ç´¢å¼•å’Œå€¼ã€‚
2.mapè¿”å›é”®å’Œå€¼ã€‚
3.é€šé“(channel)åªè¿”å›é€šé“å†…çš„å€¼ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>	arr <span style="color:#ff6ac1">:=</span> [<span style="color:#ff6ac1">...</span>]<span style="color:#9aedfe">int</span>{<span style="color:#ff9f43">1</span>, <span style="color:#ff9f43">2</span>, <span style="color:#ff9f43">3</span>} <span style="color:#78787e">//[3]int
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>	<span style="color:#78787e">//arr := []int{1, 2, 3}  //[]int
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>	<span style="color:#ff6ac1">for</span> i, v <span style="color:#ff6ac1">:=</span> <span style="color:#ff6ac1">range</span> arr {
</span></span><span style="display:flex;"><span>		fmt.<span style="color:#57c7ff">Printf</span>(<span style="color:#5af78e">&#34;%v:%v\n&#34;</span>, i, v)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	fmt.<span style="color:#57c7ff">Printf</span>(<span style="color:#5af78e">&#34;%T\n&#34;</span>, arr)
</span></span></code></pre></div><p>breakï¼šåœ¨å¾ªç¯ä¸­ï¼Œè·³å‡ºä¸€å±‚å¾ªç¯</p>
<p>continue</p>
<p>goto</p>
<h2 id="æ•°ç»„">æ•°ç»„<a hidden class="anchor" aria-hidden="true" href="#æ•°ç»„">#</a></h2>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#ff6ac1">package</span> Base
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">import</span> <span style="color:#5af78e">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">func</span> <span style="color:#57c7ff">Array</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#78787e">//	æ•°ç»„åˆ—è¡¨åˆå§‹åŒ–
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>	<span style="color:#ff5c57">var</span> arr = [<span style="color:#ff9f43">5</span>]<span style="color:#9aedfe">int</span>{<span style="color:#ff9f43">4</span>, <span style="color:#ff9f43">5</span>, <span style="color:#ff9f43">6</span>, <span style="color:#ff9f43">7</span>, <span style="color:#ff9f43">8</span>}
</span></span><span style="display:flex;"><span>	fmt.<span style="color:#57c7ff">Println</span>(arr)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>	<span style="color:#78787e">//	ä½¿ç”¨ ... , è®©ä»–è‡ªè¡Œæ¨æ–­é•¿åº¦
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>	<span style="color:#ff5c57">var</span> arr1 = [<span style="color:#ff6ac1">...</span>]<span style="color:#9aedfe">int</span>{<span style="color:#ff9f43">4</span>, <span style="color:#ff9f43">5</span>, <span style="color:#ff9f43">6</span>, <span style="color:#ff9f43">7</span>, <span style="color:#ff9f43">8</span>, <span style="color:#ff9f43">9</span>, <span style="color:#ff9f43">10</span>}
</span></span><span style="display:flex;"><span>	fmt.<span style="color:#57c7ff">Println</span>(arr1)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>	<span style="color:#78787e">//	æŒ‡å®šç´¢å¼•å€¼çš„æ–¹å¼åˆå§‹åŒ–
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>	<span style="color:#ff5c57">var</span> arr2 = [<span style="color:#ff6ac1">...</span>]<span style="color:#9aedfe">int</span>{<span style="color:#ff9f43">0</span>: <span style="color:#ff9f43">1</span>, <span style="color:#ff9f43">2</span>: <span style="color:#ff9f43">2</span>, <span style="color:#ff9f43">3</span>: <span style="color:#ff9f43">4</span>}
</span></span><span style="display:flex;"><span>	fmt.<span style="color:#57c7ff">Println</span>(arr2)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="åˆ‡ç‰‡">åˆ‡ç‰‡<a hidden class="anchor" aria-hidden="true" href="#åˆ‡ç‰‡">#</a></h2>
<p>å‰é¢æˆ‘ä»¬å­¦ä¹ äº†æ•°ç»„ï¼Œæ•°ç»„æ˜¯å›ºå®šé•¿åº¦ï¼Œå¯ä»¥å®¹çº³ç›¸åŒæ•°æ®ç±»å‹çš„å…ƒç´ çš„é›†åˆã€‚å½“é•¿åº¦å›ºå®šæ—¶ï¼Œä½¿ç”¨è¿˜æ˜¯å¸¦æ¥ä¸€äº›é™åˆ¶ï¼Œæ¯”å¦‚ï¼šæˆ‘ä»¬ç”³è¯·çš„é•¿åº¦å¤ªå¤§æµªè´¹å†…å­˜ï¼Œå¤ªå°åˆä¸å¤Ÿç”¨ã€‚</p>
<p>é‰´äºä¸Šè¿°åŸå› ï¼Œæˆ‘ä»¬æœ‰äº†goè¯­è¨€çš„åˆ‡ç‰‡ï¼Œå¯ä»¥æŠŠåˆ‡ç‰‡ç†è§£ä¸ºï¼Œå¯å˜é•¿åº¦çš„æ•°ç»„ï¼Œ<strong>å…¶å®å®ƒåº•å±‚å°±æ˜¯ä½¿ç”¨æ•°ç»„å®ç°çš„</strong>ï¼Œå¢åŠ äº†è‡ªåŠ¨æ‰©å®¹åŠŸèƒ½ã€‚åˆ‡ç‰‡ (slice) æ˜¯ä¸€ä¸ªæ‹¥æœ‰ç›¸åŒç±»å‹å…ƒç´ çš„å¯å˜é•¿åº¦çš„åºåˆ—ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#ff5c57">func</span> <span style="color:#57c7ff">Slice</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#78787e">//	æ•°ç»„
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>	<span style="color:#ff5c57">var</span> arr = [<span style="color:#ff6ac1">...</span>]<span style="color:#9aedfe">int</span>{<span style="color:#ff9f43">3</span>, <span style="color:#ff9f43">4</span>, <span style="color:#ff9f43">5</span>, <span style="color:#ff9f43">6</span>}
</span></span><span style="display:flex;"><span>	fmt.<span style="color:#57c7ff">Println</span>(arr)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#78787e">//	åˆ‡ç‰‡
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>	<span style="color:#ff5c57">var</span> slice = []<span style="color:#9aedfe">int</span>{<span style="color:#ff9f43">3</span>, <span style="color:#ff9f43">4</span>, <span style="color:#ff9f43">5</span>, <span style="color:#ff9f43">6</span>}
</span></span><span style="display:flex;"><span>	fmt.<span style="color:#57c7ff">Println</span>(slice)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#78787e">//  é€šè¿‡ make
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>	<span style="color:#ff5c57">var</span> sliceByMake = <span style="color:#ff5c57">make</span>([]<span style="color:#9aedfe">int</span>, <span style="color:#ff9f43">5</span>)
</span></span><span style="display:flex;"><span>	fmt.<span style="color:#57c7ff">Println</span>(sliceByMake)
</span></span><span style="display:flex;"><span>	<span style="color:#ff5c57">println</span>(<span style="color:#5af78e">&#34;len&#34;</span>, <span style="color:#ff5c57">len</span>(sliceByMake))
</span></span><span style="display:flex;"><span>	<span style="color:#ff5c57">println</span>(<span style="color:#5af78e">&#34;cap&#34;</span>, <span style="color:#ff5c57">cap</span>(sliceByMake))
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="tips">tips<a hidden class="anchor" aria-hidden="true" href="#tips">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>	headNum <span style="color:#ff6ac1">:=</span> <span style="color:#ff9f43">6</span>
</span></span><span style="display:flex;"><span>	<span style="color:#78787e">// è¿™é‡Œåˆ›å»ºäº† 6 ä¸ª 0
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>	<span style="color:#ff5c57">var</span> UidIntArr = <span style="color:#ff5c57">make</span>([]<span style="color:#9aedfe">int</span>, headNum)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#78787e">// right
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>	<span style="color:#ff5c57">var</span> UidIntArr = <span style="color:#ff5c57">make</span>([]<span style="color:#9aedfe">int</span>, <span style="color:#ff9f43">0</span>, headNum)
</span></span></code></pre></div><h3 id="æ·»åŠ åˆ é™¤copy">æ·»åŠ ã€åˆ é™¤ã€Copy<a hidden class="anchor" aria-hidden="true" href="#æ·»åŠ åˆ é™¤copy">#</a></h3>
<p>åˆ é™¤ï¼šè¿ç»­å®¹å™¨çš„å…ƒç´ åˆ é™¤æ— è®ºåœ¨ä»»ä½•è¯­è¨€ä¸­ï¼Œéƒ½è¦å°†åˆ é™¤ç‚¹å‰åçš„å…ƒç´ ç§»åŠ¨åˆ°æ–°çš„ä½ç½®ï¼Œéšç€å…ƒç´ çš„å¢åŠ ï¼Œè¿™ä¸ªè¿‡ç¨‹å°†ä¼šå˜å¾—æä¸ºè€—æ—¶ï¼Œå› æ­¤ï¼Œå½“ä¸šåŠ¡éœ€è¦å¤§é‡ã€é¢‘ç¹åœ°ä»ä¸€ä¸ªåˆ‡ç‰‡ä¸­åˆ é™¤å…ƒç´ æ—¶ï¼Œå¦‚æœå¯¹æ€§èƒ½è¦æ±‚è¾ƒé«˜çš„è¯ï¼Œå°±éœ€è¦è€ƒè™‘æ›´æ¢å…¶ä»–çš„å®¹å™¨äº†ï¼ˆå¦‚åŒé“¾è¡¨ç­‰èƒ½å¿«é€Ÿä»åˆ é™¤ç‚¹åˆ é™¤å…ƒç´ ï¼‰ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>	<span style="color:#78787e">//	add
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>	<span style="color:#ff5c57">var</span> slice1 = []<span style="color:#9aedfe">int</span>{<span style="color:#ff9f43">1</span>, <span style="color:#ff9f43">2</span>, <span style="color:#ff9f43">3</span>, <span style="color:#ff9f43">4</span>, <span style="color:#ff9f43">5</span>}
</span></span><span style="display:flex;"><span>	fmt.<span style="color:#57c7ff">Println</span>(<span style="color:#5af78e">&#34;before add&#34;</span>, slice1)
</span></span><span style="display:flex;"><span>	slice1 = <span style="color:#ff5c57">append</span>(slice1, <span style="color:#ff9f43">6</span>)
</span></span><span style="display:flex;"><span>	slice1 = <span style="color:#ff5c57">append</span>(slice1, <span style="color:#ff9f43">6</span>)
</span></span><span style="display:flex;"><span>	slice1 = <span style="color:#ff5c57">append</span>(slice1, <span style="color:#ff9f43">6</span>)
</span></span><span style="display:flex;"><span>	fmt.<span style="color:#57c7ff">Println</span>(<span style="color:#5af78e">&#34;after add&#34;</span>, slice1)
</span></span><span style="display:flex;"><span>	<span style="color:#78787e">//before add [1 2 3 4 5]
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>	<span style="color:#78787e">//after add [1 2 3 4 5 6 6 6]
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>
</span></span><span style="display:flex;"><span>	<span style="color:#78787e">//	delete
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>	fmt.<span style="color:#57c7ff">Println</span>(<span style="color:#5af78e">&#34;before delete&#34;</span>, slice1)
</span></span><span style="display:flex;"><span>	<span style="color:#78787e">//  å‡è®¾æƒ³åˆ é™¤ ä¸‹æ ‡ä¸º 4 çš„å…ƒç´ 
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>	slice1 = <span style="color:#ff5c57">append</span>(slice1[:<span style="color:#ff9f43">4</span>], slice1[<span style="color:#ff9f43">5</span>:]<span style="color:#ff6ac1">...</span>)  <span style="color:#78787e">//&lt;=======
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>	fmt.<span style="color:#57c7ff">Println</span>(<span style="color:#5af78e">&#34;after delete&#34;</span>, slice1)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#78787e">//	copy
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>	<span style="color:#ff5c57">var</span> slice3 = []<span style="color:#9aedfe">int</span>{<span style="color:#ff9f43">1</span>, <span style="color:#ff9f43">2</span>, <span style="color:#ff9f43">3</span>, <span style="color:#ff9f43">4</span>, <span style="color:#ff9f43">5</span>}
</span></span><span style="display:flex;"><span>	<span style="color:#ff5c57">var</span> slice4 []<span style="color:#9aedfe">int</span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff5c57">copy</span>(slice4, slice3)
</span></span><span style="display:flex;"><span>	fmt.<span style="color:#57c7ff">Println</span>(<span style="color:#5af78e">&#34;slice4&#34;</span>, slice1)
</span></span></code></pre></div><h2 id="map">map<a hidden class="anchor" aria-hidden="true" href="#map">#</a></h2>
<p>mapæ˜¯ä¸€ç§key:valueé”®å€¼å¯¹çš„æ•°æ®ç»“æ„å®¹å™¨ã€‚mapå†…éƒ¨å®ç°æ˜¯å“ˆå¸Œè¡¨(hash)ã€‚
mapæœ€é‡è¦çš„ä¸€ç‚¹æ˜¯é€šè¿‡keyæ¥å¿«é€Ÿæ£€ç´¢æ•°æ®ï¼Œkeyç±»ä¼¼äºç´¢å¼•ï¼ŒæŒ‡å‘æ•°æ®çš„å€¼ã€‚
mapæ˜¯å¼•ç”¨ç±»å‹çš„ã€‚</p>
<h3 id="åˆå§‹åŒ–">åˆå§‹åŒ–<a hidden class="anchor" aria-hidden="true" href="#åˆå§‹åŒ–">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#ff5c57">func</span> <span style="color:#57c7ff">MapInit</span>() {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	map1 <span style="color:#ff6ac1">:=</span> <span style="color:#ff5c57">map</span>[<span style="color:#9aedfe">string</span>]<span style="color:#9aedfe">string</span>{
</span></span><span style="display:flex;"><span>		<span style="color:#5af78e">&#34;name&#34;</span>:   <span style="color:#5af78e">&#34;Tom&#34;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#5af78e">&#34;age&#34;</span>:    <span style="color:#5af78e">&#34;12&#34;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#5af78e">&#34;gender&#34;</span>: <span style="color:#5af78e">&#34;male&#34;</span>,
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	fmt.<span style="color:#57c7ff">Println</span>(map1)
</span></span><span style="display:flex;"><span>	<span style="color:#78787e">//map[age:12 gender:male name:Tom]
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>
</span></span><span style="display:flex;"><span>	map2 <span style="color:#ff6ac1">:=</span> <span style="color:#ff5c57">make</span>(<span style="color:#ff5c57">map</span>[<span style="color:#9aedfe">string</span>]<span style="color:#9aedfe">string</span>, <span style="color:#ff9f43">5</span>)
</span></span><span style="display:flex;"><span>	map2[<span style="color:#5af78e">&#34;name&#34;</span>] = <span style="color:#5af78e">&#34;Amy&#34;</span>
</span></span><span style="display:flex;"><span>	map2[<span style="color:#5af78e">&#34;age&#34;</span>] = <span style="color:#5af78e">&#34;13&#34;</span>
</span></span><span style="display:flex;"><span>	map2[<span style="color:#5af78e">&#34;gender&#34;</span>] = <span style="color:#5af78e">&#34;female&#34;</span>
</span></span><span style="display:flex;"><span>	fmt.<span style="color:#57c7ff">Println</span>(map2)
</span></span><span style="display:flex;"><span>	<span style="color:#78787e">//map[age:13 gender:female name:Amy]
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>}
</span></span></code></pre></div><h3 id="å–å€¼éå†">å–å€¼ã€éå†<a hidden class="anchor" aria-hidden="true" href="#å–å€¼éå†">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>	<span style="color:#78787e">//	é€šè¿‡ key å–å€¼
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>	key <span style="color:#ff6ac1">:=</span> <span style="color:#5af78e">&#34;name&#34;</span>
</span></span><span style="display:flex;"><span>	value <span style="color:#ff6ac1">:=</span> map2[key]
</span></span><span style="display:flex;"><span>	fmt.<span style="color:#57c7ff">Println</span>(<span style="color:#5af78e">&#34;key = name , value = &#34;</span>, value)
</span></span><span style="display:flex;"><span>	<span style="color:#78787e">//key = name , value =  Amy
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>
</span></span><span style="display:flex;"><span>	<span style="color:#78787e">//	åˆ¤æ–­ä¸€ä¸ªmapæ˜¯å¦å«æœ‰æŸä¸ª key å€¼
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>	value1, ok <span style="color:#ff6ac1">:=</span> map2[key]
</span></span><span style="display:flex;"><span>	fmt.<span style="color:#57c7ff">Printf</span>(<span style="color:#5af78e">&#34;key = name , isExist = %t , value = %v\n&#34;</span>, ok, value1)
</span></span><span style="display:flex;"><span>	<span style="color:#78787e">//key = name , isExist = true , value = Amy
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>
</span></span><span style="display:flex;"><span>	<span style="color:#78787e">//	éå†
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>	<span style="color:#ff6ac1">for</span> k, v <span style="color:#ff6ac1">:=</span> <span style="color:#ff6ac1">range</span> map2 {
</span></span><span style="display:flex;"><span>		fmt.<span style="color:#57c7ff">Printf</span>(<span style="color:#5af78e">&#34;%v:%v\n&#34;</span>, k, v)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#78787e">//name:Amy
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>	<span style="color:#78787e">//age:13
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>	<span style="color:#78787e">//gender:female
</span></span></span></code></pre></div><h2 id="function">function<a hidden class="anchor" aria-hidden="true" href="#function">#</a></h2>
<p>goè¯­è¨€ä¸­å‡½æ•°ç‰¹æ€§</p>
<p>1.goè¯­è¨€ä¸­æœ‰3ç§å‡½æ•°ï¼šæ™®é€šå‡½æ•°ã€åŒ¿åå‡½æ•°ï¼ˆæ²¡æœ‰åç§°çš„å‡½æ•°ï¼‰ã€æ–¹æ³•ï¼ˆå®šä¹‰åœ¨structä¸Šçš„å‡½æ•°ï¼‰ã€‚</p>
<p>2.goè¯­è¨€ä¸­ä¸å…è®¸å‡½æ•°é‡è½½(overload),ä¹Ÿå°±æ˜¯è¯´ä¸å…è®¸å‡½æ•°åŒåã€‚</p>
<p>3.goè¯­è¨€ä¸­çš„å‡½æ•°ä¸èƒ½åµŒå¥—å‡½æ•°ï¼Œä½†å¯ä»¥åµŒå¥—åŒ¿åå‡½æ•°ã€‚</p>
<p>4.å‡½æ•°æ˜¯ä¸€ä¸ªå€¼ï¼Œå¯ä»¥å°†å‡½æ•°èµ‹å€¼ç»™å˜é‡ï¼Œä½¿å¾—è¿™ä¸ªå˜é‡ä¹Ÿæˆä¸ºå‡½æ•°ã€‚</p>
<p>5.å‡½æ•°å¯ä»¥ä½œä¸ºå‚æ•°ä¼ é€’ç»™å¦ä¸€ä¸ªå‡½æ•°ã€‚</p>
<p>6.å‡½æ•°çš„è¿”å›å€¼å¯ä»¥æ˜¯ä¸€ä¸ªå‡½æ•°ã€‚</p>
<p>7.å‡½æ•°è°ƒç”¨çš„æ—¶å€™ï¼Œå¦‚æœæœ‰å‚æ•°ä¼ é€’ç»™å‡½æ•°ï¼Œåˆ™å…ˆæ‹·è´å‚æ•°çš„å‰¯æœ¬ï¼Œå†å°†å‰¯æœ¬ä¼ é€’ç»™å‡½æ•°ã€‚</p>
<p>8.å‡½æ•°å‚æ•°å¯ä»¥æ²¡æœ‰åç§°ã€‚</p>
<h3 id="è¿”å›å€¼">è¿”å›å€¼<a hidden class="anchor" aria-hidden="true" href="#è¿”å›å€¼">#</a></h3>
<p>1,returnå…³é”®å­—ä¸­æŒ‡å®šäº†å‚æ•°æ—¶ï¼Œè¿”å›å€¼å¯ä»¥ä¸ç”¨åç§°ã€‚å¦‚æœreturnçœç•¥å‚æ•°ï¼Œåˆ™è¿”å›å€¼éƒ¨åˆ†å¿…é¡»å¸¦åç§°</p>
<p>2.å½“è¿”å›å€¼æœ‰åç§°æ—¶ï¼Œå¿…é¡»ä½¿ç”¨æ‹¬å·åŒ…å›´ï¼Œé€—å·åˆ†éš”ï¼Œå³ä½¿åªæœ‰ä¸€ä¸ªè¿”å›å€¼</p>
<p>3.ä½†å³ä½¿è¿”å›å€¼å‘½åäº†ï¼Œreturnä¸­ä¹Ÿå¯ä»¥å¼ºåˆ¶æŒ‡å®šå…¶å®ƒè¿”å›å€¼çš„åç§°ï¼Œä¹Ÿå°±æ˜¯è¯´returnçš„ä¼˜å…ˆçº§æ›´é«˜</p>
<p>4.å‘½åçš„è¿”å›å€¼æ˜¯é¢„å…ˆå£°æ˜å¥½çš„ï¼Œåœ¨å‡½æ•°å†…éƒ¨å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œæ— éœ€å†æ¬¡å£°æ˜ã€‚å‘½åè¿”å›å€¼çš„åç§°ä¸èƒ½å’Œå‡½æ•°å‚
æ•°åç§°ç›¸åŒï¼Œå¦åˆ™æŠ¥é”™æç¤ºå˜é‡é‡å¤å®šä¹‰</p>
<p>5.returnä¸­å¯ä»¥æœ‰è¡¨è¾¾å¼ï¼Œä½†ä¸èƒ½å‡ºç°èµ‹å€¼è¡¨è¾¾å¼ï¼Œè¿™å’Œå…¶å®ƒè¯­è¨€å¯èƒ½æœ‰æ‰€ä¸åŒã€‚ä¾‹å¦‚return a+bæ˜¯æ­£ç¡®
çš„ï¼Œä½†return c=a+bæ˜¯é”™è¯¯çš„ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#ff5c57">func</span> <span style="color:#57c7ff">Function</span>() {
</span></span><span style="display:flex;"><span>	name, age <span style="color:#ff6ac1">:=</span> <span style="color:#57c7ff">fun1</span>()
</span></span><span style="display:flex;"><span>	fmt.<span style="color:#57c7ff">Printf</span>(<span style="color:#5af78e">&#34;name:%v,age:%v\n&#34;</span>, name, age)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">func</span> <span style="color:#57c7ff">fun1</span>() (name <span style="color:#9aedfe">string</span>, age <span style="color:#9aedfe">int</span>) {
</span></span><span style="display:flex;"><span>	name = <span style="color:#5af78e">&#34;Amy&#34;</span>
</span></span><span style="display:flex;"><span>	age = <span style="color:#ff9f43">19</span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">return</span>
</span></span><span style="display:flex;"><span>	<span style="color:#78787e">//	ç­‰ä»·äº ==&gt; return name, age
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>}
</span></span></code></pre></div><h3 id="å‚æ•°">å‚æ•°<a hidden class="anchor" aria-hidden="true" href="#å‚æ•°">#</a></h3>
<h4 id="å€¼ä¼ é€’">å€¼ä¼ é€’<a hidden class="anchor" aria-hidden="true" href="#å€¼ä¼ é€’">#</a></h4>
<p>ã€å› ä¸ºä¼šåˆ›å»ºå‡½æ•°å‰¯æœ¬ã€‘</p>
<blockquote>
<p><strong>æ³¨æ„</strong> ï¼šmapã€sliceã€interfaceã€channelè¿™äº›æ•°æ®ç±»å‹æœ¬èº«å°±æ˜¯æŒ‡é’ˆç±»å‹çš„ï¼Œæ‰€ä»¥å°±ç®—æ˜¯æ‹·è´ä¼ å€¼ä¹Ÿæ˜¯æ‹·è´çš„æŒ‡é’ˆï¼Œæ‹·è´åçš„å‚æ•°ä»ç„¶æŒ‡å‘åº•å±‚æ•°æ®ç»“æ„ï¼Œæ‰€ä»¥ä¿®æ”¹å®ƒä»¬å¯èƒ½ä¼šå½±å“å¤–éƒ¨æ•°æ®ç»“æ„çš„å€¼ã€‚</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#ff5c57">func</span> <span style="color:#57c7ff">Function</span>() {
</span></span><span style="display:flex;"><span>	a <span style="color:#ff6ac1">:=</span> []<span style="color:#9aedfe">int</span>{<span style="color:#ff9f43">1</span>, <span style="color:#ff9f43">2</span>}
</span></span><span style="display:flex;"><span>	<span style="color:#57c7ff">fun2</span>(a)
</span></span><span style="display:flex;"><span>	fmt.<span style="color:#57c7ff">Println</span>(a[<span style="color:#ff9f43">0</span>])
</span></span><span style="display:flex;"><span>    <span style="color:#78787e">// 100
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">func</span> <span style="color:#57c7ff">fun2</span>(a []<span style="color:#9aedfe">int</span>) {
</span></span><span style="display:flex;"><span>	a[<span style="color:#ff9f43">0</span>] = <span style="color:#ff9f43">100</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h4 id="å˜é•¿å‚æ•°">å˜é•¿å‚æ•°<a hidden class="anchor" aria-hidden="true" href="#å˜é•¿å‚æ•°">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#ff5c57">func</span> <span style="color:#57c7ff">Function</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#57c7ff">fun3</span>(<span style="color:#5af78e">&#34;Amy&#34;</span>, <span style="color:#5af78e">&#34;Beijing&#34;</span>, <span style="color:#5af78e">&#34;23&#34;</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">func</span> <span style="color:#57c7ff">fun3</span>(args <span style="color:#ff6ac1">...</span><span style="color:#9aedfe">string</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">for</span> i, arg <span style="color:#ff6ac1">:=</span> <span style="color:#ff6ac1">range</span> args {
</span></span><span style="display:flex;"><span>		fmt.<span style="color:#57c7ff">Printf</span>(<span style="color:#5af78e">&#34;%v:%v\n&#34;</span>, i, arg)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff9f43">0</span>:Amy
</span></span><span style="display:flex;"><span><span style="color:#ff9f43">1</span>:Beijing
</span></span><span style="display:flex;"><span><span style="color:#ff9f43">2</span>:<span style="color:#ff9f43">23</span>
</span></span></code></pre></div><h3 id="é«˜é˜¶å‡½æ•°">é«˜é˜¶å‡½æ•°<a hidden class="anchor" aria-hidden="true" href="#é«˜é˜¶å‡½æ•°">#</a></h3>
<p>å‡½æ•°å¯ä»¥ä½œä¸ºä¸€ä¸ªå‡½æ•°çš„å‚æ•°ã€è¿”å›å€¼ã€‚</p>
<h3 id="åŒ¿åå‡½æ•°">åŒ¿åå‡½æ•°<a hidden class="anchor" aria-hidden="true" href="#åŒ¿åå‡½æ•°">#</a></h3>
<h3 id="é—­åŒ…">é—­åŒ…<a hidden class="anchor" aria-hidden="true" href="#é—­åŒ…">#</a></h3>
<p>é—­åŒ…å¯ä»¥ç†è§£æˆå®šä¹‰åœ¨ä¸€ä¸ªå‡½æ•°å†…éƒ¨çš„å‡½æ•°ã€‚åœ¨æœ¬è´¨ä¸Šï¼Œé—­åŒ…æ˜¯å°†å‡½æ•°å†…éƒ¨å’Œå‡½æ•°å¤–éƒ¨è¿æ¥èµ·æ¥çš„æ¡¥æ¢ã€‚æˆ–è€…è¯´æ˜¯å‡½æ•°å’Œå…¶å¼•ç”¨ç¯å¢ƒçš„ç»„åˆä½“ã€‚
é—­åŒ…æŒ‡çš„æ˜¯ä¸€ä¸ªå‡½æ•°å’Œä¸å…¶ç›¸å…³çš„å¼•ç”¨ç¯å¢ƒç»„åˆè€Œæˆçš„å®ä½“ã€‚ç®€å•æ¥è¯´ï¼Œ==é—­åŒ…=å‡½æ•°+å¼•ç”¨ç¯å¢ƒ==ã€‚</p>
<p>å˜é‡fæ˜¯ä¸€ä¸ªå‡½æ•°å¹¶ä¸”å®ƒå¼•ç”¨äº†å…¶å¤–éƒ¨ä½œç”¨åŸŸä¸­çš„xå˜é‡ï¼Œæ­¤æ—¶få°±æ˜¯ä¸€ä¸ªé—­åŒ…ã€‚åœ¨fçš„ç”Ÿå‘½å‘¨æœŸå†…ï¼Œå˜é‡xä¹Ÿä¸€ç›´æœ‰æ•ˆã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#ff5c57">func</span> <span style="color:#57c7ff">Closure</span>() {
</span></span><span style="display:flex;"><span>	f <span style="color:#ff6ac1">:=</span> <span style="color:#57c7ff">add</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#ff5c57">println</span>(<span style="color:#57c7ff">f</span>(<span style="color:#ff9f43">10</span>))
</span></span><span style="display:flex;"><span>	<span style="color:#ff5c57">println</span>(<span style="color:#57c7ff">f</span>(<span style="color:#ff9f43">20</span>))
</span></span><span style="display:flex;"><span>	<span style="color:#ff5c57">println</span>(<span style="color:#57c7ff">f</span>(<span style="color:#ff9f43">30</span>))
</span></span><span style="display:flex;"><span>	<span style="color:#78787e">//  10
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>	<span style="color:#78787e">//  30
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>	<span style="color:#78787e">//  60
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>	<span style="color:#78787e">//	å˜é‡é€ƒé€¸ï¼Œä»æ ˆå»åˆ°å †
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">func</span> <span style="color:#57c7ff">add</span>() <span style="color:#ff5c57">func</span>(<span style="color:#9aedfe">int</span>) <span style="color:#9aedfe">int</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#ff5c57">var</span> x <span style="color:#9aedfe">int</span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">return</span> <span style="color:#ff5c57">func</span>(y <span style="color:#9aedfe">int</span>) <span style="color:#9aedfe">int</span> {
</span></span><span style="display:flex;"><span>		x <span style="color:#ff6ac1">+=</span> y
</span></span><span style="display:flex;"><span>		<span style="color:#ff6ac1">return</span> x
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="é€’å½’">é€’å½’<a hidden class="anchor" aria-hidden="true" href="#é€’å½’">#</a></h2>
<p>å‡½æ•°å†…éƒ¨è°ƒç”¨å‡½æ•°è‡ªèº«çš„å‡½æ•°ç§°ä¸ºé€’å½’å‡½æ•°ã€‚
ä½¿ç”¨é€’å½’å‡½æ•°æœ€é‡è¦çš„ä¸‰ç‚¹ï¼š</p>
<p>1.é€’å½’å°±æ˜¯è‡ªå·±è°ƒç”¨è‡ªå·±ã€‚
2.å¿…é¡»å…ˆå®šä¹‰å‡½æ•°çš„<strong>é€€å‡ºæ¡ä»¶</strong>ï¼Œæ²¡æœ‰é€€å‡ºæ¡ä»¶ï¼Œé€’å½’å°†æˆä¸ºæ­»å¾ªç¯ã€‚
3.goè¯­è¨€é€’å½’å‡½æ•°å¾ˆå¯èƒ½ä¼šäº§ç”Ÿä¸€å¤§å †çš„goroutine,ä¹Ÿå¾ˆå¯èƒ½ä¼šå‡ºç°æ ˆç©ºé—´å†…å­˜è°¥å‡ºé—®é¢˜ã€‚</p>
<h2 id="defer">defer<a hidden class="anchor" aria-hidden="true" href="#defer">#</a></h2>
<p>goè¯­è¨€ä¸­çš„deferè¯­å¥ä¼šå°†å…¶åé¢è·Ÿéšçš„è¯­å¥è¿›è¡Œå»¶è¿Ÿå¤„ç†ã€‚</p>
<p>åœ¨deferå½’å±çš„å‡½æ•°å³å°†è¿”å›æ—¶ï¼Œå°†å»¶è¿Ÿå¤„ç†çš„è¯­å¥æŒ‰deferå®šä¹‰çš„é€†åºè¿›è¡Œæ‰§è¡Œï¼Œ</p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå…ˆè¢«deferçš„è¯­å¥æœ€åè¢«æ‰§è¡Œï¼Œæœ€åè¢«deferçš„è¯­å¥ï¼Œæœ€å…ˆè¢«æ‰§è¡Œã€‚</p>
<p>defer&rsquo;ç‰¹æ€§</p>
<p>1.å…³é”®å­—deferç”¨äºæ³¨å†Œå»¶è¿Ÿè°ƒç”¨ã€‚
2.è¿™äº›è°ƒç”¨ç›´åˆ°returnå‰æ‰è¢«æ‰§ã€‚å› æ­¤ï¼Œå¯ä»¥ç”¨æ¥åšèµ„æºæ¸…ç†ã€‚
3.å¤šä¸ªdeferè¯­å¥ï¼ŒæŒ‰å…ˆè¿›åå‡ºçš„æ–¹å¼æ‰§è¡Œã€‚
4.deferè¯­å¥ä¸­çš„å˜é‡ï¼Œåœ¨deferå£°æ˜æ—¶å°±å†³å®šäº†ã€‚</p>
<p>deferç”¨é€”
1.å…³é—­æ–‡ä»¶å¥æŸ„
2.é”èµ„æºé‡Šæ”¾
3.æ•°æ®åº“è¿æ¥é‡Šæ”¾</p>
<h2 id="initå‡½æ•°">initå‡½æ•°<a hidden class="anchor" aria-hidden="true" href="#initå‡½æ•°">#</a></h2>
<p>golangæœ‰ä¸€ä¸ªç‰¹æ®Šçš„å‡½æ•°initå‡½æ•°ï¼Œå…ˆäºmainå‡½æ•°æ‰§è¡Œï¼Œå®ç°åŒ…çº§åˆ«çš„ä¸€äº›åˆå§‹åŒ–æ“ä½œã€‚</p>
<h3 id="initå‡½æ•°çš„ä¸»è¦ç‰¹ç‚¹">initå‡½æ•°çš„ä¸»è¦ç‰¹ç‚¹<a hidden class="anchor" aria-hidden="true" href="#initå‡½æ•°çš„ä¸»è¦ç‰¹ç‚¹">#</a></h3>
<ul>
<li>Â·initå‡½æ•°å…ˆäºmainå‡½æ•°==è‡ªåŠ¨æ‰§è¡Œ==ï¼Œä¸èƒ½è¢«å…¶ä»–å‡½æ•°è°ƒç”¨ï¼š</li>
<li>Â·initå‡½æ•°<strong>æ²¡æœ‰è¾“å…¥å‚æ•°ã€è¿”å›å€¼</strong>ï¼š</li>
<li>Â·æ¯ä¸ªåŒ…å¯ä»¥æœ‰å¤šä¸ªinitå‡½æ•°ï¼š</li>
<li>Â·åŒ…çš„æ¯ä¸ªæºæ–‡ä»¶ä¹Ÿå¯ä»¥æœ‰å¤šä¸ªinitå‡½æ•°ï¼Œè¿™ç‚¹æ¯”è¾ƒç‰¹æ®Šï¼š</li>
<li>Â·åŒä¸€ä¸ªåŒ…çš„initæ‰§è¡Œé¡ºåºï¼Œgolangæ²¡æœ‰æ˜ç¡®å®šä¹‰ï¼Œç¼–ç¨‹æ—¶è¦æ³¨æ„ç¨‹åºä¸è¦ä¾èµ–è¿™ä¸ªæ‰§è¡Œé¡ºåºã€‚</li>
<li>Â·ä¸åŒåŒ…çš„itå‡½æ•°æŒ‰ç…§åŒ…ï¼Œå¯¼å…¥çš„ä¾èµ–å…³ç³»å†³å®šæ‰§è¡Œé¡ºåºã€‚</li>
</ul>
<h3 id="golangåˆå§‹åŒ–é¡ºåº">golangåˆå§‹åŒ–é¡ºåº<a hidden class="anchor" aria-hidden="true" href="#golangåˆå§‹åŒ–é¡ºåº">#</a></h3>
<p>åˆå§‹åŒ–é¡ºåºï¼šå˜é‡åˆå§‹åŒ–-&gt;init()-&gt;main()</p>
<h2 id="æŒ‡é’ˆ">æŒ‡é’ˆ<a hidden class="anchor" aria-hidden="true" href="#æŒ‡é’ˆ">#</a></h2>
<p>G0è¯­è¨€ä¸­çš„å‡½æ•°ä¼ å‚éƒ½æ˜¯å€¼æ‹·è´ï¼Œå½“æˆ‘ä»¬æƒ³è¦ä¿®æ”¹æŸä¸ªå˜é‡çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªæŒ‡å‘è¯¥å˜é‡åœ°å€çš„æŒ‡é’ˆå˜
é‡ã€‚ä¼ é€’æ•°æ®ä½¿ç”¨æŒ‡é’ˆï¼Œè€Œæ— é¡»æ‹·è´æ•°æ®ã€‚</p>
<p>ç±»å‹æŒ‡é’ˆä¸èƒ½è¿›è¡Œåç§»å’Œè¿ç®—ã€‚</p>
<p>G0è¯­è¨€ä¸­çš„æŒ‡é’ˆæ“ä½œéå¸¸ç®€å•ï¼Œåªéœ€è¦è®°ä½ä¸¤ä¸ªç¬¦å·ï¼š<code>&amp;</code>ï¼ˆå–åœ°å€ï¼‰å’Œ  <code>*</code>ï¼ˆæ ¹æ®åœ°å€å–å€¼ï¼‰ã€‚</p>
<h3 id="æŒ‡é’ˆåœ°å€å’ŒæŒ‡é’ˆç±»å‹">æŒ‡é’ˆåœ°å€å’ŒæŒ‡é’ˆç±»å‹<a hidden class="anchor" aria-hidden="true" href="#æŒ‡é’ˆåœ°å€å’ŒæŒ‡é’ˆç±»å‹">#</a></h3>
<p>æ¯ä¸ªå˜é‡åœ¨è¿è¡Œæ—¶éƒ½æ‹¥æœ‰ä¸€ä¸ªåœ°å€ï¼Œè¿™ä¸ªåœ°å€ä»£è¡¨å˜é‡åœ¨å†…å­˜ä¸­çš„ä½ç½®ã€‚</p>
<p>Goè¯­è¨€ä¸­ä½¿ç”¨<code>&amp;</code>å­—ç¬¦æ”¾åœ¨å˜é‡å‰é¢å¯¹å˜é‡è¿›è¡Œå–åœ°å€æ“ä½œã€‚</p>
<p>Goè¯­è¨€ä¸­çš„å€¼ç±»å‹(intã€floatã€boolã€stringã€arrayã€struct)éƒ½æœ‰å¯¹åº”çš„æŒ‡é’ˆç±»å‹ï¼Œå¦‚ï¼š<code>*intã€*int64ã€*string</code>ç­‰ã€‚</p>
<h3 id="æŒ‡é’ˆè¯­æ³•">æŒ‡é’ˆè¯­æ³•<a hidden class="anchor" aria-hidden="true" href="#æŒ‡é’ˆè¯­æ³•">#</a></h3>
<p>ä¸€ä¸ªæŒ‡é’ˆå˜é‡æŒ‡å‘äº†ä¸€ä¸ªå€¼çš„å†…å­˜åœ°å€ã€‚</p>
<p>(ä¹Ÿå°±æ˜¯æˆ‘ä»¬å£°æ˜äº†ä¸€ä¸ªæŒ‡é’ˆä¹‹åï¼Œå¯ä»¥åƒå˜é‡èµ‹å€¼ä¸€æ ·ï¼ŒæŠŠä¸€ä¸ªå€¼çš„å†…å­˜åœ°å€æ”¾å…¥åˆ°æŒ‡é’ˆå½“ä¸­ã€‚)</p>
<p>ç±»ä¼¼äºå˜é‡å’Œå¸¸é‡ï¼Œåœ¨ä½¿ç”¨æŒ‡é’ˆå‰ä½ éœ€è¦å£°æ˜æŒ‡é’ˆã€‚æŒ‡é’ˆå£°æ˜æ ¼å¼å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#ff5c57">var</span> var_name <span style="color:#ff6ac1">*</span><span style="color:#ff5c57">var</span><span style="color:#ff6ac1">-</span><span style="color:#ff5c57">type</span>
</span></span></code></pre></div><ul>
<li>var-type: ä¸ºæŒ‡é’ˆç±»å‹</li>
<li>var-name: ä¸ºæŒ‡é’ˆå˜é‡å</li>
<li><code>*</code>ï¼šç”¨äºæŒ‡å®šå˜é‡æ˜¯ä½œä¸ºä¸€ä¸ªæŒ‡é’ˆ</li>
</ul>
<h2 id="æŒ‡é’ˆæ•°ç»„">æŒ‡é’ˆæ•°ç»„<a hidden class="anchor" aria-hidden="true" href="#æŒ‡é’ˆæ•°ç»„">#</a></h2>
<p>è¡¨ç¤ºæ•°ç»„é‡Œé¢çš„å…ƒç´ çš„ç±»å‹æ˜¯æŒ‡é’ˆç±»å‹</p>
<p>å®šä¹‰è¯­æ³•</p>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#ff5c57">var</span> ptr [MAX]<span style="color:#ff6ac1">*</span><span style="color:#9aedfe">int</span>;
</span></span></code></pre></div><p>ä¾‹å­</p>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#ff5c57">func</span> <span style="color:#57c7ff">Pointer</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#ff5c57">var</span> arr = [<span style="color:#ff9f43">3</span>]<span style="color:#9aedfe">int</span>{<span style="color:#ff9f43">1</span>, <span style="color:#ff9f43">2</span>, <span style="color:#ff9f43">3</span>}
</span></span><span style="display:flex;"><span>	<span style="color:#ff5c57">var</span> pArr [<span style="color:#ff9f43">3</span>]<span style="color:#ff6ac1">*</span><span style="color:#9aedfe">int</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">for</span> i <span style="color:#ff6ac1">:=</span> <span style="color:#ff9f43">0</span>; i &lt; <span style="color:#ff5c57">len</span>(arr); i<span style="color:#ff6ac1">++</span> {
</span></span><span style="display:flex;"><span>		pArr[i] = <span style="color:#ff6ac1">&amp;</span>arr[i]
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">for</span> i <span style="color:#ff6ac1">:=</span> <span style="color:#ff9f43">0</span>; i &lt; <span style="color:#ff5c57">len</span>(arr); i<span style="color:#ff6ac1">++</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#ff5c57">println</span>(pArr[i])
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#78787e">//0xc000143f38
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>	<span style="color:#78787e">//0xc000143f40
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>	<span style="color:#78787e">//0xc000143f48
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>}
</span></span></code></pre></div><h2 id="ç±»å‹å®šä¹‰å’Œç±»å‹åˆ«å">ç±»å‹å®šä¹‰å’Œç±»å‹åˆ«å<a hidden class="anchor" aria-hidden="true" href="#ç±»å‹å®šä¹‰å’Œç±»å‹åˆ«å">#</a></h2>
<p>åœ¨ä»‹ç»ç»“æ„ä½“ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ä»€ä¹ˆæ˜¯ç±»å‹å®šä¹‰å’Œç±»å‹åˆ«åã€‚</p>
<h3 id="goè¯­è¨€ç±»å‹å®šä¹‰">goè¯­è¨€ç±»å‹å®šä¹‰<a hidden class="anchor" aria-hidden="true" href="#goè¯­è¨€ç±»å‹å®šä¹‰">#</a></h3>
<p>ç±»å‹å®šä¹‰çš„è¯­æ³•</p>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>type NewType Type
</span></span></code></pre></div><p>å®ä¾‹</p>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>	<span style="color:#78787e">//ç±»å‹å®šä¹‰
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>	<span style="color:#ff5c57">type</span> MyInt <span style="color:#9aedfe">int</span>
</span></span><span style="display:flex;"><span>	<span style="color:#78787e">//iä¸ºMyIntç±»å‹
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>	<span style="color:#ff5c57">var</span> i MyInt
</span></span><span style="display:flex;"><span>	i = <span style="color:#ff9f43">100</span>
</span></span><span style="display:flex;"><span>	fmt.<span style="color:#57c7ff">Printf</span>(<span style="color:#5af78e">&#34;i:%v i:%T\n&#34;</span>, i, i)
</span></span><span style="display:flex;"><span>	<span style="color:#78787e">//	i:100 i:Base.MyInt
</span></span></span></code></pre></div><h3 id="ç±»å‹åˆ«å">ç±»å‹åˆ«å<a hidden class="anchor" aria-hidden="true" href="#ç±»å‹åˆ«å">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>	<span style="color:#78787e">//ç±»å‹åˆ«å
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>	<span style="color:#ff5c57">type</span> MyInt1 = <span style="color:#9aedfe">int</span>
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#ff5c57">var</span> i1 MyInt1
</span></span><span style="display:flex;"><span>	i1 = <span style="color:#ff9f43">100</span>
</span></span><span style="display:flex;"><span>	fmt.<span style="color:#57c7ff">Printf</span>(<span style="color:#5af78e">&#34;i:%v i:%T\n&#34;</span>, i1, i1)
</span></span><span style="display:flex;"><span>	<span style="color:#78787e">//	i:100 i:int
</span></span></span></code></pre></div><h2 id="ç»“æ„ä½“">ç»“æ„ä½“<a hidden class="anchor" aria-hidden="true" href="#ç»“æ„ä½“">#</a></h2>
<p>goè¯­è¨€æ²¡æœ‰é¢å‘å¯¹è±¡çš„æ¦‚å¿µäº†ï¼Œä½†æ˜¯å¯ä»¥ä½¿ç”¨ç»“æ„ä½“æ¥å®ç°é¢å‘å¯¹è±¡ç¼–ç¨‹çš„ä¸€äº›ç‰¹æ€§ï¼Œä¾‹å¦‚ï¼šç»§æ‰¿ã€ç»„åˆç­‰ç‰¹
æ€§ã€‚</p>
<h3 id="ç»“æ„ä½“çš„å®šä¹‰">ç»“æ„ä½“çš„å®šä¹‰<a hidden class="anchor" aria-hidden="true" href="#ç»“æ„ä½“çš„å®šä¹‰">#</a></h3>
<p>ç»“æ„ä½“çš„å®šä¹‰å’Œç±»å‹å®šä¹‰ç±»ä¼¼ï¼Œåªä¸è¿‡å¤šäº†ä¸€ä¸ªstructå…³é”®å­—ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#ff5c57">type</span> Person <span style="color:#ff5c57">struct</span> {
</span></span><span style="display:flex;"><span>	id    <span style="color:#9aedfe">int</span>
</span></span><span style="display:flex;"><span>	name  <span style="color:#9aedfe">string</span>
</span></span><span style="display:flex;"><span>	age   <span style="color:#9aedfe">int</span>
</span></span><span style="display:flex;"><span>	email <span style="color:#9aedfe">string</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">func</span> <span style="color:#57c7ff">Struct</span>() {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#78787e">//  åˆå§‹åŒ–
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>	person1 <span style="color:#ff6ac1">:=</span> Person{
</span></span><span style="display:flex;"><span>		<span style="color:#ff9f43">2</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#5af78e">&#34;Amy&#34;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#ff9f43">23</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#5af78e">&#34;hello@qq.com&#34;</span>,
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	person2 <span style="color:#ff6ac1">:=</span> Person{
</span></span><span style="display:flex;"><span>		id:    <span style="color:#ff9f43">3</span>,
</span></span><span style="display:flex;"><span>		name:  <span style="color:#5af78e">&#34;Tom&#34;</span>,
</span></span><span style="display:flex;"><span>		age:   <span style="color:#ff9f43">20</span>,
</span></span><span style="display:flex;"><span>		email: <span style="color:#5af78e">&#34;world@qq.com&#34;</span>,
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	fmt.<span style="color:#57c7ff">Printf</span>(<span style="color:#5af78e">&#34;%#v\n&#34;</span>, person1)
</span></span><span style="display:flex;"><span>	fmt.<span style="color:#57c7ff">Printf</span>(<span style="color:#5af78e">&#34;%#v\n&#34;</span>, person2)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="ç»“æ„ä½“æŒ‡é’ˆ">ç»“æ„ä½“æŒ‡é’ˆ<a hidden class="anchor" aria-hidden="true" href="#ç»“æ„ä½“æŒ‡é’ˆ">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>	<span style="color:#ff5c57">var</span> p1Point <span style="color:#ff6ac1">*</span>Person
</span></span><span style="display:flex;"><span>	p1Point = <span style="color:#ff6ac1">&amp;</span>person1
</span></span><span style="display:flex;"><span>	fmt.<span style="color:#57c7ff">Printf</span>(<span style="color:#5af78e">&#34;%p\n&#34;</span>, p1Point)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#78787e">//  é€šè¿‡ new 
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>	<span style="color:#ff5c57">var</span> p2Point = <span style="color:#ff5c57">new</span>(Person)
</span></span><span style="display:flex;"><span>	fmt.<span style="color:#57c7ff">Printf</span>(<span style="color:#5af78e">&#34;%p\n&#34;</span>, p2Point)
</span></span></code></pre></div><h3 id="ç»“æ„ä½“ä½œä¸ºå‡½æ•°å‚æ•°">ç»“æ„ä½“ä½œä¸ºå‡½æ•°å‚æ•°<a hidden class="anchor" aria-hidden="true" href="#ç»“æ„ä½“ä½œä¸ºå‡½æ•°å‚æ•°">#</a></h3>
<p>goç»“æ„ä½“å¯ä»¥åƒæ™®é€šå˜é‡ä¸€æ ·ï¼Œä½œä¸ºå‡½æ•°çš„å‚æ•°ï¼Œä¼ é€’ç»™å‡½æ•°ï¼Œè¿™é‡Œåˆ†ä¸ºä¸¤ç§æƒ…å†µï¼š</p>
<ol>
<li>ç›´æ¥ä¼ é€’ç»“æ„ä½“ï¼Œè¿™æ˜¯æ˜¯ä¸€ä¸ªå‰¯æœ¬ï¼ˆæ‹·è´ï¼‰ï¼Œåœ¨å‡½æ•°å†…éƒ¨ä¸ä¼šæ”¹å˜å¤–é¢ç»“æ„ä½“å†…å®¹ã€‚</li>
<li>ä¼ é€’ç»“æ„ä½“æŒ‡é’ˆï¼Œè¿™æ—¶åœ¨å‡½æ•°å†…éƒ¨ï¼Œèƒ½å¤Ÿæ”¹å˜å¤–éƒ¨ç»“æ„ä½“å†…å®¹ã€‚</li>
</ol>
<h4 id="ç›´æ¥ä¼ é€’ç»“æ„ä½“">ç›´æ¥ä¼ é€’ç»“æ„ä½“<a hidden class="anchor" aria-hidden="true" href="#ç›´æ¥ä¼ é€’ç»“æ„ä½“">#</a></h4>
<p>è¿™æ˜¯å€¼ä¼ é€’ï¼Œå°†æ‹·è´ä¸€ä»½ï¼Œä¸ä¼šæ”¹å˜åŸæ¥çš„æ•°æ®</p>
<h4 id="ä¼ é€’ç»“æ„ä½“æŒ‡é’ˆ">ä¼ é€’ç»“æ„ä½“æŒ‡é’ˆ<a hidden class="anchor" aria-hidden="true" href="#ä¼ é€’ç»“æ„ä½“æŒ‡é’ˆ">#</a></h4>
<p>è¿™å°±ä¼šä¿®æ”¹åŸæ¥çš„æ•°æ®äº†</p>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#ff5c57">type</span> Person <span style="color:#ff5c57">struct</span> {
</span></span><span style="display:flex;"><span>	id    <span style="color:#9aedfe">int</span>
</span></span><span style="display:flex;"><span>	name  <span style="color:#9aedfe">string</span>
</span></span><span style="display:flex;"><span>	age   <span style="color:#9aedfe">int</span>
</span></span><span style="display:flex;"><span>	email <span style="color:#9aedfe">string</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">func</span> <span style="color:#57c7ff">Struct</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#78787e">//  åˆå§‹åŒ–
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>	person1 <span style="color:#ff6ac1">:=</span> Person{
</span></span><span style="display:flex;"><span>		<span style="color:#ff9f43">2</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#5af78e">&#34;Amy&#34;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#ff9f43">23</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#5af78e">&#34;hello@qq.com&#34;</span>,
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	fmt.<span style="color:#57c7ff">Printf</span>(<span style="color:#5af78e">&#34;%#v\n&#34;</span>, person1)
</span></span><span style="display:flex;"><span>	<span style="color:#57c7ff">showPerson</span>(<span style="color:#ff6ac1">&amp;</span>person1)
</span></span><span style="display:flex;"><span>	fmt.<span style="color:#57c7ff">Printf</span>(<span style="color:#5af78e">&#34;%#v\n&#34;</span>, person1)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#78787e">//Base.Person{id:2, name:&#34;Amy&#34;, age:23, email:&#34;hello@qq.com&#34;}
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>	<span style="color:#78787e">//Base.Person{id:2, name:&#34;Amy&#34;, age:1000, email:&#34;hello@qq.com&#34;}
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">func</span> <span style="color:#57c7ff">showPerson</span>(person <span style="color:#ff6ac1">*</span>Person) {
</span></span><span style="display:flex;"><span>	person.age = <span style="color:#ff9f43">1000</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="åµŒå¥—ç»“æ„ä½“">åµŒå¥—ç»“æ„ä½“<a hidden class="anchor" aria-hidden="true" href="#åµŒå¥—ç»“æ„ä½“">#</a></h3>
<p>goè¯­è¨€æ²¡æœ‰é¢å‘å¯¹è±¡ç¼–ç¨‹æ€æƒ³ï¼Œä¹Ÿæ²¡æœ‰ç»§æ‰¿å…³ç³»ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡ç»“æ„ä½“åµŒå¥—æ¥å®ç°è¿™ç§æ•ˆæœã€‚</p>
<p>ä¸‹é¢é€šè¿‡å®ä¾‹æ¼”ç¤ºå¦‚ä½•å®ç°ç»“æ„ä½“åµŒå¥—ï¼ŒåŠ å…¥æœ‰ä¸€ä¸ªäººPersonç»“æ„ä½“ï¼Œè¿™ä¸ªäººè¿˜å…»äº†ä¸€ä¸ªå® ç‰©Dogç»“æ„ä½“ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#ff5c57">type</span> Dog <span style="color:#ff5c57">struct</span> {
</span></span><span style="display:flex;"><span>	name  <span style="color:#9aedfe">string</span>
</span></span><span style="display:flex;"><span>	color <span style="color:#9aedfe">string</span>
</span></span><span style="display:flex;"><span>	age   <span style="color:#9aedfe">int</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">type</span> Person <span style="color:#ff5c57">struct</span> {
</span></span><span style="display:flex;"><span>	dog  Dog
</span></span><span style="display:flex;"><span>	name <span style="color:#9aedfe">string</span>
</span></span><span style="display:flex;"><span>	age  <span style="color:#9aedfe">int</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="æ–¹æ³•">æ–¹æ³•<a hidden class="anchor" aria-hidden="true" href="#æ–¹æ³•">#</a></h2>
<p>gpè¯­è¨€æ²¡æœ‰é¢å‘å¯¹è±¡çš„ç‰¹æ€§ï¼Œä¹Ÿæ²¡æœ‰ç±»å¯¹è±¡çš„æ¦‚å¿µã€‚</p>
<p>ä½†æ˜¯ï¼Œå¯ä»¥ä½¿ç”¨ç»“æ„ä½“æ¥æ¨¡æ‹Ÿè¿™äº›ç‰¹æ€§ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“é¢å‘å¯¹è±¡é‡Œé¢æœ‰ç±»æ–¹æ³•ç­‰æ¦‚å¿µã€‚</p>
<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥å£°æ˜ä¸€äº›æ–¹æ³•ï¼Œå±äºæŸä¸ªç»“æ„ä½“ã€‚</p>
<h3 id="æ–¹æ³•çš„è¯­æ³•">æ–¹æ³•çš„è¯­æ³•<a hidden class="anchor" aria-hidden="true" href="#æ–¹æ³•çš„è¯­æ³•">#</a></h3>
<p>Goä¸­çš„æ–¹æ³•ï¼Œæ˜¯ä¸€ç§ç‰¹æ®Šçš„å‡½æ•°ï¼Œå®šä¹‰äºstructä¹‹ä¸Šï¼ˆä¸structå…³è”ã€ç»‘å®šï¼‰ï¼Œè¢«ç§°ä¸ºstructçš„æ¥å—è€…(receiver))ã€‚</p>
<p>é€šä¿—çš„è®²ï¼Œæ–¹æ³•å°±æ˜¯æœ‰æ¥æ”¶è€…çš„å‡½æ•°ã€‚</p>
<p>ä¸€ä¸ªæ–¹æ³•å’Œä¸€ä¸ªå‡½æ•°éå¸¸ç›¸ä¼¼ï¼Œå¤šäº†ä¸€ä¸ªæ¥å—ç±»å‹ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ini" data-lang="ini"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#57c7ff">è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š</span>
</span></span><span style="display:flex;"><span><span style="color:#57c7ff">type mytype struct{}</span>
</span></span><span style="display:flex;"><span><span style="color:#57c7ff">func (recv mytype)my_method(para)return_type {}</span>
</span></span><span style="display:flex;"><span><span style="color:#57c7ff">func (recv *mytype)my_method(para)return_type {}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#57c7ff">mytype:å®šä¹‰ä¸€ä¸ªç»“æ„ä½“</span>
</span></span><span style="display:flex;"><span><span style="color:#57c7ff">recv:æ¥å—è¯¥æ–¹æ³•çš„ç»“æ„ä½“(receiver)</span>
</span></span><span style="display:flex;"><span><span style="color:#57c7ff">my-method:æ–¹æ³•åç§°</span>
</span></span><span style="display:flex;"><span><span style="color:#57c7ff">para:å‚æ•°åˆ—è¡¨</span>
</span></span><span style="display:flex;"><span><span style="color:#57c7ff">return-type:è¿”å›å€¼ç±»å‹</span>
</span></span></code></pre></div><p>å®ä¾‹</p>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#ff5c57">type</span> Person <span style="color:#ff5c57">struct</span> {
</span></span><span style="display:flex;"><span>	name <span style="color:#9aedfe">string</span>
</span></span><span style="display:flex;"><span>	age  <span style="color:#9aedfe">int</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">func</span> (p Person) <span style="color:#57c7ff">eat</span>() {
</span></span><span style="display:flex;"><span>	fmt.<span style="color:#57c7ff">Printf</span>(<span style="color:#5af78e">&#34;%v is eating.\n&#34;</span>, p.name)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">func</span> (p Person) <span style="color:#57c7ff">sleep</span>() {
</span></span><span style="display:flex;"><span>	fmt.<span style="color:#57c7ff">Printf</span>(<span style="color:#5af78e">&#34;%v is sleepy.\n&#34;</span>, p.name)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">func</span> <span style="color:#57c7ff">Struct</span>() {
</span></span><span style="display:flex;"><span>	person <span style="color:#ff6ac1">:=</span> Person{
</span></span><span style="display:flex;"><span>		name: <span style="color:#5af78e">&#34;Tom&#34;</span>,
</span></span><span style="display:flex;"><span>		age:  <span style="color:#ff9f43">43</span>,
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	person.<span style="color:#57c7ff">eat</span>()
</span></span><span style="display:flex;"><span>	person.<span style="color:#57c7ff">sleep</span>()
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="æ–¹æ³•çš„æ³¨æ„äº‹é¡¹">æ–¹æ³•çš„æ³¨æ„äº‹é¡¹<a hidden class="anchor" aria-hidden="true" href="#æ–¹æ³•çš„æ³¨æ„äº‹é¡¹">#</a></h3>
<ol>
<li>æ–¹æ³•çš„receiver typeå¹¶éä¸€å®šè¦æ˜¯structç±»å‹ï¼Œtypeå®šä¹‰çš„ç±»å‹åˆ«åã€sliceã€.mapã€channelã€.funcç±»å‹ç­‰éƒ½å¯
ä»¥ã€‚</li>
<li>structç»“åˆå®ƒçš„æ–¹æ³•å°±ç­‰ä»·äºé¢å‘å¯¹è±¡ä¸­çš„ç±»ã€‚åªä¸è¿‡structå¯ä»¥å’Œå®ƒçš„æ–¹æ³•åˆ†å¼€ï¼Œå¹¶éä¸€å®šè¦å±äºåŒä¸€ä¸ªæ–‡
ä»¶ï¼Œä½†å¿…é¡»å±äºåŒä¸€ä¸ªåŒ…ã€‚</li>
<li>æ–¹æ³•æœ‰ä¸¤ç§æ¥æ”¶ç±»å‹ï¼š(T Type)å’Œ(T*Type),å®ƒä»¬ä¹‹é—´æœ‰åŒºåˆ«ã€‚</li>
<li>æ–¹æ³•å°±æ˜¯å‡½æ•°ï¼Œæ‰€ä»¥Goä¸­æ²¡æœ‰æ–¹æ³•é‡è½½(overload)çš„è¯´æ³•ï¼Œä¹Ÿå°±æ˜¯è¯´åŒä¸€ä¸ªç±»å‹ä¸­çš„æ‰€æœ‰æ–¹æ³•åå¿…é¡»éƒ½å”¯ä¸€ã€‚</li>
<li>å¦‚æœreceiveræ˜¯ä¸€ä¸ªæŒ‡é’ˆç±»å‹ï¼Œåˆ™ä¼šè‡ªåŠ¨è§£é™¤å¼•ç”¨ã€‚</li>
<li>æ–¹æ³•å’Œtypeæ˜¯åˆ†å¼€çš„ï¼Œæ„å‘³ç€å®ä¾‹çš„è¡Œä¸º(behavior)å’Œæ•°æ®å­˜å‚¨(field)æ˜¯åˆ†å¼€çš„ï¼Œä½†æ˜¯å®ƒä»¬é€šè¿‡receiverå»ºç«‹èµ·
å…³è”å…³ç³»ã€‚</li>
</ol>
<h3 id="æ–¹æ³•æ¥æ”¶è€…ç±»å‹">æ–¹æ³•æ¥æ”¶è€…ç±»å‹<a hidden class="anchor" aria-hidden="true" href="#æ–¹æ³•æ¥æ”¶è€…ç±»å‹">#</a></h3>
<p>ç»“æ„ä½“å®ä¾‹ï¼Œæœ‰å€¼ç±»å‹å’ŒæŒ‡é’ˆç±»å‹ï¼Œé‚£ä¹ˆæ–¹æ³•çš„æ¥æ”¶è€…æ˜¯ç»“æ„ä½“ï¼Œé‚£ä¹ˆä¹Ÿæœ‰å€¼ç±»å‹å’ŒæŒ‡é’ˆç±»å‹ã€‚</p>
<p>åŒºåˆ«å°±æ˜¯æ¥æ”¶è€…æ˜¯å¦å¤åˆ¶ç»“æ„ä½“å‰¯æœ¬ã€‚==å€¼ç±»å‹å¤åˆ¶ï¼ŒæŒ‡é’ˆç±»å‹ä¸å¤åˆ¶ã€‚==</p>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#ff6ac1">package</span> Base
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">import</span> <span style="color:#5af78e">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">type</span> Person <span style="color:#ff5c57">struct</span> {
</span></span><span style="display:flex;"><span>	name <span style="color:#9aedfe">string</span>
</span></span><span style="display:flex;"><span>	age  <span style="color:#9aedfe">int</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">func</span> (p Person) <span style="color:#57c7ff">modifyName</span>() {
</span></span><span style="display:flex;"><span>	p.name = <span style="color:#5af78e">&#34;hello&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">func</span> (p <span style="color:#ff6ac1">*</span>Person) <span style="color:#57c7ff">modifyName1</span>() {
</span></span><span style="display:flex;"><span>	p.name = <span style="color:#5af78e">&#34;hello&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">func</span> <span style="color:#57c7ff">Struct</span>() {
</span></span><span style="display:flex;"><span>	person <span style="color:#ff6ac1">:=</span> Person{
</span></span><span style="display:flex;"><span>		name: <span style="color:#5af78e">&#34;Tom&#34;</span>,
</span></span><span style="display:flex;"><span>		age:  <span style="color:#ff9f43">43</span>,
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	fmt.<span style="color:#57c7ff">Println</span>(person)
</span></span><span style="display:flex;"><span>	person.<span style="color:#57c7ff">modifyName</span>()
</span></span><span style="display:flex;"><span>	fmt.<span style="color:#57c7ff">Println</span>(person)
</span></span><span style="display:flex;"><span>	person.<span style="color:#57c7ff">modifyName1</span>()
</span></span><span style="display:flex;"><span>	fmt.<span style="color:#57c7ff">Println</span>(person)
</span></span><span style="display:flex;"><span>	<span style="color:#78787e">//{Tom 43}
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>	<span style="color:#78787e">//{Tom 43}
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>	<span style="color:#78787e">//{hello 43}
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>}
</span></span></code></pre></div><h2 id="æ¥å£">æ¥å£<a hidden class="anchor" aria-hidden="true" href="#æ¥å£">#</a></h2>
<p>æ¥å£åƒæ˜¯ä¸€ä¸ªå…¬å¸é‡Œé¢çš„é¢†å¯¼ï¼Œä»–ä¼šå®šä¹‰ä¸€äº›é€šç”¨è§„èŒƒï¼Œ<strong>åªè®¾è®¡è§„èŒƒï¼Œè€Œä¸å®ç°è§„èŒƒ</strong>ã€‚</p>
<p>goè¯­è¨€çš„æ¥å£ï¼Œæ˜¯ä¸€ç§æ–°çš„ç±»å‹å®šä¹‰ï¼Œå®ƒæŠŠæ‰€æœ‰çš„å…·æœ‰å…±æ€§çš„æ–¹æ³•å®šä¹‰åœ¨ä¸€èµ·ï¼Œä»»ä½•å…¶ä»–ç±»å‹åªè¦å®ç°äº†è¿™äº›æ–¹
æ³•å°±æ˜¯å®ç°äº†è¿™ä¸ªæ¥å£ã€‚</p>
<p>è¯­æ³•æ ¼å¼å’Œæ–¹æ³•éå¸¸ç±»ä¼¼ã€‚</p>
<h3 id="db_init">db_init<a hidden class="anchor" aria-hidden="true" href="#db_init">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#ff6ac1">package</span> Dao
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">import</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#5af78e">&#34;log&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#5af78e">&#34;server/Model&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#5af78e">&#34;gorm.io/driver/mysql&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#5af78e">&#34;gorm.io/gorm&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#5af78e">&#34;gorm.io/gorm/schema&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">type</span> Manager <span style="color:#ff5c57">interface</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#57c7ff">Register</span>(userinfo Model.User) <span style="color:#9aedfe">error</span>
</span></span><span style="display:flex;"><span>	<span style="color:#57c7ff">GetUser</span>(userId <span style="color:#9aedfe">uint64</span>) (Model.User, <span style="color:#9aedfe">error</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#57c7ff">IsExist</span>(username <span style="color:#9aedfe">string</span>) (Model.User, <span style="color:#9aedfe">error</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#57c7ff">GetPostListByUserId</span>(userId <span style="color:#9aedfe">uint64</span>) ([]Model.Post, <span style="color:#9aedfe">error</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#57c7ff">UpdateProfileById</span>(userId <span style="color:#9aedfe">uint64</span>, data <span style="color:#ff6ac1">*</span>Model.User) <span style="color:#9aedfe">error</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#57c7ff">GetCommunityList</span>() ([]Model.Community, <span style="color:#9aedfe">error</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#57c7ff">StoreArticle</span>(postInfo Model.Post) <span style="color:#9aedfe">error</span>
</span></span><span style="display:flex;"><span>	<span style="color:#57c7ff">GetList</span>(latestTime <span style="color:#9aedfe">int64</span>) ([]Model.Post, <span style="color:#9aedfe">error</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#57c7ff">GetPostById</span>(postId <span style="color:#9aedfe">int64</span>) (Model.Post, <span style="color:#9aedfe">error</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#57c7ff">GetUsernameById</span>(AuthorId <span style="color:#9aedfe">uint64</span>) (author <span style="color:#9aedfe">string</span>, err <span style="color:#9aedfe">error</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#57c7ff">GetCommunityNameById</span>(CommunityId <span style="color:#9aedfe">uint64</span>) (CommunityName <span style="color:#9aedfe">string</span>, err <span style="color:#9aedfe">error</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#57c7ff">DeletePostById</span>(postId <span style="color:#9aedfe">int64</span>) <span style="color:#9aedfe">error</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#57c7ff">AddComment</span>(comment <span style="color:#ff6ac1">*</span>Model.Comment)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">type</span> manager <span style="color:#ff5c57">struct</span> {
</span></span><span style="display:flex;"><span>	db <span style="color:#ff6ac1">*</span>gorm.DB
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">var</span> Mgr Manager
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">func</span> <span style="color:#57c7ff">init</span>() {
</span></span><span style="display:flex;"><span>	dsn <span style="color:#ff6ac1">:=</span> <span style="color:#5af78e">&#34;root:Admin666@tcp(127.0.0.1:3306)/blogserver?charset=utf8mb4&amp;parseTime=True&amp;loc=Local&#34;</span>
</span></span><span style="display:flex;"><span>	db, err <span style="color:#ff6ac1">:=</span> gorm.<span style="color:#57c7ff">Open</span>(mysql.<span style="color:#57c7ff">Open</span>(dsn), <span style="color:#ff6ac1">&amp;</span>gorm.Config{
</span></span><span style="display:flex;"><span>		NamingStrategy: schema.NamingStrategy{
</span></span><span style="display:flex;"><span>			SingularTable: <span style="color:#ff6ac1">true</span>,
</span></span><span style="display:flex;"><span>		},
</span></span><span style="display:flex;"><span>	})
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">if</span> err <span style="color:#ff6ac1">!=</span> <span style="color:#ff6ac1">nil</span> {
</span></span><span style="display:flex;"><span>		log.<span style="color:#57c7ff">Fatal</span>(<span style="color:#5af78e">&#34;Failed to init db:&#34;</span>, err)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	Mgr = <span style="color:#ff6ac1">&amp;</span>manager{db: db}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">if</span> err <span style="color:#ff6ac1">:=</span> db.<span style="color:#57c7ff">AutoMigrate</span>(<span style="color:#ff6ac1">&amp;</span>Model.Post{}); err <span style="color:#ff6ac1">!=</span> <span style="color:#ff6ac1">nil</span> {
</span></span><span style="display:flex;"><span>		log.<span style="color:#57c7ff">Fatal</span>(err)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="daouser">dao.user<a hidden class="anchor" aria-hidden="true" href="#daouser">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#ff6ac1">package</span> Dao
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">import</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#5af78e">&#34;server/Model&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">func</span> (mgr manager) <span style="color:#57c7ff">Register</span>(userinfo Model.User) <span style="color:#9aedfe">error</span> {
</span></span><span style="display:flex;"><span>	result <span style="color:#ff6ac1">:=</span> mgr.db.<span style="color:#57c7ff">Create</span>(<span style="color:#ff6ac1">&amp;</span>userinfo)
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">return</span> result.Error
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">func</span> (mgr manager) <span style="color:#57c7ff">GetUser</span>(userId <span style="color:#9aedfe">uint64</span>) (Model.User, <span style="color:#9aedfe">error</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#ff5c57">var</span> user Model.User
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">if</span> err <span style="color:#ff6ac1">:=</span> mgr.db.<span style="color:#57c7ff">Select</span>(<span style="color:#5af78e">&#34;user_id&#34;</span>, <span style="color:#5af78e">&#34;username&#34;</span>, <span style="color:#5af78e">&#34;company&#34;</span>, <span style="color:#5af78e">&#34;user_page&#34;</span>, <span style="color:#5af78e">&#34;user_introduce&#34;</span>, <span style="color:#5af78e">&#34;position&#34;</span>, <span style="color:#5af78e">&#34;created_at&#34;</span>).
</span></span><span style="display:flex;"><span>		<span style="color:#57c7ff">Where</span>(<span style="color:#5af78e">&#34;user_id=?&#34;</span>, userId).<span style="color:#57c7ff">Find</span>(<span style="color:#ff6ac1">&amp;</span>user).Error; err <span style="color:#ff6ac1">!=</span> <span style="color:#ff6ac1">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#ff6ac1">return</span> user, err
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">return</span> user, <span style="color:#ff6ac1">nil</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">func</span> (mgr manager) <span style="color:#57c7ff">IsExist</span>(username <span style="color:#9aedfe">string</span>) (Model.User, <span style="color:#9aedfe">error</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#ff5c57">var</span> userinfo Model.User
</span></span><span style="display:flex;"><span>	result <span style="color:#ff6ac1">:=</span> mgr.db.<span style="color:#57c7ff">Where</span>(<span style="color:#5af78e">&#34;username=?&#34;</span>, username).<span style="color:#57c7ff">Find</span>(<span style="color:#ff6ac1">&amp;</span>userinfo)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">return</span> userinfo, result.Error
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">func</span> (mgr manager) <span style="color:#57c7ff">UpdateProfileById</span>(userId <span style="color:#9aedfe">uint64</span>, data <span style="color:#ff6ac1">*</span>Model.User) <span style="color:#9aedfe">error</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#ff5c57">var</span> userinfo Model.User
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff5c57">var</span> maps = <span style="color:#ff5c57">make</span>(<span style="color:#ff5c57">map</span>[<span style="color:#9aedfe">string</span>]<span style="color:#ff5c57">interface</span>{})
</span></span><span style="display:flex;"><span>	maps[<span style="color:#5af78e">&#34;username&#34;</span>] = data.Username
</span></span><span style="display:flex;"><span>	maps[<span style="color:#5af78e">&#34;user_page&#34;</span>] = data.UserPage
</span></span><span style="display:flex;"><span>	maps[<span style="color:#5af78e">&#34;company&#34;</span>] = data.Company
</span></span><span style="display:flex;"><span>	maps[<span style="color:#5af78e">&#34;user_introduce&#34;</span>] = data.UserIntroduce
</span></span><span style="display:flex;"><span>	maps[<span style="color:#5af78e">&#34;position&#34;</span>] = data.Position
</span></span><span style="display:flex;"><span>	err <span style="color:#ff6ac1">:=</span> mgr.db.<span style="color:#57c7ff">Model</span>(<span style="color:#ff6ac1">&amp;</span>userinfo).<span style="color:#57c7ff">Where</span>(<span style="color:#5af78e">&#34;user_id = ? &#34;</span>, userId).<span style="color:#57c7ff">Updates</span>(maps).Error
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">return</span> err
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="æ¥å£å’Œç±»å‹çš„å…³ç³»">æ¥å£å’Œç±»å‹çš„å…³ç³»<a hidden class="anchor" aria-hidden="true" href="#æ¥å£å’Œç±»å‹çš„å…³ç³»">#</a></h3>
<p>1.ä¸€ä¸ªç±»å‹å¯ä»¥å®ç°å¤šä¸ªæ¥å£
2.å¤šä¸ªç±»å‹å¯ä»¥å®ç°åŒä¸€ä¸ªæ¥å£ï¼ˆå¤šæ€ï¼‰</p>
<p>ä¸€ä¸ªç±»å‹å®ç°å¤šä¸ªæ¥å£</p>
<p>ä¾‹å¦‚ï¼šæœ‰ä¸€ä¸ªPlayeræ¥å£å¯ä»¥æ’­æ”¾éŸ³ä¹ï¼Œæœ‰ä¸€ä¸ªVideoæ¥å£å¯ä»¥æ’­æ”¾è§†é¢‘ï¼Œ</p>
<p>ä¸€ä¸ªæ‰‹æœºMobileå®ç°è¿™ä¸¤ä¸ªæ¥å£ï¼Œæ—¢å¯ä»¥æ’­æ”¾éŸ³ä¹ï¼Œåˆå¯ä»¥æ’­æ”¾è§†é¢‘ã€‚</p>
<h3 id="æ¥å£åµŒå¥—">æ¥å£åµŒå¥—<a hidden class="anchor" aria-hidden="true" href="#æ¥å£åµŒå¥—">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#ff6ac1">package</span> Base
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">import</span> <span style="color:#5af78e">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">type</span> Fly <span style="color:#ff5c57">interface</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#57c7ff">FlyFunc</span>()
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">type</span> Swim <span style="color:#ff5c57">interface</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#57c7ff">SwimFunc</span>()
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">type</span> FlyFish <span style="color:#ff5c57">interface</span> {
</span></span><span style="display:flex;"><span>	Fly
</span></span><span style="display:flex;"><span>	Swim
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">type</span> Fish <span style="color:#ff5c57">struct</span> {
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">func</span> (f Fish) <span style="color:#57c7ff">FlyFunc</span>() {
</span></span><span style="display:flex;"><span>	fmt.<span style="color:#57c7ff">Println</span>(<span style="color:#5af78e">&#34;Fish is flying.&#34;</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">func</span> (f Fish) <span style="color:#57c7ff">SwimFunc</span>() {
</span></span><span style="display:flex;"><span>	fmt.<span style="color:#57c7ff">Println</span>(<span style="color:#5af78e">&#34;Fish is swimming.&#34;</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">func</span> <span style="color:#57c7ff">Interface</span>() {
</span></span><span style="display:flex;"><span>   <span style="color:#ff5c57">var</span> ff FlyFish
</span></span><span style="display:flex;"><span>   <span style="color:#78787e">//  æ­¤å¤„å¦‚æœä¸å®ç°æ–¹æ³•ä¼šæŠ¥é”™
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>   ff = Fish{}
</span></span><span style="display:flex;"><span>   ff.<span style="color:#57c7ff">SwimFunc</span>()
</span></span><span style="display:flex;"><span>   ff.<span style="color:#57c7ff">FlyFunc</span>()
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="é€šè¿‡æ¥å£å®ç°ocpè®¾è®¡åŸåˆ™">é€šè¿‡æ¥å£å®ç°OCPè®¾è®¡åŸåˆ™<a hidden class="anchor" aria-hidden="true" href="#é€šè¿‡æ¥å£å®ç°ocpè®¾è®¡åŸåˆ™">#</a></h3>
<p>é¢å‘å¯¹è±¡çš„å¯å¤ç”¨è®¾è®¡çš„ç¬¬ä¸€å—åŸºçŸ³ï¼Œä¾¿æ˜¯æ‰€è°“çš„â€å¼€-é—­â€œåŸåˆ™(Open-Closed Principle,å¸¸ç¼©å†™ä¸ºOCP)ã€‚</p>
<p>è™½ç„¶ï¼Œgoä¸æ˜¯é¢å‘å¯¹è±¡è¯­è¨€ï¼Œä½†æ˜¯ä¹Ÿå¯ä»¥æ¨¡æ‹Ÿå®ç°è¿™ä¸ªåŸåˆ™ã€‚</p>
<h3 id="å®ä¾‹">å®ä¾‹<a hidden class="anchor" aria-hidden="true" href="#å®ä¾‹">#</a></h3>
<p>æ¥å£:</p>
<ul>
<li>
<p>ç‰¹æ®Šçš„æ•°æ®ç±»å‹</p>
</li>
<li>
<p>æ–¹æ³•å®šä¹‰çš„é›†åˆ</p>
</li>
<li>
<p>æ–¹æ³•å(å½¢å‚ç±»å‹)è¿”å›å€¼ç±»å‹</p>
</li>
<li>
<p>æé«˜ä»£ç çš„å¤ç”¨ç‡</p>
</li>
</ul>
<p>æ¥å£æœ¬èº«ä¸èƒ½ç»‘å®šæ–¹æ³•</p>
<p>ä¿å­˜çš„æ˜¯ï¼šå€¼+åŸå§‹ç±»å‹</p>
<p>5.2.2 å®ç°</p>
<p>ä¸€ä¸ªç±»å‹å®ç°äº†æ¥å£çš„æ‰€æœ‰æ–¹æ³•</p>
<p>å³å®ç°äº†è¯¥æ¥å£</p>
<p>goä¸­æ— éœ€â€œimplementsâ€å…³é”®å­—</p>
<p>5.2.3 ç±»å‹é€‰æ‹©</p>
<p>switchâ€¦case + interface.(type)</p>
<p>.(type)ä¸èƒ½åœ¨ switchâ€¦case å¤–ä½¿ç”¨</p>
<p>5.2.4 ç±»å‹æ–­è¨€</p>
<p>è¿˜åŸä¸ºåŸå§‹ç±»å‹ interface.(Type)</p>
<p>å¦‚æœæ¥å£æ²¡æœ‰ä¿å­˜ç±»å‹ï¼Œåˆ™ä¼šæŠ¥é”™</p>
<p>å¯è¿”å›ä¸¤ä¸ªå€¼</p>
<p>value, ok :=  interface.(Type)</p>
<p>5.2.5 ç©ºæ¥å£</p>
<p>interface{}</p>
<p>ç©ºæ¥å£å¯ä¿å­˜ä»»ä½•ç±»å‹</p>
<p>5.2.6 nilé—®é¢˜</p>
<p>nil å€¼ï¼šæœ‰ç±»å‹æ²¡æœ‰å€¼ï¼Œæ¥å£æœ¬èº«å¹¶ä¸æ˜¯ nilï¼Œå¯ä»¥å¤„ç†</p>
<p>nil æ¥å£ï¼šå³æ²¡æœ‰ä¿å­˜å€¼ï¼Œä¹Ÿæ²¡æœ‰ä¿å­˜ç±»å‹ï¼Œä½¿ç”¨æ—¶ä¼šæŠ¥é”™</p>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#78787e">//5.2 æ¥å£
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span><span style="color:#ff5c57">type</span> textMes <span style="color:#ff5c57">struct</span> {
</span></span><span style="display:flex;"><span>	Type <span style="color:#9aedfe">string</span>
</span></span><span style="display:flex;"><span>	Text <span style="color:#9aedfe">string</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">func</span> (tm <span style="color:#ff6ac1">*</span>textMes) <span style="color:#57c7ff">setText</span>() {
</span></span><span style="display:flex;"><span>	tm.Text = <span style="color:#5af78e">&#34;hello&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">type</span> imgMes <span style="color:#ff5c57">struct</span> {
</span></span><span style="display:flex;"><span>	Type <span style="color:#9aedfe">string</span>
</span></span><span style="display:flex;"><span>	Img  <span style="color:#9aedfe">string</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">func</span> (im <span style="color:#ff6ac1">*</span>imgMes) <span style="color:#57c7ff">setImg</span>() {
</span></span><span style="display:flex;"><span>	im.Img = <span style="color:#5af78e">&#34;æ¸…æ˜ä¸Šæ²³å›¾&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">type</span> Mes <span style="color:#ff5c57">interface</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#57c7ff">setType</span>()
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">func</span> (tm <span style="color:#ff6ac1">*</span>textMes) <span style="color:#57c7ff">setType</span>() {
</span></span><span style="display:flex;"><span>	tm.Type = <span style="color:#5af78e">&#34;æ–‡å­—æ¶ˆæ¯&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">func</span> (im <span style="color:#ff6ac1">*</span>imgMes) <span style="color:#57c7ff">setType</span>() {
</span></span><span style="display:flex;"><span>	im.Type = <span style="color:#5af78e">&#34;å›¾ç‰‡æ¶ˆæ¯&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">func</span> <span style="color:#57c7ff">SendMes</span>(m Mes) {
</span></span><span style="display:flex;"><span>	m.<span style="color:#57c7ff">setType</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">switch</span> mptr <span style="color:#ff6ac1">:=</span> m.(<span style="color:#ff5c57">type</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">case</span> <span style="color:#ff6ac1">*</span>textMes:
</span></span><span style="display:flex;"><span>		mptr.<span style="color:#57c7ff">setText</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">case</span> <span style="color:#ff6ac1">*</span>imgMes:
</span></span><span style="display:flex;"><span>		mptr.<span style="color:#57c7ff">setImg</span>()
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	fmt.<span style="color:#57c7ff">Println</span>(<span style="color:#5af78e">&#34;m=&#34;</span>, m)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">func</span> <span style="color:#57c7ff">Interface</span>() {
</span></span><span style="display:flex;"><span>	tm <span style="color:#ff6ac1">:=</span> textMes{}
</span></span><span style="display:flex;"><span>	<span style="color:#57c7ff">SendMes</span>(<span style="color:#ff6ac1">&amp;</span>tm)
</span></span><span style="display:flex;"><span>	im <span style="color:#ff6ac1">:=</span> imgMes{}
</span></span><span style="display:flex;"><span>	<span style="color:#57c7ff">SendMes</span>(<span style="color:#ff6ac1">&amp;</span>im)
</span></span><span style="display:flex;"><span>	<span style="color:#ff5c57">var</span> n1 <span style="color:#9aedfe">int</span> = <span style="color:#ff9f43">1</span>
</span></span><span style="display:flex;"><span>	n1interface <span style="color:#ff6ac1">:=</span> <span style="color:#ff5c57">interface</span>{}(n1)
</span></span><span style="display:flex;"><span>	n2, ok <span style="color:#ff6ac1">:=</span> n1interface.(<span style="color:#9aedfe">int</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">if</span> ok {
</span></span><span style="display:flex;"><span>		fmt.<span style="color:#57c7ff">Println</span>(<span style="color:#5af78e">&#34;n2=&#34;</span>, n2)
</span></span><span style="display:flex;"><span>	} <span style="color:#ff6ac1">else</span> {
</span></span><span style="display:flex;"><span>		fmt.<span style="color:#57c7ff">Println</span>(<span style="color:#5af78e">&#34;ç±»å‹æ–­è¨€å¤±è´¥&#34;</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="ç»§æ‰¿">ç»§æ‰¿<a hidden class="anchor" aria-hidden="true" href="#ç»§æ‰¿">#</a></h2>
<p>golangæœ¬è´¨ä¸Šæ²¡æœ‰ocpçš„æ¦‚å¿µï¼Œä¹Ÿæ²¡æœ‰ç»§æ‰¿çš„æ¦‚å¿µï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡ç»“æ„ä½“åµŒå¥—å®ç°è¿™ä¸ªç‰¹æ€§ã€‚</p>
<p>golang ä¸­çš„ç»§æ‰¿æ˜¯é€šè¿‡ç»“æ„ä½“ä¸­çš„==åŒ¿åå­—æ®µ==æ¥å®ç°</p>
<p>ä¾‹ï¼šå®šä¹‰ä¸€ä¸ª BaseNum å¯¹è±¡ (ç»“æ„ä½“)ï¼Œä½œä¸ºçˆ¶ç±»ï¼ŒAdd å’ŒSub å¯¹è±¡(ç»“æ„ä½“)ä¸­åŒ…å«äº†BaseNum åŒ¿åå­—æ®µï¼Œ æ­¤æ—¶ Add å’ŒSub å°±æ˜¯BaseNumçš„å­ç±»</p>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#ff6ac1">type</span> <span style="color:#f3f99d">BaseNum</span> <span style="color:#ff6ac1">struct</span> {
</span></span><span style="display:flex;"><span>     num1 int
</span></span><span style="display:flex;"><span>     num2 int
</span></span><span style="display:flex;"><span>} <span style="color:#78787e">// BaseNum å³ä¸ºçˆ¶ç±»å‹åç§°
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">type</span> <span style="color:#f3f99d">Add</span> <span style="color:#ff6ac1">struct</span> {
</span></span><span style="display:flex;"><span>    BaseNum
</span></span><span style="display:flex;"><span>} <span style="color:#78787e">//åŠ æ³•å­ç±», å®šä¹‰åŠ æ³•å­ç±»çš„ä¸»è¦ç›®çš„, æ˜¯ä¸ºäº†å®šä¹‰å¯¹åº”å­ç±»çš„æ–¹æ³•
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">type</span> <span style="color:#f3f99d">Sub</span> <span style="color:#ff6ac1">struct</span> {
</span></span><span style="display:flex;"><span>    BaseNum
</span></span><span style="display:flex;"><span>} <span style="color:#78787e">//å‡æ³•å­ç±»
</span></span></span></code></pre></div><h2 id="æ„é€ å‡½æ•°">æ„é€ å‡½æ•°<a hidden class="anchor" aria-hidden="true" href="#æ„é€ å‡½æ•°">#</a></h2>
<p>golangæ²¡æœ‰æ„é€ å‡½æ•°çš„æ¦‚å¿µï¼Œå¯ä»¥ä½¿ç”¨å‡½æ•°æ¥æ¨¡æ‹Ÿæ„é€ å‡½æ•°çš„çš„åŠŸèƒ½ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#ff6ac1">package</span> Base
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">import</span> <span style="color:#5af78e">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">type</span> Person1 <span style="color:#ff5c57">struct</span> {
</span></span><span style="display:flex;"><span>	name <span style="color:#9aedfe">string</span>
</span></span><span style="display:flex;"><span>	age  <span style="color:#9aedfe">int</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">func</span> <span style="color:#57c7ff">NewPerson</span>(name <span style="color:#9aedfe">string</span>, age <span style="color:#9aedfe">int</span>) (<span style="color:#ff6ac1">*</span>Person1, <span style="color:#9aedfe">error</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">if</span> name <span style="color:#ff6ac1">==</span> <span style="color:#5af78e">&#34;&#34;</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#ff6ac1">return</span> <span style="color:#ff6ac1">nil</span>, fmt.<span style="color:#57c7ff">Errorf</span>(<span style="color:#5af78e">&#34;nameä¸èƒ½ä¸ºç©º&#34;</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">if</span> age &lt; <span style="color:#ff9f43">0</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#ff6ac1">return</span> <span style="color:#ff6ac1">nil</span>, fmt.<span style="color:#57c7ff">Errorf</span>(<span style="color:#5af78e">&#34;ageä¸èƒ½å°äºg&#34;</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">return</span> <span style="color:#ff6ac1">&amp;</span>Person1{name: name, age: age}, <span style="color:#ff6ac1">nil</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">func</span> <span style="color:#57c7ff">Constructor</span>() {
</span></span><span style="display:flex;"><span>	person, err <span style="color:#ff6ac1">:=</span> <span style="color:#57c7ff">NewPerson</span>(<span style="color:#5af78e">&#34;tom&#34;</span>, <span style="color:#ff9f43">20</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">if</span> err <span style="color:#ff6ac1">!=</span> <span style="color:#ff6ac1">nil</span> {
</span></span><span style="display:flex;"><span>		fmt.<span style="color:#57c7ff">Printf</span>(<span style="color:#5af78e">&#34;err:%v\n&#34;</span>, err)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	fmt.<span style="color:#57c7ff">Printf</span>(<span style="color:#5af78e">&#34;person:%v\n&#34;</span>, <span style="color:#ff6ac1">*</span>person)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="åŒ…ç®¡ç†å·¥å…·go-module">åŒ…ç®¡ç†å·¥å…·go module<a hidden class="anchor" aria-hidden="true" href="#åŒ…ç®¡ç†å·¥å…·go-module">#</a></h2>
<p>go modulesæ˜¯golang1.11æ–°åŠ çš„ç‰¹æ€§ï¼Œç”¨æ¥ç®¡ç†æ¨¡å—ä¸­åŒ…çš„ä¾èµ–å…³ç³»ã€‚</p>
<p>go modä½¿ç”¨æ–¹æ³•</p>
<ul>
<li>
<p>åˆå§‹åŒ–æ¨¡å—	go mod init&lt;é¡¹ç›®æ¨¡å—åç§°&gt;</p>
</li>
<li>
<p>ä¾èµ–å…³ç³»å¤„ç†ï¼Œæ ¹æ®go.modæ–‡ä»¶	go mod tidy</p>
</li>
<li>
<p>å°†ä¾èµ–åŒ…å¤åˆ¶åˆ°é¡¹ç›®ä¸‹çš„vendorç›®å½•	go mod vendor</p>
<p>å¦‚æœåŒ…è¢«å±è”½ï¼ˆå¢™ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªå‘½ä»¤ï¼Œéšåä½¿ç”¨go build-mod=vendorç¼–è¯‘</p>
</li>
<li>
<p>æ˜¾ç¤ºä¾èµ–å…³ç³»	go list -m all</p>
</li>
<li>
<p>æ˜¾ç¤ºè¯¦ç»†ä¾èµ–å…³ç³»	go list -m -json all</p>
</li>
<li>
<p>ä¸‹è½½ä¾èµ–	go mod download [path@version]
[path@version]æ˜¯éå¿…å†™çš„</p>
</li>
</ul>
<h2 id="å¹¶å‘ç¼–ç¨‹-åç¨‹">å¹¶å‘ç¼–ç¨‹-&gt;åç¨‹<a hidden class="anchor" aria-hidden="true" href="#å¹¶å‘ç¼–ç¨‹-åç¨‹">#</a></h2>
<p>Golangä¸­çš„å¹¶å‘æ˜¯å‡½æ•°ç›¸äº’ç‹¬ç«‹è¿è¡Œçš„èƒ½åŠ›ã€‚<code>Goroutines</code>æ˜¯å¹¶å‘è¿è¡Œçš„å‡½æ•°ã€‚</p>
<p>Golangæä¾›äº†Goroutinesä½œä¸ºå¹¶å‘å¤„ç†æ“ä½œçš„ä¸€ç§æ–¹å¼ã€‚</p>
<p>åˆ›å»ºä¸€ä¸ªåç¨‹éå¸¸ç®€å•ï¼Œå°±æ˜¯åœ¨ä¸€ä¸ªä»»åŠ¡å‡½æ•°å‰é¢æ·»åŠ ä¸€ä¸ªgoå…³é”®å­—ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#ff6ac1">go</span> <span style="color:#57c7ff">task</span>()
</span></span></code></pre></div><h3 id="q1-select--case">Q1 select â€¦â€¦ case<a hidden class="anchor" aria-hidden="true" href="#q1-select--case">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#78787e">//5.3 åç¨‹
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span><span style="color:#ff5c57">var</span> (
</span></span><span style="display:flex;"><span>	c    <span style="color:#9aedfe">int</span>
</span></span><span style="display:flex;"><span>	lock sync.Mutex
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">func</span> <span style="color:#57c7ff">PrimeNum</span>(n <span style="color:#9aedfe">int</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">for</span> i <span style="color:#ff6ac1">:=</span> <span style="color:#ff9f43">2</span>; i &lt; n; i<span style="color:#ff6ac1">++</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#ff6ac1">if</span> n<span style="color:#ff6ac1">%</span>i <span style="color:#ff6ac1">==</span> <span style="color:#ff9f43">0</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#ff6ac1">return</span>
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	fmt.<span style="color:#57c7ff">Printf</span>(<span style="color:#5af78e">&#34;%v\t&#34;</span>, n)
</span></span><span style="display:flex;"><span>	lock.<span style="color:#57c7ff">Lock</span>()
</span></span><span style="display:flex;"><span>	c<span style="color:#ff6ac1">++</span>
</span></span><span style="display:flex;"><span>	lock.<span style="color:#57c7ff">Unlock</span>()
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">func</span> <span style="color:#57c7ff">Goroutine</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">for</span> i <span style="color:#ff6ac1">:=</span> <span style="color:#ff9f43">2</span>; i &lt; <span style="color:#ff9f43">100001</span>; i<span style="color:#ff6ac1">++</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#ff6ac1">go</span> <span style="color:#57c7ff">PrimeNum</span>(i)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#ff5c57">var</span> key <span style="color:#9aedfe">string</span>
</span></span><span style="display:flex;"><span>	fmt.<span style="color:#57c7ff">Scanln</span>(<span style="color:#ff6ac1">&amp;</span>key)
</span></span><span style="display:flex;"><span>	fmt.<span style="color:#57c7ff">Printf</span>(<span style="color:#5af78e">&#34;\nå…±æ‰¾åˆ°%vä¸ªç´ æ•°\n&#34;</span>, c)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#78787e">//5.4 channel
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span><span style="color:#ff5c57">func</span> <span style="color:#57c7ff">pushNum</span>(c <span style="color:#ff5c57">chan</span> <span style="color:#9aedfe">int</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">for</span> i <span style="color:#ff6ac1">:=</span> <span style="color:#ff9f43">0</span>; i &lt; <span style="color:#ff9f43">100</span>; i<span style="color:#ff6ac1">++</span> {
</span></span><span style="display:flex;"><span>		c <span style="color:#ff6ac1">&lt;-</span> i
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#ff5c57">close</span>(c)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">func</span> <span style="color:#57c7ff">pushPrimeNum</span>(n <span style="color:#9aedfe">int</span>, c <span style="color:#ff5c57">chan</span> <span style="color:#9aedfe">int</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">for</span> i <span style="color:#ff6ac1">:=</span> <span style="color:#ff9f43">2</span>; i &lt; n; i<span style="color:#ff6ac1">++</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#ff6ac1">if</span> n<span style="color:#ff6ac1">%</span>i <span style="color:#ff6ac1">==</span> <span style="color:#ff9f43">0</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#ff6ac1">return</span>
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	c <span style="color:#ff6ac1">&lt;-</span> n
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">func</span> <span style="color:#57c7ff">Channel</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#ff5c57">var</span> c1 <span style="color:#ff5c57">chan</span> <span style="color:#9aedfe">int</span> = <span style="color:#ff5c57">make</span>(<span style="color:#ff5c57">chan</span> <span style="color:#9aedfe">int</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">go</span> <span style="color:#57c7ff">pushNum</span>(c1)
</span></span><span style="display:flex;"><span>	<span style="color:#78787e">// for {
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>	<span style="color:#78787e">// 	v, ok := &lt;-c1
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>	<span style="color:#78787e">// 	if ok {
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>	<span style="color:#78787e">// 		fmt.Printf(&#34;%v\t&#34;, v)
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>	<span style="color:#78787e">// 	} else {
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>	<span style="color:#78787e">// 		break
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>	<span style="color:#78787e">// 	}
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>	<span style="color:#78787e">// }
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>	<span style="color:#ff6ac1">for</span> v <span style="color:#ff6ac1">:=</span> <span style="color:#ff6ac1">range</span> c1 {
</span></span><span style="display:flex;"><span>		fmt.<span style="color:#57c7ff">Printf</span>(<span style="color:#5af78e">&#34;%v\t&#34;</span>, v)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#ff5c57">var</span> c2 <span style="color:#ff5c57">chan</span> <span style="color:#9aedfe">int</span> = <span style="color:#ff5c57">make</span>(<span style="color:#ff5c57">chan</span> <span style="color:#9aedfe">int</span>, <span style="color:#ff9f43">100</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">for</span> i <span style="color:#ff6ac1">:=</span> <span style="color:#ff9f43">2</span>; i &lt; <span style="color:#ff9f43">100001</span>; i<span style="color:#ff6ac1">++</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#ff6ac1">go</span> <span style="color:#57c7ff">pushPrimeNum</span>(i, c2)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>Print:
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">for</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#ff6ac1">select</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#ff6ac1">case</span> v <span style="color:#ff6ac1">:=</span> <span style="color:#ff6ac1">&lt;-</span>c2:
</span></span><span style="display:flex;"><span>			fmt.<span style="color:#57c7ff">Printf</span>(<span style="color:#5af78e">&#34;%v\t&#34;</span>, v)
</span></span><span style="display:flex;"><span>		<span style="color:#ff6ac1">default</span>:
</span></span><span style="display:flex;"><span>			fmt.<span style="color:#57c7ff">Println</span>(<span style="color:#5af78e">&#34;æ‰€æœ‰ç´ æ•°å·²ç»æ‰¾åˆ°&#34;</span>)
</span></span><span style="display:flex;"><span>			<span style="color:#ff6ac1">break</span> Print
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>åœ¨ Go ç¼–ç¨‹è¯­è¨€ä¸­ï¼Œ<code>select</code> è¯­å¥ç”¨äºåœ¨å¤šä¸ªé€šé“æ“ä½œä¸­è¿›è¡Œé€‰æ‹©ã€‚å®ƒå¯ä»¥åœ¨å¤šä¸ªé€šé“ä¸Šç­‰å¾…æ•°æ®åˆ°è¾¾æˆ–æ“ä½œå®Œæˆï¼Œå¹¶æ ¹æ®æƒ…å†µæ‰§è¡Œç›¸åº”çš„æ“ä½œã€‚<code>select</code> çš„ç»“æ„å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#ff6ac1">select</span> {
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">case</span> <span style="color:#ff6ac1">&lt;-</span>channel1:
</span></span><span style="display:flex;"><span>    <span style="color:#78787e">// æ‰§è¡Œ channel1 æ•°æ®åˆ°è¾¾æ—¶çš„æ“ä½œ
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span><span style="color:#ff6ac1">case</span> data <span style="color:#ff6ac1">:=</span> <span style="color:#ff6ac1">&lt;-</span>channel2:
</span></span><span style="display:flex;"><span>    <span style="color:#78787e">// æ‰§è¡Œ channel2 æ•°æ®åˆ°è¾¾æ—¶çš„æ“ä½œï¼Œå¹¶å°†æ•°æ®å­˜å‚¨åœ¨ data å˜é‡ä¸­
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span><span style="color:#ff6ac1">case</span> channel3 <span style="color:#ff6ac1">&lt;-</span> data:
</span></span><span style="display:flex;"><span>    <span style="color:#78787e">// æ‰§è¡Œå°† data å‘é€åˆ° channel3 çš„æ“ä½œ
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span><span style="color:#ff6ac1">default</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#78787e">// å½“æ²¡æœ‰ä»»ä½•é€šé“æ“ä½œå‡†å¤‡å°±ç»ªæ—¶æ‰§è¡Œçš„æ“ä½œ
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>}
</span></span></code></pre></div><p>åœ¨æ‚¨æä¾›çš„ä»£ç ä¸­ï¼Œæ‚¨ä½¿ç”¨äº† <code>select</code> æ¥ä»é€šé“ <code>c2</code> ä¸­æ¥æ”¶æ•°æ®ï¼ŒåŒæ—¶è¿˜è®¾ç½®äº†ä¸€ä¸ª <code>default</code> åˆ†æ”¯ã€‚è®©æˆ‘å¯¹æ‚¨çš„ä»£ç è¿›è¡Œè§£é‡Šï¼š</p>
<ol>
<li>é¦–å…ˆï¼Œæ‚¨åˆ›å»ºäº†ä¸€ä¸ªç¼“å†²é€šé“ <code>c2</code>ï¼Œå¹¶å¯åŠ¨äº†ä¸€ç³»åˆ— goroutineï¼Œæ¯ä¸ª goroutine è´Ÿè´£å°†ç´ æ•°æ¨é€åˆ° <code>c2</code> é€šé“ã€‚</li>
<li>ç„¶åï¼Œä½¿ç”¨ä¸€ä¸ªæ— é™å¾ªç¯ï¼Œä¸æ–­åœ°æ‰§è¡Œ <code>select</code> è¯­å¥ã€‚</li>
<li>åœ¨ <code>select</code> è¯­å¥ä¸­ï¼Œæ‚¨ä½¿ç”¨äº†ä¸€ä¸ª <code>case</code> åˆ†æ”¯ï¼Œè¯¥åˆ†æ”¯å°è¯•ä» <code>c2</code> é€šé“æ¥æ”¶ä¸€ä¸ªæ•´æ•°ã€‚å¦‚æœ <code>c2</code> é€šé“ä¸­æœ‰æ•°æ®ï¼Œå®ƒä¼šæ‰§è¡Œç›¸åº”çš„æ“ä½œï¼Œå°†æ¥æ”¶åˆ°çš„æ•´æ•°æ‰“å°å‡ºæ¥ã€‚</li>
<li>æ‚¨è¿˜ä½¿ç”¨äº†ä¸€ä¸ª <code>default</code> åˆ†æ”¯ï¼Œè¿™æ˜¯å½“æ²¡æœ‰é€šé“æ“ä½œå‡†å¤‡å°±ç»ªæ—¶æ‰§è¡Œçš„åˆ†æ”¯ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒä¼šè¾“å‡º &ldquo;æ‰€æœ‰ç´ æ•°å·²ç»æ‰¾åˆ°&rdquo;ï¼Œå¹¶é€šè¿‡ <code>break Print</code> è¯­å¥è·³å‡º <code>for</code> å¾ªç¯ã€‚</li>
</ol>
<p>æ€»ç»“æ¥è¯´ï¼Œæ‚¨çš„ä»£ç é€šè¿‡å¤šä¸ªå¹¶å‘çš„ goroutine è®¡ç®—ç´ æ•°å¹¶æ¨é€åˆ°é€šé“ä¸­ï¼Œç„¶åä½¿ç”¨ <code>select</code> è¯­å¥ä»é€šé“ä¸­æ¥æ”¶æ•°æ®å¹¶è¿›è¡Œå¤„ç†ã€‚<code>select</code> çš„ä½œç”¨åœ¨äºå…è®¸æ‚¨åŒæ—¶ç­‰å¾…å¤šä¸ªé€šé“çš„æ•°æ®åˆ°è¾¾ï¼Œå“ªä¸ªé€šé“æœ‰æ•°æ®ï¼Œå°±æ‰§è¡Œç›¸åº”çš„æ“ä½œã€‚</p>
<p>é‚£è¿™æ®µä»£ç æ²¡æœ‰ select case å¯ä»¥å—ï¼Ÿ</p>
<p>å½“æ‚¨ä½¿ç”¨ <code>select</code> æ—¶ï¼Œæ˜¯å› ä¸ºæ‚¨å¸Œæœ›èƒ½å¤ŸåŒæ—¶ç›‘è§†å¤šä¸ªé€šé“ï¼Œå¹¶åœ¨å…¶ä¸­ä»»ä½•ä¸€ä¸ªé€šé“å°±ç»ªæ—¶æ‰§è¡Œç›¸åº”çš„æ“ä½œã€‚åœ¨æ‚¨çš„ä»£ç ç¤ºä¾‹ä¸­ï¼Œæ‚¨ä½¿ç”¨ <code>select</code> æ¥ä»é€šé“ <code>c2</code> æ¥æ”¶æ•°æ®ï¼Œå¹¶åœ¨æ²¡æœ‰æ•°æ®å¯æ¥æ”¶æ—¶è¾“å‡ºæç¤ºã€‚</p>
<p>å¦‚æœæ‚¨ä¸éœ€è¦åŒæ—¶ç›‘è§†å¤šä¸ªé€šé“ï¼Œè€Œåªæ˜¯å¸Œæœ›ä»å•ä¸ªé€šé“ä¸­æ¥æ”¶æ•°æ®å¹¶æ‰§è¡Œç›¸åº”çš„æ“ä½œï¼Œé‚£ä¹ˆæ˜¯å¯ä»¥çœç•¥ <code>select</code> çš„ã€‚æ‚¨å¯ä»¥ç›´æ¥ä½¿ç”¨é€šé“çš„é˜»å¡æ¥æ”¶æ“ä½œï¼Œä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#ff6ac1">for</span> {
</span></span><span style="display:flex;"><span>    v, ok <span style="color:#ff6ac1">:=</span> <span style="color:#ff6ac1">&lt;-</span>c2
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">if</span> !ok {
</span></span><span style="display:flex;"><span>        fmt.<span style="color:#57c7ff">Println</span>(<span style="color:#5af78e">&#34;æ‰€æœ‰ç´ æ•°å·²ç»æ‰¾åˆ°&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">break</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    fmt.<span style="color:#57c7ff">Printf</span>(<span style="color:#5af78e">&#34;%v\t&#34;</span>, v)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>åœ¨è¿™ä¸ªå¾ªç¯ä¸­ï¼Œ<code>v, ok := &lt;-c2</code> å°†ä»é€šé“ <code>c2</code> æ¥æ”¶æ•°æ®ï¼Œå¹¶å°†æ•°æ®å­˜å‚¨åœ¨å˜é‡ <code>v</code> ä¸­ã€‚åŒæ—¶ï¼Œ<code>ok</code> è¡¨ç¤ºé€šé“æ˜¯å¦å…³é—­ï¼Œå¦‚æœé€šé“å…³é—­äº†ï¼Œå°±ä¸å†æœ‰æ•°æ®å¯ä»¥æ¥æ”¶äº†ã€‚</p>
<p>ç„¶åï¼Œæ‚¨å¯ä»¥æ£€æŸ¥ <code>ok</code> çš„å€¼ï¼Œå¦‚æœä¸º <code>false</code>ï¼Œå°±è¾“å‡ºæç¤ºä¿¡æ¯å¹¶è·³å‡ºå¾ªç¯ã€‚å¦åˆ™ï¼Œç»§ç»­æ‰§è¡Œæ‰“å°æ“ä½œã€‚</p>
<p>æ‰€ä»¥ï¼Œæ‚¨å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚ï¼Œé€‰æ‹©ä½¿ç”¨å¸¦æœ‰ <code>select</code> çš„å¹¶å‘æ“ä½œï¼Œæˆ–è€…ç›´æ¥ä½¿ç”¨é€šé“çš„é˜»å¡æ¥æ”¶æ“ä½œã€‚</p>
<h2 id="å¹¶å‘ç¼–ç¨‹-é€šé“channel">å¹¶å‘ç¼–ç¨‹-&gt;é€šé“channel<a hidden class="anchor" aria-hidden="true" href="#å¹¶å‘ç¼–ç¨‹-é€šé“channel">#</a></h2>
<p>Goæä¾›äº†ä¸€ç§ç§°ä¸ºé€šé“çš„æœºåˆ¶ï¼Œç”¨äºåœ¨==goroutineä¹‹é—´==å…±äº«æ•°æ®ã€‚</p>
<p>å½“æ‚¨ä½œä¸ºgoroutineæ‰§è¡Œå¹¶å‘æ´»åŠ¨æ—¶ï¼Œéœ€è¦åœ¨goroutineä¹‹é—´å…±äº«èµ„æºæˆ–æ•°æ®ï¼Œé€šé“å……å½“goroutineä¹‹é—´çš„ç®¡é“ï¼ˆç®¡é“ï¼‰å¹¶æä¾›ä¸€ç§æœºåˆ¶æ¥ä¿è¯åŒæ­¥äº¤æ¢ã€‚éœ€è¦åœ¨å£°æ˜é€šé“æ—¶æŒ‡å®šæ•°æ®ç±»å‹ã€‚æˆ‘ä»¬å¯ä»¥å…±äº«å†…ç½®ã€å‘½åã€ç»“æ„å’Œå¼•ç”¨ç±»å‹çš„å€¼å’ŒæŒ‡é’ˆã€‚æ•°æ®åœ¨é€šé“ä¸Šä¼ é€’ï¼šåœ¨
ä»»ä½•ç»™å®šæ—¶é—´åªæœ‰ä¸€ä¸ªgoroutineå¯ä»¥è®¿é—®æ•°æ®é¡¹ï¼šå› æ­¤æŒ‰ç…§è®¾è®¡ä¸ä¼šå‘ç”Ÿæ•°æ®ç«äº‰ã€‚</p>
<p>æ ¹æ®æ•°æ®äº¤æ¢çš„è¡Œä¸ºï¼Œæœ‰ä¸¤ç§ç±»å‹çš„é€šé“ï¼šæ— ç¼“å†²é€šé“å’Œç¼“å†²é€šé“ã€‚</p>
<p>æ— ç¼“å†²é€šé“ç”¨äºæ‰§è¡Œgoroutineä¹‹é—´çš„åŒæ­¥é€šä¿¡ï¼Œè€Œç¼“å†²é€šé“ç”¨äºæ‰§è¡Œå¼‚æ­¥é€šä¿¡ã€‚</p>
<p>æ— ç¼“å†²é€šé“ä¿è¯åœ¨å‘é€å’Œæ¥æ”¶å‘ç”Ÿçš„ç¬é—´æ‰§è¡Œä¸¤ä¸ªgoroutineä¹‹é—´çš„äº¤æ¢ã€‚ç¼“å†²é€šé“æ²¡æœ‰è¿™æ ·çš„ä¿è¯ã€‚</p>
<p>æ— ç¼“å†²é€šé“ï¼ˆUnbuffered Channelï¼‰å’Œç¼“å†²é€šé“ï¼ˆBuffered Channelï¼‰æ˜¯ Go è¯­è¨€ä¸­çš„ä¸¤ç§é€šé“ç±»å‹ï¼Œå®ƒä»¬åœ¨ä½¿ç”¨æ–¹å¼å’Œé€‚ç”¨åœºæ™¯ä¸Šæœ‰ä¸€äº›åŒºåˆ«ã€‚</p>
<ol>
<li>
<p><strong>æ— ç¼“å†²é€šé“ï¼š</strong></p>
<p>æ— ç¼“å†²é€šé“æ˜¯æŒ‡åœ¨å‘é€æ•°æ®åˆ°é€šé“æ—¶ï¼Œå‘é€æ–¹ä¼šè¢«é˜»å¡ç›´åˆ°æ¥æ”¶æ–¹æ¥æ”¶æ•°æ®ã€‚åŒæ ·ï¼Œåœ¨æ¥æ”¶æ•°æ®æ—¶ï¼Œæ¥æ”¶æ–¹ä¼šè¢«é˜»å¡ç›´åˆ°å‘é€æ–¹å‘é€æ•°æ®ã€‚è¿™ç§é€šé“ä¿è¯äº†æ•°æ®çš„åŒæ­¥ä¼ è¾“ï¼Œå‘é€å’Œæ¥æ”¶æ˜¯ç´§å¯†è€¦åˆçš„ã€‚æ— ç¼“å†²é€šé“çš„å£°æ˜æ–¹å¼ä¸º <code>make(chan T)</code>ã€‚</p>
<p><strong>é€‚ç”¨åœºæ™¯ï¼š</strong></p>
<ul>
<li>åœ¨å¹¶å‘ç¼–ç¨‹ä¸­ï¼Œç”¨äºåè°ƒä¸¤ä¸ª goroutine ä¹‹é—´çš„åŒæ­¥æ“ä½œã€‚</li>
<li>å½“ç¡®ä¿å‘é€æ–¹å’Œæ¥æ”¶æ–¹åŒæ­¥å·¥ä½œå¾ˆé‡è¦æ—¶ï¼Œå¯ä»¥ä½¿ç”¨æ— ç¼“å†²é€šé“ã€‚</li>
</ul>
</li>
<li>
<p><strong>ç¼“å†²é€šé“ï¼š</strong></p>
<p>ç¼“å†²é€šé“å…è®¸åœ¨é€šé“ä¸­å­˜å‚¨ä¸€å®šæ•°é‡çš„æ•°æ®ï¼Œå½“é€šé“ä¸­çš„æ•°æ®æ•°é‡è¾¾åˆ°ç¼“å†²åŒºå¤§å°æ—¶ï¼Œå‘é€æ–¹æ‰ä¼šè¢«é˜»å¡ã€‚åªæœ‰åœ¨é€šé“æ»¡äº†æ—¶ï¼Œå‘é€æ–¹æ‰ä¼šè¢«é˜»å¡ã€‚åŒæ ·ï¼Œå½“é€šé“ä¸­æ²¡æœ‰æ•°æ®æ—¶ï¼Œæ¥æ”¶æ–¹æ‰ä¼šè¢«é˜»å¡ã€‚ç¼“å†²é€šé“çš„å£°æ˜æ–¹å¼ä¸º <code>make(chan T, capacity)</code>ã€‚</p>
<p><strong>é€‚ç”¨åœºæ™¯ï¼š</strong></p>
<ul>
<li>åœ¨è§£è€¦å‘é€æ–¹å’Œæ¥æ”¶æ–¹çš„æƒ…å†µä¸‹ï¼Œå…è®¸å‘é€æ–¹å‘é€æ•°æ®åˆ°é€šé“ï¼Œç„¶åç»§ç»­æ‰§è¡Œå…¶ä»–æ“ä½œï¼Œè€Œä¸å¿…ç­‰å¾…æ¥æ”¶æ–¹ã€‚</li>
<li>åœ¨ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ç¼“å†²é€šé“æ¥å¹³è¡¡ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä¹‹é—´çš„é€Ÿåº¦å·®å¼‚</li>
</ul>
</li>
</ol>
<p>é€šé“ç”±<code>make</code>å‡½æ•°åˆ›å»ºï¼Œè¯¥å‡½æ•°æŒ‡å®šchanå…³é”®å­—å’Œé€šé“çš„å…ƒç´ ç±»å‹ã€‚</p>
<p>è¿™æ˜¯åˆ›å»ºæ— ç¼“å†²å’Œç¼“å†²é€šé“çš„ä»£ç å—ï¼š</p>
<p>è¯­æ³•</p>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>Unbuffered<span style="color:#ff6ac1">:=</span><span style="color:#ff5c57">make</span>(<span style="color:#ff5c57">chan</span> <span style="color:#9aedfe">int</span>)	<span style="color:#78787e">//æ•´å‹æ— ç¼“å†²é€šé“
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>buffered<span style="color:#ff6ac1">:=</span><span style="color:#ff5c57">make</span>(<span style="color:#ff5c57">chan</span> <span style="color:#9aedfe">int</span>,<span style="color:#ff9f43">10</span>)	<span style="color:#78787e">//æ•´å‹æœ‰ç¼“å†²é€šé“
</span></span></span></code></pre></div><p>ä½¿ç”¨å†…ç½®å‡½æ•°makeåˆ›å»ºæ— ç¼“å†²å’Œç¼“å†²é€šé“ã€‚</p>
<p>makeçš„ç¬¬ä¸€ä¸ªå‚æ•°éœ€è¦å…³é”®å­—chan,ç„¶åæ˜¯é€šé“å…è®¸äº¤æ¢çš„æ•°æ®ç±»å‹ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#ff6ac1">package</span> Base
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">import</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#5af78e">&#34;math/rand&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#5af78e">&#34;time&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">var</span> channel = <span style="color:#ff5c57">make</span>(<span style="color:#ff5c57">chan</span> <span style="color:#9aedfe">int</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">func</span> <span style="color:#57c7ff">send</span>() {
</span></span><span style="display:flex;"><span>	rand.<span style="color:#57c7ff">Seed</span>(time.<span style="color:#57c7ff">Now</span>().<span style="color:#57c7ff">UnixNano</span>())
</span></span><span style="display:flex;"><span>	random <span style="color:#ff6ac1">:=</span> rand.<span style="color:#57c7ff">Intn</span>(<span style="color:#ff9f43">10</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#ff5c57">println</span>(<span style="color:#5af78e">&#34;éšæœºå€¼ï¼š&#34;</span>, random)
</span></span><span style="display:flex;"><span>	time.<span style="color:#57c7ff">Sleep</span>(<span style="color:#ff9f43">2</span> <span style="color:#ff6ac1">*</span> time.Second)
</span></span><span style="display:flex;"><span>	channel <span style="color:#ff6ac1">&lt;-</span> random
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">func</span> <span style="color:#57c7ff">GoRoutine</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">defer</span> <span style="color:#ff5c57">close</span>(channel)
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">go</span> <span style="color:#57c7ff">send</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#ff5c57">println</span>(<span style="color:#5af78e">&#34;wait...&#34;</span>)
</span></span><span style="display:flex;"><span>	receive <span style="color:#ff6ac1">:=</span> <span style="color:#ff6ac1">&lt;-</span>channel
</span></span><span style="display:flex;"><span>	<span style="color:#ff5c57">println</span>(<span style="color:#5af78e">&#34;æ¥æ”¶å€¼ï¼š&#34;</span>, receive)
</span></span><span style="display:flex;"><span>	<span style="color:#ff5c57">println</span>(<span style="color:#5af78e">&#34;end...&#34;</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="channel-éå†">channel éå†<a hidden class="anchor" aria-hidden="true" href="#channel-éå†">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#ff6ac1">package</span> Base
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">func</span> <span style="color:#57c7ff">Channel</span>() {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	c <span style="color:#ff6ac1">:=</span> <span style="color:#ff5c57">make</span>(<span style="color:#ff5c57">chan</span> <span style="color:#9aedfe">int</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">go</span> <span style="color:#ff5c57">func</span>() {
</span></span><span style="display:flex;"><span>		<span style="color:#ff6ac1">for</span> i <span style="color:#ff6ac1">:=</span> <span style="color:#ff9f43">0</span>; i &lt; <span style="color:#ff9f43">5</span>; i<span style="color:#ff6ac1">++</span> {
</span></span><span style="display:flex;"><span>			c <span style="color:#ff6ac1">&lt;-</span> i
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		<span style="color:#ff5c57">close</span>(c)
</span></span><span style="display:flex;"><span>	}()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">for</span> v <span style="color:#ff6ac1">:=</span> <span style="color:#ff6ac1">range</span> c {
</span></span><span style="display:flex;"><span>		<span style="color:#ff5c57">println</span>(v)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="å¹¶å‘ç¼–ç¨‹-waitgroupå®ç°åŒæ­¥">å¹¶å‘ç¼–ç¨‹-&gt;WaitGroupå®ç°åŒæ­¥<a hidden class="anchor" aria-hidden="true" href="#å¹¶å‘ç¼–ç¨‹-waitgroupå®ç°åŒæ­¥">#</a></h2>
<p>æŸ¥çœ‹æ·»åŠ WaitGroupå’Œä¸æ·»åŠ WaitGroupçš„åŒºåˆ«</p>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#ff6ac1">package</span> Base
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">import</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#5af78e">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#5af78e">&#34;sync&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">var</span> wg sync.WaitGroup
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">func</span> <span style="color:#57c7ff">showMsg</span>(i <span style="color:#9aedfe">int</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">defer</span> wg.<span style="color:#57c7ff">Done</span>()
</span></span><span style="display:flex;"><span>	fmt.<span style="color:#57c7ff">Println</span>(i)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">func</span> <span style="color:#57c7ff">GoRoutine</span>() {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">for</span> i <span style="color:#ff6ac1">:=</span> <span style="color:#ff9f43">0</span>; i &lt; <span style="color:#ff9f43">10</span>; i<span style="color:#ff6ac1">++</span> {
</span></span><span style="display:flex;"><span>		wg.<span style="color:#57c7ff">Add</span>(<span style="color:#ff9f43">1</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#ff6ac1">go</span> <span style="color:#57c7ff">showMsg</span>(i)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	wg.<span style="color:#57c7ff">Wait</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#78787e">// StuData è¯·æ±‚å‚æ•°éªŒè¯ç»“æ„
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span><span style="color:#ff5c57">type</span> StuData <span style="color:#ff5c57">struct</span> {
</span></span><span style="display:flex;"><span>	File <span style="color:#ff6ac1">*</span>multipart.FileHeader <span style="color:#5af78e">`form:&#34;file&#34; binding:&#34;required&#34;`</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">func</span> <span style="color:#57c7ff">dealStuData</span>(row []<span style="color:#9aedfe">string</span>, buff <span style="color:#ff5c57">chan</span> <span style="color:#ff5c57">map</span>[<span style="color:#9aedfe">string</span>]<span style="color:#9aedfe">string</span>, wg <span style="color:#ff6ac1">*</span>sync.WaitGroup, userList <span style="color:#ff5c57">chan</span> <span style="color:#ff5c57">map</span>[<span style="color:#9aedfe">string</span>]<span style="color:#9aedfe">string</span>, errData <span style="color:#ff5c57">chan</span> []<span style="color:#9aedfe">string</span>) {
</span></span><span style="display:flex;"><span>	errMsg <span style="color:#ff6ac1">:=</span> <span style="color:#ff5c57">make</span>(<span style="color:#ff5c57">map</span>[<span style="color:#9aedfe">string</span>]<span style="color:#9aedfe">string</span>, <span style="color:#ff9f43">0</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#78787e">// ä¸èƒ½æäº¤ç©ºæ•°æ®
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>	<span style="color:#ff6ac1">for</span> _, val <span style="color:#ff6ac1">:=</span> <span style="color:#ff6ac1">range</span> row {
</span></span><span style="display:flex;"><span>		<span style="color:#ff6ac1">if</span> val <span style="color:#ff6ac1">==</span> <span style="color:#5af78e">&#34;&#34;</span> {
</span></span><span style="display:flex;"><span>			errMsg[<span style="color:#5af78e">&#34;name&#34;</span>] = row[common.EStuName]
</span></span><span style="display:flex;"><span>			errMsg[<span style="color:#5af78e">&#34;reason&#34;</span>] = <span style="color:#5af78e">&#34;æ•°æ®ä¸èƒ½ä¸ºç©º&#34;</span>
</span></span><span style="display:flex;"><span>			errData <span style="color:#ff6ac1">&lt;-</span> row
</span></span><span style="display:flex;"><span>			buff <span style="color:#ff6ac1">&lt;-</span> errMsg
</span></span><span style="display:flex;"><span>			wg.<span style="color:#57c7ff">Done</span>()
</span></span><span style="display:flex;"><span>			<span style="color:#ff6ac1">return</span>
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">if</span> row[common.EStuGender] <span style="color:#ff6ac1">!=</span> <span style="color:#5af78e">&#34;ç”·&#34;</span> <span style="color:#ff6ac1">&amp;&amp;</span> row[common.EStuGender] <span style="color:#ff6ac1">!=</span> <span style="color:#5af78e">&#34;å¥³&#34;</span> {
</span></span><span style="display:flex;"><span>		errMsg[<span style="color:#5af78e">&#34;name&#34;</span>] = row[common.EStuName]
</span></span><span style="display:flex;"><span>		errMsg[<span style="color:#5af78e">&#34;reason&#34;</span>] = <span style="color:#5af78e">&#34;æ€§åˆ«æ ¼å¼é”™è¯¯&#34;</span>
</span></span><span style="display:flex;"><span>		errData <span style="color:#ff6ac1">&lt;-</span> row
</span></span><span style="display:flex;"><span>		buff <span style="color:#ff6ac1">&lt;-</span> errMsg
</span></span><span style="display:flex;"><span>		wg.<span style="color:#57c7ff">Done</span>()
</span></span><span style="display:flex;"><span>		<span style="color:#ff6ac1">return</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#78787e">// æ¯”å¯¹å­¦é™¢ä»£ç æ˜¯å¦æ­£ç¡®
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>	org <span style="color:#ff6ac1">:=</span> common.Organization{}
</span></span><span style="display:flex;"><span>	err <span style="color:#ff6ac1">:=</span> org.<span style="color:#57c7ff">GetOrgByCode</span>(row[common.EStuCollegeCode])
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">if</span> err <span style="color:#ff6ac1">!=</span> <span style="color:#ff6ac1">nil</span> {
</span></span><span style="display:flex;"><span>		msg <span style="color:#ff6ac1">:=</span> fmt.<span style="color:#57c7ff">Sprintf</span>(<span style="color:#5af78e">&#34;æŸ¥è¯¢ç›®æ ‡å­¦é™¢ä»£ç é”™è¯¯:%v&#34;</span>, err)
</span></span><span style="display:flex;"><span>		logger.<span style="color:#57c7ff">Error</span>(msg)
</span></span><span style="display:flex;"><span>		errMsg[<span style="color:#5af78e">&#34;name&#34;</span>] = row[common.EStuName]
</span></span><span style="display:flex;"><span>		errMsg[<span style="color:#5af78e">&#34;reason&#34;</span>] = msg
</span></span><span style="display:flex;"><span>		errData <span style="color:#ff6ac1">&lt;-</span> row
</span></span><span style="display:flex;"><span>		buff <span style="color:#ff6ac1">&lt;-</span> errMsg
</span></span><span style="display:flex;"><span>		wg.<span style="color:#57c7ff">Done</span>()
</span></span><span style="display:flex;"><span>		<span style="color:#ff6ac1">return</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">if</span> errors.<span style="color:#57c7ff">Is</span>(err, sql.ErrNoRows) <span style="color:#ff6ac1">||</span> org.Name <span style="color:#ff6ac1">!=</span> row[common.EStuCollege] {
</span></span><span style="display:flex;"><span>		<span style="color:#ff5c57">var</span> msg <span style="color:#9aedfe">string</span>
</span></span><span style="display:flex;"><span>		<span style="color:#ff6ac1">if</span> org.Code <span style="color:#ff6ac1">!=</span> <span style="color:#5af78e">&#34;&#34;</span> {
</span></span><span style="display:flex;"><span>			msg = fmt.<span style="color:#57c7ff">Sprintf</span>(<span style="color:#5af78e">&#34;åŒä¸€ä¸ªå­¦é™¢å‡ºç°ä¸åŒçš„å­¦é™¢ä»£ç ï¼šæ­£ç¡®ï¼šã€%v,%vã€‘ï¼Œé”™è¯¯ï¼šã€%v,%vã€‘&#34;</span>, org.Code, org.Name, row[common.EStuCollegeCode], row[common.EStuCollege])
</span></span><span style="display:flex;"><span>		} <span style="color:#ff6ac1">else</span> {
</span></span><span style="display:flex;"><span>			msg = fmt.<span style="color:#57c7ff">Sprintf</span>(<span style="color:#5af78e">&#34;ä¸å­˜åœ¨ä»£ç ä¸ºï¼š%vçš„å­¦é™¢&#34;</span>, row[common.EStuCollegeCode])
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		logger.<span style="color:#57c7ff">Error</span>(msg)
</span></span><span style="display:flex;"><span>		errMsg[<span style="color:#5af78e">&#34;name&#34;</span>] = row[common.EStuName]
</span></span><span style="display:flex;"><span>		errMsg[<span style="color:#5af78e">&#34;reason&#34;</span>] = msg
</span></span><span style="display:flex;"><span>		errData <span style="color:#ff6ac1">&lt;-</span> row
</span></span><span style="display:flex;"><span>		buff <span style="color:#ff6ac1">&lt;-</span> errMsg
</span></span><span style="display:flex;"><span>		wg.<span style="color:#57c7ff">Done</span>()
</span></span><span style="display:flex;"><span>		<span style="color:#ff6ac1">return</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	ab <span style="color:#ff6ac1">:=</span> common.AddrBook{}
</span></span><span style="display:flex;"><span>	<span style="color:#78787e">// é€šè¿‡åŒæ­¥ç³»ç»Ÿæ•°æ®åº“æŸ¥çœ‹ä¼ä¸šå¾®ä¿¡ä¸­æ˜¯å¦æœ‰å¯¹åº”çš„å­¦é™¢éƒ¨é—¨
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>	collegeDep, err <span style="color:#ff6ac1">:=</span> ab.<span style="color:#57c7ff">GetDepByDbID</span>(row[common.EStuCollegeCode], row[common.EStuLevel])
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">if</span> err <span style="color:#ff6ac1">!=</span> <span style="color:#ff6ac1">nil</span> <span style="color:#ff6ac1">&amp;&amp;</span> !errors.<span style="color:#57c7ff">Is</span>(err, sql.ErrNoRows) {
</span></span><span style="display:flex;"><span>		msg <span style="color:#ff6ac1">:=</span> fmt.<span style="color:#57c7ff">Sprintf</span>(<span style="color:#5af78e">&#34;æŸ¥è¯¢åŒæ­¥ç³»ç»Ÿåº“å¤±è´¥:%s&#34;</span>, err.<span style="color:#57c7ff">Error</span>())
</span></span><span style="display:flex;"><span>		logger.<span style="color:#57c7ff">Error</span>(msg)
</span></span><span style="display:flex;"><span>		errMsg[<span style="color:#5af78e">&#34;name&#34;</span>] = row[common.EStuName]
</span></span><span style="display:flex;"><span>		errMsg[<span style="color:#5af78e">&#34;reason&#34;</span>] = msg
</span></span><span style="display:flex;"><span>		errData <span style="color:#ff6ac1">&lt;-</span> row
</span></span><span style="display:flex;"><span>		buff <span style="color:#ff6ac1">&lt;-</span> errMsg
</span></span><span style="display:flex;"><span>		wg.<span style="color:#57c7ff">Done</span>()
</span></span><span style="display:flex;"><span>		<span style="color:#ff6ac1">return</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#78787e">// å¦‚æœå¯¹åº”å­¦é™¢éƒ¨é—¨ä¸å­˜åœ¨
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>	<span style="color:#ff6ac1">if</span> errors.<span style="color:#57c7ff">Is</span>(err, sql.ErrNoRows) {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		parentDepid, _ <span style="color:#ff6ac1">:=</span> strconv.<span style="color:#57c7ff">Atoi</span>(pid[row[common.EStuLevel]])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		depid, err <span style="color:#ff6ac1">:=</span> ab.<span style="color:#57c7ff">GetAndUpdateConf</span>()
</span></span><span style="display:flex;"><span>		<span style="color:#ff6ac1">if</span> err <span style="color:#ff6ac1">!=</span> <span style="color:#ff6ac1">nil</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#78787e">// TODO æ•°æ®åº“å¼‚å¸¸æ¦‚ç‡å°ï¼Œæ•…ç›´æ¥è¿”å›500
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>			logger.<span style="color:#57c7ff">Error</span>(err.<span style="color:#57c7ff">Error</span>())
</span></span><span style="display:flex;"><span>			errMsg[<span style="color:#5af78e">&#34;name&#34;</span>] = row[common.EStuName]
</span></span><span style="display:flex;"><span>			errMsg[<span style="color:#5af78e">&#34;reason&#34;</span>] = err.<span style="color:#57c7ff">Error</span>()
</span></span><span style="display:flex;"><span>			errData <span style="color:#ff6ac1">&lt;-</span> row
</span></span><span style="display:flex;"><span>			buff <span style="color:#ff6ac1">&lt;-</span> errMsg
</span></span><span style="display:flex;"><span>			wg.<span style="color:#57c7ff">Done</span>()
</span></span><span style="display:flex;"><span>			<span style="color:#ff6ac1">return</span>
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#78787e">// TODO åœ¨ä¼ä¸šå¾®ä¿¡ä¸­æ–°å»ºå­¦é™¢éƒ¨é—¨
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>		err = Wxapi.<span style="color:#57c7ff">CreateDept</span>(row[common.EStuCollege], <span style="color:#ff5c57">int64</span>(parentDepid), depid, depid)
</span></span><span style="display:flex;"><span>		<span style="color:#ff6ac1">if</span> err <span style="color:#ff6ac1">!=</span> <span style="color:#ff6ac1">nil</span> {
</span></span><span style="display:flex;"><span>			logger.<span style="color:#57c7ff">Error</span>(fmt.<span style="color:#57c7ff">Sprintf</span>(<span style="color:#5af78e">&#34;æ–°å»ºå­¦é™¢éƒ¨é—¨å¤±è´¥: %s,é”™è¯¯æ•°æ®ä¸º:[%s],&#34;</span>, err.<span style="color:#57c7ff">Error</span>(), strings.<span style="color:#57c7ff">Join</span>(row, <span style="color:#5af78e">&#34;,&#34;</span>)))
</span></span><span style="display:flex;"><span>			errMsg[<span style="color:#5af78e">&#34;name&#34;</span>] = row[common.EStuName]
</span></span><span style="display:flex;"><span>			errMsg[<span style="color:#5af78e">&#34;reason&#34;</span>] = err.<span style="color:#57c7ff">Error</span>()
</span></span><span style="display:flex;"><span>			errData <span style="color:#ff6ac1">&lt;-</span> row
</span></span><span style="display:flex;"><span>			buff <span style="color:#ff6ac1">&lt;-</span> errMsg
</span></span><span style="display:flex;"><span>			wg.<span style="color:#57c7ff">Done</span>()
</span></span><span style="display:flex;"><span>			<span style="color:#ff6ac1">return</span>
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		collegeDep.WxName = row[common.EStuCollege]
</span></span><span style="display:flex;"><span>		collegeDep.WxParentID = pid[row[common.EStuLevel]]
</span></span><span style="display:flex;"><span>		collegeDep.WxCollegeID = <span style="color:#5af78e">&#34;None&#34;</span>
</span></span><span style="display:flex;"><span>		collegeDep.DbID = row[common.EStuCollegeCode]
</span></span><span style="display:flex;"><span>		collegeDep.Grade = <span style="color:#5af78e">&#34;None&#34;</span>
</span></span><span style="display:flex;"><span>		collegeDep.WxGrade = <span style="color:#5af78e">&#34;None&#34;</span>
</span></span><span style="display:flex;"><span>		collegeDep.Level = <span style="color:#ff9f43">3</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#78787e">// TODO å°†éƒ¨é—¨ä¿¡æ¯å†™å…¥æ•°æ®åº“
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>		err = ab.<span style="color:#57c7ff">NewDep</span>(<span style="color:#ff6ac1">&amp;</span>collegeDep, row[common.EStuLevel], depid)
</span></span><span style="display:flex;"><span>		<span style="color:#ff6ac1">if</span> err <span style="color:#ff6ac1">!=</span> <span style="color:#ff6ac1">nil</span> {
</span></span><span style="display:flex;"><span>			msg <span style="color:#ff6ac1">:=</span> fmt.<span style="color:#57c7ff">Sprintf</span>(<span style="color:#5af78e">&#34;å°†éƒ¨é—¨ä¿¡æ¯å†™å…¥æ•°æ®åº“å¤±è´¥: %s,&#34;</span>, err.<span style="color:#57c7ff">Error</span>())
</span></span><span style="display:flex;"><span>			logger.<span style="color:#57c7ff">Error</span>(msg)
</span></span><span style="display:flex;"><span>			<span style="color:#78787e">// TODO åˆ é™¤åˆ›å»ºçš„éƒ¨é—¨
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>			err <span style="color:#ff6ac1">:=</span> Wxapi.<span style="color:#57c7ff">DelDept</span>(depid)
</span></span><span style="display:flex;"><span>			<span style="color:#ff6ac1">if</span> err <span style="color:#ff6ac1">!=</span> <span style="color:#ff6ac1">nil</span> {
</span></span><span style="display:flex;"><span>				logger.<span style="color:#57c7ff">Error</span>(fmt.<span style="color:#57c7ff">Sprintf</span>(<span style="color:#5af78e">&#34;åˆ é™¤éƒ¨é—¨å¤±è´¥ï¼š%s&#34;</span>, err.<span style="color:#57c7ff">Error</span>()))
</span></span><span style="display:flex;"><span>			}
</span></span><span style="display:flex;"><span>			errMsg[<span style="color:#5af78e">&#34;name&#34;</span>] = row[common.EStuName]
</span></span><span style="display:flex;"><span>			errMsg[<span style="color:#5af78e">&#34;reason&#34;</span>] = msg
</span></span><span style="display:flex;"><span>			errData <span style="color:#ff6ac1">&lt;-</span> row
</span></span><span style="display:flex;"><span>			buff <span style="color:#ff6ac1">&lt;-</span> errMsg
</span></span><span style="display:flex;"><span>			wg.<span style="color:#57c7ff">Done</span>()
</span></span><span style="display:flex;"><span>			<span style="color:#ff6ac1">return</span>
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#78787e">// é€šè¿‡åŒæ­¥ç³»ç»Ÿæ•°æ®åº“æŸ¥çœ‹ä¼ä¸šå¾®ä¿¡ä¸­æ˜¯å¦æœ‰å¯¹åº”çš„å¹´çº§éƒ¨é—¨
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>	gradeDep, err <span style="color:#ff6ac1">:=</span> ab.<span style="color:#57c7ff">GetDepByParentIdAndName</span>(collegeDep.WxID, row[common.EStuGrade], row[common.EStuLevel])
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">if</span> err <span style="color:#ff6ac1">!=</span> <span style="color:#ff6ac1">nil</span> <span style="color:#ff6ac1">&amp;&amp;</span> !errors.<span style="color:#57c7ff">Is</span>(err, sql.ErrNoRows) {
</span></span><span style="display:flex;"><span>		msg <span style="color:#ff6ac1">:=</span> fmt.<span style="color:#57c7ff">Sprintf</span>(<span style="color:#5af78e">&#34;æŸ¥è¯¢åŒæ­¥æ•°æ®åº“å¤±è´¥: %s&#34;</span>, err.<span style="color:#57c7ff">Error</span>())
</span></span><span style="display:flex;"><span>		logger.<span style="color:#57c7ff">Error</span>(msg)
</span></span><span style="display:flex;"><span>		errMsg[<span style="color:#5af78e">&#34;name&#34;</span>] = row[common.EStuName]
</span></span><span style="display:flex;"><span>		errMsg[<span style="color:#5af78e">&#34;reason&#34;</span>] = msg
</span></span><span style="display:flex;"><span>		errData <span style="color:#ff6ac1">&lt;-</span> row
</span></span><span style="display:flex;"><span>		buff <span style="color:#ff6ac1">&lt;-</span> errMsg
</span></span><span style="display:flex;"><span>		wg.<span style="color:#57c7ff">Done</span>()
</span></span><span style="display:flex;"><span>		<span style="color:#ff6ac1">return</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#78787e">// å¦‚æœå¹´çº§éƒ¨é—¨ä¸å­˜åœ¨
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>	<span style="color:#ff6ac1">if</span> errors.<span style="color:#57c7ff">Is</span>(err, sql.ErrNoRows) {
</span></span><span style="display:flex;"><span>		parentId, _ <span style="color:#ff6ac1">:=</span> strconv.<span style="color:#57c7ff">Atoi</span>(collegeDep.WxID)
</span></span><span style="display:flex;"><span>		depid, err <span style="color:#ff6ac1">:=</span> ab.<span style="color:#57c7ff">GetAndUpdateConf</span>()
</span></span><span style="display:flex;"><span>		<span style="color:#ff6ac1">if</span> err <span style="color:#ff6ac1">!=</span> <span style="color:#ff6ac1">nil</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#78787e">// TODO æ•°æ®åº“å¼‚å¸¸æ¦‚ç‡å°ï¼Œæ•…ç›´æ¥è¿”å›500
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>			logger.<span style="color:#57c7ff">Error</span>(fmt.<span style="color:#57c7ff">Sprintf</span>(<span style="color:#5af78e">&#34;æŸ¥è¯¢åŒæ­¥æ•°æ®åº“å¤±è´¥:%s&#34;</span>, err.<span style="color:#57c7ff">Error</span>()))
</span></span><span style="display:flex;"><span>			errMsg[<span style="color:#5af78e">&#34;name&#34;</span>] = row[common.EStuName]
</span></span><span style="display:flex;"><span>			errMsg[<span style="color:#5af78e">&#34;reason&#34;</span>] = err.<span style="color:#57c7ff">Error</span>()
</span></span><span style="display:flex;"><span>			errData <span style="color:#ff6ac1">&lt;-</span> row
</span></span><span style="display:flex;"><span>			buff <span style="color:#ff6ac1">&lt;-</span> errMsg
</span></span><span style="display:flex;"><span>			wg.<span style="color:#57c7ff">Done</span>()
</span></span><span style="display:flex;"><span>			<span style="color:#ff6ac1">return</span>
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		<span style="color:#78787e">// TODO åœ¨ä¼ä¸šå¾®ä¿¡ä¸­æ–°å»ºå¹´çº§éƒ¨é—¨
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>		err = Wxapi.<span style="color:#57c7ff">CreateDept</span>(row[common.EStuGrade], <span style="color:#ff5c57">int64</span>(parentId), depid, depid)
</span></span><span style="display:flex;"><span>		<span style="color:#ff6ac1">if</span> err <span style="color:#ff6ac1">!=</span> <span style="color:#ff6ac1">nil</span> {
</span></span><span style="display:flex;"><span>			logger.<span style="color:#57c7ff">Error</span>(fmt.<span style="color:#57c7ff">Sprintf</span>(<span style="color:#5af78e">&#34;æ–°å»ºå¹´çº§éƒ¨é—¨å¤±è´¥: %s&#34;</span>, err.<span style="color:#57c7ff">Error</span>()))
</span></span><span style="display:flex;"><span>			errMsg[<span style="color:#5af78e">&#34;name&#34;</span>] = row[common.EStuName]
</span></span><span style="display:flex;"><span>			errMsg[<span style="color:#5af78e">&#34;reason&#34;</span>] = err.<span style="color:#57c7ff">Error</span>()
</span></span><span style="display:flex;"><span>			errData <span style="color:#ff6ac1">&lt;-</span> row
</span></span><span style="display:flex;"><span>			buff <span style="color:#ff6ac1">&lt;-</span> errMsg
</span></span><span style="display:flex;"><span>			wg.<span style="color:#57c7ff">Done</span>()
</span></span><span style="display:flex;"><span>			<span style="color:#ff6ac1">return</span>
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		gradeDep.WxName = row[common.EStuGrade]
</span></span><span style="display:flex;"><span>		gradeDep.WxParentID = collegeDep.WxID
</span></span><span style="display:flex;"><span>		gradeDep.WxCollegeID = collegeDep.WxID
</span></span><span style="display:flex;"><span>		gradeDep.DbID = <span style="color:#5af78e">&#34;None&#34;</span>
</span></span><span style="display:flex;"><span>		gradeDep.Grade = <span style="color:#5af78e">&#34;None&#34;</span>
</span></span><span style="display:flex;"><span>		gradeDep.WxGrade = <span style="color:#5af78e">&#34;None&#34;</span>
</span></span><span style="display:flex;"><span>		gradeDep.Level = collegeDep.Level <span style="color:#ff6ac1">+</span> <span style="color:#ff9f43">1</span>
</span></span><span style="display:flex;"><span>		<span style="color:#78787e">// TODO å°†éƒ¨é—¨ä¿¡æ¯å†™å…¥æ•°æ®åº“
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>		err = ab.<span style="color:#57c7ff">NewDep</span>(<span style="color:#ff6ac1">&amp;</span>gradeDep, row[common.EStuLevel], depid)
</span></span><span style="display:flex;"><span>		<span style="color:#ff6ac1">if</span> err <span style="color:#ff6ac1">!=</span> <span style="color:#ff6ac1">nil</span> {
</span></span><span style="display:flex;"><span>			msg <span style="color:#ff6ac1">:=</span> fmt.<span style="color:#57c7ff">Sprintf</span>(<span style="color:#5af78e">&#34;å°†éƒ¨é—¨ä¿¡æ¯å†™å…¥æ•°æ®åº“å¤±è´¥: %s,&#34;</span>, err.<span style="color:#57c7ff">Error</span>())
</span></span><span style="display:flex;"><span>			logger.<span style="color:#57c7ff">Error</span>(msg)
</span></span><span style="display:flex;"><span>			errMsg[<span style="color:#5af78e">&#34;name&#34;</span>] = row[common.EStuName]
</span></span><span style="display:flex;"><span>			errMsg[<span style="color:#5af78e">&#34;reason&#34;</span>] = msg
</span></span><span style="display:flex;"><span>			errData <span style="color:#ff6ac1">&lt;-</span> row
</span></span><span style="display:flex;"><span>			buff <span style="color:#ff6ac1">&lt;-</span> errMsg
</span></span><span style="display:flex;"><span>			wg.<span style="color:#57c7ff">Done</span>()
</span></span><span style="display:flex;"><span>			<span style="color:#ff6ac1">return</span>
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#78787e">// å…ˆæŸ¥è¯¢æ˜¯å¦æœ‰è¯¥æ–°ç”Ÿæ•°æ®
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>	bts <span style="color:#ff6ac1">:=</span> common.TStudent{}
</span></span><span style="display:flex;"><span>	err1 <span style="color:#ff6ac1">:=</span> bts.<span style="color:#57c7ff">QueryStudentByIdCard</span>(row[common.EStuIdCard])
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">if</span> err1 <span style="color:#ff6ac1">!=</span> <span style="color:#ff6ac1">nil</span> <span style="color:#ff6ac1">&amp;&amp;</span> !errors.<span style="color:#57c7ff">Is</span>(err1, gorm.ErrRecordNotFound) {
</span></span><span style="display:flex;"><span>		msg <span style="color:#ff6ac1">:=</span> fmt.<span style="color:#57c7ff">Sprintf</span>(<span style="color:#5af78e">&#34;æŸ¥è¯¢å­¦ç”Ÿä¿¡æ¯é”™è¯¯:%s&#34;</span>, err)
</span></span><span style="display:flex;"><span>		logger.<span style="color:#57c7ff">Error</span>(msg)
</span></span><span style="display:flex;"><span>		errMsg[<span style="color:#5af78e">&#34;name&#34;</span>] = row[common.EStuName]
</span></span><span style="display:flex;"><span>		errMsg[<span style="color:#5af78e">&#34;reason&#34;</span>] = msg
</span></span><span style="display:flex;"><span>		errData <span style="color:#ff6ac1">&lt;-</span> row
</span></span><span style="display:flex;"><span>		buff <span style="color:#ff6ac1">&lt;-</span> errMsg
</span></span><span style="display:flex;"><span>		wg.<span style="color:#57c7ff">Done</span>()
</span></span><span style="display:flex;"><span>		<span style="color:#ff6ac1">return</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#78787e">// å½•å…¥æ–°ç”Ÿæ•°æ®
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>	ts <span style="color:#ff6ac1">:=</span> common.TStudent{
</span></span><span style="display:flex;"><span>		Name:        row[common.EStuName],
</span></span><span style="display:flex;"><span>		IdCard:      row[common.EStuIdCard],
</span></span><span style="display:flex;"><span>		StuId:       row[common.EStuStuId],
</span></span><span style="display:flex;"><span>		Gender:      WxGender[row[common.EStuGender]],
</span></span><span style="display:flex;"><span>		Birthday:    row[common.EStuBirth],
</span></span><span style="display:flex;"><span>		College:     row[common.EStuCollege],
</span></span><span style="display:flex;"><span>		CollegeCode: row[common.EStuCollegeCode],
</span></span><span style="display:flex;"><span>		Grade:       row[common.EStuGrade],
</span></span><span style="display:flex;"><span>		Level:       row[common.EStuLevel],
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	curUser <span style="color:#ff6ac1">:=</span> <span style="color:#ff5c57">make</span>(<span style="color:#ff5c57">map</span>[<span style="color:#9aedfe">string</span>]<span style="color:#9aedfe">string</span>, <span style="color:#ff9f43">0</span>)
</span></span><span style="display:flex;"><span>	curUser[<span style="color:#5af78e">&#34;name&#34;</span>] = row[common.EStuName]
</span></span><span style="display:flex;"><span>	curUser[<span style="color:#5af78e">&#34;idcard&#34;</span>] = row[common.EStuIdCard]
</span></span><span style="display:flex;"><span>	curUser[<span style="color:#5af78e">&#34;stu_id&#34;</span>] = row[common.EStuStuId]
</span></span><span style="display:flex;"><span>	curUser[<span style="color:#5af78e">&#34;gender&#34;</span>] = WxGender[row[common.EStuGender]]
</span></span><span style="display:flex;"><span>	curUser[<span style="color:#5af78e">&#34;birth&#34;</span>] = row[common.EStuBirth]
</span></span><span style="display:flex;"><span>	curUser[<span style="color:#5af78e">&#34;college&#34;</span>] = row[common.EStuCollege]
</span></span><span style="display:flex;"><span>	curUser[<span style="color:#5af78e">&#34;college_code&#34;</span>] = row[common.EStuCollegeCode]
</span></span><span style="display:flex;"><span>	curUser[<span style="color:#5af78e">&#34;grade&#34;</span>] = row[common.EStuGrade]
</span></span><span style="display:flex;"><span>	curUser[<span style="color:#5af78e">&#34;level&#34;</span>] = row[common.EStuLevel]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	exist <span style="color:#ff6ac1">:=</span> <span style="color:#ff6ac1">false</span>
</span></span><span style="display:flex;"><span>	<span style="color:#78787e">// å¦‚æœå·²æœ‰ä¿¡æ¯
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>	<span style="color:#ff6ac1">if</span> err1 <span style="color:#ff6ac1">==</span> <span style="color:#ff6ac1">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#ff6ac1">if</span> bts.Status <span style="color:#ff6ac1">==</span> <span style="color:#5af78e">&#34;å·²æ ¸éªŒ&#34;</span> {
</span></span><span style="display:flex;"><span>			errMsg[<span style="color:#5af78e">&#34;name&#34;</span>] = row[common.EStuName]
</span></span><span style="display:flex;"><span>			errMsg[<span style="color:#5af78e">&#34;reason&#34;</span>] = <span style="color:#5af78e">&#34;success&#34;</span>
</span></span><span style="display:flex;"><span>			buff <span style="color:#ff6ac1">&lt;-</span> errMsg
</span></span><span style="display:flex;"><span>			wg.<span style="color:#57c7ff">Done</span>()
</span></span><span style="display:flex;"><span>			<span style="color:#ff6ac1">return</span>
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		err <span style="color:#ff6ac1">:=</span> ts.<span style="color:#57c7ff">UpdateStudentByIdCard</span>(ts.IdCard)
</span></span><span style="display:flex;"><span>		<span style="color:#ff6ac1">if</span> err <span style="color:#ff6ac1">!=</span> <span style="color:#ff6ac1">nil</span> {
</span></span><span style="display:flex;"><span>			msg <span style="color:#ff6ac1">:=</span> fmt.<span style="color:#57c7ff">Sprintf</span>(<span style="color:#5af78e">&#34;ä¿®æ”¹å­¦ç”Ÿä¿¡æ¯å¤±è´¥:%s,é”™è¯¯æ•°æ®:[%s]&#34;</span>, err, strings.<span style="color:#57c7ff">Join</span>(row, <span style="color:#5af78e">&#34;,&#34;</span>))
</span></span><span style="display:flex;"><span>			logger.<span style="color:#57c7ff">Error</span>(msg)
</span></span><span style="display:flex;"><span>			errMsg[<span style="color:#5af78e">&#34;name&#34;</span>] = row[common.EStuName]
</span></span><span style="display:flex;"><span>			errMsg[<span style="color:#5af78e">&#34;reason&#34;</span>] = msg
</span></span><span style="display:flex;"><span>			errData <span style="color:#ff6ac1">&lt;-</span> row
</span></span><span style="display:flex;"><span>			buff <span style="color:#ff6ac1">&lt;-</span> errMsg
</span></span><span style="display:flex;"><span>			wg.<span style="color:#57c7ff">Done</span>()
</span></span><span style="display:flex;"><span>			<span style="color:#ff6ac1">return</span>
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		exist = <span style="color:#ff6ac1">true</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#78787e">//TODO åˆ¤æ–­ä¸­é—´åº“ä¸­æ˜¯å¦æœ‰è¯¥ç ”ç©¶ç”Ÿçš„ä¿¡æ¯ï¼ˆè¦ä»ä¸­é—´åº“ä¸­æœ¬ç§‘ç”Ÿï¼Œç ”ç©¶ç”Ÿï¼Œæ•™èŒå·¥è¡¨ä¸­æŸ¥è¯¢ï¼‰
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>	<span style="color:#ff6ac1">if</span> row[common.EStuLevel] <span style="color:#ff6ac1">!=</span> <span style="color:#5af78e">&#34;æœ¬ç§‘ç”Ÿ&#34;</span> {
</span></span><span style="display:flex;"><span>		pgStu <span style="color:#ff6ac1">:=</span> common.PGStudent{}
</span></span><span style="display:flex;"><span>		originPosition, err2 <span style="color:#ff6ac1">:=</span> pgStu.<span style="color:#57c7ff">GetStudentByIdCard</span>(row[common.EStuIdCard])
</span></span><span style="display:flex;"><span>		<span style="color:#ff6ac1">if</span> err2 <span style="color:#ff6ac1">!=</span> <span style="color:#ff6ac1">nil</span> <span style="color:#ff6ac1">&amp;&amp;</span> !errors.<span style="color:#57c7ff">Is</span>(err2, sql.ErrNoRows) {
</span></span><span style="display:flex;"><span>			logger.<span style="color:#57c7ff">Error</span>(fmt.<span style="color:#57c7ff">Sprintf</span>(<span style="color:#5af78e">&#34;ä¸­é—´åº“æ“ä½œé”™è¯¯ï¼š%s&#34;</span>, err2))
</span></span><span style="display:flex;"><span>			errMsg[<span style="color:#5af78e">&#34;name&#34;</span>] = row[common.EStuName]
</span></span><span style="display:flex;"><span>			errMsg[<span style="color:#5af78e">&#34;reason&#34;</span>] = err2.<span style="color:#57c7ff">Error</span>()
</span></span><span style="display:flex;"><span>			errData <span style="color:#ff6ac1">&lt;-</span> row
</span></span><span style="display:flex;"><span>			buff <span style="color:#ff6ac1">&lt;-</span> errMsg
</span></span><span style="display:flex;"><span>			wg.<span style="color:#57c7ff">Done</span>()
</span></span><span style="display:flex;"><span>			<span style="color:#ff6ac1">return</span>
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		<span style="color:#78787e">// TODO å¦‚æœè¯¥ç ”ç©¶ç”Ÿä¿¡æ¯åœ¨ä¸­é—´åº“ä¸­å­˜åœ¨
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>		<span style="color:#ff6ac1">if</span> err2 <span style="color:#ff6ac1">==</span> <span style="color:#ff6ac1">nil</span> {
</span></span><span style="display:flex;"><span>			user, err3 <span style="color:#ff6ac1">:=</span> Wxapi.<span style="color:#57c7ff">GetUser</span>(pgStu.StuID)
</span></span><span style="display:flex;"><span>			<span style="color:#ff6ac1">if</span> err3 <span style="color:#ff6ac1">!=</span> <span style="color:#ff6ac1">nil</span> {
</span></span><span style="display:flex;"><span>				msg <span style="color:#ff6ac1">:=</span> fmt.<span style="color:#57c7ff">Sprintf</span>(<span style="color:#5af78e">&#34;åœ¨ä¼ä¸šå¾®ä¿¡ä¸­è·å–ç ”ç©¶ç”Ÿ:%s çš„ä¿¡æ¯å¤±è´¥,ERROR:%s&#34;</span>, pgStu.Name, err3.<span style="color:#57c7ff">Error</span>())
</span></span><span style="display:flex;"><span>				logger.<span style="color:#57c7ff">Error</span>(msg)
</span></span><span style="display:flex;"><span>				errMsg[<span style="color:#5af78e">&#34;name&#34;</span>] = row[common.EStuName]
</span></span><span style="display:flex;"><span>				errMsg[<span style="color:#5af78e">&#34;reason&#34;</span>] = msg
</span></span><span style="display:flex;"><span>				errData <span style="color:#ff6ac1">&lt;-</span> row
</span></span><span style="display:flex;"><span>				buff <span style="color:#ff6ac1">&lt;-</span> errMsg
</span></span><span style="display:flex;"><span>				wg.<span style="color:#57c7ff">Done</span>()
</span></span><span style="display:flex;"><span>				<span style="color:#ff6ac1">return</span>
</span></span><span style="display:flex;"><span>			}
</span></span><span style="display:flex;"><span>			<span style="color:#ff5c57">var</span> depid []<span style="color:#9aedfe">int64</span>
</span></span><span style="display:flex;"><span>			d, _ <span style="color:#ff6ac1">:=</span> strconv.<span style="color:#57c7ff">Atoi</span>(gradeDep.WxID)
</span></span><span style="display:flex;"><span>			<span style="color:#ff6ac1">for</span> _, val <span style="color:#ff6ac1">:=</span> <span style="color:#ff6ac1">range</span> user.Departments {
</span></span><span style="display:flex;"><span>				<span style="color:#ff6ac1">if</span> val.DeptID <span style="color:#ff6ac1">!=</span> <span style="color:#ff5c57">int64</span>(d) {
</span></span><span style="display:flex;"><span>					depid = <span style="color:#ff5c57">append</span>(depid, val.DeptID)
</span></span><span style="display:flex;"><span>				}
</span></span><span style="display:flex;"><span>			}
</span></span><span style="display:flex;"><span>			<span style="color:#78787e">// TODO ç»™ä¼ä¸šå¾®ä¿¡ä¸­å­˜åœ¨æ•°æ®çš„ç ”ç©¶ç”Ÿæ·»åŠ æ–°éƒ¨é—¨
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>			depid = <span style="color:#ff5c57">append</span>(depid, <span style="color:#ff5c57">int64</span>(d))
</span></span><span style="display:flex;"><span>			extattr <span style="color:#ff6ac1">:=</span> user.Extattr
</span></span><span style="display:flex;"><span>			err4 <span style="color:#ff6ac1">:=</span> Wxapi.<span style="color:#57c7ff">UpdateUser</span>(pgStu.StuID, pgStu.Name, depid, WxGender[row[common.EStuGender]], extattr)
</span></span><span style="display:flex;"><span>			<span style="color:#ff6ac1">if</span> err4 <span style="color:#ff6ac1">!=</span> <span style="color:#ff6ac1">nil</span> {
</span></span><span style="display:flex;"><span>				msg <span style="color:#ff6ac1">:=</span> fmt.<span style="color:#57c7ff">Sprintf</span>(<span style="color:#5af78e">&#34;æ›´æ–°å·²æœ‰ç ”ç©¶ç”Ÿéƒ¨é—¨å¤±è´¥:%s&#34;</span>, err4.<span style="color:#57c7ff">Error</span>())
</span></span><span style="display:flex;"><span>				logger.<span style="color:#57c7ff">Error</span>(msg)
</span></span><span style="display:flex;"><span>				errMsg[<span style="color:#5af78e">&#34;name&#34;</span>] = row[common.EStuName]
</span></span><span style="display:flex;"><span>				errMsg[<span style="color:#5af78e">&#34;reason&#34;</span>] = msg
</span></span><span style="display:flex;"><span>				errData <span style="color:#ff6ac1">&lt;-</span> row
</span></span><span style="display:flex;"><span>				buff <span style="color:#ff6ac1">&lt;-</span> errMsg
</span></span><span style="display:flex;"><span>				wg.<span style="color:#57c7ff">Done</span>()
</span></span><span style="display:flex;"><span>				<span style="color:#ff6ac1">return</span>
</span></span><span style="display:flex;"><span>			}
</span></span><span style="display:flex;"><span>			ts.Status = <span style="color:#5af78e">&#34;å·²æ ¸éªŒ&#34;</span>
</span></span><span style="display:flex;"><span>			ts.InMidDb = <span style="color:#5af78e">&#34;y&#34;</span> <span style="color:#78787e">//è®°å½•è¯¥æˆå‘˜ä¿¡æ¯åœ¨ä¸­é—´åº“ä¸­å­˜åœ¨
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>			ts.OriginalPosition = originPosition
</span></span><span style="display:flex;"><span>			curUser[<span style="color:#5af78e">&#34;status&#34;</span>] = <span style="color:#5af78e">&#34;å·²æ ¸éªŒ&#34;</span>
</span></span><span style="display:flex;"><span>			curUser[<span style="color:#5af78e">&#34;in_middb&#34;</span>] = <span style="color:#5af78e">&#34;y&#34;</span>
</span></span><span style="display:flex;"><span>			curUser[<span style="color:#5af78e">&#34;originPosition&#34;</span>] = originPosition
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#78787e">// è·å–æ ‡ç­¾åˆ—è¡¨
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>	taglist, err <span style="color:#ff6ac1">:=</span> Wxapi.<span style="color:#57c7ff">GetTagList</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">if</span> err <span style="color:#ff6ac1">!=</span> <span style="color:#ff6ac1">nil</span> {
</span></span><span style="display:flex;"><span>		logger.<span style="color:#57c7ff">Error</span>(fmt.<span style="color:#57c7ff">Sprintf</span>(<span style="color:#5af78e">&#34;è·å–ä¼ä¸šå¾®ä¿¡æ ‡ç­¾åˆ—è¡¨å¤±è´¥:%s&#34;</span>, err.<span style="color:#57c7ff">Error</span>()))
</span></span><span style="display:flex;"><span>		errMsg[<span style="color:#5af78e">&#34;name&#34;</span>] = row[common.EStuName]
</span></span><span style="display:flex;"><span>		errMsg[<span style="color:#5af78e">&#34;reason&#34;</span>] = err.<span style="color:#57c7ff">Error</span>()
</span></span><span style="display:flex;"><span>		errData <span style="color:#ff6ac1">&lt;-</span> row
</span></span><span style="display:flex;"><span>		buff <span style="color:#ff6ac1">&lt;-</span> errMsg
</span></span><span style="display:flex;"><span>		wg.<span style="color:#57c7ff">Done</span>()
</span></span><span style="display:flex;"><span>		<span style="color:#ff6ac1">return</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	flag <span style="color:#ff6ac1">:=</span> <span style="color:#ff6ac1">false</span> <span style="color:#78787e">// åˆ¤æ–­æ ‡ç­¾æ˜¯å¦å­˜åœ¨
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>	tmp <span style="color:#ff6ac1">:=</span> strings.<span style="color:#57c7ff">Replace</span>(row[common.EStuGrade], <span style="color:#5af78e">&#34;çº§&#34;</span>, <span style="color:#5af78e">&#34;&#34;</span>, <span style="color:#ff6ac1">-</span><span style="color:#ff9f43">1</span>)
</span></span><span style="display:flex;"><span>	tmp = fmt.<span style="color:#57c7ff">Sprintf</span>(<span style="color:#5af78e">&#34;%s/æ‰€æœ‰å­¦é™¢%sçº§éƒ¨é—¨&#34;</span>, row[common.EStuLevel], tmp)
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">for</span> _, values <span style="color:#ff6ac1">:=</span> <span style="color:#ff6ac1">range</span> taglist.TagList {
</span></span><span style="display:flex;"><span>		<span style="color:#ff6ac1">if</span> values.TagName <span style="color:#ff6ac1">==</span> tmp {
</span></span><span style="display:flex;"><span>			flag = <span style="color:#ff6ac1">true</span>
</span></span><span style="display:flex;"><span>			<span style="color:#ff6ac1">break</span>
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	tagId <span style="color:#ff6ac1">:=</span> <span style="color:#ff5c57">int64</span>(<span style="color:#ff6ac1">-</span><span style="color:#ff9f43">1</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#78787e">// æ ‡ç­¾ä¸å­˜åœ¨
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>	<span style="color:#ff6ac1">if</span> !flag {
</span></span><span style="display:flex;"><span>		<span style="color:#ff5c57">var</span> err <span style="color:#9aedfe">error</span>
</span></span><span style="display:flex;"><span>		tagId, err = Wxapi.<span style="color:#57c7ff">CreateTag</span>(tmp)
</span></span><span style="display:flex;"><span>		<span style="color:#ff6ac1">if</span> err <span style="color:#ff6ac1">!=</span> <span style="color:#ff6ac1">nil</span> {
</span></span><span style="display:flex;"><span>			msg <span style="color:#ff6ac1">:=</span> fmt.<span style="color:#57c7ff">Sprintf</span>(<span style="color:#5af78e">&#34;åˆ›å»ºæ ‡ç­¾å¤±è´¥ï¼š%s,ERR: %s&#34;</span>, tmp, err.<span style="color:#57c7ff">Error</span>())
</span></span><span style="display:flex;"><span>			logger.<span style="color:#57c7ff">Error</span>(msg)
</span></span><span style="display:flex;"><span>			errMsg[<span style="color:#5af78e">&#34;name&#34;</span>] = row[common.EStuName]
</span></span><span style="display:flex;"><span>			errMsg[<span style="color:#5af78e">&#34;reason&#34;</span>] = msg
</span></span><span style="display:flex;"><span>			errData <span style="color:#ff6ac1">&lt;-</span> row
</span></span><span style="display:flex;"><span>			buff <span style="color:#ff6ac1">&lt;-</span> errMsg
</span></span><span style="display:flex;"><span>			wg.<span style="color:#57c7ff">Done</span>()
</span></span><span style="display:flex;"><span>			<span style="color:#ff6ac1">return</span>
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#78787e">// å°†å¯¹åº”å¹´çº§éƒ¨é—¨åŠ å…¥åˆ°æ ‡ç­¾
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>	<span style="color:#ff6ac1">if</span> tagId <span style="color:#ff6ac1">!=</span> <span style="color:#ff6ac1">-</span><span style="color:#ff9f43">1</span> {
</span></span><span style="display:flex;"><span>		curDepid, _ <span style="color:#ff6ac1">:=</span> strconv.<span style="color:#57c7ff">Atoi</span>(gradeDep.WxID)
</span></span><span style="display:flex;"><span>		err <span style="color:#ff6ac1">:=</span> Wxapi.<span style="color:#57c7ff">AddTagUserOrDep</span>(tagId, []<span style="color:#9aedfe">string</span>{}, []<span style="color:#9aedfe">int64</span>{<span style="color:#ff5c57">int64</span>(curDepid)})
</span></span><span style="display:flex;"><span>		<span style="color:#ff6ac1">if</span> err <span style="color:#ff6ac1">!=</span> <span style="color:#ff6ac1">nil</span> {
</span></span><span style="display:flex;"><span>			msg <span style="color:#ff6ac1">:=</span> fmt.<span style="color:#57c7ff">Sprintf</span>(<span style="color:#5af78e">&#34;ä¸ºéƒ¨é—¨%væ·»åŠ æ ‡ç­¾ï¼š[%v]å¤±è´¥ï¼ŒERR: %s&#34;</span>, gradeDep.WxID, tmp, err.<span style="color:#57c7ff">Error</span>())
</span></span><span style="display:flex;"><span>			logger.<span style="color:#57c7ff">Error</span>(msg)
</span></span><span style="display:flex;"><span>			errMsg[<span style="color:#5af78e">&#34;name&#34;</span>] = row[common.EStuName]
</span></span><span style="display:flex;"><span>			errMsg[<span style="color:#5af78e">&#34;reason&#34;</span>] = msg
</span></span><span style="display:flex;"><span>			errData <span style="color:#ff6ac1">&lt;-</span> row
</span></span><span style="display:flex;"><span>			buff <span style="color:#ff6ac1">&lt;-</span> errMsg
</span></span><span style="display:flex;"><span>			wg.<span style="color:#57c7ff">Done</span>()
</span></span><span style="display:flex;"><span>			<span style="color:#ff6ac1">return</span>
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	errMsg[<span style="color:#5af78e">&#34;name&#34;</span>] = row[common.EStuName]
</span></span><span style="display:flex;"><span>	errMsg[<span style="color:#5af78e">&#34;reason&#34;</span>] = <span style="color:#5af78e">&#34;success&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">if</span> !exist {
</span></span><span style="display:flex;"><span>		userList <span style="color:#ff6ac1">&lt;-</span> curUser
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	buff <span style="color:#ff6ac1">&lt;-</span> errMsg
</span></span><span style="display:flex;"><span>	wg.<span style="color:#57c7ff">Done</span>()
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#ff5c57">func</span> (st <span style="color:#ff6ac1">*</span>StuHandle) <span style="color:#57c7ff">ImportStuData</span>(context <span style="color:#ff6ac1">*</span>gin.Context) {
</span></span><span style="display:flex;"><span>	<span style="color:#ff5c57">var</span> resp = gin.H{
</span></span><span style="display:flex;"><span>		<span style="color:#5af78e">&#34;status&#34;</span>:       <span style="color:#ff9f43">200</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#5af78e">&#34;msg&#34;</span>:          <span style="color:#5af78e">&#34;æ“ä½œæˆåŠŸ&#34;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#5af78e">&#34;err_data_url&#34;</span>: <span style="color:#5af78e">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff5c57">var</span> form StuData
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">if</span> err <span style="color:#ff6ac1">:=</span> context.<span style="color:#57c7ff">ShouldBind</span>(<span style="color:#ff6ac1">&amp;</span>form); err <span style="color:#ff6ac1">!=</span> <span style="color:#ff6ac1">nil</span> {
</span></span><span style="display:flex;"><span>		logger.<span style="color:#57c7ff">Error</span>(err.<span style="color:#57c7ff">Error</span>())
</span></span><span style="display:flex;"><span>		<span style="color:#57c7ff">Response</span>(context, http.StatusBadRequest, <span style="color:#5af78e">&#34;è¯·æ±‚ä¸åˆæ³•&#34;</span>, resp)
</span></span><span style="display:flex;"><span>		<span style="color:#ff6ac1">return</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	tmpFile <span style="color:#ff6ac1">:=</span> <span style="color:#5af78e">`./fileTmp/test.xlsx`</span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">if</span> _, err <span style="color:#ff6ac1">:=</span> os.<span style="color:#57c7ff">Stat</span>(tmpFile); os.<span style="color:#57c7ff">IsNotExist</span>(err) {
</span></span><span style="display:flex;"><span>		logger.<span style="color:#57c7ff">Info</span>(<span style="color:#5af78e">&#34;æ–‡ä»¶ä¸å­˜åœ¨&#34;</span>)
</span></span><span style="display:flex;"><span>	} <span style="color:#ff6ac1">else</span> {
</span></span><span style="display:flex;"><span>		logger.<span style="color:#57c7ff">Info</span>(<span style="color:#5af78e">&#34;æ–‡ä»¶å­˜åœ¨&#34;</span>)
</span></span><span style="display:flex;"><span>		err <span style="color:#ff6ac1">:=</span> os.<span style="color:#57c7ff">Remove</span>(tmpFile)
</span></span><span style="display:flex;"><span>		<span style="color:#ff6ac1">if</span> err <span style="color:#ff6ac1">!=</span> <span style="color:#ff6ac1">nil</span> {
</span></span><span style="display:flex;"><span>			msg <span style="color:#ff6ac1">:=</span> fmt.<span style="color:#57c7ff">Sprintf</span>(<span style="color:#5af78e">&#34;åˆ é™¤æ–‡ä»¶å¤±è´¥: %s&#34;</span>, err)
</span></span><span style="display:flex;"><span>			logger.<span style="color:#57c7ff">Error</span>(msg)
</span></span><span style="display:flex;"><span>			<span style="color:#57c7ff">Response</span>(context, http.StatusInternalServerError, <span style="color:#5af78e">&#34;æ“ä½œå¤±è´¥ï¼Œè¯·ç¨åå†è¯•&#34;</span>, resp)
</span></span><span style="display:flex;"><span>			<span style="color:#ff6ac1">return</span>
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#78787e">// æ¥æ”¶å¹¶å¤„ç†ä¸Šä¼ çš„excelè¡¨æ ¼
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>	err <span style="color:#ff6ac1">:=</span> context.<span style="color:#57c7ff">SaveUploadedFile</span>(form.File, tmpFile)
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">if</span> err <span style="color:#ff6ac1">!=</span> <span style="color:#ff6ac1">nil</span> {
</span></span><span style="display:flex;"><span>		msg <span style="color:#ff6ac1">:=</span> fmt.<span style="color:#57c7ff">Sprintf</span>(<span style="color:#5af78e">&#34;ä¿å­˜ä¸Šä¼ æ–‡ä»¶å¤±è´¥: %s&#34;</span>, err)
</span></span><span style="display:flex;"><span>		logger.<span style="color:#57c7ff">Error</span>(msg)
</span></span><span style="display:flex;"><span>		<span style="color:#57c7ff">Response</span>(context, http.StatusInternalServerError, <span style="color:#5af78e">&#34;æ“ä½œå¤±è´¥ï¼Œè¯·ç¨åå†è¯•&#34;</span>, resp)
</span></span><span style="display:flex;"><span>		<span style="color:#ff6ac1">return</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	f, err <span style="color:#ff6ac1">:=</span> excelize.<span style="color:#57c7ff">OpenFile</span>(tmpFile)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">if</span> err <span style="color:#ff6ac1">!=</span> <span style="color:#ff6ac1">nil</span> {
</span></span><span style="display:flex;"><span>		msg <span style="color:#ff6ac1">:=</span> fmt.<span style="color:#57c7ff">Sprintf</span>(<span style="color:#5af78e">&#34;æ‰“å¼€æ–‡ä»¶å¤±è´¥:%s&#34;</span>, err)
</span></span><span style="display:flex;"><span>		logger.<span style="color:#57c7ff">Error</span>(msg)
</span></span><span style="display:flex;"><span>		<span style="color:#57c7ff">Response</span>(context, http.StatusInternalServerError, <span style="color:#5af78e">&#34;æ“ä½œå¤±è´¥ï¼Œè¯·ç¨åå†è¯•&#34;</span>, resp)
</span></span><span style="display:flex;"><span>		<span style="color:#ff6ac1">return</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#78787e">// å…³é—­æ–‡ä»¶
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>	<span style="color:#ff6ac1">defer</span> <span style="color:#ff5c57">func</span>() {
</span></span><span style="display:flex;"><span>		<span style="color:#ff6ac1">if</span> err <span style="color:#ff6ac1">:=</span> f.<span style="color:#57c7ff">Close</span>(); err <span style="color:#ff6ac1">!=</span> <span style="color:#ff6ac1">nil</span> {
</span></span><span style="display:flex;"><span>			msg <span style="color:#ff6ac1">:=</span> fmt.<span style="color:#57c7ff">Sprintf</span>(<span style="color:#5af78e">&#34;å…³é—­æ–‡ä»¶å¤±è´¥:%s&#34;</span>, err)
</span></span><span style="display:flex;"><span>			logger.<span style="color:#57c7ff">Error</span>(msg)
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	rows, err <span style="color:#ff6ac1">:=</span> f.<span style="color:#57c7ff">GetRows</span>(<span style="color:#5af78e">&#34;Sheet1&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">if</span> err <span style="color:#ff6ac1">!=</span> <span style="color:#ff6ac1">nil</span> {
</span></span><span style="display:flex;"><span>		msg <span style="color:#ff6ac1">:=</span> fmt.<span style="color:#57c7ff">Sprintf</span>(<span style="color:#5af78e">&#34;è¯»å–Excelæ–‡ä»¶å¤±è´¥: %s&#34;</span>, err.<span style="color:#57c7ff">Error</span>())
</span></span><span style="display:flex;"><span>		logger.<span style="color:#57c7ff">Error</span>(msg)
</span></span><span style="display:flex;"><span>		<span style="color:#57c7ff">Response</span>(context, http.StatusAccepted, <span style="color:#5af78e">&#34;è§£æExcelæ•°æ®é”™è¯¯ï¼Œè¯·ç¡®ä¿æäº¤æ­£ç¡®çš„Excelæ•°æ®&#34;</span>, resp)
</span></span><span style="display:flex;"><span>		<span style="color:#ff6ac1">return</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">if</span> <span style="color:#ff5c57">len</span>(rows) <span style="color:#ff6ac1">==</span> <span style="color:#ff9f43">0</span> {
</span></span><span style="display:flex;"><span>		logger.<span style="color:#57c7ff">Error</span>(<span style="color:#5af78e">&#34;ä¸èƒ½æäº¤ç©ºæ–‡ä»¶&#34;</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#57c7ff">Response</span>(context, http.StatusAccepted, <span style="color:#5af78e">&#34;ä¸èƒ½æäº¤ç©ºæ–‡ä»¶&#34;</span>, resp)
</span></span><span style="display:flex;"><span>		<span style="color:#ff6ac1">return</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	row <span style="color:#ff6ac1">:=</span> rows[<span style="color:#ff9f43">0</span>]
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">if</span> <span style="color:#ff5c57">len</span>(row) <span style="color:#ff6ac1">!=</span> <span style="color:#ff9f43">9</span> <span style="color:#ff6ac1">||</span> row[common.EStuName] <span style="color:#ff6ac1">!=</span> <span style="color:#5af78e">&#34;å§“å&#34;</span> <span style="color:#ff6ac1">||</span> row[common.EStuIdCard] <span style="color:#ff6ac1">!=</span> <span style="color:#5af78e">&#34;èº«ä»½è¯å·&#34;</span> <span style="color:#ff6ac1">||</span> row[common.EStuStuId] <span style="color:#ff6ac1">!=</span>
</span></span><span style="display:flex;"><span>		<span style="color:#5af78e">&#34;å­¦å·&#34;</span> <span style="color:#ff6ac1">||</span> row[common.EStuGender] <span style="color:#ff6ac1">!=</span> <span style="color:#5af78e">&#34;æ€§åˆ«&#34;</span> <span style="color:#ff6ac1">||</span> row[common.EStuBirth] <span style="color:#ff6ac1">!=</span> <span style="color:#5af78e">&#34;å‡ºç”Ÿæ—¥æœŸ&#34;</span> <span style="color:#ff6ac1">||</span> row[common.EStuCollege] <span style="color:#ff6ac1">!=</span> <span style="color:#5af78e">&#34;å­¦é™¢åç§°&#34;</span> <span style="color:#ff6ac1">||</span> row[common.EStuCollegeCode] <span style="color:#ff6ac1">!=</span> <span style="color:#5af78e">&#34;å­¦é™¢ä»£ç &#34;</span> <span style="color:#ff6ac1">||</span>
</span></span><span style="display:flex;"><span>		row[common.EStuGrade] <span style="color:#ff6ac1">!=</span> <span style="color:#5af78e">&#34;å¹´çº§&#34;</span> <span style="color:#ff6ac1">||</span> row[common.EStuLevel] <span style="color:#ff6ac1">!=</span> <span style="color:#5af78e">&#34;å±‚æ¬¡&#34;</span> {
</span></span><span style="display:flex;"><span>		logger.<span style="color:#57c7ff">Error</span>(<span style="color:#5af78e">&#34;Excelæ ¼å¼ä¸ç¬¦åˆæ¨¡æ¿è¦æ±‚&#34;</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#57c7ff">Response</span>(context, http.StatusBadRequest, <span style="color:#5af78e">&#34;Excelæ ¼å¼ä¸ç¬¦åˆæ¨¡æ¿è¦æ±‚&#34;</span>, resp)
</span></span><span style="display:flex;"><span>		<span style="color:#ff6ac1">return</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#ff5c57">var</span> wg sync.WaitGroup
</span></span><span style="display:flex;"><span>	wg.<span style="color:#57c7ff">Add</span>(<span style="color:#ff5c57">len</span>(rows) <span style="color:#ff6ac1">-</span> <span style="color:#ff9f43">1</span>)
</span></span><span style="display:flex;"><span>	buff <span style="color:#ff6ac1">:=</span> <span style="color:#ff5c57">make</span>(<span style="color:#ff5c57">chan</span> <span style="color:#ff5c57">map</span>[<span style="color:#9aedfe">string</span>]<span style="color:#9aedfe">string</span>, <span style="color:#ff5c57">len</span>(rows)<span style="color:#ff6ac1">-</span><span style="color:#ff9f43">1</span>) <span style="color:#78787e">//å»ºç«‹ç¼“å†²åŒºï¼Œè®°å½•ä¸èƒ½å¯¼å…¥çš„æ•°æ®å¯¹åº”çš„å§“å
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>	_failInfo <span style="color:#ff6ac1">:=</span> <span style="color:#ff5c57">make</span>([]<span style="color:#ff5c57">map</span>[<span style="color:#9aedfe">string</span>]<span style="color:#9aedfe">string</span>, <span style="color:#ff9f43">0</span>)
</span></span><span style="display:flex;"><span>	userBuff <span style="color:#ff6ac1">:=</span> <span style="color:#ff5c57">make</span>(<span style="color:#ff5c57">chan</span> <span style="color:#ff5c57">map</span>[<span style="color:#9aedfe">string</span>]<span style="color:#9aedfe">string</span>, <span style="color:#ff5c57">len</span>(rows)<span style="color:#ff6ac1">-</span><span style="color:#ff9f43">1</span>)
</span></span><span style="display:flex;"><span>	errBuff <span style="color:#ff6ac1">:=</span> <span style="color:#ff5c57">make</span>(<span style="color:#ff5c57">chan</span> []<span style="color:#9aedfe">string</span>, <span style="color:#ff5c57">len</span>(rows)<span style="color:#ff6ac1">-</span><span style="color:#ff9f43">1</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#78787e">// å¤šè¿›ç¨‹å¤„ç†ï¼Œä¸ºæ¯æ¡æ•°æ®åˆ†é…ä¸€ä¸ªgoroutine
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>	<span style="color:#ff6ac1">for</span> _, data <span style="color:#ff6ac1">:=</span> <span style="color:#ff6ac1">range</span> rows[<span style="color:#ff9f43">1</span>:] {
</span></span><span style="display:flex;"><span>		<span style="color:#ff6ac1">if</span> <span style="color:#ff5c57">len</span>(data) <span style="color:#ff6ac1">!=</span> <span style="color:#ff9f43">9</span> {
</span></span><span style="display:flex;"><span>			msg <span style="color:#ff6ac1">:=</span> fmt.<span style="color:#57c7ff">Sprintf</span>(<span style="color:#5af78e">&#34;æ•°æ®ä¸ç¬¦åˆè¦æ±‚ï¼šã€%vã€‘&#34;</span>, data)
</span></span><span style="display:flex;"><span>			logger.<span style="color:#57c7ff">Error</span>(msg)
</span></span><span style="display:flex;"><span>			tmp <span style="color:#ff6ac1">:=</span> <span style="color:#ff5c57">make</span>(<span style="color:#ff5c57">map</span>[<span style="color:#9aedfe">string</span>]<span style="color:#9aedfe">string</span>, <span style="color:#ff9f43">0</span>)
</span></span><span style="display:flex;"><span>			tmp[<span style="color:#5af78e">&#34;name&#34;</span>] = row[common.EStuName]
</span></span><span style="display:flex;"><span>			tmp[<span style="color:#5af78e">&#34;reason&#34;</span>] = msg
</span></span><span style="display:flex;"><span>			errBuff <span style="color:#ff6ac1">&lt;-</span> data
</span></span><span style="display:flex;"><span>			buff <span style="color:#ff6ac1">&lt;-</span> tmp
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		<span style="color:#78787e">// å¤šçº¿ç¨‹å¤„ç†ï¼Œä¸ºæ¯æ¡æ•°æ®å¼€ä¸€ä¸ªçº¿ç¨‹
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>		<span style="color:#ff6ac1">go</span> <span style="color:#57c7ff">dealStuData</span>(data, buff, <span style="color:#ff6ac1">&amp;</span>wg, userBuff, errBuff)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	wg.<span style="color:#57c7ff">Wait</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#ff5c57">close</span>(buff)
</span></span><span style="display:flex;"><span>	<span style="color:#ff5c57">close</span>(userBuff)
</span></span><span style="display:flex;"><span>	<span style="color:#ff5c57">close</span>(errBuff)
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">for</span> val <span style="color:#ff6ac1">:=</span> <span style="color:#ff6ac1">range</span> buff {
</span></span><span style="display:flex;"><span>		_failInfo = <span style="color:#ff5c57">append</span>(_failInfo, val)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	ts <span style="color:#ff6ac1">:=</span> common.TStudent{}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	userList <span style="color:#ff6ac1">:=</span> <span style="color:#ff5c57">make</span>([]common.TStudent, <span style="color:#ff9f43">0</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">for</span> val <span style="color:#ff6ac1">:=</span> <span style="color:#ff6ac1">range</span> userBuff {
</span></span><span style="display:flex;"><span>		t <span style="color:#ff6ac1">:=</span> common.TStudent{
</span></span><span style="display:flex;"><span>			Name:        val[<span style="color:#5af78e">&#34;name&#34;</span>],
</span></span><span style="display:flex;"><span>			IdCard:      val[<span style="color:#5af78e">&#34;idcard&#34;</span>],
</span></span><span style="display:flex;"><span>			StuId:       val[<span style="color:#5af78e">&#34;stu_id&#34;</span>],
</span></span><span style="display:flex;"><span>			Gender:      val[<span style="color:#5af78e">&#34;gender&#34;</span>],
</span></span><span style="display:flex;"><span>			Birthday:    val[<span style="color:#5af78e">&#34;birth&#34;</span>],
</span></span><span style="display:flex;"><span>			College:     val[<span style="color:#5af78e">&#34;college&#34;</span>],
</span></span><span style="display:flex;"><span>			CollegeCode: val[<span style="color:#5af78e">&#34;college_code&#34;</span>],
</span></span><span style="display:flex;"><span>			Grade:       val[<span style="color:#5af78e">&#34;grade&#34;</span>],
</span></span><span style="display:flex;"><span>			Level:       val[<span style="color:#5af78e">&#34;level&#34;</span>],
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		t.Status = val[<span style="color:#5af78e">&#34;status&#34;</span>]
</span></span><span style="display:flex;"><span>		t.InMidDb = val[<span style="color:#5af78e">&#34;in_middb&#34;</span>]
</span></span><span style="display:flex;"><span>		t.OriginalPosition = val[<span style="color:#5af78e">&#34;originPosition&#34;</span>]
</span></span><span style="display:flex;"><span>		userList = <span style="color:#ff5c57">append</span>(userList, t)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	failData <span style="color:#ff6ac1">:=</span> <span style="color:#ff5c57">make</span>([][]<span style="color:#9aedfe">string</span>, <span style="color:#ff9f43">0</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">for</span> val <span style="color:#ff6ac1">:=</span> <span style="color:#ff6ac1">range</span> errBuff {
</span></span><span style="display:flex;"><span>		failData = <span style="color:#ff5c57">append</span>(failData, val)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	err = ts.<span style="color:#57c7ff">CreateStudent</span>(userList)
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">if</span> err <span style="color:#ff6ac1">!=</span> <span style="color:#ff6ac1">nil</span> {
</span></span><span style="display:flex;"><span>		logger.<span style="color:#57c7ff">Error</span>(err.<span style="color:#57c7ff">Error</span>())
</span></span><span style="display:flex;"><span>		<span style="color:#57c7ff">Response</span>(context, http.StatusInternalServerError, err.<span style="color:#57c7ff">Error</span>(), resp)
</span></span><span style="display:flex;"><span>		<span style="color:#ff6ac1">return</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	success <span style="color:#ff6ac1">:=</span> <span style="color:#ff9f43">0</span>
</span></span><span style="display:flex;"><span>	fail <span style="color:#ff6ac1">:=</span> <span style="color:#ff9f43">0</span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff5c57">var</span> failInfo []<span style="color:#9aedfe">string</span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">for</span> _, val <span style="color:#ff6ac1">:=</span> <span style="color:#ff6ac1">range</span> _failInfo {
</span></span><span style="display:flex;"><span>		<span style="color:#ff6ac1">if</span> val[<span style="color:#5af78e">&#34;reason&#34;</span>] <span style="color:#ff6ac1">!=</span> <span style="color:#5af78e">&#34;success&#34;</span> {
</span></span><span style="display:flex;"><span>			fail<span style="color:#ff6ac1">++</span>
</span></span><span style="display:flex;"><span>			failInfo = <span style="color:#ff5c57">append</span>(failInfo, val[<span style="color:#5af78e">&#34;reason&#34;</span>])
</span></span><span style="display:flex;"><span>			<span style="color:#ff6ac1">continue</span>
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		success<span style="color:#ff6ac1">++</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">if</span> <span style="color:#ff5c57">len</span>(failData) <span style="color:#ff6ac1">==</span> <span style="color:#ff9f43">0</span> {
</span></span><span style="display:flex;"><span>		resp[<span style="color:#5af78e">&#34;err_data_url&#34;</span>] = <span style="color:#5af78e">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>	} <span style="color:#ff6ac1">else</span> {
</span></span><span style="display:flex;"><span>		fileName, _ <span style="color:#ff6ac1">:=</span> golib.<span style="color:#57c7ff">NewErrDataFile</span>(failData, failInfo)
</span></span><span style="display:flex;"><span>		fileName = strings.<span style="color:#57c7ff">Replace</span>(fileName, <span style="color:#5af78e">&#34;.xlsx&#34;</span>, <span style="color:#5af78e">&#34;&#34;</span>, <span style="color:#ff6ac1">-</span><span style="color:#ff9f43">1</span>)
</span></span><span style="display:flex;"><span>		resp[<span style="color:#5af78e">&#34;err_data_url&#34;</span>] = fmt.<span style="color:#57c7ff">Sprintf</span>(<span style="color:#5af78e">&#34;%v/student/err?name=%v&#34;</span>, config.HostName, fileName)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	msg <span style="color:#ff6ac1">:=</span> fmt.<span style="color:#57c7ff">Sprintf</span>(<span style="color:#5af78e">&#34;æˆåŠŸå¯¼å…¥æ¡æ•°:%d å¯¼å…¥å¤±è´¥æ¡æ•°:%d æ€»è®¡æ¡æ•°:%d&#34;</span>, success, <span style="color:#ff5c57">len</span>(failData), <span style="color:#ff5c57">len</span>(rows)<span style="color:#ff6ac1">-</span><span style="color:#ff9f43">1</span>)
</span></span><span style="display:flex;"><span>	status <span style="color:#ff6ac1">:=</span> http.StatusOK
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">if</span> fail <span style="color:#ff6ac1">!=</span> <span style="color:#ff9f43">0</span> {
</span></span><span style="display:flex;"><span>		status = http.StatusAccepted
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#57c7ff">Response</span>(context, status, msg, resp)
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">return</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#78787e">// ä¸‹è½½ä¸èƒ½å¯¼å…¥çš„ä¿¡æ¯
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span><span style="color:#ff5c57">type</span> reqErrFile <span style="color:#ff5c57">struct</span> {
</span></span><span style="display:flex;"><span>	FileName <span style="color:#9aedfe">int</span> <span style="color:#5af78e">`form:&#34;name&#34; binding:&#34;required&#34;`</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">func</span> (st <span style="color:#ff6ac1">*</span>StuHandle) <span style="color:#57c7ff">StuErrFile</span>(ctx <span style="color:#ff6ac1">*</span>gin.Context) {
</span></span><span style="display:flex;"><span>	resp <span style="color:#ff6ac1">:=</span> gin.H{
</span></span><span style="display:flex;"><span>		<span style="color:#5af78e">&#34;status&#34;</span>: <span style="color:#ff9f43">200</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#5af78e">&#34;msg&#34;</span>:    <span style="color:#5af78e">&#34;æ“ä½œæˆåŠŸ&#34;</span>,
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	err <span style="color:#ff6ac1">:=</span> golib.<span style="color:#57c7ff">DelOldFile</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">if</span> err <span style="color:#ff6ac1">!=</span> <span style="color:#ff6ac1">nil</span> {
</span></span><span style="display:flex;"><span>		logger.<span style="color:#57c7ff">Error</span>(fmt.<span style="color:#57c7ff">Sprintf</span>(<span style="color:#5af78e">&#34;åˆ é™¤æ—§æ–‡ä»¶å¤±è´¥ï¼š%v&#34;</span>, err))
</span></span><span style="display:flex;"><span>		<span style="color:#57c7ff">Response</span>(ctx, http.StatusInternalServerError, <span style="color:#5af78e">&#34;æ“ä½œå¤±è´¥&#34;</span>, resp)
</span></span><span style="display:flex;"><span>		<span style="color:#ff6ac1">return</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#ff5c57">var</span> form reqErrFile
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">if</span> err <span style="color:#ff6ac1">:=</span> ctx.<span style="color:#57c7ff">ShouldBind</span>(<span style="color:#ff6ac1">&amp;</span>form); err <span style="color:#ff6ac1">!=</span> <span style="color:#ff6ac1">nil</span> {
</span></span><span style="display:flex;"><span>		logger.<span style="color:#57c7ff">Error</span>(fmt.<span style="color:#57c7ff">Sprintf</span>(<span style="color:#5af78e">&#34;å‚æ•°é”™è¯¯ï¼š%v&#34;</span>, err))
</span></span><span style="display:flex;"><span>		<span style="color:#57c7ff">Response</span>(ctx, http.StatusBadRequest, <span style="color:#5af78e">&#34;æ“ä½œä¸åˆæ³•&#34;</span>, resp)
</span></span><span style="display:flex;"><span>		<span style="color:#ff6ac1">return</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	file, err <span style="color:#ff6ac1">:=</span> ioutil.<span style="color:#57c7ff">ReadFile</span>(fmt.<span style="color:#57c7ff">Sprintf</span>(<span style="color:#5af78e">&#34;./fileTmp/%v.xlsx&#34;</span>, form.FileName))
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">if</span> err <span style="color:#ff6ac1">!=</span> <span style="color:#ff6ac1">nil</span> {
</span></span><span style="display:flex;"><span>		logger.<span style="color:#57c7ff">Error</span>(fmt.<span style="color:#57c7ff">Sprintf</span>(<span style="color:#5af78e">&#34;è¯»å–æ–‡ä»¶å¤±è´¥:%v&#34;</span>, err))
</span></span><span style="display:flex;"><span>		<span style="color:#57c7ff">Response</span>(ctx, http.StatusNotFound, <span style="color:#5af78e">&#34;æ‰¾ä¸åˆ°èµ„æº&#34;</span>, resp)
</span></span><span style="display:flex;"><span>		<span style="color:#ff6ac1">return</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	ctx.<span style="color:#57c7ff">Header</span>(<span style="color:#5af78e">&#34;content-disposition&#34;</span>, <span style="color:#5af78e">`attachment; filename=`</span><span style="color:#ff6ac1">+</span>fmt.<span style="color:#57c7ff">Sprintf</span>(<span style="color:#5af78e">&#34;%v.xlsx&#34;</span>, form.FileName))
</span></span><span style="display:flex;"><span>	ctx.<span style="color:#57c7ff">Data</span>(<span style="color:#ff9f43">200</span>, <span style="color:#5af78e">&#34;application/octet-stream&#34;</span>, file)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>	d := make(map[string]int,6)
</span></span><span style="display:flex;"><span>	d[&#34;name&#34;] = 0
</span></span><span style="display:flex;"><span>	d[&#34;content&#34;] = 1
</span></span><span style="display:flex;"><span>	d[&#34;org&#34;] = 2
</span></span><span style="display:flex;"><span>	d[&#34;year&#34;] = 3
</span></span><span style="display:flex;"><span>	d[&#34;user_id&#34;] = 4
</span></span><span style="display:flex;"><span>	d[&#34;username&#34;] = 5
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>data
</span></span></code></pre></div><p><img loading="lazy" src="D:%5cTypore%5cTypora%5ca_Plan%5cgolang%e4%b8%93%e9%a2%98%5cbase.assets%5cimage-20221031095233892.png" alt="image-20221031095233892"  />
</p>
<h2 id="å¹¶å‘ç¼–ç¨‹-runtime">å¹¶å‘ç¼–ç¨‹-&gt;runtime<a hidden class="anchor" aria-hidden="true" href="#å¹¶å‘ç¼–ç¨‹-runtime">#</a></h2>
<p>runtimeåŒ…é‡Œé¢å®šä¹‰äº†ä¸€äº›åç¨‹ç®¡ç†ç›¸å…³çš„api</p>
<h3 id="runtimegosched">runtime.Gosched()<a hidden class="anchor" aria-hidden="true" href="#runtimegosched">#</a></h3>
<p>è®©å‡ºCPUæ—¶é—´ç‰‡ï¼Œé‡æ–°ç­‰å¾…å®‰æ’ä»»åŠ¡</p>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#ff5c57">func</span> <span style="color:#57c7ff">showMsg1</span>(s <span style="color:#9aedfe">string</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">for</span> i <span style="color:#ff6ac1">:=</span> <span style="color:#ff9f43">0</span>; i &lt; <span style="color:#ff9f43">2</span>; i<span style="color:#ff6ac1">++</span> {
</span></span><span style="display:flex;"><span>		fmt.<span style="color:#57c7ff">Println</span>(s)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">func</span> <span style="color:#57c7ff">RunTime</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">go</span> <span style="color:#57c7ff">showMsg1</span>(<span style="color:#5af78e">&#34;java&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">for</span> i <span style="color:#ff6ac1">:=</span> <span style="color:#ff9f43">0</span>; i &lt; <span style="color:#ff9f43">2</span>; i<span style="color:#ff6ac1">++</span> {
</span></span><span style="display:flex;"><span>		runtime.<span style="color:#57c7ff">Gosched</span>()
</span></span><span style="display:flex;"><span>		fmt.<span style="color:#57c7ff">Println</span>(<span style="color:#5af78e">&#34;golang&#34;</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	fmt.<span style="color:#57c7ff">Println</span>(<span style="color:#5af78e">&#34;end...&#34;</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>java
</span></span><span style="display:flex;"><span>java
</span></span><span style="display:flex;"><span>golang
</span></span><span style="display:flex;"><span>golang
</span></span><span style="display:flex;"><span>end<span style="color:#ff6ac1">...</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>å¦‚æœæ²¡æœ‰ç¬¬11è¡Œ<span style="color:#ff5c57">ï¼Œ</span>å¯èƒ½mainåç¨‹ç›´æ¥ç»“æŸå•¦
</span></span><span style="display:flex;"><span>golang
</span></span><span style="display:flex;"><span>golang
</span></span><span style="display:flex;"><span>end<span style="color:#ff6ac1">...</span>
</span></span></code></pre></div><h3 id="runtimegoexit">runtime.Goexit()<a hidden class="anchor" aria-hidden="true" href="#runtimegoexit">#</a></h3>
<p>é€€å‡ºåç¨‹</p>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>runtime.Goexit()
</span></span></code></pre></div><h3 id="runtimegomaxprocs">runtime.GOMAXPROCS()<a hidden class="anchor" aria-hidden="true" href="#runtimegomaxprocs">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#ff5c57">func</span> <span style="color:#57c7ff">showA</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">for</span> i <span style="color:#ff6ac1">:=</span> <span style="color:#ff9f43">0</span>; i &lt; <span style="color:#ff9f43">15</span>; i<span style="color:#ff6ac1">++</span> {
</span></span><span style="display:flex;"><span>		fmt.<span style="color:#57c7ff">Printf</span>(<span style="color:#5af78e">&#34;A:%v\n&#34;</span>, i)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">func</span> <span style="color:#57c7ff">showB</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">for</span> i <span style="color:#ff6ac1">:=</span> <span style="color:#ff9f43">0</span>; i &lt; <span style="color:#ff9f43">15</span>; i<span style="color:#ff6ac1">++</span> {
</span></span><span style="display:flex;"><span>		fmt.<span style="color:#57c7ff">Printf</span>(<span style="color:#5af78e">&#34;B:%v\n&#34;</span>, i)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">func</span> <span style="color:#57c7ff">RunTime</span>() {
</span></span><span style="display:flex;"><span>	cpuNum <span style="color:#ff6ac1">:=</span> runtime.<span style="color:#57c7ff">NumCPU</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#78787e">//  æˆ‘è¿™æ˜¯ 8 æ ¸
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>	<span style="color:#ff5c57">println</span>(cpuNum)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	runtime.<span style="color:#57c7ff">GOMAXPROCS</span>(<span style="color:#ff9f43">1</span>) <span style="color:#78787e">// å¦‚æœè®¾ç½®ä¸º 1 ï¼Œåˆ™ä¸ä¼šäº¤æ›¿æ‰§è¡Œã€‚é™¤éæœ‰ç¡çœ åœ¨ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">go</span> <span style="color:#57c7ff">showA</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">go</span> <span style="color:#57c7ff">showB</span>()
</span></span><span style="display:flex;"><span>	time.<span style="color:#57c7ff">Sleep</span>(time.Second)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="å¹¶å‘ç¼–ç¨‹-mutexäº’æ–¥é”å®ç°åŒæ­¥">å¹¶å‘ç¼–ç¨‹-&gt;Mutexäº’æ–¥é”å®ç°åŒæ­¥<a hidden class="anchor" aria-hidden="true" href="#å¹¶å‘ç¼–ç¨‹-mutexäº’æ–¥é”å®ç°åŒæ­¥">#</a></h2>
<p>é™¤äº†ä½¿ç”¨ channel å®ç°åŒæ­¥ä¹‹å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨Mutexäº’æ–¥é”çš„æ–¹å¼å®ç°åŒæ­¥ã€‚</p>
<p>Goè¯­è¨€æä¾›äº†<code>sync</code>åŒ…å’Œ<code>channel</code>æœºåˆ¶æ¥è§£å†³å¹¶å‘æœºåˆ¶ä¸­ä¸åŒ<code>goroutine</code>ä¹‹é—´çš„åŒæ­¥å’Œé€šä¿¡</p>
<h3 id="æ²¡åŠ é”">æ²¡åŠ é”<a hidden class="anchor" aria-hidden="true" href="#æ²¡åŠ é”">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#ff6ac1">package</span> Base
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">import</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#5af78e">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#5af78e">&#34;time&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">func</span> <span style="color:#57c7ff">addOne</span>(i <span style="color:#9aedfe">int</span>) {
</span></span><span style="display:flex;"><span>	i<span style="color:#ff6ac1">++</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">func</span> <span style="color:#57c7ff">subOne</span>(i <span style="color:#9aedfe">int</span>) {
</span></span><span style="display:flex;"><span>	i<span style="color:#ff6ac1">--</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">func</span> <span style="color:#57c7ff">Mutex</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#ff5c57">var</span> i = <span style="color:#ff9f43">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">for</span> ; i <span style="color:#ff6ac1">&lt;=</span> <span style="color:#ff9f43">1000</span>; i<span style="color:#ff6ac1">++</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#ff6ac1">go</span> <span style="color:#57c7ff">addOne</span>(i)
</span></span><span style="display:flex;"><span>		<span style="color:#ff6ac1">go</span> <span style="color:#57c7ff">subOne</span>(i)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	time.<span style="color:#57c7ff">Sleep</span>(time.Second <span style="color:#ff6ac1">*</span> <span style="color:#ff9f43">1</span>)
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	fmt.<span style="color:#57c7ff">Println</span>(<span style="color:#5af78e">&#34;Sum:&#34;</span>, i)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Sum: <span style="color:#ff9f43">1001</span>
</span></span></code></pre></div><h3 id="åŠ äº†é”">åŠ äº†é”<a hidden class="anchor" aria-hidden="true" href="#åŠ äº†é”">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#ff6ac1">package</span> Base
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">import</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#5af78e">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#5af78e">&#34;sync&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#5af78e">&#34;time&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">var</span> mutex sync.Mutex
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">func</span> <span style="color:#57c7ff">addOne</span>(i <span style="color:#9aedfe">int</span>) {
</span></span><span style="display:flex;"><span>	mutex.<span style="color:#57c7ff">Lock</span>()
</span></span><span style="display:flex;"><span>	i<span style="color:#ff6ac1">++</span>
</span></span><span style="display:flex;"><span>	mutex.<span style="color:#57c7ff">Unlock</span>()
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">func</span> <span style="color:#57c7ff">subOne</span>(i <span style="color:#9aedfe">int</span>) {
</span></span><span style="display:flex;"><span>	mutex.<span style="color:#57c7ff">Lock</span>()
</span></span><span style="display:flex;"><span>	i<span style="color:#ff6ac1">--</span>
</span></span><span style="display:flex;"><span>	mutex.<span style="color:#57c7ff">Unlock</span>()
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">func</span> <span style="color:#57c7ff">Mutex</span>() {
</span></span><span style="display:flex;"><span>	i <span style="color:#ff6ac1">:=</span> <span style="color:#ff9f43">0</span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">for</span> ; i &lt; <span style="color:#ff9f43">1000</span>; i<span style="color:#ff6ac1">++</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#ff6ac1">go</span> <span style="color:#57c7ff">addOne</span>(i)
</span></span><span style="display:flex;"><span>		<span style="color:#ff6ac1">go</span> <span style="color:#57c7ff">subOne</span>(i)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	time.<span style="color:#57c7ff">Sleep</span>(time.Second <span style="color:#ff6ac1">*</span> <span style="color:#ff9f43">1</span>)
</span></span><span style="display:flex;"><span>	fmt.<span style="color:#57c7ff">Println</span>(<span style="color:#5af78e">&#34;Sum:&#34;</span>, i)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Sum: <span style="color:#ff9f43">1000</span>
</span></span></code></pre></div><h3 id="é”-locker">é” <code>Locker</code><a hidden class="anchor" aria-hidden="true" href="#é”-locker">#</a></h3>
<p>Goè¯­è¨€ä½¿ç”¨<code>go</code>è¯­å¥å¼€å¯æ–°çš„<code>goroutine</code>ï¼Œç”±äº<code>goroutine</code>éå¸¸è½»é‡é™¤äº†å¯¹å…¶åˆ†é…æ ˆç©ºé—´å¤–ï¼Œæ‰€å çš„ç©ºé—´ä¹Ÿæ˜¯å¾®ä¹å…¶å¾®çš„ã€‚ä½†å½“å¤šä¸ª<code>goroutine</code>åŒæ—¶å¤„ç†æ—¶ä¼šé‡åˆ°æ¯”å¦‚åŒæ—¶æŠ¢å ä¸€ä¸ªèµ„æºï¼ŒæŸä¸ª<code>goroutine</code>ä¼šç­‰å¾…ç­‰ä¸€ä¸ª<code>goroutine</code>å¤„ç†å®Œæ¯•æŸæ‰èƒ½ç»§ç»­æ‰§è¡Œçš„é—®é¢˜ã€‚å¯¹äºè¿™ç§æƒ…å†µï¼Œå®˜æ–¹å¹¶ä¸å¸Œæœ›ä¾é å…±äº«å†…å­˜çš„æ–¹å¼æ¥å®ç°è¿›ç¨‹çš„ååŒæ“ä½œï¼Œè€Œæ˜¯å¸Œæœ›é€šè¿‡<code>channel</code>ä¿¡é“çš„æ–¹å¼æ¥å¤„ç†ã€‚ä½†åœ¨æŸäº›ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œä¾ç„¶éœ€è¦ä½¿ç”¨åˆ°é”ï¼Œä¸ºæ­¤<code>sync</code>åŒ…æä¾›äº†é”ã€‚</p>
<p>å½“åœ¨å¹¶å‘æƒ…å†µä¸‹ï¼Œå¤šä¸ª<code>goroutine</code>åŒæ—¶ä¿®æ”¹æŸä¸€ä¸ªå˜é‡æ—¶ï¼Œå°±ä¼šå‡ºç°èµ„æºæŠ¢å ï¼Œå› æ­¤ä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#ff6ac1">package</span> main
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">import</span> (
</span></span><span style="display:flex;"><span>    <span style="color:#5af78e">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#5af78e">&#34;time&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">func</span> <span style="color:#57c7ff">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#ff5c57">var</span> num = <span style="color:#ff9f43">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">for</span> i <span style="color:#ff6ac1">:=</span> <span style="color:#ff9f43">0</span>; i &lt; <span style="color:#ff9f43">100000</span>; i<span style="color:#ff6ac1">++</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">go</span> <span style="color:#ff5c57">func</span>(i <span style="color:#9aedfe">int</span>) {
</span></span><span style="display:flex;"><span>            num<span style="color:#ff6ac1">++</span>
</span></span><span style="display:flex;"><span>            fmt.<span style="color:#57c7ff">Printf</span>(<span style="color:#5af78e">&#34;goroutine %d: num = %d\n&#34;</span>, i, num)
</span></span><span style="display:flex;"><span>        }(i)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    time.<span style="color:#57c7ff">Sleep</span>(time.Second)<span style="color:#78787e">//ä¸»goroutineç­‰å¾…1ç§’ä»¥ç¡®ä¿æ‰€æœ‰å·¥ä½œgoroutineæ‰§è¡Œå®Œæ¯•
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>}
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-dart" data-lang="dart"><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>goroutine <span style="color:#ff9f43">10018</span><span style="color:#ff6ac1">:</span> <span style="color:#9aedfe">num</span> <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">98635</span>
</span></span><span style="display:flex;"><span>goroutine <span style="color:#ff9f43">12646</span><span style="color:#ff6ac1">:</span> <span style="color:#9aedfe">num</span> <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">98635</span>
</span></span><span style="display:flex;"><span>goroutine <span style="color:#ff9f43">12844</span><span style="color:#ff6ac1">:</span> <span style="color:#9aedfe">num</span> <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">98635</span>
</span></span><span style="display:flex;"><span>goroutine <span style="color:#ff9f43">12950</span><span style="color:#ff6ac1">:</span> <span style="color:#9aedfe">num</span> <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">98635</span>
</span></span><span style="display:flex;"><span>...
</span></span></code></pre></div><p>ä¸Šä¾‹ä¸­<code>goroutine</code>ä¸€ä¾æ¬¡ä»å¯„å­˜å™¨ä¸­è¯»å–<code>num</code>çš„å€¼ååšåŠ æ³•è¿ç®—ï¼Œç„¶åå°†å…¶ç»“æœå›å†™åˆ°å¯„å­˜å™¨ä¸­ã€‚è¿è¡Œä¸­ä¼šå‘ç°å­˜åœ¨ä¸€ä¸ª<code>goroutine</code>å–å‡º<code>num</code>çš„å€¼æ—¶åšåŠ æ³•è¿ç®—æ—¶ï¼Œå¦ä¸€ä¸ª<code>goroutine</code>ä¹Ÿå–å‡ºäº†<code>num</code>çš„å€¼ã€‚å› ä¸ºä¸Šä¸€ä¸ª<code>goroutine</code>è¿è¡Œç»“æœè¿˜æ²¡æœ‰å›å†™åˆ°å¯„å­˜å™¨ï¼Œæœ€ç»ˆå¯¼è‡´å¤šä¸ª<code>goroutine</code>äº§ç”Ÿçš„ç›¸åŒçš„ç»“æœã€‚</p>
<p>å¹¶å‘ç¼–ç¨‹ä¸­åŒæ­¥åŸè¯­-é”ï¼Œä¸ºäº†ä¿è¯å¤šä¸ªçº¿ç¨‹æˆ–<code>goroutine</code>åœ¨è®¿é—®åŒä¸€å—å†…å­˜æ—¶ä¸å‡ºç°æ··ä¹±ï¼ŒGoè¯­è¨€çš„<code>sync</code>åŒ…æä¾›äº†å¸¸è§çš„å¹¶å‘ç¼–ç¨‹åŒæ­¥åŸè¯­çš„æ§åˆ¶é”ã€‚</p>
<p><code>sync</code>åŒ…å›´ç»•ç€<code>Locker</code>é”æ¥å£å±•å¼€ï¼Œ<code>Locker</code>æ¥å£ä¸­æä¾›äº†ä¸¤ä¸ªæ–¹æ³•<code>Lock()</code>å’Œ<code>Unlock()</code>ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#ff5c57">type</span> Locker <span style="color:#ff5c57">interface</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#57c7ff">Lock</span>()
</span></span><span style="display:flex;"><span>  <span style="color:#57c7ff">Unlock</span>()
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Goè¯­è¨€æ ‡å‡†åº“<code>sync</code>ä¸­æä¾›äº†ä¸¤ç§é”åˆ†åˆ«æ˜¯äº’æ–¥é”<code>sync.Mutex</code>å’Œè¯»å†™äº’æ–¥é”<code>sync.RWMutex</code></p>
<h3 id="äº’æ–¥é”syncmutex">äº’æ–¥é”<code>sync.Mutex</code><a hidden class="anchor" aria-hidden="true" href="#äº’æ–¥é”syncmutex">#</a></h3>
<blockquote>
<p>sync.Mutexæ˜¯ä¸€ä¸ªäº’æ–¥é”ï¼Œå¯ä»¥ç”±ä¸åŒçš„goroutineåŠ é”å’Œè§£é”ã€‚</p>
</blockquote>
<p><code>sync.Mutex</code>æ˜¯Golangæ ‡å‡†åº“æä¾›çš„ä¸€ä¸ªäº’æ–¥é”ï¼Œå½“ä¸€ä¸ª<code>goroutine</code>è·å¾—äº’æ–¥é”æƒé™åï¼Œå…¶ä»–è¯·æ±‚é”çš„<code>goroutine</code>ä¼šé˜»å¡åœ¨<code>Lock()</code>æ–¹æ³•çš„è°ƒç”¨ä¸Šï¼Œç›´åˆ°è°ƒç”¨<code>Unlock()</code>æ–¹æ³•è¢«é‡Šæ”¾ã€‚</p>
<p>ä¾‹å¦‚ï¼š10ä¸ªå¹¶å‘çš„<code>goroutine</code>æ‰“å°åŒä¸€ä¸ªæ•°å­—100ï¼Œä¸ºé¿å…é‡å¤æ‰“å°ï¼Œå®ç°<code>printOnce(num int)</code>å‡½æ•°ï¼Œä½¿ç”¨é›†åˆ<code>set</code>è®°å½•å·²æ‰“å°è¿‡çš„æ•°å­—ã€‚è‹¥æ•°å­—å·²ç»æ‰“å°è¿‡ï¼Œåˆ™ä¸å†æ‰“å°ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ vim mutex_test.go
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#ff6ac1">package</span> test
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">import</span> (
</span></span><span style="display:flex;"><span>    <span style="color:#5af78e">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#5af78e">&#34;testing&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#5af78e">&#34;time&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">var</span> set = <span style="color:#ff5c57">make</span>(<span style="color:#ff5c57">map</span>[<span style="color:#9aedfe">int</span>]<span style="color:#9aedfe">bool</span>, <span style="color:#ff9f43">0</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">func</span> <span style="color:#57c7ff">printOnce</span>(index <span style="color:#9aedfe">int</span>, num <span style="color:#9aedfe">int</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">if</span> _, ok <span style="color:#ff6ac1">:=</span> set[num]; !ok {
</span></span><span style="display:flex;"><span>        fmt.<span style="color:#57c7ff">Println</span>(index, num)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    set[num] = <span style="color:#ff6ac1">true</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">func</span> <span style="color:#57c7ff">TestPrint</span>(t <span style="color:#ff6ac1">*</span>testing.T) {
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">for</span> i <span style="color:#ff6ac1">:=</span> <span style="color:#ff9f43">0</span>; i &lt; <span style="color:#ff9f43">10</span>; i<span style="color:#ff6ac1">++</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">go</span> <span style="color:#57c7ff">printOnce</span>(i, <span style="color:#ff9f43">100</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    time.<span style="color:#57c7ff">Sleep</span>(time.Second)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ go <span style="color:#ff5c57">test</span> -v mutex_test.go
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">===</span> RUN   TestPrint
</span></span><span style="display:flex;"><span><span style="color:#ff9f43">9</span> <span style="color:#ff9f43">100</span>
</span></span><span style="display:flex;"><span><span style="color:#ff9f43">3</span> <span style="color:#ff9f43">100</span>
</span></span><span style="display:flex;"><span>--- PASS: TestPrint <span style="color:#ff6ac1">(</span>1.00s<span style="color:#ff6ac1">)</span>
</span></span><span style="display:flex;"><span>PASS
</span></span><span style="display:flex;"><span>ok      command-line-arguments  1.304s
</span></span></code></pre></div><p>ç¨‹åºå¤šæ¬¡è¿è¡Œåä¼šå‘ç°æ‰“å°æ¬¡æ•°å¤šæ¬¡ï¼Œå› ä¸ºå¯¹åŒä¸€ä¸ªæ•°æ®ç»“æ„<code>set</code>çš„è®¿é—®å‘ç”Ÿäº†å†²çªã€‚</p>
<p>å¹¶å‘è®¿é—®ä¸­æ¯”å¦‚å¤šä¸ª<code>goroutine</code>å¹¶å‘æ›´æ–°åŒä¸€ä¸ªèµ„æºï¼Œæ¯”å¦‚è®¡æ—¶å™¨ã€è´¦æˆ·ä½™é¢ã€ç§’æ€ç³»ç»Ÿã€å‘åŒä¸€ä¸ªç¼“å­˜ä¸­å¹¶å‘å†™å…¥æ•°æ®ç­‰ç­‰ã€‚å¦‚æœæ²¡æœ‰äº’æ–¥æ§åˆ¶ï¼Œå¾ˆå®¹æ˜“ä¼šå‡ºç°å¼‚å¸¸ï¼Œæ¯”å¦‚è®¡æ—¶å™¨è®¡æ•°ä¸å‡†ç¡®ã€ç”¨æˆ·è´¦æˆ·å¯èƒ½å‡ºç°é€æ”¯ã€ç§’æ€ç³»ç»Ÿå‡ºç°è¶…å–ã€ç¼“å­˜å‡ºç°æ•°æ®ç¼“å­˜ç­‰ç­‰ï¼Œåæœä¼šå¾ˆä¸¥é‡ã€‚</p>
<p>äº’æ–¥é”æ˜¯å¹¶å‘æ§åˆ¶çš„ä¸€ç§åŸºæœ¬æ‰‹æ®µï¼Œæ˜¯ä¸ºäº†é¿å…ç«äº‰è€Œå»ºç«‹çš„ä¸€ç§å¹¶å‘æ§åˆ¶æœºåˆ¶ã€‚å­¦ä¹ å‰é¦–å…ˆéœ€è¦å¼„æ¸…æ¥šä¸€ä¸ªæ¦‚å¿µ-ä¸´ç•ŒåŒºã€‚åœ¨å¹¶å‘ç¼–ç¨‹ä¸­ï¼Œå¦‚æœç¨‹åºä¸­çš„ä¸€éƒ¨åˆ†ä¼šè¢«å¹¶å‘è®¿é—®æˆ–ä¿®æ”¹ï¼Œä¸ºäº†é¿å…å¹¶å‘è®¿é—®å¯¼è‡´çš„æ„æƒ³ä¸åˆ°çš„ç»“æœï¼Œè¿™éƒ¨åˆ†ç¨‹åºéœ€è¦è¢«ä¿æŠ¤èµ·æ¥ï¼Œè¿™éƒ¨åˆ†è¢«ä¿æŠ¤èµ·æ¥çš„ç¨‹åºå°±å«åšä¸´ç•ŒåŒºã€‚</p>
<p>ä¸´ç•ŒåŒºæ˜¯ä¸€ä¸ªè¢«å…±äº«çš„èµ„æºï¼Œæˆ–è€…è¯´æ˜¯ä¸€ä¸ªæ•´ä½“çš„å…±äº«èµ„æºï¼Œæ¯”å¦‚å¯¹æ•°æ®åº“çš„è®¿é—®ï¼Œå¯¹æŸä¸ªå…±äº«æ•°æ®ç»“æ„çš„æ“ä½œã€‚å¯¹ä¸€ä¸ªI/Oè®¾å¤‡çš„ä½¿ç”¨ï¼Œå¯¹ä¸€ä¸ªè¿æ¥æ± ä¸­çš„è¿æ¥çš„è°ƒç”¨ç­‰ç­‰ã€‚</p>
<p>å¦‚æœå¾ˆå¤šçº¿ç¨‹åŒæ­¥è®¿é—®ä¸´ç•ŒåŒºå°±ä¼šé€ æˆè®¿é—®æˆ–æ“ä½œé”™è¯¯ï¼Œè¿™å¹¶ä¸æ˜¯æˆ‘ä»¬å¸Œæœ›çœ‹åˆ°çš„ç»“æœã€‚æ‰€ä»¥ï¼Œä½¿ç”¨äº’æ–¥é”ï¼Œé™å®šä¸´ç•ŒåŒºåªèƒ½åŒæ—¶ç”±ä¸€ä¸ªçº¿ç¨‹æŒæœ‰ã€‚å½“ä¸´ç•ŒåŒºç”±ä¸€ä¸ªçº¿ç¨‹æŒæœ‰çš„æ—¶å€™ï¼Œå…¶ä»–çº¿ç¨‹å¦‚æœæƒ³è¿›å…¥ä¸´ç•ŒåŒºå°±ä¼šè¿”å›å¤±è´¥ï¼Œæˆ–è€…æ˜¯ç­‰å¾…ã€‚ç›´åˆ°æŒæœ‰çš„çº¿ç¨‹é€€å‡ºä¸´ç•ŒåŒºï¼Œè¿™äº›ç­‰å¾…çº¿ç¨‹ä¸­çš„æŸä¸€ä¸ªæ‰æœ‰æœºä¼šæ¥ç€æŒæœ‰è¿™ä¸ªä¸´ç•ŒåŒºã€‚</p>
<p><img loading="lazy" src="https:////upload-images.jianshu.io/upload_images/4933701-df569b90327e0eb1.png?imageMogr2/auto-orient/strip%7cimageView2/2/w/720/format/webp" alt="img"  />
</p>
<p>äº’æ–¥é”</p>
<p>äº’æ–¥é”å¯ä»¥å¾ˆå¥½çš„è§£å†³èµ„æºç«äº‰çš„é—®é¢˜ï¼Œå› æ­¤ä¹Ÿæœ‰äººç§°ä¹‹ä¸ºæ’å®ƒé”ã€‚Golangæ ‡å‡†åº“ä¸­ä½¿ç”¨Mutexæ¥å®ç°äº’æ–¥é”ã€‚æ ¹æ®2019å¹´åˆ†æGoå¹¶å‘Bugçš„è®ºæ–‡Understanding Real-World Concurrency Bugs in Goä¸­ï¼ŒMutexæ˜¯ä½¿ç”¨æœ€ä¸ºå¹¿æ³›çš„åŒæ­¥åŸè¯­ï¼ˆSynchronization primitivesï¼Œ å¹¶å‘åŸè¯­æˆ–åŒæ­¥åŸè¯­ï¼‰ã€‚å…³äºåŒæ­¥åŸè¯­å¹¶æ²¡æœ‰ä¸€ä¸ªä¸¥æ ¼çš„å®šä¹‰ï¼Œå¯å°†å…¶çœ‹ä½œæ˜¯è§£å†³å¹¶å‘é—®é¢˜çš„ä¸€ä¸ªåŸºç¡€çš„æ•°æ®ç»“æ„ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#ff5c57">type</span> Mutex <span style="color:#ff5c57">struct</span> {
</span></span><span style="display:flex;"><span>  state <span style="color:#9aedfe">int32</span> <span style="color:#78787e">//çŠ¶æ€æ ‡è¯†
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>  sema <span style="color:#9aedfe">uint32</span> <span style="color:#78787e">//ä¿¡å·é‡
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>}
</span></span></code></pre></div><p>Goæ ‡å‡†åº“æä¾›äº†<code>sync.Mutex</code>äº’æ–¥é”ç±»å‹ä»¥åŠä¸¤ä¸ªæ–¹æ³•åˆ†åˆ«æ˜¯<code>Lock</code>åŠ é”å’Œ<code>Unlock</code>é‡Šæ”¾é”ã€‚å¯ä»¥é€šè¿‡åœ¨ä»£ç å‰è°ƒç”¨<code>Lock</code>æ–¹æ³•ï¼Œåœ¨ä»£ç åè°ƒç”¨<code>Unlock</code>æ–¹æ³•æ¥ä¿è¯ä¸€æ®µä»£ç çš„äº’æ–¥æ‰§è¡Œï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨<code>defer</code>è¯­å¥æ¥ä¿è¯äº’æ–¥é”ä¸€å®šä¼šè¢«è§£é”ã€‚å½“ä¸€ä¸ª<code>goroutine</code>è°ƒç”¨<code>Lock</code>æ–¹æ³•è·å¾—é”åï¼Œå…¶å®ƒè¯·æ±‚çš„<code>goroutine</code>éƒ½ä¼šé˜»å¡åœ¨<code>Lock</code>æ–¹æ³•ç›´åˆ°é”è¢«é‡Šæ”¾ã€‚</p>
<p>ä¸€ä¸ªäº’æ–¥é”åªèƒ½åŒæ—¶è¢«ä¸€ä¸ª<code>goroutine</code>é”å®šï¼Œå…¶å®ƒ<code>goroutine</code>å°†é˜»å¡ç›´åˆ°äº’æ–¥é”è¢«è§£é”ï¼Œä¹Ÿå°±æ˜¯é‡æ–°äº‰æŠ¢å¯¹äº’æ–¥é”çš„é”å®šã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¯¹ä¸€ä¸ªæœªé”å®šçš„äº’æ–¥é”è§£é”æ—¶å°†ä¼šäº§ç”Ÿè¿è¡Œæ—¶é”™è¯¯ã€‚</p>
<p><code>sync.Mutex</code>ä¸åŒºåˆ†è¯»å†™é”ï¼Œåªæœ‰<code>Lock()</code>å’Œ<code>Lock()</code>ä¹‹é—´æ‰ä¼šå¯¼è‡´é˜»å¡çš„æƒ…å†µã€‚è‹¥åœ¨ä¸€ä¸ªåœ°æ–¹<code>Lock()</code>ï¼Œåœ¨å¦ä¸€ä¸ªåœ°æ–¹ä¸<code>Lock()</code>è€Œæ˜¯ç›´æ¥ä¿®æ”¹æˆ–è®¿é—®å…±äº«æ•°æ®ï¼Œå¯¹äº<code>sync.Mutext</code>ç±»å‹æ˜¯å…è®¸çš„ï¼Œå› ä¸º<code>mutex</code>ä¸ä¼šå’Œ<code>goroutine</code>è¿›è¡Œå…³è”ã€‚è‹¥è¦åŒºåˆ†è¯»é”å’Œå†™é”ï¼Œå¯ä½¿ç”¨<code>sync.RWMutex</code>ç±»å‹ã€‚</p>
<p>åœ¨<code>Lock()</code>å’Œ<code>Unlock()</code>ä¹‹é—´çš„ä»£ç æ®µæˆä¸ºèµ„æºä¸´ç•ŒåŒºï¼ˆcritical sectionï¼‰ï¼Œåœ¨è¿™ä¸€åŒºé—´å†…çš„ä»£ç æ˜¯ä¸¥æ ¼è¢«<code>Lock()</code>ä¿æŠ¤çš„ï¼Œæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä»»ä½•ä¸€ä¸ªæ—¶é—´ç‚¹éƒ½åªèƒ½æœ‰ä¸€ä¸ª<code>goroutine</code>æ‰§è¡Œè¿™æ®µåŒºé—´çš„ä»£ç ã€‚</p>
<p>ä¾‹å¦‚ï¼šä½¿ç”¨äº’æ–¥é”çš„<code>Lock()</code>å’Œ<code>Unlock()</code>æ–¹æ³•å°†å†²çªåŒ…è£¹</p>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#ff6ac1">package</span> test
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">import</span> (
</span></span><span style="display:flex;"><span>    <span style="color:#5af78e">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#5af78e">&#34;sync&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#5af78e">&#34;testing&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#5af78e">&#34;time&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">var</span> m sync.Mutex
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">var</span> set = <span style="color:#ff5c57">make</span>(<span style="color:#ff5c57">map</span>[<span style="color:#9aedfe">int</span>]<span style="color:#9aedfe">bool</span>, <span style="color:#ff9f43">0</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">func</span> <span style="color:#57c7ff">printOnce</span>(index <span style="color:#9aedfe">int</span>, num <span style="color:#9aedfe">int</span>) {
</span></span><span style="display:flex;"><span>    m.<span style="color:#57c7ff">Lock</span>()
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">defer</span> m.<span style="color:#57c7ff">Unlock</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">if</span> _, ok <span style="color:#ff6ac1">:=</span> set[num]; !ok {
</span></span><span style="display:flex;"><span>        fmt.<span style="color:#57c7ff">Println</span>(index, num)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    set[num] = <span style="color:#ff6ac1">true</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">func</span> <span style="color:#57c7ff">TestPrint</span>(t <span style="color:#ff6ac1">*</span>testing.T) {
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">for</span> i <span style="color:#ff6ac1">:=</span> <span style="color:#ff9f43">0</span>; i &lt; <span style="color:#ff9f43">10</span>; i<span style="color:#ff6ac1">++</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">go</span> <span style="color:#57c7ff">printOnce</span>(i, <span style="color:#ff9f43">100</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    time.<span style="color:#57c7ff">Sleep</span>(time.Second)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>ç›¸åŒçš„æ•°å­—åªä¼šæ¯”æ‰“å°ä¸€æ¬¡ï¼Œå½“ä¸€ä¸ª<code>goroutine</code>è°ƒç”¨äº†<code>Lock()</code>æ–¹æ³•æ—¶ï¼Œå…¶ä»–<code>goroutine</code>è¢«é˜»å¡äº†ï¼Œç›´åˆ°<code>Unlock()</code>è°ƒç”¨å°†é”é‡Šæ”¾ã€‚å› æ­¤è¢«åŒ…è£¹éƒ¨åˆ†çš„ä»£ç å°±èƒ½é¿å…å†²çªï¼Œå®ç°äº’æ–¥ã€‚</p>
<p>äº’æ–¥å³ä¸èƒ½åŒæ—¶è¿è¡Œï¼Œä½¿ç”¨äº’æ–¥é”çš„ä¸¤ä¸ªä»£ç ç‰‡æ®µç›¸äº’æ’æ–¥ï¼Œåªæœ‰å…¶ä¸­ä¸€ä¸ªä»£ç ç‰‡æ®µæ‰§è¡Œå®Œæ¯•åï¼Œå¦ä¸€ä¸ªæ‰èƒ½æ‰§è¡Œã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#ff6ac1">package</span> main
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">import</span> (
</span></span><span style="display:flex;"><span>    <span style="color:#5af78e">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#5af78e">&#34;sync&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#5af78e">&#34;time&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">func</span> <span style="color:#57c7ff">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#ff5c57">var</span> num = <span style="color:#ff9f43">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff5c57">var</span> locker sync.Mutex
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">for</span> i <span style="color:#ff6ac1">:=</span> <span style="color:#ff9f43">0</span>; i &lt; <span style="color:#ff9f43">100000</span>; i<span style="color:#ff6ac1">++</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">go</span> <span style="color:#ff5c57">func</span>(i <span style="color:#9aedfe">int</span>) {
</span></span><span style="display:flex;"><span>            locker.<span style="color:#57c7ff">Lock</span>()
</span></span><span style="display:flex;"><span>            <span style="color:#ff6ac1">defer</span> locker.<span style="color:#57c7ff">Unlock</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            num<span style="color:#ff6ac1">++</span>
</span></span><span style="display:flex;"><span>            fmt.<span style="color:#57c7ff">Printf</span>(<span style="color:#5af78e">&#34;goroutine %d: num = %d\n&#34;</span>, i, num)
</span></span><span style="display:flex;"><span>        }(i)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    time.<span style="color:#57c7ff">Sleep</span>(time.Second)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>ä»ä¸Šä¾‹ä¸­å¯ä»¥å‘ç°ï¼Œæ·»åŠ äº’æ–¥é”åï¼Œä¸ä»…æ²¡æœ‰å‡ºç°æŠ¢å èµ„æºå¯¼è‡´çš„é‡å¤è¾“å‡ºï¼Œè€Œä¸”è¾“å‡ºç»“æœé¡ºåºé€’å¢ã€‚</p>
<p>Goè¯­è¨€ä¸­çš„Mutexç±»å‹çš„äº’æ–¥é”<code>Lock()</code>é”å®šä¸å…¶å®ƒè¯­è¨€ä¸åŒçš„æ˜¯ï¼Œ<code>Lock()</code>é”å®šçš„æ˜¯äº’æ–¥é”è€Œéä¸€æ®µä»£ç ã€‚å…¶ä»–è¯­è¨€æ¯”å¦‚Javaä¸­ä½¿ç”¨åŒæ­¥é”é”å®šçš„æ˜¯ä¸€æ®µä»£ç ï¼Œä»¥ç¡®ä¿å¤šçº¿ç¨‹å¹¶å‘èª“åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥æ§åˆ¶è¿è¡Œæ­¤ä»£ç å—ç›´åˆ°é‡Šæ”¾åŒæ­¥é”ã€‚Goè¯­è¨€æ˜¯åœ¨<code>goroutine</code>ä¸­é”å®šäº’æ–¥é”ï¼Œå…¶å®ƒ<code>goroutine</code>æ‰§è¡Œåˆ°æœ‰é”çš„ä½ç½®æ—¶ï¼Œç”±äºè·å–ä¸åˆ°äº’æ–¥é”çš„é”å®šï¼Œå› æ­¤ä¼šå‘ç”Ÿé˜»å¡è€Œç­‰å¾…ï¼Œä»è€Œè¾¾åˆ°æ§åˆ¶åŒæ­¥çš„ç›®çš„ã€‚</p>
<h3 id="race-detector">race detector<a hidden class="anchor" aria-hidden="true" href="#race-detector">#</a></h3>
<p>Golangæä¾›äº†ä¸€ä¸ªæ£€æµ‹å¹¶å‘è®¿é—®å…±äº«èµ„æºæ˜¯å¦å­˜åœ¨é—®é¢˜çš„å·¥å…· - race detectorï¼Œå®ƒå¯ä»¥å¸®åŠ©è‡ªåŠ¨å‘ç°åŸä¸­æœ‰æ²¡æœ‰data raceçš„é—®é¢˜ã€‚</p>
<p>Golangçš„race detectoræ˜¯åŸºäºGoogleçš„C/C++ sanitizersæŠ€æœ¯å®ç°çš„ï¼Œç¼–è¯‘å™¨é€šè¿‡æ¢æµ‹æ‰€æœ‰çš„å†…å­˜è®¿é—®ï¼ŒåŠ å…¥ä»£ç èƒ½ç›‘è§†å¯¹è¿™äº›å†…å­˜åœ°å€çš„è®¿é—®ï¼ˆè¯»æˆ–æ˜¯å†™ï¼‰ã€‚ä»£ç è¿è¡Œæ—¶race detectorèƒ½ç›‘æ§å¯¹å…±äº«å˜é‡çš„éåŒæ­¥è®¿é—®ï¼Œå‡ºç°raceæ—¶å°±ä¼šæ‰“å°å‡ºè­¦å‘Šä¿¡æ¯ã€‚</p>
<p><a href="https://links.jianshu.com/go?to=https%3A%2F%2Fblog.golang.org%2Frace-detector">https://blog.golang.org/race-detector</a></p>
<h3 id="è¯»å†™é”syncrwmutex">è¯»å†™é”<code>sync.RWMutex</code><a hidden class="anchor" aria-hidden="true" href="#è¯»å†™é”syncrwmutex">#</a></h3>
<p>åœ¨é“¶è¡Œå­˜å–é’±æ—¶ï¼Œå¯¹è´¦æˆ·ä½™é¢çš„ä¿®æ”¹æ˜¯éœ€è¦åŠ é”çš„ï¼Œå› æ­¤æ­¤æ—¶å¯èƒ½æœ‰äººæ±‡æ¬¾åˆ°ä½ çš„è´¦æˆ·ï¼Œå¦‚æœå¯¹é‡‘é¢çš„ä¿®æ”¹ä¸åŠ é”ï¼Œå¾ˆå¯èƒ½å¯¼è‡´æœ€åçš„é‡‘é¢å‘ç”Ÿé”™è¯¯ã€‚è¯»å–è´¦æˆ·ä½™é¢ä¹Ÿéœ€è¦ç­‰å¾…ä¿®æ”¹æ“ä½œç»“æŸï¼Œæ‰èƒ½è¯»å–åˆ°æ­£ç¡®çš„ä½™é¢ã€‚å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œè¯»å–ä½™é¢çš„æ“ä½œä¼šæ›´åŠ é¢‘ç¹ï¼Œå¦‚æœèƒ½ä¿è¯è¯»å–ä½™é¢çš„æ“ä½œèƒ½å¹¶å‘æ‰§è¡Œï¼Œç¨‹åºçš„æ•ˆç‡ä¼šå¾ˆå¤§åœ°æå‡ã€‚</p>
<p>ä¿è¯è¯»æ“ä½œçš„å®‰å…¨ï¼Œåªéœ€è¦ä¿è¯å¹¶å‘è¯»æ—¶æ²¡æœ‰å†™æ“ä½œåœ¨è¿›è¡Œå°±è¡Œã€‚åœ¨è¿™ç§åœºæ™¯ä¸‹å°±éœ€è¦ä¸€ç§ç‰¹æ®Šç±»å‹çš„é”ï¼Œå³å…è®¸å¤šä¸ªåªè¯»æ“ä½œå¹¶è¡Œæ‰§è¡Œï¼Œä½†å†™æ“ä½œä¼šå®Œå…¨äº’æ–¥ã€‚è¿™ç§é”ç§°ä¹‹ä¸ºå¤šè¯»å•å†™é”ï¼ˆmultiple readers, single writer lockï¼‰ï¼Œç®€ç§°è¯»å†™é”ã€‚è¯»å†™é”åˆ†ä¸ºè¯»é”å’Œå†™é”ï¼Œè¯»é”å…è®¸åŒæ—¶æ‰§è¡Œï¼Œä½†å†™é”æ˜¯äº’æ–¥çš„ã€‚</p>
<p><code>sync.RWMutex</code>è¯»å†™é”æ˜¯åŸºäº<code>sync.Mutex</code>å®ç°çš„ï¼Œè¯»å†™é”çš„ç‰¹ç‚¹æ˜¯é’ˆå¯¹è¯»å†™æ“ä½œçš„äº’æ–¥é”ï¼Œè¯»å†™é”ä¸äº’æ–¥é”æœ€å¤§ä¸åŒä¹‹å¤„åœ¨äºåˆ†åˆ«å¯¹è¯»ã€å†™è¿›è¡Œäº†é”å®šã€‚ä¸€èˆ¬ç”¨åœ¨å¤§é‡è¯»æ“ä½œå°‘é‡å†™æ“ä½œä¸­ã€‚</p>
<ul>
<li>åŒæ—¶åªèƒ½å…·æœ‰ä¸€ä¸ª<code>goroutine</code>èƒ½å¤Ÿè·å¾—å†™é”å®š</li>
<li>åŒæ—¶å¯ä»¥å…·æœ‰ä»»æ„å¤šä¸ª<code>goroutine</code>è·å¾—è¯»é”å®š</li>
<li>åŒæ—¶åªèƒ½å­˜åœ¨å†™é”å®šæˆ–è¯»é”å®šï¼Œå³è¯»å’Œå†™äº’æ–¥ã€‚</li>
</ul>
<p>æ¢å¥è¯è¯´</p>
<ul>
<li>å½“åªæœ‰ä¸€ä¸ª<code>goroutine</code>è·å¾—å†™é”å®šæ—¶ï¼Œå…¶å®ƒæ— è®ºæ˜¯è¯»é”å®šè¿˜æ˜¯å†™é”å®šéƒ½å°†ä¼šé˜»å¡ç›´åˆ°å†™è§£é”ã€‚</li>
<li>å½“åªæœ‰ä¸€ä¸ª<code>goroutine</code>è·å¾—è¯»é”å®šæ—¶ï¼Œå…¶å®ƒè¯»é”å®šä»ç„¶å¯ä»¥ç»§ç»­æ‰§è¡Œã€‚</li>
<li>å½“æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªè¯»é”å®šæ—¶ï¼Œå†™é”å®šå°†ç­‰å¾…æ‰€æœ‰è¯»é”å®šè§£é”ä¹‹åæ‰èƒ½è¿›è¡Œå†™é”å®šã€‚</li>
</ul>
<p>è¿™é‡Œæ‰€è°“çš„è¯»é”å®šï¼ˆRLockï¼‰ç›®çš„æ˜¯ä¸ºäº†å‘Šè¯‰å†™é”å®šï¼ˆLockï¼‰ï¼Œæ­¤æ—¶æœ‰å¾ˆå¤šäººæ­£åœ¨è¯»å–æ•°æ®ï¼Œå†™é”å®šéœ€è¦æ’é˜Ÿç­‰å¾…ã€‚</p>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œè¯»å†™é”ä¼šåˆ†ä¸ºå‡ ç§æƒ…å†µï¼š</p>
<ul>
<li>è¯»é”ä¹‹é—´ä¸äº’æ–¥ï¼Œåœ¨æ²¡æœ‰å†™é”çš„æƒ…å†µä¸‹ï¼Œè¯»é”æ˜¯æ— å µå¡çš„ï¼Œå¤šä¸ª<code>goroutine</code>å¯ä»¥åŒæ—¶è·å¾—è¯»é”ã€‚</li>
<li>å†™é”ä¹‹é—´æ˜¯äº’æ–¥çš„ï¼Œå½“å­˜åœ¨å†™é”æ—¶ï¼Œå…¶å®ƒå†™é”ä¼šé˜»å¡ã€‚</li>
<li>å†™é”ä¸è¯»é”äº’æ–¥ï¼Œè‹¥å­˜åœ¨è¯»é”åˆ™å†™é”é˜»å¡ï¼Œè‹¥å­˜åœ¨å†™é”åˆ™è¯»é”é˜»å¡ã€‚</li>
</ul>
<p>Goæ ‡å‡†åº“<code>sync.RWMutex</code>è¯»å†™äº’æ–¥é”æä¾›äº†å››ä¸ªæ–¹æ³•</p>
<table>
<thead>
<tr>
<th>è¯»å†™äº’æ–¥é”</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td>Lock</td>
<td>æ·»åŠ å†™é”</td>
</tr>
<tr>
<td>Unlock</td>
<td>é‡Šæ”¾å†™é”</td>
</tr>
<tr>
<td>RLock</td>
<td>æ·»åŠ è¯»é”</td>
</tr>
<tr>
<td>RUnlock</td>
<td>é‡Šæ”¾è¯»é”</td>
</tr>
</tbody>
</table>
<h2 id="å¹¶å‘ç¼–ç¨‹-select-switch">å¹¶å‘ç¼–ç¨‹-&gt;select switch<a hidden class="anchor" aria-hidden="true" href="#å¹¶å‘ç¼–ç¨‹-select-switch">#</a></h2>
<p>1.selectæ˜¯Goä¸­çš„ä¸€ä¸ªæ§åˆ¶ç»“æ„ï¼Œç±»ä¼¼äºswitchè¯­å¥ï¼Œç”¨äºå¤„ç†å¼‚æ­¥IOæ“ä½œã€‚selectä¼šç›‘å¬caseè¯­å¥ä¸­channelçš„è¯»å†™æ“ä½œï¼Œå½“caseä¸­channelè¯»å†™æ“ä½œä¸ºéé˜»å¡çŠ¶æ€ï¼ˆå³èƒ½è¯»å†™ï¼‰æ—¶ï¼Œå°†ä¼šè§¦å‘ç›¸åº”çš„åŠ¨ä½œã€‚</p>
<blockquote>
<p>selectä¸­çš„caseè¯­å¥å¿…é¡»æ˜¯ä¸€ä¸ªchannelæ“ä½œ.
selectä¸­çš„defaultå­å¥æ€»æ˜¯å¯è¿è¡Œçš„ã€‚</p>
</blockquote>
<p>2.å¦‚æœæœ‰å¤šä¸ªcaseéƒ½å¯ä»¥è¿è¡Œï¼Œselectä¼šéšæœºå…¬å¹³åœ°é€‰å‡ºä¸€ä¸ªæ‰§è¡Œï¼Œå…¶ä»–ä¸ä¼šæ‰§è¡Œã€‚</p>
<p>3.å¦‚æœæ²¡æœ‰å¯è¿è¡Œçš„caseè¯­å¥ï¼Œä¸”æœ‰defaultè¯­å¥ï¼Œé‚£ä¹ˆå°±ä¼šæ‰§è¡Œdefaultçš„åŠ¨ä½œã€‚</p>
<p>4.å¦‚æœæ²¡æœ‰å¯è¿è¡Œçš„caseè¯­å¥ï¼Œä¸”æ²¡æœ‰defaultè¯­å¥ï¼Œselectå°†é˜»å¡ï¼Œç›´åˆ°æŸä¸ªcaseé€šä¿¡å¯ä»¥è¿è¡Œ.</p>
<p>å®ä¾‹</p>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#ff6ac1">package</span> Base
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">import</span> <span style="color:#5af78e">&#34;time&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">var</span> chanInt = <span style="color:#ff5c57">make</span>(<span style="color:#ff5c57">chan</span> <span style="color:#9aedfe">int</span>)
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">var</span> chanStr = <span style="color:#ff5c57">make</span>(<span style="color:#ff5c57">chan</span> <span style="color:#9aedfe">string</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">func</span> <span style="color:#57c7ff">Channel</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">go</span> <span style="color:#ff5c57">func</span>() {
</span></span><span style="display:flex;"><span>		chanInt <span style="color:#ff6ac1">&lt;-</span> <span style="color:#ff9f43">100</span>
</span></span><span style="display:flex;"><span>		chanStr <span style="color:#ff6ac1">&lt;-</span> <span style="color:#5af78e">&#34;Hello&#34;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#ff6ac1">defer</span> <span style="color:#ff5c57">close</span>(chanInt)
</span></span><span style="display:flex;"><span>		<span style="color:#ff6ac1">defer</span> <span style="color:#ff5c57">close</span>(chanStr)
</span></span><span style="display:flex;"><span>	}()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">for</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#ff6ac1">select</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#ff6ac1">case</span> r <span style="color:#ff6ac1">:=</span> <span style="color:#ff6ac1">&lt;-</span>chanInt:
</span></span><span style="display:flex;"><span>			<span style="color:#ff5c57">println</span>(<span style="color:#5af78e">&#34;chanInt&#34;</span>, r)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#ff6ac1">case</span> r <span style="color:#ff6ac1">:=</span> <span style="color:#ff6ac1">&lt;-</span>chanStr:
</span></span><span style="display:flex;"><span>			<span style="color:#ff5c57">println</span>(<span style="color:#5af78e">&#34;chanStr&#34;</span>, r)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#ff6ac1">default</span>:
</span></span><span style="display:flex;"><span>			<span style="color:#ff5c57">println</span>(<span style="color:#5af78e">&#34;default&#34;</span>)
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		time.<span style="color:#57c7ff">Sleep</span>(time.Second)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>default
chanInt 100
chanStr Hello
chanStr
chanStr
chanInt 0
chanInt 0
&hellip;&hellip;</p>
<h2 id="å¹¶å‘ç¼–ç¨‹-timer">å¹¶å‘ç¼–ç¨‹-&gt;Timer<a hidden class="anchor" aria-hidden="true" href="#å¹¶å‘ç¼–ç¨‹-timer">#</a></h2>
<p>Timeré¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å®šæ—¶å™¨çš„æ„æ€ï¼Œå¯ä»¥å®ç°ä¸€äº›å®šæ—¶æ“ä½œï¼Œå†…éƒ¨ä¹Ÿæ˜¯é€šè¿‡channelæ¥å®ç°çš„ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#ff6ac1">package</span> Base
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">import</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#5af78e">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#5af78e">&#34;time&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">func</span> <span style="color:#57c7ff">Timer</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#78787e">// ç¬¬ä¸€ç§åˆ›å»ºæ–¹å¼
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>	timer <span style="color:#ff6ac1">:=</span> time.<span style="color:#57c7ff">NewTimer</span>(time.Second <span style="color:#ff6ac1">*</span> <span style="color:#ff9f43">2</span>)
</span></span><span style="display:flex;"><span>	fmt.<span style="color:#57c7ff">Println</span>(time.<span style="color:#57c7ff">Now</span>())
</span></span><span style="display:flex;"><span>	c <span style="color:#ff6ac1">:=</span> <span style="color:#ff6ac1">&lt;-</span>timer.C
</span></span><span style="display:flex;"><span>	fmt.<span style="color:#57c7ff">Println</span>(c)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#78787e">//  ç›¸å·®ä¸¤ç§’
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>	<span style="color:#78787e">//2022-09-13 11:28:25.6609052 +0800 +08 m=+0.004536701
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>	<span style="color:#78787e">//2022-09-13 11:28:27.6616643 +0800 +08 m=+2.005295801
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="å¹¶å‘ç¼–ç¨‹-ticker">å¹¶å‘ç¼–ç¨‹-&gt;Ticker<a hidden class="anchor" aria-hidden="true" href="#å¹¶å‘ç¼–ç¨‹-ticker">#</a></h2>
<p>Timeråªæ‰§è¡Œä¸€æ¬¡ï¼ŒTickerTå¯ä»¥å‘¨æœŸçš„æ‰§è¡Œã€‚</p>
<p>å®ä¾‹</p>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#ff5c57">func</span> <span style="color:#57c7ff">Ticker</span>() {
</span></span><span style="display:flex;"><span>	ticker <span style="color:#ff6ac1">:=</span> time.<span style="color:#57c7ff">NewTicker</span>(time.Second)
</span></span><span style="display:flex;"><span>	count <span style="color:#ff6ac1">:=</span> <span style="color:#ff9f43">0</span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">for</span> <span style="color:#ff6ac1">range</span> ticker.C {
</span></span><span style="display:flex;"><span>		fmt.<span style="color:#57c7ff">Println</span>(<span style="color:#5af78e">&#34;ticker...&#34;</span>)
</span></span><span style="display:flex;"><span>		count<span style="color:#ff6ac1">++</span>
</span></span><span style="display:flex;"><span>		<span style="color:#ff6ac1">if</span> count <span style="color:#ff6ac1">&gt;=</span> <span style="color:#ff9f43">5</span> {
</span></span><span style="display:flex;"><span>			ticker.<span style="color:#57c7ff">Stop</span>()
</span></span><span style="display:flex;"><span>			<span style="color:#ff6ac1">break</span>
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="å¹¶å‘ç¼–ç¨‹-åŸå­å˜é‡">å¹¶å‘ç¼–ç¨‹-&gt;åŸå­å˜é‡<a hidden class="anchor" aria-hidden="true" href="#å¹¶å‘ç¼–ç¨‹-åŸå­å˜é‡">#</a></h2>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#ff6ac1">package</span> Base
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">import</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#5af78e">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#5af78e">&#34;sync/atomic&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#5af78e">&#34;time&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">var</span> num <span style="color:#9aedfe">int64</span> = <span style="color:#ff9f43">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">func</span> <span style="color:#57c7ff">Add</span>(i <span style="color:#9aedfe">int64</span>) {
</span></span><span style="display:flex;"><span>	atomic.<span style="color:#57c7ff">AddInt64</span>(<span style="color:#ff6ac1">&amp;</span>i, <span style="color:#ff9f43">1</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">func</span> <span style="color:#57c7ff">Sub</span>(i <span style="color:#9aedfe">int64</span>) {
</span></span><span style="display:flex;"><span>	atomic.<span style="color:#57c7ff">AddInt64</span>(<span style="color:#ff6ac1">&amp;</span>i, <span style="color:#ff6ac1">-</span><span style="color:#ff9f43">1</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">func</span> <span style="color:#57c7ff">Atomic</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">for</span> ; num &lt; <span style="color:#ff9f43">1000</span>; num<span style="color:#ff6ac1">++</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#ff6ac1">go</span> <span style="color:#57c7ff">Add</span>(num)
</span></span><span style="display:flex;"><span>		<span style="color:#ff6ac1">go</span> <span style="color:#57c7ff">Sub</span>(num)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	time.<span style="color:#57c7ff">Sleep</span>(time.Second <span style="color:#ff6ac1">*</span> <span style="color:#ff9f43">1</span>)
</span></span><span style="display:flex;"><span>	fmt.<span style="color:#57c7ff">Println</span>(<span style="color:#5af78e">&#34;Sum:&#34;</span>, num)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h1 id="advanced-level">Advanced level<a hidden class="anchor" aria-hidden="true" href="#advanced-level">#</a></h1>
<h2 id="fmt">fmt<a hidden class="anchor" aria-hidden="true" href="#fmt">#</a></h2>
<p><a href="https://www.bilibili.com/read/cv14519061/?from=readlist">https://www.bilibili.com/read/cv14519061/?from=readlist</a></p>
<h2 id="æ–‡ä»¶å¸¸è§æ“ä½œè¯»å†™-os-io-bufioåŒ…">æ–‡ä»¶å¸¸è§æ“ä½œ/è¯»å†™ (os, io, bufioåŒ…)<a hidden class="anchor" aria-hidden="true" href="#æ–‡ä»¶å¸¸è§æ“ä½œè¯»å†™-os-io-bufioåŒ…">#</a></h2>
<p><a href="https://www.bilibili.com/read/cv14586068/?from=readlist">https://www.bilibili.com/read/cv14586068/?from=readlist</a></p>
<h2 id="é”™è¯¯æ—¥å¿—å•å…ƒæµ‹è¯•">é”™è¯¯/æ—¥å¿—/å•å…ƒæµ‹è¯•<a hidden class="anchor" aria-hidden="true" href="#é”™è¯¯æ—¥å¿—å•å…ƒæµ‹è¯•">#</a></h2>
<p>é”™è¯¯å¤„ç†</p>
<p><img loading="lazy" src="base.assets/712443b1669e81a8d28523569312af3e12dbe8e1.png@1256w_256h_!web-article-pic.avif" alt="img"  />
</p>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#ff5c57">func</span> <span style="color:#57c7ff">Errors</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">defer</span> <span style="color:#ff5c57">func</span>() {
</span></span><span style="display:flex;"><span>		err <span style="color:#ff6ac1">:=</span> <span style="color:#ff5c57">recover</span>()
</span></span><span style="display:flex;"><span>		fmt.<span style="color:#57c7ff">Println</span>(<span style="color:#5af78e">&#34;æ•æ‰åˆ°äº†é”™è¯¯:&#34;</span>, err)
</span></span><span style="display:flex;"><span>	}()
</span></span><span style="display:flex;"><span>	err1 <span style="color:#ff6ac1">:=</span> errors.<span style="color:#57c7ff">New</span>(<span style="color:#5af78e">&#34;å¯çˆ±çš„é”™è¯¯&#34;</span>)
</span></span><span style="display:flex;"><span>	fmt.<span style="color:#57c7ff">Println</span>(<span style="color:#5af78e">&#34;err1=&#34;</span>, err1)
</span></span><span style="display:flex;"><span>	err2 <span style="color:#ff6ac1">:=</span> fmt.<span style="color:#57c7ff">Errorf</span>(<span style="color:#5af78e">&#34;%sçš„é”™è¯¯&#34;</span>, <span style="color:#5af78e">&#34;æ¸©æŸ”&#34;</span>)
</span></span><span style="display:flex;"><span>	fmt.<span style="color:#57c7ff">Println</span>(<span style="color:#5af78e">&#34;err2=&#34;</span>, err2)
</span></span><span style="display:flex;"><span>	<span style="color:#ff5c57">panic</span>(err1)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="å•å…ƒæµ‹è¯•-1">å•å…ƒæµ‹è¯•<a hidden class="anchor" aria-hidden="true" href="#å•å…ƒæµ‹è¯•-1">#</a></h3>
<p>6.10.1 å‘½åè§„èŒƒ</p>
<p>æ–‡ä»¶å: xxx_test.go (é€šå¸¸xxxä¸ºè¢«æµ‹è¯•æ–‡ä»¶å)</p>
<p>6.10.2 æµ‹è¯•å‡½æ•°</p>
<p>æµ‹è¯•å‡½æ•°: func TestXxx(*testing.T) (é€šå¸¸Xxxä¸ºè¢«æµ‹è¯•å‡½æ•°å)</p>
<p>æ€§èƒ½æµ‹è¯•å‡½æ•°: func BenchmarkXxx(*testing.B) (é€šå¸¸Xxxä¸ºè¢«æµ‹è¯•å‡½æ•°å)</p>
<p>6.10.3 testing.Tä¸testing.B</p>
<p>testing.Tä¸testing.Bæ˜¯testingåŒ…å®šä¹‰çš„ç»“æ„ä½“ï¼Œä¸‹é¢ç®€ç§°tä¸b</p>
<p><img loading="lazy" src="base.assets/b8950c14a871cc5bed9198ad1fe126786f372a8d.png@1256w_784h_!web-article-pic.avif" alt="img"  />
</p>
<p>6.10.4 æµ‹è¯•å‘½ä»¤(go modä¸‹)</p>
<p>é¡¹ç›®åå¯ä»¥ç®€å†™ä¸º&rdquo;.&quot;ï¼Œä¸‹é¢åŒä¸€ä¸º&quot;.&quot;</p>
<p>æµ‹è¯•æŒ‡å®šåŒ…: go test ./æ–‡ä»¶å¤¹è·¯å¾„</p>
<p>å°†è‡ªåŠ¨è°ƒç”¨æ‰€æœ‰_test.goæ–‡ä»¶ä¸­çš„æ‰€æœ‰TestXxxå‡½æ•°</p>
<p>æµ‹è¯•æŒ‡å®šæ–‡ä»¶: go test ./æ–‡ä»¶å¤¹è·¯å¾„/xxx_test.go ./go/æ–‡ä»¶å¤¹è·¯å¾„/xxx.go</p>
<p>å°†è‡ªåŠ¨è°ƒç”¨xxx_test.goä¸­çš„æ‰€æœ‰TestXxxå‡½æ•°</p>
<p>flag</p>
<p>flagå¯ä»¥å†™åœ¨ ./&hellip; å‰ä¹Ÿå¯ä»¥å†™åœ¨ ./&hellip; ä¹‹å</p>
<p>ä¹Ÿè¿è¡ŒBenchmarkXxxå‡½æ•°: go test -bench ./â€¦</p>
<p>è¯¦ç»†è¾“å‡º(verbose): go test -v ./â€¦</p>
<p>å³ä½¿è¿è¡ŒæˆåŠŸä¹Ÿè¾“å‡ºæ—¥å¿—</p>
<p>è§„å®šæµ‹è¯•æ—¶é—´: go test -benchtime XhXmXs ./â€¦</p>
<p>è§„å®šæµ‹è¯•æ¬¡æ•°: go test -benchtime  Nx ./â€¦</p>
<p>æŒ‡å®šæµ‹è¯•cpuæ•°é‡: go test -cpu N ./â€¦</p>
<p>æŒ‡å®šæµ‹è¯•å‡½æ•°: go test -run  TestXxx ./â€¦</p>
<p>åªæµ‹è¯•TestXxxå‡½æ•°</p>
<p>è¶…æ—¶é™åˆ¶: go test -timeout XhXmXs ./â€¦</p>
<p>é»˜è®¤é™åˆ¶ä¸º10min</p>
<p>æ‰“å°æµ‹è¯•çš„å†…å­˜ä½¿ç”¨ç»Ÿè®¡: go test -benchmem ./â€¦</p>
<p>ä½œè€…ï¼šFangChannel <a href="https://www.bilibili.com/read/cv14614760/?from=readlist">https://www.bilibili.com/read/cv14614760/?from=readlist</a> å‡ºå¤„ï¼šbilibili</p>
<h2 id="for-range-1">for range<a hidden class="anchor" aria-hidden="true" href="#for-range-1">#</a></h2>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#ff6ac1">package</span> main
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">import</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#5af78e">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#5af78e">&#34;strings&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">type</span>  Detail <span style="color:#ff5c57">struct</span>{
</span></span><span style="display:flex;"><span>  Rid <span style="color:#9aedfe">int</span>
</span></span><span style="display:flex;"><span>  TeamName <span style="color:#9aedfe">string</span>
</span></span><span style="display:flex;"><span>  Member <span style="color:#9aedfe">string</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">type</span> TeamMember <span style="color:#ff5c57">struct</span>{
</span></span><span style="display:flex;"><span>  Rid <span style="color:#9aedfe">int</span>
</span></span><span style="display:flex;"><span>  Member <span style="color:#9aedfe">string</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">func</span> <span style="color:#57c7ff">main</span>() {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  d1<span style="color:#ff6ac1">:=</span>Detail{
</span></span><span style="display:flex;"><span>    Rid: <span style="color:#ff9f43">10</span>,
</span></span><span style="display:flex;"><span>    TeamName: <span style="color:#5af78e">&#34;ddd10&#34;</span>,
</span></span><span style="display:flex;"><span>    Member: <span style="color:#5af78e">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  d2<span style="color:#ff6ac1">:=</span>Detail{
</span></span><span style="display:flex;"><span>    Rid: <span style="color:#ff9f43">11</span>,
</span></span><span style="display:flex;"><span>    TeamName: <span style="color:#5af78e">&#34;ddd11&#34;</span>,
</span></span><span style="display:flex;"><span>    Member: <span style="color:#5af78e">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  d3<span style="color:#ff6ac1">:=</span>Detail{
</span></span><span style="display:flex;"><span>    Rid: <span style="color:#ff9f43">12</span>,
</span></span><span style="display:flex;"><span>    TeamName: <span style="color:#5af78e">&#34;ddd12&#34;</span>,
</span></span><span style="display:flex;"><span>    Member: <span style="color:#5af78e">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  t1<span style="color:#ff6ac1">:=</span>TeamMember{
</span></span><span style="display:flex;"><span>    Rid: <span style="color:#ff9f43">10</span>,
</span></span><span style="display:flex;"><span>    Member: <span style="color:#5af78e">&#34;10çš„Member&#34;</span>,
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#ff5c57">var</span> ds []Detail
</span></span><span style="display:flex;"><span>  ds = <span style="color:#ff5c57">append</span>(ds,d1,d2,d3)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff5c57">var</span> ts []TeamMember
</span></span><span style="display:flex;"><span>  ts = <span style="color:#ff5c57">append</span>(ts, t1)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  fmt.<span style="color:#57c7ff">Println</span>(ts)
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  fmt.<span style="color:#57c7ff">Println</span>(ds)
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">for</span> i <span style="color:#ff6ac1">:=</span> <span style="color:#ff9f43">0</span>; i &lt; <span style="color:#ff5c57">len</span>(ds); i<span style="color:#ff6ac1">++</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#ff6ac1">for</span> j <span style="color:#ff6ac1">:=</span> <span style="color:#ff9f43">0</span>; j &lt; <span style="color:#ff5c57">len</span>(ts); j<span style="color:#ff6ac1">++</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#ff6ac1">if</span> ds[i].Rid <span style="color:#ff6ac1">==</span> ts[j].Rid {
</span></span><span style="display:flex;"><span>				ds[i].Member = ts[j].Member
</span></span><span style="display:flex;"><span>				<span style="color:#ff6ac1">break</span>
</span></span><span style="display:flex;"><span>			}
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#78787e">// ==== ?? ====
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>    
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">for</span> _, v <span style="color:#ff6ac1">:=</span> <span style="color:#ff6ac1">range</span> ds {
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">for</span> _, v2 <span style="color:#ff6ac1">:=</span> <span style="color:#ff6ac1">range</span> ts {
</span></span><span style="display:flex;"><span>            <span style="color:#ff6ac1">if</span> v.Rid <span style="color:#ff6ac1">==</span> v2.Rid {
</span></span><span style="display:flex;"><span>                v.member = v2.menber
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  fmt.<span style="color:#57c7ff">Println</span>(ts)
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  fmt.<span style="color:#57c7ff">Println</span>(ds)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div>

        </div>
        <div class="post-reward">
            <div style="padding: 0 0 0 0; margin: 0 0 0 0; width: 100%; font-size:16px; text-align: center;">
                <div id="QR" style="opacity: 0;">
                    <div id="wechat" style="display: inline-block">
                        <a class="fancybox" rel="group">
                            <img id="wechat_qr" src="https://Bin-lin-rgb.github.io/img/wechat_pay.png" alt="wechat_pay"></a>
                        <p>å¾®ä¿¡</p>
                    </div>
                    <div id="alipay" style="display: inline-block">
                        <a class="fancybox" rel="group">
                            <img id="alipay_qr" src="https://Bin-lin-rgb.github.io/img/alipay.png" alt="alipay"></a>
                        <p>æ”¯ä»˜å®</p>
                    </div>
                </div>
                <button id="rewardButton"
                        onclick="
                    var qr = document.getElementById('QR');
                    if (qr.style.opacity === '0') {
                        qr.style.opacity='1';
                    } else {
                        qr.style.opacity='0'
                    }"
                >
                    <span>ğŸ§§ é¼“åŠ±</span>
                </button>
            </div>
        </div>

        <footer class="post-footer">
            
<nav class="paginav">
  <a class="next" href="https://Bin-lin-rgb.github.io/posts/basics/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80%E7%AF%87/">
    <span class="title">ä¸‹ä¸€é¡µ Â»</span>
    <br>
    <span>è®¡ç®—æœºç½‘ç»œä¹‹åŸºç¡€ç¯‡</span>
  </a>
</nav>

        </footer>
    </div>

<style>
    .comments_details summary::marker {
        font-size: 20px;
        content: 'ğŸ‘‰å±•å¼€è¯„è®º';
        color: var(--content);
    }
    .comments_details[open] summary::marker{
        font-size: 20px;
        content: 'ğŸ‘‡å…³é—­è¯„è®º';
        color: var(--content);
    }
</style>


<div>
    <details class="comments_details">
        <summary style="cursor: pointer; margin: 50px 0 20px 0;width: 130px;">
            <span style="font-size: 20px;color: var(--content);">...</span>
        </summary>
        <div id="tcomment"></div>
    </details>
    <script src="https://cdn.staticfile.org/twikoo/1.5.8/twikoo.all.min.js">
    </script>
    <script>
        twikoo.init({
            envId: 'https://twikoo-api-nine-silk.vercel.app/',
            el: "#tcomment",
            lang: 'zh-CN',
            region: 'ap-guangzhou',
            path: window.TWIKOO_MAGIC_PATH||window.location.pathname,
        })
    
    
    
    
    
    
    
    </script>
</div>
</article>
</main>

<footer class="footer">
    <span>
        Copyright
        &copy;
        2021-2023
        <a href="https://Bin-lin-rgb.github.io/" style="color:#939393;">Blaine&#39;s Blog</a>
        All Rights Reserved
    </span>
    <a href="https://beian.miit.gov.cn/" target="_blank" style="color:#939393;">å¤‡æ¡ˆå·</a>&nbsp;
    <span>
        <a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=null"
           style="display:inline-block;text-decoration:none;height:20px;color:#939393;">
            <img src="%e5%85%ac%e5%ae%89%e5%9b%be%e6%a0%87%e9%93%be%e6%8e%a5" style="float:left;margin: 0px 5px 0px 0px;"/>
            å…¬ç½‘å®‰å¤‡
        </a>
    </span>
    <span id="busuanzi_container">
        <span class="fa fa-user"></span> <span id="busuanzi_value_site_uv"></span>
        <span class="fa fa-eye"></span> <span id="busuanzi_value_site_pv"></span>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <span class="topInner">
        <svg class="topSvg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
            <path d="M12 6H0l6-6z"/>
        </svg>
        <span id="read_progress"></span>
    </span>
</a>

<script>
    document.addEventListener('scroll', function (e) {
        const readProgress = document.getElementById("read_progress");
        const scrollHeight = document.documentElement.scrollHeight;
        const clientHeight = document.documentElement.clientHeight;
        const scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
        readProgress.innerText = ((scrollTop / (scrollHeight - clientHeight)).toFixed(2) * 100).toFixed(0);
    })
</script>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });
</script>
<script>
    let mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 200 || document.documentElement.scrollTop > 200) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };
</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        (function() {
            document.cookie = "change-themes" + "="+ escape ("false");
        })()

        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    });
</script>

<script>
    document.body.addEventListener('copy', function (e) {
        if (window.getSelection().toString() && window.getSelection().toString().length > 50) {
            let clipboardData = e.clipboardData || window.clipboardData;
            if (clipboardData) {
                e.preventDefault();
                let htmlData = window.getSelection().toString() +
                    '\r\n\nâ€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\r\n' +
                    'ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºã€Œ'+"Blaine's Blog"+'ã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚' +
                '\r\nåŸæ–‡é“¾æ¥ï¼š' + location.href;
                let textData = window.getSelection().toString() +
                    '\r\n\nâ€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\r\n' +
                    'ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºã€Œ'+"Blaine's Blog"+'ã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚' +
                '\r\nåŸæ–‡é“¾æ¥ï¼š' + location.href;
                clipboardData.setData('text/html', htmlData);
                clipboardData.setData('text/plain', textData);
            }
        }
    });
</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;
        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerText = 'å¤åˆ¶';

        function copyingDone() {
            copybutton.innerText = 'å·²å¤åˆ¶ï¼';
            setTimeout(() => {
                copybutton.innerText = 'å¤åˆ¶';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                let text = codeblock.textContent +
                    '\r\nâ€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\r\n' +
                    'ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºã€Œ'+"Blaine's Blog"+'ã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚' +
                '\r\nåŸæ–‡é“¾æ¥ï¼š' + location.href;
                navigator.clipboard.writeText(text);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) {}
            selection.removeRange(range);
        });

        let language = codeblock.className.replaceAll("language-", "")
        let macTool = document.createElement("div")
        let macTool1 = document.createElement("div")
        let macTool2 = document.createElement("div")
        let macTool3 = document.createElement("div")
        let languageType = document.createElement("div")
        languageType.innerText = language
        macTool.setAttribute('class', 'mac-tool')
        macTool1.setAttribute('class', 'mac bb1')
        macTool2.setAttribute('class', 'mac bb2')
        macTool3.setAttribute('class', 'mac bb3')
        languageType.setAttribute('class', 'language-type')
        macTool.appendChild(macTool1)
        macTool.appendChild(macTool2)
        macTool.appendChild(macTool3)
        macTool.appendChild(languageType)

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
            container.appendChild(macTool)
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
            container.appendChild(macTool)
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
            container.appendChild(macTool)
        }
    });
</script>
</body>

</html>
